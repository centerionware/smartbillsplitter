var xm=Object.defineProperty;var gm=(e,t,r)=>t in e?xm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ba=(e,t,r)=>gm(e,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}})();function vm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var vd={exports:{}},$n={},wd={exports:{}},re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ka=Symbol.for("react.element"),wm=Symbol.for("react.portal"),ym=Symbol.for("react.fragment"),bm=Symbol.for("react.strict_mode"),km=Symbol.for("react.profiler"),jm=Symbol.for("react.provider"),Nm=Symbol.for("react.context"),Sm=Symbol.for("react.forward_ref"),Cm=Symbol.for("react.suspense"),Im=Symbol.for("react.memo"),Dm=Symbol.for("react.lazy"),Ki=Symbol.iterator;function Em(e){return e===null||typeof e!="object"?null:(e=Ki&&e[Ki]||e["@@iterator"],typeof e=="function"?e:null)}var yd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bd=Object.assign,kd={};function Is(e,t,r){this.props=e,this.context=t,this.refs=kd,this.updater=r||yd}Is.prototype.isReactComponent={};Is.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Is.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function jd(){}jd.prototype=Is.prototype;function Ho(e,t,r){this.props=e,this.context=t,this.refs=kd,this.updater=r||yd}var Wo=Ho.prototype=new jd;Wo.constructor=Ho;bd(Wo,Is.prototype);Wo.isPureReactComponent=!0;var Gi=Array.isArray,Nd=Object.prototype.hasOwnProperty,Ko={current:null},Sd={key:!0,ref:!0,__self:!0,__source:!0};function Cd(e,t,r){var a,n={},l=null,o=null;if(t!=null)for(a in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(l=""+t.key),t)Nd.call(t,a)&&!Sd.hasOwnProperty(a)&&(n[a]=t[a]);var i=arguments.length-2;if(i===1)n.children=r;else if(1<i){for(var c=Array(i),d=0;d<i;d++)c[d]=arguments[d+2];n.children=c}if(e&&e.defaultProps)for(a in i=e.defaultProps,i)n[a]===void 0&&(n[a]=i[a]);return{$$typeof:ka,type:e,key:l,ref:o,props:n,_owner:Ko.current}}function Mm(e,t){return{$$typeof:ka,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Go(e){return typeof e=="object"&&e!==null&&e.$$typeof===ka}function Tm(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var Yi=/\/+/g;function ol(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Tm(""+e.key):t.toString(36)}function en(e,t,r,a,n){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(l){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case ka:case wm:o=!0}}if(o)return o=e,n=n(o),e=a===""?"."+ol(o,0):a,Gi(n)?(r="",e!=null&&(r=e.replace(Yi,"$&/")+"/"),en(n,t,r,"",function(d){return d})):n!=null&&(Go(n)&&(n=Mm(n,r+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(Yi,"$&/")+"/")+e)),t.push(n)),1;if(o=0,a=a===""?".":a+":",Gi(e))for(var i=0;i<e.length;i++){l=e[i];var c=a+ol(l,i);o+=en(l,t,r,c,n)}else if(c=Em(e),typeof c=="function")for(e=c.call(e),i=0;!(l=e.next()).done;)l=l.value,c=a+ol(l,i++),o+=en(l,t,r,c,n);else if(l==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function La(e,t,r){if(e==null)return e;var a=[],n=0;return en(e,a,"","",function(l){return t.call(r,l,n++)}),a}function Pm(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var $e={current:null},tn={transition:null},Bm={ReactCurrentDispatcher:$e,ReactCurrentBatchConfig:tn,ReactCurrentOwner:Ko};function Id(){throw Error("act(...) is not supported in production builds of React.")}re.Children={map:La,forEach:function(e,t,r){La(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return La(e,function(){t++}),t},toArray:function(e){return La(e,function(t){return t})||[]},only:function(e){if(!Go(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};re.Component=Is;re.Fragment=ym;re.Profiler=km;re.PureComponent=Ho;re.StrictMode=bm;re.Suspense=Cm;re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bm;re.act=Id;re.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=bd({},e.props),n=e.key,l=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(l=t.ref,o=Ko.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in t)Nd.call(t,c)&&!Sd.hasOwnProperty(c)&&(a[c]=t[c]===void 0&&i!==void 0?i[c]:t[c])}var c=arguments.length-2;if(c===1)a.children=r;else if(1<c){i=Array(c);for(var d=0;d<c;d++)i[d]=arguments[d+2];a.children=i}return{$$typeof:ka,type:e.type,key:n,ref:l,props:a,_owner:o}};re.createContext=function(e){return e={$$typeof:Nm,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:jm,_context:e},e.Consumer=e};re.createElement=Cd;re.createFactory=function(e){var t=Cd.bind(null,e);return t.type=e,t};re.createRef=function(){return{current:null}};re.forwardRef=function(e){return{$$typeof:Sm,render:e}};re.isValidElement=Go;re.lazy=function(e){return{$$typeof:Dm,_payload:{_status:-1,_result:e},_init:Pm}};re.memo=function(e,t){return{$$typeof:Im,type:e,compare:t===void 0?null:t}};re.startTransition=function(e){var t=tn.transition;tn.transition={};try{e()}finally{tn.transition=t}};re.unstable_act=Id;re.useCallback=function(e,t){return $e.current.useCallback(e,t)};re.useContext=function(e){return $e.current.useContext(e)};re.useDebugValue=function(){};re.useDeferredValue=function(e){return $e.current.useDeferredValue(e)};re.useEffect=function(e,t){return $e.current.useEffect(e,t)};re.useId=function(){return $e.current.useId()};re.useImperativeHandle=function(e,t,r){return $e.current.useImperativeHandle(e,t,r)};re.useInsertionEffect=function(e,t){return $e.current.useInsertionEffect(e,t)};re.useLayoutEffect=function(e,t){return $e.current.useLayoutEffect(e,t)};re.useMemo=function(e,t){return $e.current.useMemo(e,t)};re.useReducer=function(e,t,r){return $e.current.useReducer(e,t,r)};re.useRef=function(e){return $e.current.useRef(e)};re.useState=function(e){return $e.current.useState(e)};re.useSyncExternalStore=function(e,t,r){return $e.current.useSyncExternalStore(e,t,r)};re.useTransition=function(){return $e.current.useTransition()};re.version="18.3.1";wd.exports=re;var p=wd.exports;const _n=vm(p);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lm=p,Rm=Symbol.for("react.element"),Am=Symbol.for("react.fragment"),Om=Object.prototype.hasOwnProperty,zm=Lm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$m={key:!0,ref:!0,__self:!0,__source:!0};function Dd(e,t,r){var a,n={},l=null,o=null;r!==void 0&&(l=""+r),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(o=t.ref);for(a in t)Om.call(t,a)&&!$m.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps,t)n[a]===void 0&&(n[a]=t[a]);return{$$typeof:Rm,type:e,key:l,ref:o,props:n,_owner:zm.current}}$n.Fragment=Am;$n.jsx=Dd;$n.jsxs=Dd;vd.exports=$n;var s=vd.exports,_l={},Ed={exports:{}},rt={},Md={exports:{}},Td={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(E,T){var M=E.length;E.push(T);e:for(;0<M;){var R=M-1>>>1,$=E[R];if(0<n($,T))E[R]=T,E[M]=$,M=R;else break e}}function r(E){return E.length===0?null:E[0]}function a(E){if(E.length===0)return null;var T=E[0],M=E.pop();if(M!==T){E[0]=M;e:for(var R=0,$=E.length,G=$>>>1;R<G;){var V=2*(R+1)-1,oe=E[V],fe=V+1,Je=E[fe];if(0>n(oe,M))fe<$&&0>n(Je,oe)?(E[R]=Je,E[fe]=M,R=fe):(E[R]=oe,E[V]=M,R=V);else if(fe<$&&0>n(Je,M))E[R]=Je,E[fe]=M,R=fe;else break e}}return T}function n(E,T){var M=E.sortIndex-T.sortIndex;return M!==0?M:E.id-T.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var o=Date,i=o.now();e.unstable_now=function(){return o.now()-i}}var c=[],d=[],h=1,m=null,u=3,f=!1,g=!1,w=!1,j=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(E){for(var T=r(d);T!==null;){if(T.callback===null)a(d);else if(T.startTime<=E)a(d),T.sortIndex=T.expirationTime,t(c,T);else break;T=r(d)}}function y(E){if(w=!1,b(E),!g)if(r(c)!==null)g=!0,K(k);else{var T=r(d);T!==null&&L(y,T.startTime-E)}}function k(E,T){g=!1,w&&(w=!1,x(D),D=-1),f=!0;var M=u;try{for(b(T),m=r(c);m!==null&&(!(m.expirationTime>T)||E&&!P());){var R=m.callback;if(typeof R=="function"){m.callback=null,u=m.priorityLevel;var $=R(m.expirationTime<=T);T=e.unstable_now(),typeof $=="function"?m.callback=$:m===r(c)&&a(c),b(T)}else a(c);m=r(c)}if(m!==null)var G=!0;else{var V=r(d);V!==null&&L(y,V.startTime-T),G=!1}return G}finally{m=null,u=M,f=!1}}var N=!1,S=null,D=-1,I=5,C=-1;function P(){return!(e.unstable_now()-C<I)}function A(){if(S!==null){var E=e.unstable_now();C=E;var T=!0;try{T=S(!0,E)}finally{T?z():(N=!1,S=null)}}else N=!1}var z;if(typeof v=="function")z=function(){v(A)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,ee=U.port2;U.port1.onmessage=A,z=function(){ee.postMessage(null)}}else z=function(){j(A,0)};function K(E){S=E,N||(N=!0,z())}function L(E,T){D=j(function(){E(e.unstable_now())},T)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(E){E.callback=null},e.unstable_continueExecution=function(){g||f||(g=!0,K(k))},e.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<E?Math.floor(1e3/E):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(E){switch(u){case 1:case 2:case 3:var T=3;break;default:T=u}var M=u;u=T;try{return E()}finally{u=M}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(E,T){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var M=u;u=E;try{return T()}finally{u=M}},e.unstable_scheduleCallback=function(E,T,M){var R=e.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?R+M:R):M=R,E){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=M+$,E={id:h++,callback:T,priorityLevel:E,startTime:M,expirationTime:$,sortIndex:-1},M>R?(E.sortIndex=M,t(d,E),r(c)===null&&E===r(d)&&(w?(x(D),D=-1):w=!0,L(y,M-R))):(E.sortIndex=$,t(c,E),g||f||(g=!0,K(k))),E},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(E){var T=u;return function(){var M=u;u=T;try{return E.apply(this,arguments)}finally{u=M}}}})(Td);Md.exports=Td;var _m=Md.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fm=p,tt=_m;function B(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Pd=new Set,aa={};function $r(e,t){gs(e,t),gs(e+"Capture",t)}function gs(e,t){for(aa[e]=t,e=0;e<t.length;e++)Pd.add(t[e])}var At=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fl=Object.prototype.hasOwnProperty,Um=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ji={},Qi={};function Vm(e){return Fl.call(Qi,e)?!0:Fl.call(Ji,e)?!1:Um.test(e)?Qi[e]=!0:(Ji[e]=!0,!1)}function Hm(e,t,r,a){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return a?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Wm(e,t,r,a){if(t===null||typeof t>"u"||Hm(e,t,r,a))return!0;if(a)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function _e(e,t,r,a,n,l,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=a,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=l,this.removeEmptyString=o}var Te={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Te[e]=new _e(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Te[t]=new _e(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Te[e]=new _e(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Te[e]=new _e(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Te[e]=new _e(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Te[e]=new _e(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Te[e]=new _e(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Te[e]=new _e(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Te[e]=new _e(e,5,!1,e.toLowerCase(),null,!1,!1)});var Yo=/[\-:]([a-z])/g;function Jo(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Yo,Jo);Te[t]=new _e(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Yo,Jo);Te[t]=new _e(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Yo,Jo);Te[t]=new _e(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Te[e]=new _e(e,1,!1,e.toLowerCase(),null,!1,!1)});Te.xlinkHref=new _e("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Te[e]=new _e(e,1,!1,e.toLowerCase(),null,!0,!0)});function Qo(e,t,r,a){var n=Te.hasOwnProperty(t)?Te[t]:null;(n!==null?n.type!==0:a||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Wm(t,r,n,a)&&(r=null),a||n===null?Vm(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=r===null?n.type===3?!1:"":r:(t=n.attributeName,a=n.attributeNamespace,r===null?e.removeAttribute(t):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,a?e.setAttributeNS(a,t,r):e.setAttribute(t,r))))}var _t=Fm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ra=Symbol.for("react.element"),Qr=Symbol.for("react.portal"),Xr=Symbol.for("react.fragment"),Xo=Symbol.for("react.strict_mode"),Ul=Symbol.for("react.profiler"),Bd=Symbol.for("react.provider"),Ld=Symbol.for("react.context"),qo=Symbol.for("react.forward_ref"),Vl=Symbol.for("react.suspense"),Hl=Symbol.for("react.suspense_list"),Zo=Symbol.for("react.memo"),Gt=Symbol.for("react.lazy"),Rd=Symbol.for("react.offscreen"),Xi=Symbol.iterator;function Ls(e){return e===null||typeof e!="object"?null:(e=Xi&&e[Xi]||e["@@iterator"],typeof e=="function"?e:null)}var ge=Object.assign,il;function Ws(e){if(il===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);il=t&&t[1]||""}return`
`+il+e}var cl=!1;function dl(e,t){if(!e||cl)return"";cl=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var a=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){a=d}e.call(t.prototype)}else{try{throw Error()}catch(d){a=d}e()}}catch(d){if(d&&a&&typeof d.stack=="string"){for(var n=d.stack.split(`
`),l=a.stack.split(`
`),o=n.length-1,i=l.length-1;1<=o&&0<=i&&n[o]!==l[i];)i--;for(;1<=o&&0<=i;o--,i--)if(n[o]!==l[i]){if(o!==1||i!==1)do if(o--,i--,0>i||n[o]!==l[i]){var c=`
`+n[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=i);break}}}finally{cl=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Ws(e):""}function Km(e){switch(e.tag){case 5:return Ws(e.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 2:case 15:return e=dl(e.type,!1),e;case 11:return e=dl(e.type.render,!1),e;case 1:return e=dl(e.type,!0),e;default:return""}}function Wl(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Xr:return"Fragment";case Qr:return"Portal";case Ul:return"Profiler";case Xo:return"StrictMode";case Vl:return"Suspense";case Hl:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ld:return(e.displayName||"Context")+".Consumer";case Bd:return(e._context.displayName||"Context")+".Provider";case qo:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Zo:return t=e.displayName||null,t!==null?t:Wl(e.type)||"Memo";case Gt:t=e._payload,e=e._init;try{return Wl(e(t))}catch{}}return null}function Gm(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Wl(t);case 8:return t===Xo?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ir(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ad(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ym(e){var t=Ad(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,l=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(o){a=""+o,l.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(o){a=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Aa(e){e._valueTracker||(e._valueTracker=Ym(e))}function Od(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),a="";return e&&(a=Ad(e)?e.checked?"true":"false":e.value),e=a,e!==r?(t.setValue(e),!0):!1}function pn(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Kl(e,t){var r=t.checked;return ge({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function qi(e,t){var r=t.defaultValue==null?"":t.defaultValue,a=t.checked!=null?t.checked:t.defaultChecked;r=ir(t.value!=null?t.value:r),e._wrapperState={initialChecked:a,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function zd(e,t){t=t.checked,t!=null&&Qo(e,"checked",t,!1)}function Gl(e,t){zd(e,t);var r=ir(t.value),a=t.type;if(r!=null)a==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Yl(e,t.type,r):t.hasOwnProperty("defaultValue")&&Yl(e,t.type,ir(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Zi(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!(a!=="submit"&&a!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Yl(e,t,r){(t!=="number"||pn(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Ks=Array.isArray;function is(e,t,r,a){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&a&&(e[r].defaultSelected=!0)}else{for(r=""+ir(r),t=null,n=0;n<e.length;n++){if(e[n].value===r){e[n].selected=!0,a&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function Jl(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(B(91));return ge({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ec(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(B(92));if(Ks(r)){if(1<r.length)throw Error(B(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:ir(r)}}function $d(e,t){var r=ir(t.value),a=ir(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),a!=null&&(e.defaultValue=""+a)}function tc(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function _d(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ql(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?_d(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Oa,Fd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,a,n){MSApp.execUnsafeLocalFunction(function(){return e(t,r,a,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Oa=Oa||document.createElement("div"),Oa.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Oa.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function na(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Js={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Jm=["Webkit","ms","Moz","O"];Object.keys(Js).forEach(function(e){Jm.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Js[t]=Js[e]})});function Ud(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Js.hasOwnProperty(e)&&Js[e]?(""+t).trim():t+"px"}function Vd(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var a=r.indexOf("--")===0,n=Ud(r,t[r],a);r==="float"&&(r="cssFloat"),a?e.setProperty(r,n):e[r]=n}}var Qm=ge({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xl(e,t){if(t){if(Qm[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(B(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(B(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(B(61))}if(t.style!=null&&typeof t.style!="object")throw Error(B(62))}}function ql(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zl=null;function ei(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var eo=null,cs=null,ds=null;function rc(e){if(e=Sa(e)){if(typeof eo!="function")throw Error(B(280));var t=e.stateNode;t&&(t=Wn(t),eo(e.stateNode,e.type,t))}}function Hd(e){cs?ds?ds.push(e):ds=[e]:cs=e}function Wd(){if(cs){var e=cs,t=ds;if(ds=cs=null,rc(e),t)for(e=0;e<t.length;e++)rc(t[e])}}function Kd(e,t){return e(t)}function Gd(){}var ul=!1;function Yd(e,t,r){if(ul)return e(t,r);ul=!0;try{return Kd(e,t,r)}finally{ul=!1,(cs!==null||ds!==null)&&(Gd(),Wd())}}function la(e,t){var r=e.stateNode;if(r===null)return null;var a=Wn(r);if(a===null)return null;r=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(B(231,t,typeof r));return r}var to=!1;if(At)try{var Rs={};Object.defineProperty(Rs,"passive",{get:function(){to=!0}}),window.addEventListener("test",Rs,Rs),window.removeEventListener("test",Rs,Rs)}catch{to=!1}function Xm(e,t,r,a,n,l,o,i,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(r,d)}catch(h){this.onError(h)}}var Qs=!1,xn=null,gn=!1,ro=null,qm={onError:function(e){Qs=!0,xn=e}};function Zm(e,t,r,a,n,l,o,i,c){Qs=!1,xn=null,Xm.apply(qm,arguments)}function ef(e,t,r,a,n,l,o,i,c){if(Zm.apply(this,arguments),Qs){if(Qs){var d=xn;Qs=!1,xn=null}else throw Error(B(198));gn||(gn=!0,ro=d)}}function _r(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Jd(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function sc(e){if(_r(e)!==e)throw Error(B(188))}function tf(e){var t=e.alternate;if(!t){if(t=_r(e),t===null)throw Error(B(188));return t!==e?null:e}for(var r=e,a=t;;){var n=r.return;if(n===null)break;var l=n.alternate;if(l===null){if(a=n.return,a!==null){r=a;continue}break}if(n.child===l.child){for(l=n.child;l;){if(l===r)return sc(n),e;if(l===a)return sc(n),t;l=l.sibling}throw Error(B(188))}if(r.return!==a.return)r=n,a=l;else{for(var o=!1,i=n.child;i;){if(i===r){o=!0,r=n,a=l;break}if(i===a){o=!0,a=n,r=l;break}i=i.sibling}if(!o){for(i=l.child;i;){if(i===r){o=!0,r=l,a=n;break}if(i===a){o=!0,a=l,r=n;break}i=i.sibling}if(!o)throw Error(B(189))}}if(r.alternate!==a)throw Error(B(190))}if(r.tag!==3)throw Error(B(188));return r.stateNode.current===r?e:t}function Qd(e){return e=tf(e),e!==null?Xd(e):null}function Xd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Xd(e);if(t!==null)return t;e=e.sibling}return null}var qd=tt.unstable_scheduleCallback,ac=tt.unstable_cancelCallback,rf=tt.unstable_shouldYield,sf=tt.unstable_requestPaint,ye=tt.unstable_now,af=tt.unstable_getCurrentPriorityLevel,ti=tt.unstable_ImmediatePriority,Zd=tt.unstable_UserBlockingPriority,vn=tt.unstable_NormalPriority,nf=tt.unstable_LowPriority,eu=tt.unstable_IdlePriority,Fn=null,Dt=null;function lf(e){if(Dt&&typeof Dt.onCommitFiberRoot=="function")try{Dt.onCommitFiberRoot(Fn,e,void 0,(e.current.flags&128)===128)}catch{}}var vt=Math.clz32?Math.clz32:df,of=Math.log,cf=Math.LN2;function df(e){return e>>>=0,e===0?32:31-(of(e)/cf|0)|0}var za=64,$a=4194304;function Gs(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function wn(e,t){var r=e.pendingLanes;if(r===0)return 0;var a=0,n=e.suspendedLanes,l=e.pingedLanes,o=r&268435455;if(o!==0){var i=o&~n;i!==0?a=Gs(i):(l&=o,l!==0&&(a=Gs(l)))}else o=r&~n,o!==0?a=Gs(o):l!==0&&(a=Gs(l));if(a===0)return 0;if(t!==0&&t!==a&&!(t&n)&&(n=a&-a,l=t&-t,n>=l||n===16&&(l&4194240)!==0))return t;if(a&4&&(a|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=a;0<t;)r=31-vt(t),n=1<<r,a|=e[r],t&=~n;return a}function uf(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mf(e,t){for(var r=e.suspendedLanes,a=e.pingedLanes,n=e.expirationTimes,l=e.pendingLanes;0<l;){var o=31-vt(l),i=1<<o,c=n[o];c===-1?(!(i&r)||i&a)&&(n[o]=uf(i,t)):c<=t&&(e.expiredLanes|=i),l&=~i}}function so(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function tu(){var e=za;return za<<=1,!(za&4194240)&&(za=64),e}function ml(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function ja(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-vt(t),e[t]=r}function ff(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-vt(r),l=1<<n;t[n]=0,a[n]=-1,e[n]=-1,r&=~l}}function ri(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var a=31-vt(r),n=1<<a;n&t|e[a]&t&&(e[a]|=t),r&=~n}}var ne=0;function ru(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var su,si,au,nu,lu,ao=!1,_a=[],Zt=null,er=null,tr=null,oa=new Map,ia=new Map,Jt=[],hf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nc(e,t){switch(e){case"focusin":case"focusout":Zt=null;break;case"dragenter":case"dragleave":er=null;break;case"mouseover":case"mouseout":tr=null;break;case"pointerover":case"pointerout":oa.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ia.delete(t.pointerId)}}function As(e,t,r,a,n,l){return e===null||e.nativeEvent!==l?(e={blockedOn:t,domEventName:r,eventSystemFlags:a,nativeEvent:l,targetContainers:[n]},t!==null&&(t=Sa(t),t!==null&&si(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function pf(e,t,r,a,n){switch(t){case"focusin":return Zt=As(Zt,e,t,r,a,n),!0;case"dragenter":return er=As(er,e,t,r,a,n),!0;case"mouseover":return tr=As(tr,e,t,r,a,n),!0;case"pointerover":var l=n.pointerId;return oa.set(l,As(oa.get(l)||null,e,t,r,a,n)),!0;case"gotpointercapture":return l=n.pointerId,ia.set(l,As(ia.get(l)||null,e,t,r,a,n)),!0}return!1}function ou(e){var t=Cr(e.target);if(t!==null){var r=_r(t);if(r!==null){if(t=r.tag,t===13){if(t=Jd(r),t!==null){e.blockedOn=t,lu(e.priority,function(){au(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function rn(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=no(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var a=new r.constructor(r.type,r);Zl=a,r.target.dispatchEvent(a),Zl=null}else return t=Sa(r),t!==null&&si(t),e.blockedOn=r,!1;t.shift()}return!0}function lc(e,t,r){rn(e)&&r.delete(t)}function xf(){ao=!1,Zt!==null&&rn(Zt)&&(Zt=null),er!==null&&rn(er)&&(er=null),tr!==null&&rn(tr)&&(tr=null),oa.forEach(lc),ia.forEach(lc)}function Os(e,t){e.blockedOn===t&&(e.blockedOn=null,ao||(ao=!0,tt.unstable_scheduleCallback(tt.unstable_NormalPriority,xf)))}function ca(e){function t(n){return Os(n,e)}if(0<_a.length){Os(_a[0],e);for(var r=1;r<_a.length;r++){var a=_a[r];a.blockedOn===e&&(a.blockedOn=null)}}for(Zt!==null&&Os(Zt,e),er!==null&&Os(er,e),tr!==null&&Os(tr,e),oa.forEach(t),ia.forEach(t),r=0;r<Jt.length;r++)a=Jt[r],a.blockedOn===e&&(a.blockedOn=null);for(;0<Jt.length&&(r=Jt[0],r.blockedOn===null);)ou(r),r.blockedOn===null&&Jt.shift()}var us=_t.ReactCurrentBatchConfig,yn=!0;function gf(e,t,r,a){var n=ne,l=us.transition;us.transition=null;try{ne=1,ai(e,t,r,a)}finally{ne=n,us.transition=l}}function vf(e,t,r,a){var n=ne,l=us.transition;us.transition=null;try{ne=4,ai(e,t,r,a)}finally{ne=n,us.transition=l}}function ai(e,t,r,a){if(yn){var n=no(e,t,r,a);if(n===null)kl(e,t,a,bn,r),nc(e,a);else if(pf(n,e,t,r,a))a.stopPropagation();else if(nc(e,a),t&4&&-1<hf.indexOf(e)){for(;n!==null;){var l=Sa(n);if(l!==null&&su(l),l=no(e,t,r,a),l===null&&kl(e,t,a,bn,r),l===n)break;n=l}n!==null&&a.stopPropagation()}else kl(e,t,a,null,r)}}var bn=null;function no(e,t,r,a){if(bn=null,e=ei(a),e=Cr(e),e!==null)if(t=_r(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Jd(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return bn=e,null}function iu(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(af()){case ti:return 1;case Zd:return 4;case vn:case nf:return 16;case eu:return 536870912;default:return 16}default:return 16}}var Xt=null,ni=null,sn=null;function cu(){if(sn)return sn;var e,t=ni,r=t.length,a,n="value"in Xt?Xt.value:Xt.textContent,l=n.length;for(e=0;e<r&&t[e]===n[e];e++);var o=r-e;for(a=1;a<=o&&t[r-a]===n[l-a];a++);return sn=n.slice(e,1<a?1-a:void 0)}function an(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Fa(){return!0}function oc(){return!1}function st(e){function t(r,a,n,l,o){this._reactName=r,this._targetInst=n,this.type=a,this.nativeEvent=l,this.target=o,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(r=e[i],this[i]=r?r(l):l[i]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?Fa:oc,this.isPropagationStopped=oc,this}return ge(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Fa)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Fa)},persist:function(){},isPersistent:Fa}),t}var Ds={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},li=st(Ds),Na=ge({},Ds,{view:0,detail:0}),wf=st(Na),fl,hl,zs,Un=ge({},Na,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:oi,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==zs&&(zs&&e.type==="mousemove"?(fl=e.screenX-zs.screenX,hl=e.screenY-zs.screenY):hl=fl=0,zs=e),fl)},movementY:function(e){return"movementY"in e?e.movementY:hl}}),ic=st(Un),yf=ge({},Un,{dataTransfer:0}),bf=st(yf),kf=ge({},Na,{relatedTarget:0}),pl=st(kf),jf=ge({},Ds,{animationName:0,elapsedTime:0,pseudoElement:0}),Nf=st(jf),Sf=ge({},Ds,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Cf=st(Sf),If=ge({},Ds,{data:0}),cc=st(If),Df={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ef={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tf(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Mf[e])?!!t[e]:!1}function oi(){return Tf}var Pf=ge({},Na,{key:function(e){if(e.key){var t=Df[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=an(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Ef[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:oi,charCode:function(e){return e.type==="keypress"?an(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?an(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Bf=st(Pf),Lf=ge({},Un,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dc=st(Lf),Rf=ge({},Na,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:oi}),Af=st(Rf),Of=ge({},Ds,{propertyName:0,elapsedTime:0,pseudoElement:0}),zf=st(Of),$f=ge({},Un,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_f=st($f),Ff=[9,13,27,32],ii=At&&"CompositionEvent"in window,Xs=null;At&&"documentMode"in document&&(Xs=document.documentMode);var Uf=At&&"TextEvent"in window&&!Xs,du=At&&(!ii||Xs&&8<Xs&&11>=Xs),uc=" ",mc=!1;function uu(e,t){switch(e){case"keyup":return Ff.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var qr=!1;function Vf(e,t){switch(e){case"compositionend":return mu(t);case"keypress":return t.which!==32?null:(mc=!0,uc);case"textInput":return e=t.data,e===uc&&mc?null:e;default:return null}}function Hf(e,t){if(qr)return e==="compositionend"||!ii&&uu(e,t)?(e=cu(),sn=ni=Xt=null,qr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return du&&t.locale!=="ko"?null:t.data;default:return null}}var Wf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Wf[e.type]:t==="textarea"}function fu(e,t,r,a){Hd(a),t=kn(t,"onChange"),0<t.length&&(r=new li("onChange","change",null,r,a),e.push({event:r,listeners:t}))}var qs=null,da=null;function Kf(e){Nu(e,0)}function Vn(e){var t=ts(e);if(Od(t))return e}function Gf(e,t){if(e==="change")return t}var hu=!1;if(At){var xl;if(At){var gl="oninput"in document;if(!gl){var hc=document.createElement("div");hc.setAttribute("oninput","return;"),gl=typeof hc.oninput=="function"}xl=gl}else xl=!1;hu=xl&&(!document.documentMode||9<document.documentMode)}function pc(){qs&&(qs.detachEvent("onpropertychange",pu),da=qs=null)}function pu(e){if(e.propertyName==="value"&&Vn(da)){var t=[];fu(t,da,e,ei(e)),Yd(Kf,t)}}function Yf(e,t,r){e==="focusin"?(pc(),qs=t,da=r,qs.attachEvent("onpropertychange",pu)):e==="focusout"&&pc()}function Jf(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Vn(da)}function Qf(e,t){if(e==="click")return Vn(t)}function Xf(e,t){if(e==="input"||e==="change")return Vn(t)}function qf(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var yt=typeof Object.is=="function"?Object.is:qf;function ua(e,t){if(yt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(a=0;a<r.length;a++){var n=r[a];if(!Fl.call(t,n)||!yt(e[n],t[n]))return!1}return!0}function xc(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function gc(e,t){var r=xc(e);e=0;for(var a;r;){if(r.nodeType===3){if(a=e+r.textContent.length,e<=t&&a>=t)return{node:r,offset:t-e};e=a}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=xc(r)}}function xu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?xu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function gu(){for(var e=window,t=pn();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=pn(e.document)}return t}function ci(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Zf(e){var t=gu(),r=e.focusedElem,a=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&xu(r.ownerDocument.documentElement,r)){if(a!==null&&ci(r)){if(t=a.start,e=a.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=r.textContent.length,l=Math.min(a.start,n);a=a.end===void 0?l:Math.min(a.end,n),!e.extend&&l>a&&(n=a,a=l,l=n),n=gc(r,l);var o=gc(r,a);n&&o&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),l>a?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var eh=At&&"documentMode"in document&&11>=document.documentMode,Zr=null,lo=null,Zs=null,oo=!1;function vc(e,t,r){var a=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;oo||Zr==null||Zr!==pn(a)||(a=Zr,"selectionStart"in a&&ci(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Zs&&ua(Zs,a)||(Zs=a,a=kn(lo,"onSelect"),0<a.length&&(t=new li("onSelect","select",null,t,r),e.push({event:t,listeners:a}),t.target=Zr)))}function Ua(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var es={animationend:Ua("Animation","AnimationEnd"),animationiteration:Ua("Animation","AnimationIteration"),animationstart:Ua("Animation","AnimationStart"),transitionend:Ua("Transition","TransitionEnd")},vl={},vu={};At&&(vu=document.createElement("div").style,"AnimationEvent"in window||(delete es.animationend.animation,delete es.animationiteration.animation,delete es.animationstart.animation),"TransitionEvent"in window||delete es.transitionend.transition);function Hn(e){if(vl[e])return vl[e];if(!es[e])return e;var t=es[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in vu)return vl[e]=t[r];return e}var wu=Hn("animationend"),yu=Hn("animationiteration"),bu=Hn("animationstart"),ku=Hn("transitionend"),ju=new Map,wc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mr(e,t){ju.set(e,t),$r(t,[e])}for(var wl=0;wl<wc.length;wl++){var yl=wc[wl],th=yl.toLowerCase(),rh=yl[0].toUpperCase()+yl.slice(1);mr(th,"on"+rh)}mr(wu,"onAnimationEnd");mr(yu,"onAnimationIteration");mr(bu,"onAnimationStart");mr("dblclick","onDoubleClick");mr("focusin","onFocus");mr("focusout","onBlur");mr(ku,"onTransitionEnd");gs("onMouseEnter",["mouseout","mouseover"]);gs("onMouseLeave",["mouseout","mouseover"]);gs("onPointerEnter",["pointerout","pointerover"]);gs("onPointerLeave",["pointerout","pointerover"]);$r("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$r("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$r("onBeforeInput",["compositionend","keypress","textInput","paste"]);$r("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$r("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$r("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ys="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sh=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ys));function yc(e,t,r){var a=e.type||"unknown-event";e.currentTarget=r,ef(a,t,void 0,e),e.currentTarget=null}function Nu(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var a=e[r],n=a.event;a=a.listeners;e:{var l=void 0;if(t)for(var o=a.length-1;0<=o;o--){var i=a[o],c=i.instance,d=i.currentTarget;if(i=i.listener,c!==l&&n.isPropagationStopped())break e;yc(n,i,d),l=c}else for(o=0;o<a.length;o++){if(i=a[o],c=i.instance,d=i.currentTarget,i=i.listener,c!==l&&n.isPropagationStopped())break e;yc(n,i,d),l=c}}}if(gn)throw e=ro,gn=!1,ro=null,e}function ue(e,t){var r=t[fo];r===void 0&&(r=t[fo]=new Set);var a=e+"__bubble";r.has(a)||(Su(t,e,2,!1),r.add(a))}function bl(e,t,r){var a=0;t&&(a|=4),Su(r,e,a,t)}var Va="_reactListening"+Math.random().toString(36).slice(2);function ma(e){if(!e[Va]){e[Va]=!0,Pd.forEach(function(r){r!=="selectionchange"&&(sh.has(r)||bl(r,!1,e),bl(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Va]||(t[Va]=!0,bl("selectionchange",!1,t))}}function Su(e,t,r,a){switch(iu(t)){case 1:var n=gf;break;case 4:n=vf;break;default:n=ai}r=n.bind(null,t,r,e),n=void 0,!to||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),a?n!==void 0?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):n!==void 0?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function kl(e,t,r,a,n){var l=a;if(!(t&1)&&!(t&2)&&a!==null)e:for(;;){if(a===null)return;var o=a.tag;if(o===3||o===4){var i=a.stateNode.containerInfo;if(i===n||i.nodeType===8&&i.parentNode===n)break;if(o===4)for(o=a.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===n||c.nodeType===8&&c.parentNode===n))return;o=o.return}for(;i!==null;){if(o=Cr(i),o===null)return;if(c=o.tag,c===5||c===6){a=l=o;continue e}i=i.parentNode}}a=a.return}Yd(function(){var d=l,h=ei(r),m=[];e:{var u=ju.get(e);if(u!==void 0){var f=li,g=e;switch(e){case"keypress":if(an(r)===0)break e;case"keydown":case"keyup":f=Bf;break;case"focusin":g="focus",f=pl;break;case"focusout":g="blur",f=pl;break;case"beforeblur":case"afterblur":f=pl;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=ic;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=bf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Af;break;case wu:case yu:case bu:f=Nf;break;case ku:f=zf;break;case"scroll":f=wf;break;case"wheel":f=_f;break;case"copy":case"cut":case"paste":f=Cf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=dc}var w=(t&4)!==0,j=!w&&e==="scroll",x=w?u!==null?u+"Capture":null:u;w=[];for(var v=d,b;v!==null;){b=v;var y=b.stateNode;if(b.tag===5&&y!==null&&(b=y,x!==null&&(y=la(v,x),y!=null&&w.push(fa(v,y,b)))),j)break;v=v.return}0<w.length&&(u=new f(u,g,null,r,h),m.push({event:u,listeners:w}))}}if(!(t&7)){e:{if(u=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",u&&r!==Zl&&(g=r.relatedTarget||r.fromElement)&&(Cr(g)||g[Ot]))break e;if((f||u)&&(u=h.window===h?h:(u=h.ownerDocument)?u.defaultView||u.parentWindow:window,f?(g=r.relatedTarget||r.toElement,f=d,g=g?Cr(g):null,g!==null&&(j=_r(g),g!==j||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=d),f!==g)){if(w=ic,y="onMouseLeave",x="onMouseEnter",v="mouse",(e==="pointerout"||e==="pointerover")&&(w=dc,y="onPointerLeave",x="onPointerEnter",v="pointer"),j=f==null?u:ts(f),b=g==null?u:ts(g),u=new w(y,v+"leave",f,r,h),u.target=j,u.relatedTarget=b,y=null,Cr(h)===d&&(w=new w(x,v+"enter",g,r,h),w.target=b,w.relatedTarget=j,y=w),j=y,f&&g)t:{for(w=f,x=g,v=0,b=w;b;b=Hr(b))v++;for(b=0,y=x;y;y=Hr(y))b++;for(;0<v-b;)w=Hr(w),v--;for(;0<b-v;)x=Hr(x),b--;for(;v--;){if(w===x||x!==null&&w===x.alternate)break t;w=Hr(w),x=Hr(x)}w=null}else w=null;f!==null&&bc(m,u,f,w,!1),g!==null&&j!==null&&bc(m,j,g,w,!0)}}e:{if(u=d?ts(d):window,f=u.nodeName&&u.nodeName.toLowerCase(),f==="select"||f==="input"&&u.type==="file")var k=Gf;else if(fc(u))if(hu)k=Xf;else{k=Jf;var N=Yf}else(f=u.nodeName)&&f.toLowerCase()==="input"&&(u.type==="checkbox"||u.type==="radio")&&(k=Qf);if(k&&(k=k(e,d))){fu(m,k,r,h);break e}N&&N(e,u,d),e==="focusout"&&(N=u._wrapperState)&&N.controlled&&u.type==="number"&&Yl(u,"number",u.value)}switch(N=d?ts(d):window,e){case"focusin":(fc(N)||N.contentEditable==="true")&&(Zr=N,lo=d,Zs=null);break;case"focusout":Zs=lo=Zr=null;break;case"mousedown":oo=!0;break;case"contextmenu":case"mouseup":case"dragend":oo=!1,vc(m,r,h);break;case"selectionchange":if(eh)break;case"keydown":case"keyup":vc(m,r,h)}var S;if(ii)e:{switch(e){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else qr?uu(e,r)&&(D="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(D="onCompositionStart");D&&(du&&r.locale!=="ko"&&(qr||D!=="onCompositionStart"?D==="onCompositionEnd"&&qr&&(S=cu()):(Xt=h,ni="value"in Xt?Xt.value:Xt.textContent,qr=!0)),N=kn(d,D),0<N.length&&(D=new cc(D,e,null,r,h),m.push({event:D,listeners:N}),S?D.data=S:(S=mu(r),S!==null&&(D.data=S)))),(S=Uf?Vf(e,r):Hf(e,r))&&(d=kn(d,"onBeforeInput"),0<d.length&&(h=new cc("onBeforeInput","beforeinput",null,r,h),m.push({event:h,listeners:d}),h.data=S))}Nu(m,t)})}function fa(e,t,r){return{instance:e,listener:t,currentTarget:r}}function kn(e,t){for(var r=t+"Capture",a=[];e!==null;){var n=e,l=n.stateNode;n.tag===5&&l!==null&&(n=l,l=la(e,r),l!=null&&a.unshift(fa(e,l,n)),l=la(e,t),l!=null&&a.push(fa(e,l,n))),e=e.return}return a}function Hr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function bc(e,t,r,a,n){for(var l=t._reactName,o=[];r!==null&&r!==a;){var i=r,c=i.alternate,d=i.stateNode;if(c!==null&&c===a)break;i.tag===5&&d!==null&&(i=d,n?(c=la(r,l),c!=null&&o.unshift(fa(r,c,i))):n||(c=la(r,l),c!=null&&o.push(fa(r,c,i)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var ah=/\r\n?/g,nh=/\u0000|\uFFFD/g;function kc(e){return(typeof e=="string"?e:""+e).replace(ah,`
`).replace(nh,"")}function Ha(e,t,r){if(t=kc(t),kc(e)!==t&&r)throw Error(B(425))}function jn(){}var io=null,co=null;function uo(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var mo=typeof setTimeout=="function"?setTimeout:void 0,lh=typeof clearTimeout=="function"?clearTimeout:void 0,jc=typeof Promise=="function"?Promise:void 0,oh=typeof queueMicrotask=="function"?queueMicrotask:typeof jc<"u"?function(e){return jc.resolve(null).then(e).catch(ih)}:mo;function ih(e){setTimeout(function(){throw e})}function jl(e,t){var r=t,a=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(a===0){e.removeChild(n),ca(t);return}a--}else r!=="$"&&r!=="$?"&&r!=="$!"||a++;r=n}while(r);ca(t)}function rr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Nc(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Es=Math.random().toString(36).slice(2),It="__reactFiber$"+Es,ha="__reactProps$"+Es,Ot="__reactContainer$"+Es,fo="__reactEvents$"+Es,ch="__reactListeners$"+Es,dh="__reactHandles$"+Es;function Cr(e){var t=e[It];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ot]||r[It]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Nc(e);e!==null;){if(r=e[It])return r;e=Nc(e)}return t}e=r,r=e.parentNode}return null}function Sa(e){return e=e[It]||e[Ot],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ts(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(B(33))}function Wn(e){return e[ha]||null}var ho=[],rs=-1;function fr(e){return{current:e}}function me(e){0>rs||(e.current=ho[rs],ho[rs]=null,rs--)}function ie(e,t){rs++,ho[rs]=e.current,e.current=t}var cr={},Re=fr(cr),Ke=fr(!1),Br=cr;function vs(e,t){var r=e.type.contextTypes;if(!r)return cr;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var n={},l;for(l in r)n[l]=t[l];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Ge(e){return e=e.childContextTypes,e!=null}function Nn(){me(Ke),me(Re)}function Sc(e,t,r){if(Re.current!==cr)throw Error(B(168));ie(Re,t),ie(Ke,r)}function Cu(e,t,r){var a=e.stateNode;if(t=t.childContextTypes,typeof a.getChildContext!="function")return r;a=a.getChildContext();for(var n in a)if(!(n in t))throw Error(B(108,Gm(e)||"Unknown",n));return ge({},r,a)}function Sn(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cr,Br=Re.current,ie(Re,e),ie(Ke,Ke.current),!0}function Cc(e,t,r){var a=e.stateNode;if(!a)throw Error(B(169));r?(e=Cu(e,t,Br),a.__reactInternalMemoizedMergedChildContext=e,me(Ke),me(Re),ie(Re,e)):me(Ke),ie(Ke,r)}var Pt=null,Kn=!1,Nl=!1;function Iu(e){Pt===null?Pt=[e]:Pt.push(e)}function uh(e){Kn=!0,Iu(e)}function hr(){if(!Nl&&Pt!==null){Nl=!0;var e=0,t=ne;try{var r=Pt;for(ne=1;e<r.length;e++){var a=r[e];do a=a(!0);while(a!==null)}Pt=null,Kn=!1}catch(n){throw Pt!==null&&(Pt=Pt.slice(e+1)),qd(ti,hr),n}finally{ne=t,Nl=!1}}return null}var ss=[],as=0,Cn=null,In=0,nt=[],lt=0,Lr=null,Bt=1,Lt="";function Nr(e,t){ss[as++]=In,ss[as++]=Cn,Cn=e,In=t}function Du(e,t,r){nt[lt++]=Bt,nt[lt++]=Lt,nt[lt++]=Lr,Lr=e;var a=Bt;e=Lt;var n=32-vt(a)-1;a&=~(1<<n),r+=1;var l=32-vt(t)+n;if(30<l){var o=n-n%5;l=(a&(1<<o)-1).toString(32),a>>=o,n-=o,Bt=1<<32-vt(t)+n|r<<n|a,Lt=l+e}else Bt=1<<l|r<<n|a,Lt=e}function di(e){e.return!==null&&(Nr(e,1),Du(e,1,0))}function ui(e){for(;e===Cn;)Cn=ss[--as],ss[as]=null,In=ss[--as],ss[as]=null;for(;e===Lr;)Lr=nt[--lt],nt[lt]=null,Lt=nt[--lt],nt[lt]=null,Bt=nt[--lt],nt[lt]=null}var et=null,Ze=null,he=!1,xt=null;function Eu(e,t){var r=ot(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function Ic(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,et=e,Ze=rr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,et=e,Ze=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Lr!==null?{id:Bt,overflow:Lt}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=ot(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,et=e,Ze=null,!0):!1;default:return!1}}function po(e){return(e.mode&1)!==0&&(e.flags&128)===0}function xo(e){if(he){var t=Ze;if(t){var r=t;if(!Ic(e,t)){if(po(e))throw Error(B(418));t=rr(r.nextSibling);var a=et;t&&Ic(e,t)?Eu(a,r):(e.flags=e.flags&-4097|2,he=!1,et=e)}}else{if(po(e))throw Error(B(418));e.flags=e.flags&-4097|2,he=!1,et=e}}}function Dc(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;et=e}function Wa(e){if(e!==et)return!1;if(!he)return Dc(e),he=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!uo(e.type,e.memoizedProps)),t&&(t=Ze)){if(po(e))throw Mu(),Error(B(418));for(;t;)Eu(e,t),t=rr(t.nextSibling)}if(Dc(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(B(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Ze=rr(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Ze=null}}else Ze=et?rr(e.stateNode.nextSibling):null;return!0}function Mu(){for(var e=Ze;e;)e=rr(e.nextSibling)}function ws(){Ze=et=null,he=!1}function mi(e){xt===null?xt=[e]:xt.push(e)}var mh=_t.ReactCurrentBatchConfig;function $s(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(B(309));var a=r.stateNode}if(!a)throw Error(B(147,e));var n=a,l=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===l?t.ref:(t=function(o){var i=n.refs;o===null?delete i[l]:i[l]=o},t._stringRef=l,t)}if(typeof e!="string")throw Error(B(284));if(!r._owner)throw Error(B(290,e))}return e}function Ka(e,t){throw e=Object.prototype.toString.call(t),Error(B(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ec(e){var t=e._init;return t(e._payload)}function Tu(e){function t(x,v){if(e){var b=x.deletions;b===null?(x.deletions=[v],x.flags|=16):b.push(v)}}function r(x,v){if(!e)return null;for(;v!==null;)t(x,v),v=v.sibling;return null}function a(x,v){for(x=new Map;v!==null;)v.key!==null?x.set(v.key,v):x.set(v.index,v),v=v.sibling;return x}function n(x,v){return x=lr(x,v),x.index=0,x.sibling=null,x}function l(x,v,b){return x.index=b,e?(b=x.alternate,b!==null?(b=b.index,b<v?(x.flags|=2,v):b):(x.flags|=2,v)):(x.flags|=1048576,v)}function o(x){return e&&x.alternate===null&&(x.flags|=2),x}function i(x,v,b,y){return v===null||v.tag!==6?(v=Tl(b,x.mode,y),v.return=x,v):(v=n(v,b),v.return=x,v)}function c(x,v,b,y){var k=b.type;return k===Xr?h(x,v,b.props.children,y,b.key):v!==null&&(v.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Gt&&Ec(k)===v.type)?(y=n(v,b.props),y.ref=$s(x,v,b),y.return=x,y):(y=mn(b.type,b.key,b.props,null,x.mode,y),y.ref=$s(x,v,b),y.return=x,y)}function d(x,v,b,y){return v===null||v.tag!==4||v.stateNode.containerInfo!==b.containerInfo||v.stateNode.implementation!==b.implementation?(v=Pl(b,x.mode,y),v.return=x,v):(v=n(v,b.children||[]),v.return=x,v)}function h(x,v,b,y,k){return v===null||v.tag!==7?(v=Tr(b,x.mode,y,k),v.return=x,v):(v=n(v,b),v.return=x,v)}function m(x,v,b){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Tl(""+v,x.mode,b),v.return=x,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ra:return b=mn(v.type,v.key,v.props,null,x.mode,b),b.ref=$s(x,null,v),b.return=x,b;case Qr:return v=Pl(v,x.mode,b),v.return=x,v;case Gt:var y=v._init;return m(x,y(v._payload),b)}if(Ks(v)||Ls(v))return v=Tr(v,x.mode,b,null),v.return=x,v;Ka(x,v)}return null}function u(x,v,b,y){var k=v!==null?v.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return k!==null?null:i(x,v,""+b,y);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ra:return b.key===k?c(x,v,b,y):null;case Qr:return b.key===k?d(x,v,b,y):null;case Gt:return k=b._init,u(x,v,k(b._payload),y)}if(Ks(b)||Ls(b))return k!==null?null:h(x,v,b,y,null);Ka(x,b)}return null}function f(x,v,b,y,k){if(typeof y=="string"&&y!==""||typeof y=="number")return x=x.get(b)||null,i(v,x,""+y,k);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ra:return x=x.get(y.key===null?b:y.key)||null,c(v,x,y,k);case Qr:return x=x.get(y.key===null?b:y.key)||null,d(v,x,y,k);case Gt:var N=y._init;return f(x,v,b,N(y._payload),k)}if(Ks(y)||Ls(y))return x=x.get(b)||null,h(v,x,y,k,null);Ka(v,y)}return null}function g(x,v,b,y){for(var k=null,N=null,S=v,D=v=0,I=null;S!==null&&D<b.length;D++){S.index>D?(I=S,S=null):I=S.sibling;var C=u(x,S,b[D],y);if(C===null){S===null&&(S=I);break}e&&S&&C.alternate===null&&t(x,S),v=l(C,v,D),N===null?k=C:N.sibling=C,N=C,S=I}if(D===b.length)return r(x,S),he&&Nr(x,D),k;if(S===null){for(;D<b.length;D++)S=m(x,b[D],y),S!==null&&(v=l(S,v,D),N===null?k=S:N.sibling=S,N=S);return he&&Nr(x,D),k}for(S=a(x,S);D<b.length;D++)I=f(S,x,D,b[D],y),I!==null&&(e&&I.alternate!==null&&S.delete(I.key===null?D:I.key),v=l(I,v,D),N===null?k=I:N.sibling=I,N=I);return e&&S.forEach(function(P){return t(x,P)}),he&&Nr(x,D),k}function w(x,v,b,y){var k=Ls(b);if(typeof k!="function")throw Error(B(150));if(b=k.call(b),b==null)throw Error(B(151));for(var N=k=null,S=v,D=v=0,I=null,C=b.next();S!==null&&!C.done;D++,C=b.next()){S.index>D?(I=S,S=null):I=S.sibling;var P=u(x,S,C.value,y);if(P===null){S===null&&(S=I);break}e&&S&&P.alternate===null&&t(x,S),v=l(P,v,D),N===null?k=P:N.sibling=P,N=P,S=I}if(C.done)return r(x,S),he&&Nr(x,D),k;if(S===null){for(;!C.done;D++,C=b.next())C=m(x,C.value,y),C!==null&&(v=l(C,v,D),N===null?k=C:N.sibling=C,N=C);return he&&Nr(x,D),k}for(S=a(x,S);!C.done;D++,C=b.next())C=f(S,x,D,C.value,y),C!==null&&(e&&C.alternate!==null&&S.delete(C.key===null?D:C.key),v=l(C,v,D),N===null?k=C:N.sibling=C,N=C);return e&&S.forEach(function(A){return t(x,A)}),he&&Nr(x,D),k}function j(x,v,b,y){if(typeof b=="object"&&b!==null&&b.type===Xr&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Ra:e:{for(var k=b.key,N=v;N!==null;){if(N.key===k){if(k=b.type,k===Xr){if(N.tag===7){r(x,N.sibling),v=n(N,b.props.children),v.return=x,x=v;break e}}else if(N.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Gt&&Ec(k)===N.type){r(x,N.sibling),v=n(N,b.props),v.ref=$s(x,N,b),v.return=x,x=v;break e}r(x,N);break}else t(x,N);N=N.sibling}b.type===Xr?(v=Tr(b.props.children,x.mode,y,b.key),v.return=x,x=v):(y=mn(b.type,b.key,b.props,null,x.mode,y),y.ref=$s(x,v,b),y.return=x,x=y)}return o(x);case Qr:e:{for(N=b.key;v!==null;){if(v.key===N)if(v.tag===4&&v.stateNode.containerInfo===b.containerInfo&&v.stateNode.implementation===b.implementation){r(x,v.sibling),v=n(v,b.children||[]),v.return=x,x=v;break e}else{r(x,v);break}else t(x,v);v=v.sibling}v=Pl(b,x.mode,y),v.return=x,x=v}return o(x);case Gt:return N=b._init,j(x,v,N(b._payload),y)}if(Ks(b))return g(x,v,b,y);if(Ls(b))return w(x,v,b,y);Ka(x,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,v!==null&&v.tag===6?(r(x,v.sibling),v=n(v,b),v.return=x,x=v):(r(x,v),v=Tl(b,x.mode,y),v.return=x,x=v),o(x)):r(x,v)}return j}var ys=Tu(!0),Pu=Tu(!1),Dn=fr(null),En=null,ns=null,fi=null;function hi(){fi=ns=En=null}function pi(e){var t=Dn.current;me(Dn),e._currentValue=t}function go(e,t,r){for(;e!==null;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,a!==null&&(a.childLanes|=t)):a!==null&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===r)break;e=e.return}}function ms(e,t){En=e,fi=ns=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(We=!0),e.firstContext=null)}function ct(e){var t=e._currentValue;if(fi!==e)if(e={context:e,memoizedValue:t,next:null},ns===null){if(En===null)throw Error(B(308));ns=e,En.dependencies={lanes:0,firstContext:e}}else ns=ns.next=e;return t}var Ir=null;function xi(e){Ir===null?Ir=[e]:Ir.push(e)}function Bu(e,t,r,a){var n=t.interleaved;return n===null?(r.next=r,xi(t)):(r.next=n.next,n.next=r),t.interleaved=r,zt(e,a)}function zt(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Yt=!1;function gi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lu(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Rt(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function sr(e,t,r){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,se&2){var n=a.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),a.pending=t,zt(e,r)}return n=a.interleaved,n===null?(t.next=t,xi(a)):(t.next=n.next,n.next=t),a.interleaved=t,zt(e,r)}function nn(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var a=t.lanes;a&=e.pendingLanes,r|=a,t.lanes=r,ri(e,r)}}function Mc(e,t){var r=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,r===a)){var n=null,l=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};l===null?n=l=o:l=l.next=o,r=r.next}while(r!==null);l===null?n=l=t:l=l.next=t}else n=l=t;r={baseState:a.baseState,firstBaseUpdate:n,lastBaseUpdate:l,shared:a.shared,effects:a.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Mn(e,t,r,a){var n=e.updateQueue;Yt=!1;var l=n.firstBaseUpdate,o=n.lastBaseUpdate,i=n.shared.pending;if(i!==null){n.shared.pending=null;var c=i,d=c.next;c.next=null,o===null?l=d:o.next=d,o=c;var h=e.alternate;h!==null&&(h=h.updateQueue,i=h.lastBaseUpdate,i!==o&&(i===null?h.firstBaseUpdate=d:i.next=d,h.lastBaseUpdate=c))}if(l!==null){var m=n.baseState;o=0,h=d=c=null,i=l;do{var u=i.lane,f=i.eventTime;if((a&u)===u){h!==null&&(h=h.next={eventTime:f,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var g=e,w=i;switch(u=t,f=r,w.tag){case 1:if(g=w.payload,typeof g=="function"){m=g.call(f,m,u);break e}m=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=w.payload,u=typeof g=="function"?g.call(f,m,u):g,u==null)break e;m=ge({},m,u);break e;case 2:Yt=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,u=n.effects,u===null?n.effects=[i]:u.push(i))}else f={eventTime:f,lane:u,tag:i.tag,payload:i.payload,callback:i.callback,next:null},h===null?(d=h=f,c=m):h=h.next=f,o|=u;if(i=i.next,i===null){if(i=n.shared.pending,i===null)break;u=i,i=u.next,u.next=null,n.lastBaseUpdate=u,n.shared.pending=null}}while(!0);if(h===null&&(c=m),n.baseState=c,n.firstBaseUpdate=d,n.lastBaseUpdate=h,t=n.shared.interleaved,t!==null){n=t;do o|=n.lane,n=n.next;while(n!==t)}else l===null&&(n.shared.lanes=0);Ar|=o,e.lanes=o,e.memoizedState=m}}function Tc(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var a=e[t],n=a.callback;if(n!==null){if(a.callback=null,a=r,typeof n!="function")throw Error(B(191,n));n.call(a)}}}var Ca={},Et=fr(Ca),pa=fr(Ca),xa=fr(Ca);function Dr(e){if(e===Ca)throw Error(B(174));return e}function vi(e,t){switch(ie(xa,t),ie(pa,e),ie(Et,Ca),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ql(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ql(t,e)}me(Et),ie(Et,t)}function bs(){me(Et),me(pa),me(xa)}function Ru(e){Dr(xa.current);var t=Dr(Et.current),r=Ql(t,e.type);t!==r&&(ie(pa,e),ie(Et,r))}function wi(e){pa.current===e&&(me(Et),me(pa))}var pe=fr(0);function Tn(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Sl=[];function yi(){for(var e=0;e<Sl.length;e++)Sl[e]._workInProgressVersionPrimary=null;Sl.length=0}var ln=_t.ReactCurrentDispatcher,Cl=_t.ReactCurrentBatchConfig,Rr=0,xe=null,Se=null,Ie=null,Pn=!1,ea=!1,ga=0,fh=0;function Pe(){throw Error(B(321))}function bi(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!yt(e[r],t[r]))return!1;return!0}function ki(e,t,r,a,n,l){if(Rr=l,xe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ln.current=e===null||e.memoizedState===null?gh:vh,e=r(a,n),ea){l=0;do{if(ea=!1,ga=0,25<=l)throw Error(B(301));l+=1,Ie=Se=null,t.updateQueue=null,ln.current=wh,e=r(a,n)}while(ea)}if(ln.current=Bn,t=Se!==null&&Se.next!==null,Rr=0,Ie=Se=xe=null,Pn=!1,t)throw Error(B(300));return e}function ji(){var e=ga!==0;return ga=0,e}function Ct(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ie===null?xe.memoizedState=Ie=e:Ie=Ie.next=e,Ie}function dt(){if(Se===null){var e=xe.alternate;e=e!==null?e.memoizedState:null}else e=Se.next;var t=Ie===null?xe.memoizedState:Ie.next;if(t!==null)Ie=t,Se=e;else{if(e===null)throw Error(B(310));Se=e,e={memoizedState:Se.memoizedState,baseState:Se.baseState,baseQueue:Se.baseQueue,queue:Se.queue,next:null},Ie===null?xe.memoizedState=Ie=e:Ie=Ie.next=e}return Ie}function va(e,t){return typeof t=="function"?t(e):t}function Il(e){var t=dt(),r=t.queue;if(r===null)throw Error(B(311));r.lastRenderedReducer=e;var a=Se,n=a.baseQueue,l=r.pending;if(l!==null){if(n!==null){var o=n.next;n.next=l.next,l.next=o}a.baseQueue=n=l,r.pending=null}if(n!==null){l=n.next,a=a.baseState;var i=o=null,c=null,d=l;do{var h=d.lane;if((Rr&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),a=d.hasEagerState?d.eagerState:e(a,d.action);else{var m={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(i=c=m,o=a):c=c.next=m,xe.lanes|=h,Ar|=h}d=d.next}while(d!==null&&d!==l);c===null?o=a:c.next=i,yt(a,t.memoizedState)||(We=!0),t.memoizedState=a,t.baseState=o,t.baseQueue=c,r.lastRenderedState=a}if(e=r.interleaved,e!==null){n=e;do l=n.lane,xe.lanes|=l,Ar|=l,n=n.next;while(n!==e)}else n===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Dl(e){var t=dt(),r=t.queue;if(r===null)throw Error(B(311));r.lastRenderedReducer=e;var a=r.dispatch,n=r.pending,l=t.memoizedState;if(n!==null){r.pending=null;var o=n=n.next;do l=e(l,o.action),o=o.next;while(o!==n);yt(l,t.memoizedState)||(We=!0),t.memoizedState=l,t.baseQueue===null&&(t.baseState=l),r.lastRenderedState=l}return[l,a]}function Au(){}function Ou(e,t){var r=xe,a=dt(),n=t(),l=!yt(a.memoizedState,n);if(l&&(a.memoizedState=n,We=!0),a=a.queue,Ni(_u.bind(null,r,a,e),[e]),a.getSnapshot!==t||l||Ie!==null&&Ie.memoizedState.tag&1){if(r.flags|=2048,wa(9,$u.bind(null,r,a,n,t),void 0,null),De===null)throw Error(B(349));Rr&30||zu(r,t,n)}return n}function zu(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=xe.updateQueue,t===null?(t={lastEffect:null,stores:null},xe.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function $u(e,t,r,a){t.value=r,t.getSnapshot=a,Fu(t)&&Uu(e)}function _u(e,t,r){return r(function(){Fu(t)&&Uu(e)})}function Fu(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!yt(e,r)}catch{return!0}}function Uu(e){var t=zt(e,1);t!==null&&wt(t,e,1,-1)}function Pc(e){var t=Ct();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t.queue=e,e=e.dispatch=xh.bind(null,xe,e),[t.memoizedState,e]}function wa(e,t,r,a){return e={tag:e,create:t,destroy:r,deps:a,next:null},t=xe.updateQueue,t===null?(t={lastEffect:null,stores:null},xe.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(a=r.next,r.next=e,e.next=a,t.lastEffect=e)),e}function Vu(){return dt().memoizedState}function on(e,t,r,a){var n=Ct();xe.flags|=e,n.memoizedState=wa(1|t,r,void 0,a===void 0?null:a)}function Gn(e,t,r,a){var n=dt();a=a===void 0?null:a;var l=void 0;if(Se!==null){var o=Se.memoizedState;if(l=o.destroy,a!==null&&bi(a,o.deps)){n.memoizedState=wa(t,r,l,a);return}}xe.flags|=e,n.memoizedState=wa(1|t,r,l,a)}function Bc(e,t){return on(8390656,8,e,t)}function Ni(e,t){return Gn(2048,8,e,t)}function Hu(e,t){return Gn(4,2,e,t)}function Wu(e,t){return Gn(4,4,e,t)}function Ku(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Gu(e,t,r){return r=r!=null?r.concat([e]):null,Gn(4,4,Ku.bind(null,t,e),r)}function Si(){}function Yu(e,t){var r=dt();t=t===void 0?null:t;var a=r.memoizedState;return a!==null&&t!==null&&bi(t,a[1])?a[0]:(r.memoizedState=[e,t],e)}function Ju(e,t){var r=dt();t=t===void 0?null:t;var a=r.memoizedState;return a!==null&&t!==null&&bi(t,a[1])?a[0]:(e=e(),r.memoizedState=[e,t],e)}function Qu(e,t,r){return Rr&21?(yt(r,t)||(r=tu(),xe.lanes|=r,Ar|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,We=!0),e.memoizedState=r)}function hh(e,t){var r=ne;ne=r!==0&&4>r?r:4,e(!0);var a=Cl.transition;Cl.transition={};try{e(!1),t()}finally{ne=r,Cl.transition=a}}function Xu(){return dt().memoizedState}function ph(e,t,r){var a=nr(e);if(r={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null},qu(e))Zu(t,r);else if(r=Bu(e,t,r,a),r!==null){var n=ze();wt(r,e,a,n),e0(r,t,a)}}function xh(e,t,r){var a=nr(e),n={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null};if(qu(e))Zu(t,n);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=t.lastRenderedReducer,l!==null))try{var o=t.lastRenderedState,i=l(o,r);if(n.hasEagerState=!0,n.eagerState=i,yt(i,o)){var c=t.interleaved;c===null?(n.next=n,xi(t)):(n.next=c.next,c.next=n),t.interleaved=n;return}}catch{}finally{}r=Bu(e,t,n,a),r!==null&&(n=ze(),wt(r,e,a,n),e0(r,t,a))}}function qu(e){var t=e.alternate;return e===xe||t!==null&&t===xe}function Zu(e,t){ea=Pn=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function e0(e,t,r){if(r&4194240){var a=t.lanes;a&=e.pendingLanes,r|=a,t.lanes=r,ri(e,r)}}var Bn={readContext:ct,useCallback:Pe,useContext:Pe,useEffect:Pe,useImperativeHandle:Pe,useInsertionEffect:Pe,useLayoutEffect:Pe,useMemo:Pe,useReducer:Pe,useRef:Pe,useState:Pe,useDebugValue:Pe,useDeferredValue:Pe,useTransition:Pe,useMutableSource:Pe,useSyncExternalStore:Pe,useId:Pe,unstable_isNewReconciler:!1},gh={readContext:ct,useCallback:function(e,t){return Ct().memoizedState=[e,t===void 0?null:t],e},useContext:ct,useEffect:Bc,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,on(4194308,4,Ku.bind(null,t,e),r)},useLayoutEffect:function(e,t){return on(4194308,4,e,t)},useInsertionEffect:function(e,t){return on(4,2,e,t)},useMemo:function(e,t){var r=Ct();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var a=Ct();return t=r!==void 0?r(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=ph.bind(null,xe,e),[a.memoizedState,e]},useRef:function(e){var t=Ct();return e={current:e},t.memoizedState=e},useState:Pc,useDebugValue:Si,useDeferredValue:function(e){return Ct().memoizedState=e},useTransition:function(){var e=Pc(!1),t=e[0];return e=hh.bind(null,e[1]),Ct().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var a=xe,n=Ct();if(he){if(r===void 0)throw Error(B(407));r=r()}else{if(r=t(),De===null)throw Error(B(349));Rr&30||zu(a,t,r)}n.memoizedState=r;var l={value:r,getSnapshot:t};return n.queue=l,Bc(_u.bind(null,a,l,e),[e]),a.flags|=2048,wa(9,$u.bind(null,a,l,r,t),void 0,null),r},useId:function(){var e=Ct(),t=De.identifierPrefix;if(he){var r=Lt,a=Bt;r=(a&~(1<<32-vt(a)-1)).toString(32)+r,t=":"+t+"R"+r,r=ga++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=fh++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},vh={readContext:ct,useCallback:Yu,useContext:ct,useEffect:Ni,useImperativeHandle:Gu,useInsertionEffect:Hu,useLayoutEffect:Wu,useMemo:Ju,useReducer:Il,useRef:Vu,useState:function(){return Il(va)},useDebugValue:Si,useDeferredValue:function(e){var t=dt();return Qu(t,Se.memoizedState,e)},useTransition:function(){var e=Il(va)[0],t=dt().memoizedState;return[e,t]},useMutableSource:Au,useSyncExternalStore:Ou,useId:Xu,unstable_isNewReconciler:!1},wh={readContext:ct,useCallback:Yu,useContext:ct,useEffect:Ni,useImperativeHandle:Gu,useInsertionEffect:Hu,useLayoutEffect:Wu,useMemo:Ju,useReducer:Dl,useRef:Vu,useState:function(){return Dl(va)},useDebugValue:Si,useDeferredValue:function(e){var t=dt();return Se===null?t.memoizedState=e:Qu(t,Se.memoizedState,e)},useTransition:function(){var e=Dl(va)[0],t=dt().memoizedState;return[e,t]},useMutableSource:Au,useSyncExternalStore:Ou,useId:Xu,unstable_isNewReconciler:!1};function ht(e,t){if(e&&e.defaultProps){t=ge({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function vo(e,t,r,a){t=e.memoizedState,r=r(a,t),r=r==null?t:ge({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Yn={isMounted:function(e){return(e=e._reactInternals)?_r(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var a=ze(),n=nr(e),l=Rt(a,n);l.payload=t,r!=null&&(l.callback=r),t=sr(e,l,n),t!==null&&(wt(t,e,n,a),nn(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var a=ze(),n=nr(e),l=Rt(a,n);l.tag=1,l.payload=t,r!=null&&(l.callback=r),t=sr(e,l,n),t!==null&&(wt(t,e,n,a),nn(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ze(),a=nr(e),n=Rt(r,a);n.tag=2,t!=null&&(n.callback=t),t=sr(e,n,a),t!==null&&(wt(t,e,a,r),nn(t,e,a))}};function Lc(e,t,r,a,n,l,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,l,o):t.prototype&&t.prototype.isPureReactComponent?!ua(r,a)||!ua(n,l):!0}function t0(e,t,r){var a=!1,n=cr,l=t.contextType;return typeof l=="object"&&l!==null?l=ct(l):(n=Ge(t)?Br:Re.current,a=t.contextTypes,l=(a=a!=null)?vs(e,n):cr),t=new t(r,l),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Yn,e.stateNode=t,t._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=l),t}function Rc(e,t,r,a){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,a),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,a),t.state!==e&&Yn.enqueueReplaceState(t,t.state,null)}function wo(e,t,r,a){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs={},gi(e);var l=t.contextType;typeof l=="object"&&l!==null?n.context=ct(l):(l=Ge(t)?Br:Re.current,n.context=vs(e,l)),n.state=e.memoizedState,l=t.getDerivedStateFromProps,typeof l=="function"&&(vo(e,t,l,r),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&Yn.enqueueReplaceState(n,n.state,null),Mn(e,r,n,a),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function ks(e,t){try{var r="",a=t;do r+=Km(a),a=a.return;while(a);var n=r}catch(l){n=`
Error generating stack: `+l.message+`
`+l.stack}return{value:e,source:t,stack:n,digest:null}}function El(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function yo(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var yh=typeof WeakMap=="function"?WeakMap:Map;function r0(e,t,r){r=Rt(-1,r),r.tag=3,r.payload={element:null};var a=t.value;return r.callback=function(){Rn||(Rn=!0,Mo=a),yo(e,t)},r}function s0(e,t,r){r=Rt(-1,r),r.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var n=t.value;r.payload=function(){return a(n)},r.callback=function(){yo(e,t)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(r.callback=function(){yo(e,t),typeof a!="function"&&(ar===null?ar=new Set([this]):ar.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function Ac(e,t,r){var a=e.pingCache;if(a===null){a=e.pingCache=new yh;var n=new Set;a.set(t,n)}else n=a.get(t),n===void 0&&(n=new Set,a.set(t,n));n.has(r)||(n.add(r),e=Lh.bind(null,e,t,r),t.then(e,e))}function Oc(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function zc(e,t,r,a,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Rt(-1,1),t.tag=2,sr(r,t,1))),r.lanes|=1),e)}var bh=_t.ReactCurrentOwner,We=!1;function Oe(e,t,r,a){t.child=e===null?Pu(t,null,r,a):ys(t,e.child,r,a)}function $c(e,t,r,a,n){r=r.render;var l=t.ref;return ms(t,n),a=ki(e,t,r,a,l,n),r=ji(),e!==null&&!We?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,$t(e,t,n)):(he&&r&&di(t),t.flags|=1,Oe(e,t,a,n),t.child)}function _c(e,t,r,a,n){if(e===null){var l=r.type;return typeof l=="function"&&!Bi(l)&&l.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=l,a0(e,t,l,a,n)):(e=mn(r.type,null,a,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(l=e.child,!(e.lanes&n)){var o=l.memoizedProps;if(r=r.compare,r=r!==null?r:ua,r(o,a)&&e.ref===t.ref)return $t(e,t,n)}return t.flags|=1,e=lr(l,a),e.ref=t.ref,e.return=t,t.child=e}function a0(e,t,r,a,n){if(e!==null){var l=e.memoizedProps;if(ua(l,a)&&e.ref===t.ref)if(We=!1,t.pendingProps=a=l,(e.lanes&n)!==0)e.flags&131072&&(We=!0);else return t.lanes=e.lanes,$t(e,t,n)}return bo(e,t,r,a,n)}function n0(e,t,r){var a=t.pendingProps,n=a.children,l=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ie(os,qe),qe|=r;else{if(!(r&1073741824))return e=l!==null?l.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ie(os,qe),qe|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=l!==null?l.baseLanes:r,ie(os,qe),qe|=a}else l!==null?(a=l.baseLanes|r,t.memoizedState=null):a=r,ie(os,qe),qe|=a;return Oe(e,t,n,r),t.child}function l0(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function bo(e,t,r,a,n){var l=Ge(r)?Br:Re.current;return l=vs(t,l),ms(t,n),r=ki(e,t,r,a,l,n),a=ji(),e!==null&&!We?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,$t(e,t,n)):(he&&a&&di(t),t.flags|=1,Oe(e,t,r,n),t.child)}function Fc(e,t,r,a,n){if(Ge(r)){var l=!0;Sn(t)}else l=!1;if(ms(t,n),t.stateNode===null)cn(e,t),t0(t,r,a),wo(t,r,a,n),a=!0;else if(e===null){var o=t.stateNode,i=t.memoizedProps;o.props=i;var c=o.context,d=r.contextType;typeof d=="object"&&d!==null?d=ct(d):(d=Ge(r)?Br:Re.current,d=vs(t,d));var h=r.getDerivedStateFromProps,m=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(i!==a||c!==d)&&Rc(t,o,a,d),Yt=!1;var u=t.memoizedState;o.state=u,Mn(t,a,o,n),c=t.memoizedState,i!==a||u!==c||Ke.current||Yt?(typeof h=="function"&&(vo(t,r,h,a),c=t.memoizedState),(i=Yt||Lc(t,r,i,a,u,c,d))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=c),o.props=a,o.state=c,o.context=d,a=i):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),a=!1)}else{o=t.stateNode,Lu(e,t),i=t.memoizedProps,d=t.type===t.elementType?i:ht(t.type,i),o.props=d,m=t.pendingProps,u=o.context,c=r.contextType,typeof c=="object"&&c!==null?c=ct(c):(c=Ge(r)?Br:Re.current,c=vs(t,c));var f=r.getDerivedStateFromProps;(h=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(i!==m||u!==c)&&Rc(t,o,a,c),Yt=!1,u=t.memoizedState,o.state=u,Mn(t,a,o,n);var g=t.memoizedState;i!==m||u!==g||Ke.current||Yt?(typeof f=="function"&&(vo(t,r,f,a),g=t.memoizedState),(d=Yt||Lc(t,r,d,a,u,g,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(a,g,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(a,g,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||i===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=g),o.props=a,o.state=g,o.context=c,a=d):(typeof o.componentDidUpdate!="function"||i===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),a=!1)}return ko(e,t,r,a,l,n)}function ko(e,t,r,a,n,l){l0(e,t);var o=(t.flags&128)!==0;if(!a&&!o)return n&&Cc(t,r,!1),$t(e,t,l);a=t.stateNode,bh.current=t;var i=o&&typeof r.getDerivedStateFromError!="function"?null:a.render();return t.flags|=1,e!==null&&o?(t.child=ys(t,e.child,null,l),t.child=ys(t,null,i,l)):Oe(e,t,i,l),t.memoizedState=a.state,n&&Cc(t,r,!0),t.child}function o0(e){var t=e.stateNode;t.pendingContext?Sc(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Sc(e,t.context,!1),vi(e,t.containerInfo)}function Uc(e,t,r,a,n){return ws(),mi(n),t.flags|=256,Oe(e,t,r,a),t.child}var jo={dehydrated:null,treeContext:null,retryLane:0};function No(e){return{baseLanes:e,cachePool:null,transitions:null}}function i0(e,t,r){var a=t.pendingProps,n=pe.current,l=!1,o=(t.flags&128)!==0,i;if((i=o)||(i=e!==null&&e.memoizedState===null?!1:(n&2)!==0),i?(l=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),ie(pe,n&1),e===null)return xo(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=a.children,e=a.fallback,l?(a=t.mode,l=t.child,o={mode:"hidden",children:o},!(a&1)&&l!==null?(l.childLanes=0,l.pendingProps=o):l=Xn(o,a,0,null),e=Tr(e,a,r,null),l.return=t,e.return=t,l.sibling=e,t.child=l,t.child.memoizedState=No(r),t.memoizedState=jo,e):Ci(t,o));if(n=e.memoizedState,n!==null&&(i=n.dehydrated,i!==null))return kh(e,t,o,a,i,n,r);if(l){l=a.fallback,o=t.mode,n=e.child,i=n.sibling;var c={mode:"hidden",children:a.children};return!(o&1)&&t.child!==n?(a=t.child,a.childLanes=0,a.pendingProps=c,t.deletions=null):(a=lr(n,c),a.subtreeFlags=n.subtreeFlags&14680064),i!==null?l=lr(i,l):(l=Tr(l,o,r,null),l.flags|=2),l.return=t,a.return=t,a.sibling=l,t.child=a,a=l,l=t.child,o=e.child.memoizedState,o=o===null?No(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},l.memoizedState=o,l.childLanes=e.childLanes&~r,t.memoizedState=jo,a}return l=e.child,e=l.sibling,a=lr(l,{mode:"visible",children:a.children}),!(t.mode&1)&&(a.lanes=r),a.return=t,a.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=a,t.memoizedState=null,a}function Ci(e,t){return t=Xn({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ga(e,t,r,a){return a!==null&&mi(a),ys(t,e.child,null,r),e=Ci(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function kh(e,t,r,a,n,l,o){if(r)return t.flags&256?(t.flags&=-257,a=El(Error(B(422))),Ga(e,t,o,a)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(l=a.fallback,n=t.mode,a=Xn({mode:"visible",children:a.children},n,0,null),l=Tr(l,n,o,null),l.flags|=2,a.return=t,l.return=t,a.sibling=l,t.child=a,t.mode&1&&ys(t,e.child,null,o),t.child.memoizedState=No(o),t.memoizedState=jo,l);if(!(t.mode&1))return Ga(e,t,o,null);if(n.data==="$!"){if(a=n.nextSibling&&n.nextSibling.dataset,a)var i=a.dgst;return a=i,l=Error(B(419)),a=El(l,a,void 0),Ga(e,t,o,a)}if(i=(o&e.childLanes)!==0,We||i){if(a=De,a!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(a.suspendedLanes|o)?0:n,n!==0&&n!==l.retryLane&&(l.retryLane=n,zt(e,n),wt(a,e,n,-1))}return Pi(),a=El(Error(B(421))),Ga(e,t,o,a)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=Rh.bind(null,e),n._reactRetry=t,null):(e=l.treeContext,Ze=rr(n.nextSibling),et=t,he=!0,xt=null,e!==null&&(nt[lt++]=Bt,nt[lt++]=Lt,nt[lt++]=Lr,Bt=e.id,Lt=e.overflow,Lr=t),t=Ci(t,a.children),t.flags|=4096,t)}function Vc(e,t,r){e.lanes|=t;var a=e.alternate;a!==null&&(a.lanes|=t),go(e.return,t,r)}function Ml(e,t,r,a,n){var l=e.memoizedState;l===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:r,tailMode:n}:(l.isBackwards=t,l.rendering=null,l.renderingStartTime=0,l.last=a,l.tail=r,l.tailMode=n)}function c0(e,t,r){var a=t.pendingProps,n=a.revealOrder,l=a.tail;if(Oe(e,t,a.children,r),a=pe.current,a&2)a=a&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Vc(e,r,t);else if(e.tag===19)Vc(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(ie(pe,a),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;r!==null;)e=r.alternate,e!==null&&Tn(e)===null&&(n=r),r=r.sibling;r=n,r===null?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),Ml(t,!1,n,r,l);break;case"backwards":for(r=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&Tn(e)===null){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}Ml(t,!0,r,null,l);break;case"together":Ml(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function cn(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $t(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ar|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(B(153));if(t.child!==null){for(e=t.child,r=lr(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=lr(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function jh(e,t,r){switch(t.tag){case 3:o0(t),ws();break;case 5:Ru(t);break;case 1:Ge(t.type)&&Sn(t);break;case 4:vi(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,n=t.memoizedProps.value;ie(Dn,a._currentValue),a._currentValue=n;break;case 13:if(a=t.memoizedState,a!==null)return a.dehydrated!==null?(ie(pe,pe.current&1),t.flags|=128,null):r&t.child.childLanes?i0(e,t,r):(ie(pe,pe.current&1),e=$t(e,t,r),e!==null?e.sibling:null);ie(pe,pe.current&1);break;case 19:if(a=(r&t.childLanes)!==0,e.flags&128){if(a)return c0(e,t,r);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),ie(pe,pe.current),a)break;return null;case 22:case 23:return t.lanes=0,n0(e,t,r)}return $t(e,t,r)}var d0,So,u0,m0;d0=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};So=function(){};u0=function(e,t,r,a){var n=e.memoizedProps;if(n!==a){e=t.stateNode,Dr(Et.current);var l=null;switch(r){case"input":n=Kl(e,n),a=Kl(e,a),l=[];break;case"select":n=ge({},n,{value:void 0}),a=ge({},a,{value:void 0}),l=[];break;case"textarea":n=Jl(e,n),a=Jl(e,a),l=[];break;default:typeof n.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=jn)}Xl(r,a);var o;r=null;for(d in n)if(!a.hasOwnProperty(d)&&n.hasOwnProperty(d)&&n[d]!=null)if(d==="style"){var i=n[d];for(o in i)i.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(aa.hasOwnProperty(d)?l||(l=[]):(l=l||[]).push(d,null));for(d in a){var c=a[d];if(i=n!=null?n[d]:void 0,a.hasOwnProperty(d)&&c!==i&&(c!=null||i!=null))if(d==="style")if(i){for(o in i)!i.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in c)c.hasOwnProperty(o)&&i[o]!==c[o]&&(r||(r={}),r[o]=c[o])}else r||(l||(l=[]),l.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,i=i?i.__html:void 0,c!=null&&i!==c&&(l=l||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(l=l||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(aa.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&ue("scroll",e),l||i===c||(l=[])):(l=l||[]).push(d,c))}r&&(l=l||[]).push("style",r);var d=l;(t.updateQueue=d)&&(t.flags|=4)}};m0=function(e,t,r,a){r!==a&&(t.flags|=4)};function _s(e,t){if(!he)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function Be(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,a=0;if(t)for(var n=e.child;n!==null;)r|=n.lanes|n.childLanes,a|=n.subtreeFlags&14680064,a|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)r|=n.lanes|n.childLanes,a|=n.subtreeFlags,a|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=a,e.childLanes=r,t}function Nh(e,t,r){var a=t.pendingProps;switch(ui(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Be(t),null;case 1:return Ge(t.type)&&Nn(),Be(t),null;case 3:return a=t.stateNode,bs(),me(Ke),me(Re),yi(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Wa(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,xt!==null&&(Bo(xt),xt=null))),So(e,t),Be(t),null;case 5:wi(t);var n=Dr(xa.current);if(r=t.type,e!==null&&t.stateNode!=null)u0(e,t,r,a,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(t.stateNode===null)throw Error(B(166));return Be(t),null}if(e=Dr(Et.current),Wa(t)){a=t.stateNode,r=t.type;var l=t.memoizedProps;switch(a[It]=t,a[ha]=l,e=(t.mode&1)!==0,r){case"dialog":ue("cancel",a),ue("close",a);break;case"iframe":case"object":case"embed":ue("load",a);break;case"video":case"audio":for(n=0;n<Ys.length;n++)ue(Ys[n],a);break;case"source":ue("error",a);break;case"img":case"image":case"link":ue("error",a),ue("load",a);break;case"details":ue("toggle",a);break;case"input":qi(a,l),ue("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!l.multiple},ue("invalid",a);break;case"textarea":ec(a,l),ue("invalid",a)}Xl(r,l),n=null;for(var o in l)if(l.hasOwnProperty(o)){var i=l[o];o==="children"?typeof i=="string"?a.textContent!==i&&(l.suppressHydrationWarning!==!0&&Ha(a.textContent,i,e),n=["children",i]):typeof i=="number"&&a.textContent!==""+i&&(l.suppressHydrationWarning!==!0&&Ha(a.textContent,i,e),n=["children",""+i]):aa.hasOwnProperty(o)&&i!=null&&o==="onScroll"&&ue("scroll",a)}switch(r){case"input":Aa(a),Zi(a,l,!0);break;case"textarea":Aa(a),tc(a);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(a.onclick=jn)}a=n,t.updateQueue=a,a!==null&&(t.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=_d(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=o.createElement(r,{is:a.is}):(e=o.createElement(r),r==="select"&&(o=e,a.multiple?o.multiple=!0:a.size&&(o.size=a.size))):e=o.createElementNS(e,r),e[It]=t,e[ha]=a,d0(e,t,!1,!1),t.stateNode=e;e:{switch(o=ql(r,a),r){case"dialog":ue("cancel",e),ue("close",e),n=a;break;case"iframe":case"object":case"embed":ue("load",e),n=a;break;case"video":case"audio":for(n=0;n<Ys.length;n++)ue(Ys[n],e);n=a;break;case"source":ue("error",e),n=a;break;case"img":case"image":case"link":ue("error",e),ue("load",e),n=a;break;case"details":ue("toggle",e),n=a;break;case"input":qi(e,a),n=Kl(e,a),ue("invalid",e);break;case"option":n=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},n=ge({},a,{value:void 0}),ue("invalid",e);break;case"textarea":ec(e,a),n=Jl(e,a),ue("invalid",e);break;default:n=a}Xl(r,n),i=n;for(l in i)if(i.hasOwnProperty(l)){var c=i[l];l==="style"?Vd(e,c):l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Fd(e,c)):l==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&na(e,c):typeof c=="number"&&na(e,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(aa.hasOwnProperty(l)?c!=null&&l==="onScroll"&&ue("scroll",e):c!=null&&Qo(e,l,c,o))}switch(r){case"input":Aa(e),Zi(e,a,!1);break;case"textarea":Aa(e),tc(e);break;case"option":a.value!=null&&e.setAttribute("value",""+ir(a.value));break;case"select":e.multiple=!!a.multiple,l=a.value,l!=null?is(e,!!a.multiple,l,!1):a.defaultValue!=null&&is(e,!!a.multiple,a.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=jn)}switch(r){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Be(t),null;case 6:if(e&&t.stateNode!=null)m0(e,t,e.memoizedProps,a);else{if(typeof a!="string"&&t.stateNode===null)throw Error(B(166));if(r=Dr(xa.current),Dr(Et.current),Wa(t)){if(a=t.stateNode,r=t.memoizedProps,a[It]=t,(l=a.nodeValue!==r)&&(e=et,e!==null))switch(e.tag){case 3:Ha(a.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ha(a.nodeValue,r,(e.mode&1)!==0)}l&&(t.flags|=4)}else a=(r.nodeType===9?r:r.ownerDocument).createTextNode(a),a[It]=t,t.stateNode=a}return Be(t),null;case 13:if(me(pe),a=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(he&&Ze!==null&&t.mode&1&&!(t.flags&128))Mu(),ws(),t.flags|=98560,l=!1;else if(l=Wa(t),a!==null&&a.dehydrated!==null){if(e===null){if(!l)throw Error(B(318));if(l=t.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(B(317));l[It]=t}else ws(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Be(t),l=!1}else xt!==null&&(Bo(xt),xt=null),l=!0;if(!l)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(t.child.flags|=8192,t.mode&1&&(e===null||pe.current&1?Ce===0&&(Ce=3):Pi())),t.updateQueue!==null&&(t.flags|=4),Be(t),null);case 4:return bs(),So(e,t),e===null&&ma(t.stateNode.containerInfo),Be(t),null;case 10:return pi(t.type._context),Be(t),null;case 17:return Ge(t.type)&&Nn(),Be(t),null;case 19:if(me(pe),l=t.memoizedState,l===null)return Be(t),null;if(a=(t.flags&128)!==0,o=l.rendering,o===null)if(a)_s(l,!1);else{if(Ce!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Tn(e),o!==null){for(t.flags|=128,_s(l,!1),a=o.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=r,r=t.child;r!==null;)l=r,e=a,l.flags&=14680066,o=l.alternate,o===null?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=o.childLanes,l.lanes=o.lanes,l.child=o.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=o.memoizedProps,l.memoizedState=o.memoizedState,l.updateQueue=o.updateQueue,l.type=o.type,e=o.dependencies,l.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ie(pe,pe.current&1|2),t.child}e=e.sibling}l.tail!==null&&ye()>js&&(t.flags|=128,a=!0,_s(l,!1),t.lanes=4194304)}else{if(!a)if(e=Tn(o),e!==null){if(t.flags|=128,a=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),_s(l,!0),l.tail===null&&l.tailMode==="hidden"&&!o.alternate&&!he)return Be(t),null}else 2*ye()-l.renderingStartTime>js&&r!==1073741824&&(t.flags|=128,a=!0,_s(l,!1),t.lanes=4194304);l.isBackwards?(o.sibling=t.child,t.child=o):(r=l.last,r!==null?r.sibling=o:t.child=o,l.last=o)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=ye(),t.sibling=null,r=pe.current,ie(pe,a?r&1|2:r&1),t):(Be(t),null);case 22:case 23:return Ti(),a=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(t.flags|=8192),a&&t.mode&1?qe&1073741824&&(Be(t),t.subtreeFlags&6&&(t.flags|=8192)):Be(t),null;case 24:return null;case 25:return null}throw Error(B(156,t.tag))}function Sh(e,t){switch(ui(t),t.tag){case 1:return Ge(t.type)&&Nn(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return bs(),me(Ke),me(Re),yi(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return wi(t),null;case 13:if(me(pe),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(B(340));ws()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return me(pe),null;case 4:return bs(),null;case 10:return pi(t.type._context),null;case 22:case 23:return Ti(),null;case 24:return null;default:return null}}var Ya=!1,Le=!1,Ch=typeof WeakSet=="function"?WeakSet:Set,F=null;function ls(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(a){we(e,t,a)}else r.current=null}function Co(e,t,r){try{r()}catch(a){we(e,t,a)}}var Hc=!1;function Ih(e,t){if(io=yn,e=gu(),ci(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var a=r.getSelection&&r.getSelection();if(a&&a.rangeCount!==0){r=a.anchorNode;var n=a.anchorOffset,l=a.focusNode;a=a.focusOffset;try{r.nodeType,l.nodeType}catch{r=null;break e}var o=0,i=-1,c=-1,d=0,h=0,m=e,u=null;t:for(;;){for(var f;m!==r||n!==0&&m.nodeType!==3||(i=o+n),m!==l||a!==0&&m.nodeType!==3||(c=o+a),m.nodeType===3&&(o+=m.nodeValue.length),(f=m.firstChild)!==null;)u=m,m=f;for(;;){if(m===e)break t;if(u===r&&++d===n&&(i=o),u===l&&++h===a&&(c=o),(f=m.nextSibling)!==null)break;m=u,u=m.parentNode}m=f}r=i===-1||c===-1?null:{start:i,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(co={focusedElem:e,selectionRange:r},yn=!1,F=t;F!==null;)if(t=F,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,F=e;else for(;F!==null;){t=F;try{var g=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var w=g.memoizedProps,j=g.memoizedState,x=t.stateNode,v=x.getSnapshotBeforeUpdate(t.elementType===t.type?w:ht(t.type,w),j);x.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(B(163))}}catch(y){we(t,t.return,y)}if(e=t.sibling,e!==null){e.return=t.return,F=e;break}F=t.return}return g=Hc,Hc=!1,g}function ta(e,t,r){var a=t.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var n=a=a.next;do{if((n.tag&e)===e){var l=n.destroy;n.destroy=void 0,l!==void 0&&Co(t,r,l)}n=n.next}while(n!==a)}}function Jn(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var a=r.create;r.destroy=a()}r=r.next}while(r!==t)}}function Io(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function f0(e){var t=e.alternate;t!==null&&(e.alternate=null,f0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[It],delete t[ha],delete t[fo],delete t[ch],delete t[dh])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function h0(e){return e.tag===5||e.tag===3||e.tag===4}function Wc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||h0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Do(e,t,r){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=jn));else if(a!==4&&(e=e.child,e!==null))for(Do(e,t,r),e=e.sibling;e!==null;)Do(e,t,r),e=e.sibling}function Eo(e,t,r){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(Eo(e,t,r),e=e.sibling;e!==null;)Eo(e,t,r),e=e.sibling}var Ee=null,pt=!1;function Kt(e,t,r){for(r=r.child;r!==null;)p0(e,t,r),r=r.sibling}function p0(e,t,r){if(Dt&&typeof Dt.onCommitFiberUnmount=="function")try{Dt.onCommitFiberUnmount(Fn,r)}catch{}switch(r.tag){case 5:Le||ls(r,t);case 6:var a=Ee,n=pt;Ee=null,Kt(e,t,r),Ee=a,pt=n,Ee!==null&&(pt?(e=Ee,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Ee.removeChild(r.stateNode));break;case 18:Ee!==null&&(pt?(e=Ee,r=r.stateNode,e.nodeType===8?jl(e.parentNode,r):e.nodeType===1&&jl(e,r),ca(e)):jl(Ee,r.stateNode));break;case 4:a=Ee,n=pt,Ee=r.stateNode.containerInfo,pt=!0,Kt(e,t,r),Ee=a,pt=n;break;case 0:case 11:case 14:case 15:if(!Le&&(a=r.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){n=a=a.next;do{var l=n,o=l.destroy;l=l.tag,o!==void 0&&(l&2||l&4)&&Co(r,t,o),n=n.next}while(n!==a)}Kt(e,t,r);break;case 1:if(!Le&&(ls(r,t),a=r.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=r.memoizedProps,a.state=r.memoizedState,a.componentWillUnmount()}catch(i){we(r,t,i)}Kt(e,t,r);break;case 21:Kt(e,t,r);break;case 22:r.mode&1?(Le=(a=Le)||r.memoizedState!==null,Kt(e,t,r),Le=a):Kt(e,t,r);break;default:Kt(e,t,r)}}function Kc(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Ch),t.forEach(function(a){var n=Ah.bind(null,e,a);r.has(a)||(r.add(a),a.then(n,n))})}}function mt(e,t){var r=t.deletions;if(r!==null)for(var a=0;a<r.length;a++){var n=r[a];try{var l=e,o=t,i=o;e:for(;i!==null;){switch(i.tag){case 5:Ee=i.stateNode,pt=!1;break e;case 3:Ee=i.stateNode.containerInfo,pt=!0;break e;case 4:Ee=i.stateNode.containerInfo,pt=!0;break e}i=i.return}if(Ee===null)throw Error(B(160));p0(l,o,n),Ee=null,pt=!1;var c=n.alternate;c!==null&&(c.return=null),n.return=null}catch(d){we(n,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)x0(t,e),t=t.sibling}function x0(e,t){var r=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mt(t,e),St(e),a&4){try{ta(3,e,e.return),Jn(3,e)}catch(w){we(e,e.return,w)}try{ta(5,e,e.return)}catch(w){we(e,e.return,w)}}break;case 1:mt(t,e),St(e),a&512&&r!==null&&ls(r,r.return);break;case 5:if(mt(t,e),St(e),a&512&&r!==null&&ls(r,r.return),e.flags&32){var n=e.stateNode;try{na(n,"")}catch(w){we(e,e.return,w)}}if(a&4&&(n=e.stateNode,n!=null)){var l=e.memoizedProps,o=r!==null?r.memoizedProps:l,i=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{i==="input"&&l.type==="radio"&&l.name!=null&&zd(n,l),ql(i,o);var d=ql(i,l);for(o=0;o<c.length;o+=2){var h=c[o],m=c[o+1];h==="style"?Vd(n,m):h==="dangerouslySetInnerHTML"?Fd(n,m):h==="children"?na(n,m):Qo(n,h,m,d)}switch(i){case"input":Gl(n,l);break;case"textarea":$d(n,l);break;case"select":var u=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!l.multiple;var f=l.value;f!=null?is(n,!!l.multiple,f,!1):u!==!!l.multiple&&(l.defaultValue!=null?is(n,!!l.multiple,l.defaultValue,!0):is(n,!!l.multiple,l.multiple?[]:"",!1))}n[ha]=l}catch(w){we(e,e.return,w)}}break;case 6:if(mt(t,e),St(e),a&4){if(e.stateNode===null)throw Error(B(162));n=e.stateNode,l=e.memoizedProps;try{n.nodeValue=l}catch(w){we(e,e.return,w)}}break;case 3:if(mt(t,e),St(e),a&4&&r!==null&&r.memoizedState.isDehydrated)try{ca(t.containerInfo)}catch(w){we(e,e.return,w)}break;case 4:mt(t,e),St(e);break;case 13:mt(t,e),St(e),n=e.child,n.flags&8192&&(l=n.memoizedState!==null,n.stateNode.isHidden=l,!l||n.alternate!==null&&n.alternate.memoizedState!==null||(Ei=ye())),a&4&&Kc(e);break;case 22:if(h=r!==null&&r.memoizedState!==null,e.mode&1?(Le=(d=Le)||h,mt(t,e),Le=d):mt(t,e),St(e),a&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!h&&e.mode&1)for(F=e,h=e.child;h!==null;){for(m=F=h;F!==null;){switch(u=F,f=u.child,u.tag){case 0:case 11:case 14:case 15:ta(4,u,u.return);break;case 1:ls(u,u.return);var g=u.stateNode;if(typeof g.componentWillUnmount=="function"){a=u,r=u.return;try{t=a,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(w){we(a,r,w)}}break;case 5:ls(u,u.return);break;case 22:if(u.memoizedState!==null){Yc(m);continue}}f!==null?(f.return=u,F=f):Yc(m)}h=h.sibling}e:for(h=null,m=e;;){if(m.tag===5){if(h===null){h=m;try{n=m.stateNode,d?(l=n.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(i=m.stateNode,c=m.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,i.style.display=Ud("display",o))}catch(w){we(e,e.return,w)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(w){we(e,e.return,w)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===e)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;m.sibling===null;){if(m.return===null||m.return===e)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:mt(t,e),St(e),a&4&&Kc(e);break;case 21:break;default:mt(t,e),St(e)}}function St(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(h0(r)){var a=r;break e}r=r.return}throw Error(B(160))}switch(a.tag){case 5:var n=a.stateNode;a.flags&32&&(na(n,""),a.flags&=-33);var l=Wc(e);Eo(e,l,n);break;case 3:case 4:var o=a.stateNode.containerInfo,i=Wc(e);Do(e,i,o);break;default:throw Error(B(161))}}catch(c){we(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Dh(e,t,r){F=e,g0(e)}function g0(e,t,r){for(var a=(e.mode&1)!==0;F!==null;){var n=F,l=n.child;if(n.tag===22&&a){var o=n.memoizedState!==null||Ya;if(!o){var i=n.alternate,c=i!==null&&i.memoizedState!==null||Le;i=Ya;var d=Le;if(Ya=o,(Le=c)&&!d)for(F=n;F!==null;)o=F,c=o.child,o.tag===22&&o.memoizedState!==null?Jc(n):c!==null?(c.return=o,F=c):Jc(n);for(;l!==null;)F=l,g0(l),l=l.sibling;F=n,Ya=i,Le=d}Gc(e)}else n.subtreeFlags&8772&&l!==null?(l.return=n,F=l):Gc(e)}}function Gc(e){for(;F!==null;){var t=F;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Le||Jn(5,t);break;case 1:var a=t.stateNode;if(t.flags&4&&!Le)if(r===null)a.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:ht(t.type,r.memoizedProps);a.componentDidUpdate(n,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var l=t.updateQueue;l!==null&&Tc(t,l,a);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}Tc(t,o,r)}break;case 5:var i=t.stateNode;if(r===null&&t.flags&4){r=i;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&ca(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(B(163))}Le||t.flags&512&&Io(t)}catch(u){we(t,t.return,u)}}if(t===e){F=null;break}if(r=t.sibling,r!==null){r.return=t.return,F=r;break}F=t.return}}function Yc(e){for(;F!==null;){var t=F;if(t===e){F=null;break}var r=t.sibling;if(r!==null){r.return=t.return,F=r;break}F=t.return}}function Jc(e){for(;F!==null;){var t=F;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Jn(4,t)}catch(c){we(t,r,c)}break;case 1:var a=t.stateNode;if(typeof a.componentDidMount=="function"){var n=t.return;try{a.componentDidMount()}catch(c){we(t,n,c)}}var l=t.return;try{Io(t)}catch(c){we(t,l,c)}break;case 5:var o=t.return;try{Io(t)}catch(c){we(t,o,c)}}}catch(c){we(t,t.return,c)}if(t===e){F=null;break}var i=t.sibling;if(i!==null){i.return=t.return,F=i;break}F=t.return}}var Eh=Math.ceil,Ln=_t.ReactCurrentDispatcher,Ii=_t.ReactCurrentOwner,it=_t.ReactCurrentBatchConfig,se=0,De=null,be=null,Me=0,qe=0,os=fr(0),Ce=0,ya=null,Ar=0,Qn=0,Di=0,ra=null,He=null,Ei=0,js=1/0,Tt=null,Rn=!1,Mo=null,ar=null,Ja=!1,qt=null,An=0,sa=0,To=null,dn=-1,un=0;function ze(){return se&6?ye():dn!==-1?dn:dn=ye()}function nr(e){return e.mode&1?se&2&&Me!==0?Me&-Me:mh.transition!==null?(un===0&&(un=tu()),un):(e=ne,e!==0||(e=window.event,e=e===void 0?16:iu(e.type)),e):1}function wt(e,t,r,a){if(50<sa)throw sa=0,To=null,Error(B(185));ja(e,r,a),(!(se&2)||e!==De)&&(e===De&&(!(se&2)&&(Qn|=r),Ce===4&&Qt(e,Me)),Ye(e,a),r===1&&se===0&&!(t.mode&1)&&(js=ye()+500,Kn&&hr()))}function Ye(e,t){var r=e.callbackNode;mf(e,t);var a=wn(e,e===De?Me:0);if(a===0)r!==null&&ac(r),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(r!=null&&ac(r),t===1)e.tag===0?uh(Qc.bind(null,e)):Iu(Qc.bind(null,e)),oh(function(){!(se&6)&&hr()}),r=null;else{switch(ru(a)){case 1:r=ti;break;case 4:r=Zd;break;case 16:r=vn;break;case 536870912:r=eu;break;default:r=vn}r=S0(r,v0.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function v0(e,t){if(dn=-1,un=0,se&6)throw Error(B(327));var r=e.callbackNode;if(fs()&&e.callbackNode!==r)return null;var a=wn(e,e===De?Me:0);if(a===0)return null;if(a&30||a&e.expiredLanes||t)t=On(e,a);else{t=a;var n=se;se|=2;var l=y0();(De!==e||Me!==t)&&(Tt=null,js=ye()+500,Mr(e,t));do try{Ph();break}catch(i){w0(e,i)}while(!0);hi(),Ln.current=l,se=n,be!==null?t=0:(De=null,Me=0,t=Ce)}if(t!==0){if(t===2&&(n=so(e),n!==0&&(a=n,t=Po(e,n))),t===1)throw r=ya,Mr(e,0),Qt(e,a),Ye(e,ye()),r;if(t===6)Qt(e,a);else{if(n=e.current.alternate,!(a&30)&&!Mh(n)&&(t=On(e,a),t===2&&(l=so(e),l!==0&&(a=l,t=Po(e,l))),t===1))throw r=ya,Mr(e,0),Qt(e,a),Ye(e,ye()),r;switch(e.finishedWork=n,e.finishedLanes=a,t){case 0:case 1:throw Error(B(345));case 2:Sr(e,He,Tt);break;case 3:if(Qt(e,a),(a&130023424)===a&&(t=Ei+500-ye(),10<t)){if(wn(e,0)!==0)break;if(n=e.suspendedLanes,(n&a)!==a){ze(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=mo(Sr.bind(null,e,He,Tt),t);break}Sr(e,He,Tt);break;case 4:if(Qt(e,a),(a&4194240)===a)break;for(t=e.eventTimes,n=-1;0<a;){var o=31-vt(a);l=1<<o,o=t[o],o>n&&(n=o),a&=~l}if(a=n,a=ye()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*Eh(a/1960))-a,10<a){e.timeoutHandle=mo(Sr.bind(null,e,He,Tt),a);break}Sr(e,He,Tt);break;case 5:Sr(e,He,Tt);break;default:throw Error(B(329))}}}return Ye(e,ye()),e.callbackNode===r?v0.bind(null,e):null}function Po(e,t){var r=ra;return e.current.memoizedState.isDehydrated&&(Mr(e,t).flags|=256),e=On(e,t),e!==2&&(t=He,He=r,t!==null&&Bo(t)),e}function Bo(e){He===null?He=e:He.push.apply(He,e)}function Mh(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var a=0;a<r.length;a++){var n=r[a],l=n.getSnapshot;n=n.value;try{if(!yt(l(),n))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Qt(e,t){for(t&=~Di,t&=~Qn,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-vt(t),a=1<<r;e[r]=-1,t&=~a}}function Qc(e){if(se&6)throw Error(B(327));fs();var t=wn(e,0);if(!(t&1))return Ye(e,ye()),null;var r=On(e,t);if(e.tag!==0&&r===2){var a=so(e);a!==0&&(t=a,r=Po(e,a))}if(r===1)throw r=ya,Mr(e,0),Qt(e,t),Ye(e,ye()),r;if(r===6)throw Error(B(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sr(e,He,Tt),Ye(e,ye()),null}function Mi(e,t){var r=se;se|=1;try{return e(t)}finally{se=r,se===0&&(js=ye()+500,Kn&&hr())}}function Or(e){qt!==null&&qt.tag===0&&!(se&6)&&fs();var t=se;se|=1;var r=it.transition,a=ne;try{if(it.transition=null,ne=1,e)return e()}finally{ne=a,it.transition=r,se=t,!(se&6)&&hr()}}function Ti(){qe=os.current,me(os)}function Mr(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,lh(r)),be!==null)for(r=be.return;r!==null;){var a=r;switch(ui(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&Nn();break;case 3:bs(),me(Ke),me(Re),yi();break;case 5:wi(a);break;case 4:bs();break;case 13:me(pe);break;case 19:me(pe);break;case 10:pi(a.type._context);break;case 22:case 23:Ti()}r=r.return}if(De=e,be=e=lr(e.current,null),Me=qe=t,Ce=0,ya=null,Di=Qn=Ar=0,He=ra=null,Ir!==null){for(t=0;t<Ir.length;t++)if(r=Ir[t],a=r.interleaved,a!==null){r.interleaved=null;var n=a.next,l=r.pending;if(l!==null){var o=l.next;l.next=n,a.next=o}r.pending=a}Ir=null}return e}function w0(e,t){do{var r=be;try{if(hi(),ln.current=Bn,Pn){for(var a=xe.memoizedState;a!==null;){var n=a.queue;n!==null&&(n.pending=null),a=a.next}Pn=!1}if(Rr=0,Ie=Se=xe=null,ea=!1,ga=0,Ii.current=null,r===null||r.return===null){Ce=1,ya=t,be=null;break}e:{var l=e,o=r.return,i=r,c=t;if(t=Me,i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=i,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var u=h.alternate;u?(h.updateQueue=u.updateQueue,h.memoizedState=u.memoizedState,h.lanes=u.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=Oc(o);if(f!==null){f.flags&=-257,zc(f,o,i,l,t),f.mode&1&&Ac(l,d,t),t=f,c=d;var g=t.updateQueue;if(g===null){var w=new Set;w.add(c),t.updateQueue=w}else g.add(c);break e}else{if(!(t&1)){Ac(l,d,t),Pi();break e}c=Error(B(426))}}else if(he&&i.mode&1){var j=Oc(o);if(j!==null){!(j.flags&65536)&&(j.flags|=256),zc(j,o,i,l,t),mi(ks(c,i));break e}}l=c=ks(c,i),Ce!==4&&(Ce=2),ra===null?ra=[l]:ra.push(l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t;var x=r0(l,c,t);Mc(l,x);break e;case 1:i=c;var v=l.type,b=l.stateNode;if(!(l.flags&128)&&(typeof v.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(ar===null||!ar.has(b)))){l.flags|=65536,t&=-t,l.lanes|=t;var y=s0(l,i,t);Mc(l,y);break e}}l=l.return}while(l!==null)}k0(r)}catch(k){t=k,be===r&&r!==null&&(be=r=r.return);continue}break}while(!0)}function y0(){var e=Ln.current;return Ln.current=Bn,e===null?Bn:e}function Pi(){(Ce===0||Ce===3||Ce===2)&&(Ce=4),De===null||!(Ar&268435455)&&!(Qn&268435455)||Qt(De,Me)}function On(e,t){var r=se;se|=2;var a=y0();(De!==e||Me!==t)&&(Tt=null,Mr(e,t));do try{Th();break}catch(n){w0(e,n)}while(!0);if(hi(),se=r,Ln.current=a,be!==null)throw Error(B(261));return De=null,Me=0,Ce}function Th(){for(;be!==null;)b0(be)}function Ph(){for(;be!==null&&!rf();)b0(be)}function b0(e){var t=N0(e.alternate,e,qe);e.memoizedProps=e.pendingProps,t===null?k0(e):be=t,Ii.current=null}function k0(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Sh(r,t),r!==null){r.flags&=32767,be=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ce=6,be=null;return}}else if(r=Nh(r,t,qe),r!==null){be=r;return}if(t=t.sibling,t!==null){be=t;return}be=t=e}while(t!==null);Ce===0&&(Ce=5)}function Sr(e,t,r){var a=ne,n=it.transition;try{it.transition=null,ne=1,Bh(e,t,r,a)}finally{it.transition=n,ne=a}return null}function Bh(e,t,r,a){do fs();while(qt!==null);if(se&6)throw Error(B(327));r=e.finishedWork;var n=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(B(177));e.callbackNode=null,e.callbackPriority=0;var l=r.lanes|r.childLanes;if(ff(e,l),e===De&&(be=De=null,Me=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Ja||(Ja=!0,S0(vn,function(){return fs(),null})),l=(r.flags&15990)!==0,r.subtreeFlags&15990||l){l=it.transition,it.transition=null;var o=ne;ne=1;var i=se;se|=4,Ii.current=null,Ih(e,r),x0(r,e),Zf(co),yn=!!io,co=io=null,e.current=r,Dh(r),sf(),se=i,ne=o,it.transition=l}else e.current=r;if(Ja&&(Ja=!1,qt=e,An=n),l=e.pendingLanes,l===0&&(ar=null),lf(r.stateNode),Ye(e,ye()),t!==null)for(a=e.onRecoverableError,r=0;r<t.length;r++)n=t[r],a(n.value,{componentStack:n.stack,digest:n.digest});if(Rn)throw Rn=!1,e=Mo,Mo=null,e;return An&1&&e.tag!==0&&fs(),l=e.pendingLanes,l&1?e===To?sa++:(sa=0,To=e):sa=0,hr(),null}function fs(){if(qt!==null){var e=ru(An),t=it.transition,r=ne;try{if(it.transition=null,ne=16>e?16:e,qt===null)var a=!1;else{if(e=qt,qt=null,An=0,se&6)throw Error(B(331));var n=se;for(se|=4,F=e.current;F!==null;){var l=F,o=l.child;if(F.flags&16){var i=l.deletions;if(i!==null){for(var c=0;c<i.length;c++){var d=i[c];for(F=d;F!==null;){var h=F;switch(h.tag){case 0:case 11:case 15:ta(8,h,l)}var m=h.child;if(m!==null)m.return=h,F=m;else for(;F!==null;){h=F;var u=h.sibling,f=h.return;if(f0(h),h===d){F=null;break}if(u!==null){u.return=f,F=u;break}F=f}}}var g=l.alternate;if(g!==null){var w=g.child;if(w!==null){g.child=null;do{var j=w.sibling;w.sibling=null,w=j}while(w!==null)}}F=l}}if(l.subtreeFlags&2064&&o!==null)o.return=l,F=o;else e:for(;F!==null;){if(l=F,l.flags&2048)switch(l.tag){case 0:case 11:case 15:ta(9,l,l.return)}var x=l.sibling;if(x!==null){x.return=l.return,F=x;break e}F=l.return}}var v=e.current;for(F=v;F!==null;){o=F;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,F=b;else e:for(o=v;F!==null;){if(i=F,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:Jn(9,i)}}catch(k){we(i,i.return,k)}if(i===o){F=null;break e}var y=i.sibling;if(y!==null){y.return=i.return,F=y;break e}F=i.return}}if(se=n,hr(),Dt&&typeof Dt.onPostCommitFiberRoot=="function")try{Dt.onPostCommitFiberRoot(Fn,e)}catch{}a=!0}return a}finally{ne=r,it.transition=t}}return!1}function Xc(e,t,r){t=ks(r,t),t=r0(e,t,1),e=sr(e,t,1),t=ze(),e!==null&&(ja(e,1,t),Ye(e,t))}function we(e,t,r){if(e.tag===3)Xc(e,e,r);else for(;t!==null;){if(t.tag===3){Xc(t,e,r);break}else if(t.tag===1){var a=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(ar===null||!ar.has(a))){e=ks(r,e),e=s0(t,e,1),t=sr(t,e,1),e=ze(),t!==null&&(ja(t,1,e),Ye(t,e));break}}t=t.return}}function Lh(e,t,r){var a=e.pingCache;a!==null&&a.delete(t),t=ze(),e.pingedLanes|=e.suspendedLanes&r,De===e&&(Me&r)===r&&(Ce===4||Ce===3&&(Me&130023424)===Me&&500>ye()-Ei?Mr(e,0):Di|=r),Ye(e,t)}function j0(e,t){t===0&&(e.mode&1?(t=$a,$a<<=1,!($a&130023424)&&($a=4194304)):t=1);var r=ze();e=zt(e,t),e!==null&&(ja(e,t,r),Ye(e,r))}function Rh(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),j0(e,r)}function Ah(e,t){var r=0;switch(e.tag){case 13:var a=e.stateNode,n=e.memoizedState;n!==null&&(r=n.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(B(314))}a!==null&&a.delete(t),j0(e,r)}var N0;N0=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ke.current)We=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return We=!1,jh(e,t,r);We=!!(e.flags&131072)}else We=!1,he&&t.flags&1048576&&Du(t,In,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;cn(e,t),e=t.pendingProps;var n=vs(t,Re.current);ms(t,r),n=ki(null,t,a,e,n,r);var l=ji();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ge(a)?(l=!0,Sn(t)):l=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,gi(t),n.updater=Yn,t.stateNode=n,n._reactInternals=t,wo(t,a,e,r),t=ko(null,t,a,!0,l,r)):(t.tag=0,he&&l&&di(t),Oe(null,t,n,r),t=t.child),t;case 16:a=t.elementType;e:{switch(cn(e,t),e=t.pendingProps,n=a._init,a=n(a._payload),t.type=a,n=t.tag=zh(a),e=ht(a,e),n){case 0:t=bo(null,t,a,e,r);break e;case 1:t=Fc(null,t,a,e,r);break e;case 11:t=$c(null,t,a,e,r);break e;case 14:t=_c(null,t,a,ht(a.type,e),r);break e}throw Error(B(306,a,""))}return t;case 0:return a=t.type,n=t.pendingProps,n=t.elementType===a?n:ht(a,n),bo(e,t,a,n,r);case 1:return a=t.type,n=t.pendingProps,n=t.elementType===a?n:ht(a,n),Fc(e,t,a,n,r);case 3:e:{if(o0(t),e===null)throw Error(B(387));a=t.pendingProps,l=t.memoizedState,n=l.element,Lu(e,t),Mn(t,a,null,r);var o=t.memoizedState;if(a=o.element,l.isDehydrated)if(l={element:a,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=l,t.memoizedState=l,t.flags&256){n=ks(Error(B(423)),t),t=Uc(e,t,a,r,n);break e}else if(a!==n){n=ks(Error(B(424)),t),t=Uc(e,t,a,r,n);break e}else for(Ze=rr(t.stateNode.containerInfo.firstChild),et=t,he=!0,xt=null,r=Pu(t,null,a,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(ws(),a===n){t=$t(e,t,r);break e}Oe(e,t,a,r)}t=t.child}return t;case 5:return Ru(t),e===null&&xo(t),a=t.type,n=t.pendingProps,l=e!==null?e.memoizedProps:null,o=n.children,uo(a,n)?o=null:l!==null&&uo(a,l)&&(t.flags|=32),l0(e,t),Oe(e,t,o,r),t.child;case 6:return e===null&&xo(t),null;case 13:return i0(e,t,r);case 4:return vi(t,t.stateNode.containerInfo),a=t.pendingProps,e===null?t.child=ys(t,null,a,r):Oe(e,t,a,r),t.child;case 11:return a=t.type,n=t.pendingProps,n=t.elementType===a?n:ht(a,n),$c(e,t,a,n,r);case 7:return Oe(e,t,t.pendingProps,r),t.child;case 8:return Oe(e,t,t.pendingProps.children,r),t.child;case 12:return Oe(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(a=t.type._context,n=t.pendingProps,l=t.memoizedProps,o=n.value,ie(Dn,a._currentValue),a._currentValue=o,l!==null)if(yt(l.value,o)){if(l.children===n.children&&!Ke.current){t=$t(e,t,r);break e}}else for(l=t.child,l!==null&&(l.return=t);l!==null;){var i=l.dependencies;if(i!==null){o=l.child;for(var c=i.firstContext;c!==null;){if(c.context===a){if(l.tag===1){c=Rt(-1,r&-r),c.tag=2;var d=l.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}l.lanes|=r,c=l.alternate,c!==null&&(c.lanes|=r),go(l.return,r,t),i.lanes|=r;break}c=c.next}}else if(l.tag===10)o=l.type===t.type?null:l.child;else if(l.tag===18){if(o=l.return,o===null)throw Error(B(341));o.lanes|=r,i=o.alternate,i!==null&&(i.lanes|=r),go(o,r,t),o=l.sibling}else o=l.child;if(o!==null)o.return=l;else for(o=l;o!==null;){if(o===t){o=null;break}if(l=o.sibling,l!==null){l.return=o.return,o=l;break}o=o.return}l=o}Oe(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,a=t.pendingProps.children,ms(t,r),n=ct(n),a=a(n),t.flags|=1,Oe(e,t,a,r),t.child;case 14:return a=t.type,n=ht(a,t.pendingProps),n=ht(a.type,n),_c(e,t,a,n,r);case 15:return a0(e,t,t.type,t.pendingProps,r);case 17:return a=t.type,n=t.pendingProps,n=t.elementType===a?n:ht(a,n),cn(e,t),t.tag=1,Ge(a)?(e=!0,Sn(t)):e=!1,ms(t,r),t0(t,a,n),wo(t,a,n,r),ko(null,t,a,!0,e,r);case 19:return c0(e,t,r);case 22:return n0(e,t,r)}throw Error(B(156,t.tag))};function S0(e,t){return qd(e,t)}function Oh(e,t,r,a){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ot(e,t,r,a){return new Oh(e,t,r,a)}function Bi(e){return e=e.prototype,!(!e||!e.isReactComponent)}function zh(e){if(typeof e=="function")return Bi(e)?1:0;if(e!=null){if(e=e.$$typeof,e===qo)return 11;if(e===Zo)return 14}return 2}function lr(e,t){var r=e.alternate;return r===null?(r=ot(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function mn(e,t,r,a,n,l){var o=2;if(a=e,typeof e=="function")Bi(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Xr:return Tr(r.children,n,l,t);case Xo:o=8,n|=8;break;case Ul:return e=ot(12,r,t,n|2),e.elementType=Ul,e.lanes=l,e;case Vl:return e=ot(13,r,t,n),e.elementType=Vl,e.lanes=l,e;case Hl:return e=ot(19,r,t,n),e.elementType=Hl,e.lanes=l,e;case Rd:return Xn(r,n,l,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Bd:o=10;break e;case Ld:o=9;break e;case qo:o=11;break e;case Zo:o=14;break e;case Gt:o=16,a=null;break e}throw Error(B(130,e==null?e:typeof e,""))}return t=ot(o,r,t,n),t.elementType=e,t.type=a,t.lanes=l,t}function Tr(e,t,r,a){return e=ot(7,e,a,t),e.lanes=r,e}function Xn(e,t,r,a){return e=ot(22,e,a,t),e.elementType=Rd,e.lanes=r,e.stateNode={isHidden:!1},e}function Tl(e,t,r){return e=ot(6,e,null,t),e.lanes=r,e}function Pl(e,t,r){return t=ot(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function $h(e,t,r,a,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ml(0),this.expirationTimes=ml(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ml(0),this.identifierPrefix=a,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Li(e,t,r,a,n,l,o,i,c){return e=new $h(e,t,r,i,c),t===1?(t=1,l===!0&&(t|=8)):t=0,l=ot(3,null,null,t),e.current=l,l.stateNode=e,l.memoizedState={element:a,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},gi(l),e}function _h(e,t,r){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Qr,key:a==null?null:""+a,children:e,containerInfo:t,implementation:r}}function C0(e){if(!e)return cr;e=e._reactInternals;e:{if(_r(e)!==e||e.tag!==1)throw Error(B(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ge(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(B(171))}if(e.tag===1){var r=e.type;if(Ge(r))return Cu(e,r,t)}return t}function I0(e,t,r,a,n,l,o,i,c){return e=Li(r,a,!0,e,n,l,o,i,c),e.context=C0(null),r=e.current,a=ze(),n=nr(r),l=Rt(a,n),l.callback=t??null,sr(r,l,n),e.current.lanes=n,ja(e,n,a),Ye(e,a),e}function qn(e,t,r,a){var n=t.current,l=ze(),o=nr(n);return r=C0(r),t.context===null?t.context=r:t.pendingContext=r,t=Rt(l,o),t.payload={element:e},a=a===void 0?null:a,a!==null&&(t.callback=a),e=sr(n,t,o),e!==null&&(wt(e,n,o,l),nn(e,n,o)),o}function zn(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function qc(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Ri(e,t){qc(e,t),(e=e.alternate)&&qc(e,t)}function Fh(){return null}var D0=typeof reportError=="function"?reportError:function(e){console.error(e)};function Ai(e){this._internalRoot=e}Zn.prototype.render=Ai.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(B(409));qn(e,t,null,null)};Zn.prototype.unmount=Ai.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Or(function(){qn(null,e,null,null)}),t[Ot]=null}};function Zn(e){this._internalRoot=e}Zn.prototype.unstable_scheduleHydration=function(e){if(e){var t=nu();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Jt.length&&t!==0&&t<Jt[r].priority;r++);Jt.splice(r,0,e),r===0&&ou(e)}};function Oi(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function el(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Zc(){}function Uh(e,t,r,a,n){if(n){if(typeof a=="function"){var l=a;a=function(){var d=zn(o);l.call(d)}}var o=I0(t,a,e,0,null,!1,!1,"",Zc);return e._reactRootContainer=o,e[Ot]=o.current,ma(e.nodeType===8?e.parentNode:e),Or(),o}for(;n=e.lastChild;)e.removeChild(n);if(typeof a=="function"){var i=a;a=function(){var d=zn(c);i.call(d)}}var c=Li(e,0,!1,null,null,!1,!1,"",Zc);return e._reactRootContainer=c,e[Ot]=c.current,ma(e.nodeType===8?e.parentNode:e),Or(function(){qn(t,c,r,a)}),c}function tl(e,t,r,a,n){var l=r._reactRootContainer;if(l){var o=l;if(typeof n=="function"){var i=n;n=function(){var c=zn(o);i.call(c)}}qn(t,o,e,n)}else o=Uh(r,t,e,n,a);return zn(o)}su=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Gs(t.pendingLanes);r!==0&&(ri(t,r|1),Ye(t,ye()),!(se&6)&&(js=ye()+500,hr()))}break;case 13:Or(function(){var a=zt(e,1);if(a!==null){var n=ze();wt(a,e,1,n)}}),Ri(e,1)}};si=function(e){if(e.tag===13){var t=zt(e,134217728);if(t!==null){var r=ze();wt(t,e,134217728,r)}Ri(e,134217728)}};au=function(e){if(e.tag===13){var t=nr(e),r=zt(e,t);if(r!==null){var a=ze();wt(r,e,t,a)}Ri(e,t)}};nu=function(){return ne};lu=function(e,t){var r=ne;try{return ne=e,t()}finally{ne=r}};eo=function(e,t,r){switch(t){case"input":if(Gl(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var a=r[t];if(a!==e&&a.form===e.form){var n=Wn(a);if(!n)throw Error(B(90));Od(a),Gl(a,n)}}}break;case"textarea":$d(e,r);break;case"select":t=r.value,t!=null&&is(e,!!r.multiple,t,!1)}};Kd=Mi;Gd=Or;var Vh={usingClientEntryPoint:!1,Events:[Sa,ts,Wn,Hd,Wd,Mi]},Fs={findFiberByHostInstance:Cr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hh={bundleType:Fs.bundleType,version:Fs.version,rendererPackageName:Fs.rendererPackageName,rendererConfig:Fs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_t.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Qd(e),e===null?null:e.stateNode},findFiberByHostInstance:Fs.findFiberByHostInstance||Fh,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qa.isDisabled&&Qa.supportsFiber)try{Fn=Qa.inject(Hh),Dt=Qa}catch{}}rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vh;rt.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Oi(t))throw Error(B(200));return _h(e,t,null,r)};rt.createRoot=function(e,t){if(!Oi(e))throw Error(B(299));var r=!1,a="",n=D0;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=Li(e,1,!1,null,null,r,!1,a,n),e[Ot]=t.current,ma(e.nodeType===8?e.parentNode:e),new Ai(t)};rt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(B(188)):(e=Object.keys(e).join(","),Error(B(268,e)));return e=Qd(t),e=e===null?null:e.stateNode,e};rt.flushSync=function(e){return Or(e)};rt.hydrate=function(e,t,r){if(!el(t))throw Error(B(200));return tl(null,e,t,!0,r)};rt.hydrateRoot=function(e,t,r){if(!Oi(e))throw Error(B(405));var a=r!=null&&r.hydratedSources||null,n=!1,l="",o=D0;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(l=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=I0(t,null,e,1,r??null,n,!1,l,o),e[Ot]=t.current,ma(e),a)for(e=0;e<a.length;e++)r=a[e],n=r._getVersion,n=n(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,n]:t.mutableSourceEagerHydrationData.push(r,n);return new Zn(t)};rt.render=function(e,t,r){if(!el(t))throw Error(B(200));return tl(null,e,t,!1,r)};rt.unmountComponentAtNode=function(e){if(!el(e))throw Error(B(40));return e._reactRootContainer?(Or(function(){tl(null,null,e,!1,function(){e._reactRootContainer=null,e[Ot]=null})}),!0):!1};rt.unstable_batchedUpdates=Mi;rt.unstable_renderSubtreeIntoContainer=function(e,t,r,a){if(!el(r))throw Error(B(200));if(e==null||e._reactInternals===void 0)throw Error(B(38));return tl(e,t,r,!1,a)};rt.version="18.3.1-next-f1338f8080-20240426";function E0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(E0)}catch(e){console.error(e)}}E0(),Ed.exports=rt;var Wh=Ed.exports,ed=Wh;_l.createRoot=ed.createRoot,_l.hydrateRoot=ed.hydrateRoot;const rl="AES-GCM",Kh={name:rl,length:256},zi=!0,M0=["encrypt","decrypt"],T0={name:"ECDSA",hash:"SHA-384"},P0={name:"ECDSA",namedCurve:"P-384"},Gh=["sign","verify"],B0=e=>{let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t};function L0(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const r=t.length%4;r&&(r===2?t+="==":r===3&&(t+="="));try{const a=atob(t),n=new Uint8Array(a.length);for(let l=0;l<a.length;l++)n[l]=a.charCodeAt(l);return n}catch(a){throw a instanceof DOMException&&a.name==="InvalidCharacterError"?new Error("Failed to decode data. The Base64 string is corrupted or contains invalid characters."):new Error(`An unexpected error occurred during Base64 decoding: ${a.message}`)}}const Ns=async()=>crypto.subtle.generateKey(Kh,zi,M0),gt=async e=>crypto.subtle.exportKey("jwk",e),bt=async e=>crypto.subtle.importKey("jwk",e,{name:rl},zi,M0),Ss=async(e,t)=>{const r=crypto.getRandomValues(new Uint8Array(12)),a=typeof e=="string"?new TextEncoder().encode(e):e,n=await crypto.subtle.encrypt({name:rl,iv:r},t,a.slice()),l=new Uint8Array(n),o=new Uint8Array(r.length+l.length);return o.set(r),o.set(l,r.length),btoa(B0(o))},hs=async(e,t)=>{const r=L0(e),a=r.slice(0,12),n=r.slice(12),l=await crypto.subtle.decrypt({name:rl,iv:a},t,n.slice());return new Uint8Array(l)},sl=async()=>crypto.subtle.generateKey(P0,zi,Gh),Lo=async e=>crypto.subtle.importKey("jwk",e,P0,!0,["verify"]),R0=async(e,t)=>{const r=new TextEncoder().encode(e),a=await crypto.subtle.sign(T0,t,r.slice());return btoa(B0(new Uint8Array(a)))},ba=async(e,t,r)=>{const a=new TextEncoder().encode(e),n=L0(t);return crypto.subtle.verify(T0,r,n.slice(),a.slice())},Yh="smart-bill-splitter-sync",ps=typeof BroadcastChannel<"u"?new BroadcastChannel(Yh):null;ps||console.warn("BroadcastChannel API not supported in this browser. Cross-tab sync will not be available.");const le=async e=>{if(ps)try{const t=await nl();if(!(t!=null&&t.privateKey)){console.error("Broadcast: Communication private key not found. Cannot sign message.");return}const r=JSON.stringify(e),a=await R0(r,t.privateKey),n={payload:e,signature:a};ps.postMessage(n)}catch(t){console.error("Failed to sign and post broadcast message:",t)}},pr=e=>{const t=p.useRef(e);p.useEffect(()=>{t.current=e},[e]),p.useEffect(()=>{if(!ps)return;const r=async a=>{const n=a.data;if(!n||typeof n.payload!="object"||typeof n.signature!="string"){console.warn("Broadcast: Received a malformed or unsigned message. Ignoring.",n);return}try{const l=await nl();if(!(l!=null&&l.publicKey)){console.error("Broadcast: Communication public key not found. Cannot verify message.");return}const o=JSON.stringify(n.payload);await ba(o,n.signature,l.publicKey)?t.current(n.payload):console.warn("Broadcast: Received a message with an INVALID signature. Ignoring. This could be a security issue or a key mismatch between tabs.",n)}catch(l){console.error("Error during broadcast message verification:",l)}};return ps.addEventListener("message",r),()=>{ps.removeEventListener("message",r)}},[])},Jh="SmartBillSplitterDB",Qh=18,_={BILLS:"bills",RECURRING_BILLS:"recurring_bills",IMPORTED_BILLS:"imported_bills",GROUPS:"groups",CATEGORIES:"categories",SETTINGS:"settings",THEME:"theme",SUBSCRIPTION:"subscription",SUBSCRIPTION_DETAILS:"subscription_details",CRYPTO_KEYS:"crypto_keys",BILL_SIGNING_KEYS:"bill_signing_keys",MANAGED_PAYPAL_SUBSCRIPTIONS:"managed_paypal_subscriptions",COMMUNICATION_KEYS:"communication_keys"},ke="current";let or=null;const Ia=()=>{or&&(or.close(),or=null,console.log("Database connection closed on request from another tab."))},$i=()=>{if(!or)throw new Error("Database not initialized or has been closed. Call initDB first.");return or};function al(e){return new Promise((t,r)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>r(e.error)})}function Xh(){return new Promise((e,t)=>{if(or)return e();const r=indexedDB.open(Jh,Qh);r.onupgradeneeded=a=>{const n=a.target.result,l=a.target.transaction;if([{name:_.BILLS,options:{keyPath:"id"}},{name:_.RECURRING_BILLS,options:{keyPath:"id"}},{name:_.IMPORTED_BILLS,options:{keyPath:"id"}},{name:_.GROUPS,options:{keyPath:"id"}},{name:_.CATEGORIES,options:{keyPath:"id"}},{name:_.SETTINGS},{name:_.THEME},{name:_.SUBSCRIPTION},{name:_.SUBSCRIPTION_DETAILS},{name:_.BILL_SIGNING_KEYS,options:{keyPath:"billId"}},{name:_.MANAGED_PAYPAL_SUBSCRIPTIONS},{name:_.COMMUNICATION_KEYS}].forEach(i=>{n.objectStoreNames.contains(i.name)||n.createObjectStore(i.name,i.options)}),a.oldVersion<15&&n.objectStoreNames.contains(_.GROUPS)){console.log("Migrating groups for v15: adding popularity field.");const i=l.objectStore(_.GROUPS);i.openCursor().onsuccess=c=>{const d=c.target.result;if(d){const h=d.value;h.popularity===void 0&&(h.popularity=0,d.update(h)),d.continue()}}}if(a.oldVersion<16&&console.log("Migrating for v16: ensuring bills and recurring_bills stores exist."),a.oldVersion<17&&(console.log("Migrating for v17: adding dashboardLayoutMode to settings."),n.objectStoreNames.contains(_.SETTINGS))){const i=l.objectStore(_.SETTINGS);i.get(ke).onsuccess=c=>{const d=c.target.result;d&&d.dashboardLayoutMode===void 0&&(d.dashboardLayoutMode="card",i.put(d,ke))}}a.oldVersion<18&&console.log("Migrating for v18: Preparing for summary bill recalculation flag.")},r.onblocked=()=>{console.warn("Database upgrade is blocked. Broadcasting close request to other tabs."),le({type:"db-close-request"}),t(new Error("Waiting for other tabs to apply the update. If this message persists, please close all other tabs for this site."))},r.onsuccess=a=>{or=a.target.result,or.onversionchange=()=>{console.warn("Database version change detected from another tab. Closing connection."),Ia(),window.dispatchEvent(new CustomEvent("db-versionchange"))};const l=a;l.oldVersion>0&&l.newVersion!==l.oldVersion&&(console.log(`Database migration from v${l.oldVersion} to v${l.newVersion} was successful. Notifying other tabs.`),le({type:"db-migration-complete"})),e()},r.onerror=a=>{const n=a.target.error;console.error("Database error:",n),t(new Error(`Error opening database: ${n==null?void 0:n.message}`))}})}async function xr(e,t){return $i().transaction(e,t).objectStore(e)}async function Da(e){const t=await xr(e,"readonly");return al(t.getAll())}async function dr(e,t){const r=await xr(e,"readonly");return al(r.get(t))}async function Fe(e,t,r){const a=await xr(e,"readwrite");await al(a.put(t,r))}async function ur(e,t){const r=await xr(e,"readwrite");await al(r.delete(t))}const A0=()=>Da(_.BILLS),qh=e=>Fe(_.BILLS,e),Zh=e=>Fe(_.BILLS,e),ep=e=>ur(_.BILLS,e),tp=async e=>{const t=await xr(_.BILLS,"readwrite"),r=t.transaction;return e.forEach(a=>t.put(a)),new Promise((a,n)=>{r.oncomplete=()=>a(),r.onerror=()=>n(r.error)})},td=async(e,t)=>{const r=await xr(_.BILLS,"readwrite"),a=r.transaction;return e.forEach(n=>r.put(n)),t.forEach(n=>r.put(n)),new Promise((n,l)=>{a.oncomplete=()=>n(),a.onerror=()=>l(a.error)})},O0=()=>Da(_.RECURRING_BILLS),rp=e=>Fe(_.RECURRING_BILLS,e),Xa=e=>Fe(_.RECURRING_BILLS,e),sp=e=>ur(_.RECURRING_BILLS,e),z0=()=>Da(_.IMPORTED_BILLS),ap=e=>Fe(_.IMPORTED_BILLS,e),np=e=>Fe(_.IMPORTED_BILLS,e),lp=e=>ur(_.IMPORTED_BILLS,e),Bl=async(e,t)=>{const r=await xr(_.IMPORTED_BILLS,"readwrite"),a=r.transaction;return e.forEach(n=>r.put(n)),t.forEach(n=>r.put(n)),new Promise((n,l)=>{a.oncomplete=()=>n(),a.onerror=()=>l(a.error)})},$0=()=>Da(_.GROUPS),op=e=>Fe(_.GROUPS,e),rd=e=>Fe(_.GROUPS,e),ip=e=>ur(_.GROUPS,e),_0=()=>Da(_.CATEGORIES),cp=e=>ur(_.CATEGORIES,e),sd=async e=>{const t=await xr(_.CATEGORIES,"readwrite"),r=t.transaction;return e.forEach(a=>t.put(a)),new Promise((a,n)=>{r.oncomplete=()=>a(),r.onerror=()=>n(r.error)})},F0=()=>dr(_.SETTINGS,ke),ad=e=>Fe(_.SETTINGS,e,ke),Ro=()=>dr(_.THEME,ke),dp=e=>Fe(_.THEME,e,ke),Ao=async()=>{const e=await dr(_.SUBSCRIPTION,ke),t=await dr(_.SUBSCRIPTION_DETAILS,ke);if(e==="subscribed"&&t){const r=new Date(t.startDate),a=new Date,n=t.duration==="yearly"?366:31,l=new Date(r.getTime());if(l.setDate(l.getDate()+n),a>l)return console.log("Subscription has expired."),await zo(),await fn(null),null}return e||null},Oo=()=>dr(_.SUBSCRIPTION_DETAILS,ke),fn=e=>Fe(_.SUBSCRIPTION,e,ke),nd=e=>Fe(_.SUBSCRIPTION_DETAILS,e,ke),zo=async()=>{await ur(_.SUBSCRIPTION_DETAILS,ke),await ur(_.SUBSCRIPTION,ke)},Ea=e=>dr(_.BILL_SIGNING_KEYS,e),U0=(e,t)=>Fe(_.BILL_SIGNING_KEYS,{billId:e,privateKey:t}),$o="user_comm_key",nl=async()=>{const e=await dr(_.COMMUNICATION_KEYS,$o);return e&&e.publicKey instanceof CryptoKey&&e.privateKey instanceof CryptoKey?e:(e&&(console.warn("Found invalid or old format for communication keys in DB. A new key pair will be generated on next load."),await ur(_.COMMUNICATION_KEYS,$o)),null)},up=async e=>{await Fe(_.COMMUNICATION_KEYS,e,$o)},V0=()=>dr(_.MANAGED_PAYPAL_SUBSCRIPTIONS,ke).then(e=>e||[]),Ll=e=>Fe(_.MANAGED_PAYPAL_SUBSCRIPTIONS,e,ke),H0=async()=>{const e=await A0(),t=await O0(),r=await z0(),a=await $0(),n=await _0(),l=await F0(),o=await Ro(),i=await Ao(),c=await Oo(),d=await V0();return{bills:e,recurringBills:t,importedBills:r,groups:a,categories:n,settings:l,theme:o,subscription:i,subscriptionDetails:c,managedPayPalSubscriptions:d}},W0=async e=>{const r=$i().transaction(Object.values(_),"readwrite"),a=new Promise((n,l)=>{r.oncomplete=()=>n(),r.onerror=()=>l(r.error)});if(Object.values(_).forEach(n=>{r.objectStore(n).clear()}),e.bills){const n=r.objectStore(_.BILLS);e.bills.forEach(l=>n.put(l))}if(e.recurringBills){const n=r.objectStore(_.RECURRING_BILLS);e.recurringBills.forEach(l=>n.put(l))}if(e.importedBills){const n=r.objectStore(_.IMPORTED_BILLS);e.importedBills.forEach(l=>n.put(l))}if(e.groups){const n=r.objectStore(_.GROUPS);e.groups.forEach(l=>n.put(l))}if(e.categories){const n=r.objectStore(_.CATEGORIES);e.categories.forEach(l=>n.put(l))}e.settings&&r.objectStore(_.SETTINGS).put(e.settings,ke),e.theme&&r.objectStore(_.THEME).put(e.theme,ke),e.subscription&&r.objectStore(_.SUBSCRIPTION).put(e.subscription,ke),e.subscriptionDetails&&r.objectStore(_.SUBSCRIPTION_DETAILS).put(e.subscriptionDetails,ke),e.managedPayPalSubscriptions&&r.objectStore(_.MANAGED_PAYPAL_SUBSCRIPTIONS).put(e.managedPayPalSubscriptions,ke),await a},mp=async()=>{const e=$i(),t=Array.from(e.objectStoreNames),r={};if(t.length===0)return r;const a=e.transaction(t,"readonly"),n=t.map(l=>new Promise((o,i)=>{try{const d=a.objectStore(l).getAll();d.onsuccess=()=>{r[l]=d.result,o()},d.onerror=()=>{i(d.error)}}catch(c){i(c)}}));return await Promise.all(n),r},K0=p.createContext(void 0),fp=({children:e})=>{const[t,r]=p.useState(null),[a,n]=p.useState(null),[l,o]=p.useState(!0),i=p.useCallback(async()=>{await zo(),n(null),r(null)},[]),c=p.useCallback(async()=>{try{o(!0);const f=await Ao();if(f){if(r(f),f==="subscribed"){const g=await Oo();if(g&&g.customerId==="trial-user"){const w=new Date(g.startDate).getTime(),j=24*60*60*1e3,x=Date.now();if(x<w+j){n(g);const v=w+j-x;setTimeout(()=>{c()},v+500)}else{await i();return}}else if(g)n(g);else{await i();return}}}else r(null),n(null)}catch(f){console.error("Failed to load subscription status from DB:",f),r(null)}finally{o(!1)}},[i]);p.useEffect(()=>{c()},[c]);const d=p.useCallback(async f=>{const g={...f,startDate:new Date().toISOString()};await nd(g),await fn("subscribed"),n(g),r("subscribed")},[]),h=p.useCallback(async()=>{await zo(),await fn("free"),n(null),r("free")},[]),m=p.useCallback(async()=>{const f=await Ao(),g=await Oo();if(!f&&!g){const w={provider:"paypal",customerId:"trial-user",subscriptionId:"trial-active",startDate:new Date().toISOString(),duration:"yearly"};await nd(w),await fn("subscribed"),await c()}},[c]),u={subscriptionStatus:t,subscriptionDetails:a,isLoading:l,login:d,selectFreeTier:h,logout:i,startTrial:m};return _n.createElement(K0.Provider,{value:u},e)},Ma=()=>{const e=p.useContext(K0);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e};var H=(e=>(e.Dashboard="dashboard",e.CreateBill="create-bill",e.BillDetails="bill-details",e.Settings="settings",e.Sync="sync",e.Disclaimer="disclaimer",e.ViewShared="view-bill",e.RecurringBills="recurring-bills",e.ImportedBillDetails="imported-bill-details",e.ManageSubscription="manage-subscription",e.CreateGroup="create-group",e.GroupDetails="group-details",e))(H||{});const hp=()=>{const e=new Date,t=new Date;return t.setDate(e.getDate()-1),[{id:`bill-${Date.now()-1e3}`,description:"Morning Coffee Run",totalAmount:12.75,date:t.toISOString(),status:"active",participants:[{id:"p1",name:"Myself",amountOwed:4.25,paid:!0},{id:"p2",name:"Alex",amountOwed:4.25,paid:!1},{id:"p3",name:"Casey",amountOwed:4.25,paid:!1}],lastUpdatedAt:Date.now()},{id:`bill-${Date.now()-2e3}`,description:"Movie Night Tickets",totalAmount:30,date:new Date(e.setDate(e.getDate()-7)).toISOString(),status:"archived",participants:[{id:"p1",name:"Myself",amountOwed:15,paid:!0},{id:"p2",name:"Jordan",amountOwed:15,paid:!0}],lastUpdatedAt:Date.now()-1e4}]},Us=e=>e.sort((t,r)=>new Date(r.date).getTime()-new Date(t.date).getTime()),pp=()=>{const[e,t]=p.useState([]),[r,a]=p.useState(!0),n=p.useCallback(async(u=!1)=>{u&&a(!0);try{let f=await A0();if(u&&f.length===0&&!localStorage.getItem("sharedbills.defaultDataLoaded")){console.log("First launch: creating default example bills.");const g=hp();await tp(g),f.push(...g),localStorage.setItem("sharedbills.defaultDataLoaded","true")}t(Us(f))}catch(f){console.error("Failed to load bills from IndexedDB:",f)}finally{u&&a(!1)}},[]);p.useEffect(()=>{n(!0)},[n]),pr(p.useCallback(u=>{u.type==="bills-updated"&&n(!1)},[n]));const l=p.useCallback(async u=>{const f={...u,id:`bill-${Date.now()}`,status:"active",lastUpdatedAt:Date.now()};await qh(f),t(g=>Us([f,...g])),le({type:"bills-updated"})},[]),o=p.useCallback(async u=>{const f={...u,lastUpdatedAt:Date.now()};return await Zh(f),t(g=>Us(g.map(w=>w.id===f.id?f:w))),f},[]),i=p.useCallback(async u=>{const f=Date.now(),g=u.map(j=>({...j,lastUpdatedAt:f}));await td([],g);const w=new Map(g.map(j=>[j.id,j]));return t(j=>Us(j.map(x=>w.get(x.id)||x))),g},[]),c=p.useCallback(async u=>{await ep(u),t(f=>f.filter(g=>g.id!==u)),le({type:"bills-updated"})},[]),d=p.useCallback(async u=>{const f=e.find(g=>g.id===u);f&&await o({...f,status:"archived"})},[e,o]),h=p.useCallback(async u=>{const f=e.find(g=>g.id===u);f&&await o({...f,status:"active"})},[e,o]),m=p.useCallback(async u=>{const f=new Map(e.map(x=>[x.id,x])),g=[],w=[];let j=0;for(const x of u){const v=f.get(x.id);v?(x.lastUpdatedAt??0)>(v.lastUpdatedAt??0)?w.push({...v,...x,status:v.status}):j++:g.push({...x,status:"active"})}return(g.length>0||w.length>0)&&(await td(g,w),t(x=>{const v=new Map(x.map(b=>[b.id,b]));return w.forEach(b=>v.set(b.id,b)),g.forEach(b=>v.set(b.id,b)),Us(Array.from(v.values()))}),le({type:"bills-updated"})),{added:g.length,updated:w.length,skipped:j}},[e]);return{bills:e,isLoading:r,addBill:l,updateBill:o,deleteBill:c,archiveBill:d,unarchiveBill:h,updateMultipleBills:i,mergeBills:m}},Vs=e=>e.sort((t,r)=>new Date(r.sharedData.bill.date).getTime()-new Date(t.sharedData.bill.date).getTime()),xp=()=>{const[e,t]=p.useState([]),[r,a]=p.useState(!0),n=p.useCallback(async(u=!1)=>{u&&a(!0);try{let f=await z0();const g=[],w=f.map(j=>{var x;if(j.id.startsWith("summary-")&&!j.summaryRecalculated){console.log(`Performing one-time recalculation for summary bill: ${j.id}`);const v=JSON.parse(JSON.stringify(j)),b=(x=v.sharedData.bill.participants.find(y=>y.id===v.myParticipantId))==null?void 0:x.name;if(b){let y=0,k=0,N=!0;const S={...v.localStatus.paidItems||{}};if(v.sharedData.bill.items)for(const D of v.sharedData.bill.items){k+=D.price;let I=!1;const C=D.originalBillData;if(C){const P=C.participants.find(A=>A.name.toLowerCase().trim()===b.toLowerCase().trim());P!=null&&P.paid&&(S[D.id]=!0)}S[D.id]&&(I=!0),I||(y+=D.price,N=!1)}return v.sharedData.bill.totalAmount=k,v.sharedData.bill.participants[0]&&(v.sharedData.bill.participants[0].amountOwed=y),v.localStatus.paidItems=S,v.localStatus.myPortionPaid=N,v.summaryRecalculated=!0,g.push(v),v}}return j});g.length>0&&(console.log(`Saving ${g.length} migrated summary bills.`),await Bl([],g)),t(Vs(w))}catch(f){console.error("Failed to load imported bills:",f)}finally{u&&a(!1)}},[]);p.useEffect(()=>{n(!0)},[n]),pr(p.useCallback(u=>{u.type==="imported-bills-updated"&&n(!1)},[n]));const l=p.useCallback(async u=>{await ap(u),t(f=>Vs([u,...f])),le({type:"imported-bills-updated"})},[]),o=p.useCallback(async u=>{await np(u),t(f=>Vs(f.map(g=>g.id===u.id?u:g))),le({type:"imported-bills-updated"})},[]),i=p.useCallback(async u=>{if(u.length===0)return;await Bl([],u);const f=new Map(u.map(g=>[g.id,g]));t(g=>Vs(g.map(w=>f.get(w.id)||w))),le({type:"imported-bills-updated"})},[]),c=p.useCallback(async u=>{await lp(u),t(f=>f.filter(g=>g.id!==u)),le({type:"imported-bills-updated"})},[]),d=p.useCallback(async u=>{const f=e.find(g=>g.id===u);if(f){const g={...f,status:"archived"};await o(g)}},[e,o]),h=p.useCallback(async u=>{const f=e.find(g=>g.id===u);if(f){const g={...f,status:"active"};await o(g)}},[e,o]),m=p.useCallback(async u=>{const f=new Map(e.map(x=>[x.id,x])),g=[],w=[];let j=0;for(const x of u){const v=f.get(x.id);v?(x.lastUpdatedAt??0)>(v.lastUpdatedAt??0)?w.push({...v,...x,status:v.status,liveStatus:"live"}):j++:g.push({...x,status:"active",liveStatus:"live"})}return(g.length>0||w.length>0)&&(await Bl(g,w),t(x=>{const v=new Map(x.map(b=>[b.id,b]));return w.forEach(b=>v.set(b.id,b)),g.forEach(b=>v.set(b.id,b)),Vs(Array.from(v.values()))}),le({type:"imported-bills-updated"})),{added:g.length,updated:w.length,skipped:j}},[e]);return{importedBills:e,isLoading:r,addImportedBill:l,updateImportedBill:o,deleteImportedBill:c,archiveImportedBill:d,unarchiveImportedBill:h,mergeImportedBills:m,updateMultipleImportedBills:i}},Rl=(e,t)=>{const r=new Date(t);r.setHours(0,0,0,0);let a=new Date(r);switch(e.frequency){case"daily":a.setDate(r.getDate()+1);break;case"weekly":const n=e.dayOfWeek??0;for(a.setDate(r.getDate()+1);a.getDay()!==n;)a.setDate(a.getDate()+1);break;case"monthly":const l=e.dayOfMonth??1;if(r.getDate()<l){const i=new Date(r.getFullYear(),r.getMonth()+1,0).getDate();if(l<=i){a.setDate(l);break}}a.setMonth(r.getMonth()+1,1);const o=new Date(a.getFullYear(),a.getMonth()+1,0).getDate();a.setDate(Math.min(l,o));break;case"yearly":a.setFullYear(r.getFullYear()+1);break}return a.toISOString()},gp=(e,t)=>{const r=new Date(t),a=e.interval||1;switch(e.frequency){case"daily":r.setDate(r.getDate()+a);break;case"weekly":r.setDate(r.getDate()+7*a);break;case"monthly":const n=e.dayOfMonth??new Date(t).getDate();r.setMonth(r.getMonth()+a,1);const l=new Date(r.getFullYear(),r.getMonth()+1,0).getDate();r.setDate(Math.min(n,l));break;case"yearly":r.setFullYear(r.getFullYear()+a);break}return r.toISOString()},Wr=e=>e.sort((t,r)=>new Date(t.nextDueDate).getTime()-new Date(r.nextDueDate).getTime()),vp=()=>{const[e,t]=p.useState([]),[r,a]=p.useState(!0),n=p.useCallback(async(m=!1)=>{m&&a(!0);try{let u=await O0();t(Wr(u))}catch(u){console.error("Failed to load recurring bills:",u)}finally{m&&a(!1)}},[]);p.useEffect(()=>{n(!0)},[n]),pr(p.useCallback(m=>{m.type==="recurring-bills-updated"&&n(!1)},[n]));const l=p.useCallback(async m=>{const u={...m,id:`rb-${Date.now()}`,status:"active",nextDueDate:Rl(m.recurrenceRule,new Date)};return await rp(u),t(f=>Wr([u,...f])),le({type:"recurring-bills-updated"}),u},[]),o=p.useCallback(async m=>{const u=e.find(f=>f.id===m.id);u&&JSON.stringify(u.recurrenceRule)!==JSON.stringify(m.recurrenceRule)&&(m.nextDueDate=Rl(m.recurrenceRule,new Date)),await Xa(m),t(f=>Wr(f.map(g=>g.id===m.id?m:g))),le({type:"recurring-bills-updated"})},[e]),i=p.useCallback(async m=>{const u=e.find(f=>f.id===m);if(u){const f={...u,nextDueDate:gp(u.recurrenceRule,u.nextDueDate)};await Xa(f),t(g=>Wr(g.map(w=>w.id===m?f:w))),le({type:"recurring-bills-updated"})}},[e]),c=p.useCallback(async m=>{const u=e.find(f=>f.id===m);if(u){const f={...u,status:"archived"};await Xa(f),t(g=>Wr(g.map(w=>w.id===m?f:w))),le({type:"recurring-bills-updated"})}},[e]),d=p.useCallback(async m=>{const u=e.find(f=>f.id===m);if(u){const f={...u,status:"active",nextDueDate:Rl(u.recurrenceRule,new Date)};await Xa(f),t(g=>Wr(g.map(w=>w.id===m?f:w))),le({type:"recurring-bills-updated"})}},[e]),h=p.useCallback(async m=>{await sp(m),t(u=>u.filter(f=>f.id!==m)),le({type:"recurring-bills-updated"})},[]);return{recurringBills:e,addRecurringBill:l,updateRecurringBill:o,archiveRecurringBill:c,unarchiveRecurringBill:d,deleteRecurringBill:h,updateRecurringBillDueDate:i,isLoading:r}},qa=e=>e.sort((t,r)=>r.lastUpdatedAt-t.lastUpdatedAt),wp=()=>{const[e,t]=p.useState([]),[r,a]=p.useState(!0),n=p.useCallback(async(d=!1)=>{d&&a(!0);try{const h=await $0();t(qa(h))}catch(h){console.error("Failed to load groups:",h)}finally{d&&a(!1)}},[]);p.useEffect(()=>{n(!0)},[n]),pr(p.useCallback(d=>{d.type==="groups-updated"&&n(!1)},[n]));const l=p.useCallback(async d=>{const h={...d,id:`group-${Date.now()}`,lastUpdatedAt:Date.now(),popularity:0};return await op(h),t(m=>qa([h,...m])),le({type:"groups-updated"}),h},[]),o=p.useCallback(async d=>{const h={...d,lastUpdatedAt:Date.now()};await rd(h),t(m=>qa(m.map(u=>u.id===h.id?h:u))),le({type:"groups-updated"})},[]),i=p.useCallback(async d=>{await ip(d),t(h=>h.filter(m=>m.id!==d)),le({type:"groups-updated"})},[]),c=p.useCallback(async d=>{const h=e.find(m=>m.id===d);if(h){const m={...h,popularity:(h.popularity||0)+1};await rd(m),t(u=>qa(u.map(f=>f.id===d?m:f))),le({type:"groups-updated"})}},[e]);return{groups:e,addGroup:l,updateGroup:o,deleteGroup:i,incrementGroupPopularity:c,isLoading:r}},yp=()=>{const e=Date.now();return[{id:`cat-${e}-1`,name:"Groceries",isDefault:!0},{id:`cat-${e}-2`,name:"Dining",isDefault:!0},{id:`cat-${e}-3`,name:"Transportation",isDefault:!0},{id:`cat-${e}-4`,name:"Utilities",isDefault:!0},{id:`cat-${e}-5`,name:"Entertainment",isDefault:!0},{id:`cat-${e}-6`,name:"Shopping",isDefault:!0},{id:`cat-${e}-7`,name:"Health",isDefault:!0},{id:`cat-${e}-8`,name:"Travel",isDefault:!0},{id:`cat-${e}-9`,name:"Home",isDefault:!0},{id:`cat-${e}-10`,name:"Other",isDefault:!0}]},ld=e=>e.sort((t,r)=>t.name.localeCompare(r.name)),bp=()=>{const[e,t]=p.useState([]),[r,a]=p.useState(!0),n=p.useCallback(async(i=!1)=>{i&&a(!0);try{let c=await _0();if(i&&c.length===0&&!localStorage.getItem("sharedbills.defaultCategoriesLoaded")){console.log("First launch: creating default example categories.");const d=yp();await sd(d),c.push(...d),localStorage.setItem("sharedbills.defaultCategoriesLoaded","true")}t(ld(c))}catch(c){console.error("Failed to load categories from IndexedDB:",c)}finally{i&&a(!1)}},[]);p.useEffect(()=>{n(!0)},[n]),pr(p.useCallback(i=>{i.type==="categories-updated"&&n(!1)},[n]));const l=p.useCallback(async i=>{await sd(i),t(ld(i)),le({type:"categories-updated"})},[]),o=p.useCallback(async i=>{await cp(i),t(c=>c.filter(d=>d.id!==i)),le({type:"categories-updated"})},[]);return{categories:e,isLoading:r,saveCategories:l,deleteCategory:o}},Kr={paymentDetails:{venmo:"",paypal:"",cashApp:"",zelle:"",customMessage:""},myDisplayName:"",shareTemplate:`Hi {participantName}, this is a reminder for your outstanding bill(s). You owe a total of {totalOwed}.

Breakdown:
{billList}{paymentInfo}{promoText}`,notificationsEnabled:!1,notificationDays:3,hidePaymentMethodWarning:!1,totalBudget:void 0,dashboardLayoutMode:"card"},kp=()=>{const[e,t]=p.useState(Kr),[r,a]=p.useState(!0),n=p.useCallback(async(o=!1)=>{o&&a(!0);try{let i=await F0();if(i?i={...Kr,...i,paymentDetails:{...Kr.paymentDetails,...i.paymentDetails}}:(o&&await ad(Kr),i=Kr),o){let c=await nl();c||(console.log("Communication key pair not found, generating a new one."),c=await sl(),await up(c))}t(i)}catch(i){console.error("Failed to load settings from IndexedDB:",i),t(Kr)}finally{o&&a(!1)}},[]);p.useEffect(()=>{n(!0)},[n]),pr(p.useCallback(o=>{o.type==="settings-updated"&&n(!1)},[n]));const l=p.useCallback(async o=>{const i={...e,...o,paymentDetails:{...e.paymentDetails,...o.paymentDetails||{}}};await ad(i),le({type:"settings-updated"}),t(i)},[e]);return{settings:e,updateSettings:l,isLoading:r}},jp=()=>{const[e,t]=p.useState("system"),[r,a]=p.useState(!0),n=p.useCallback(i=>{if(typeof window>"u")return;const c=document.documentElement,d=i==="dark"||i==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches;c.classList.toggle("dark",d)},[]),l=p.useCallback(async(i=!1)=>{i&&a(!0);const c=await Ro()||"system";t(c),n(c),i&&a(!1)},[n]);return p.useEffect(()=>{l(!0)},[l]),pr(p.useCallback(i=>{i.type==="theme-updated"&&l(!1)},[l])),p.useEffect(()=>{const i=window.matchMedia("(prefers-color-scheme: dark)"),c=async()=>{await Ro()==="system"&&n("system")};return i.addEventListener("change",c),()=>{i.removeEventListener("change",c)}},[n]),{theme:e,setTheme:async i=>{await dp(i),le({type:"theme-updated"}),t(i),n(i)},isLoading:r}},Np=()=>{const[e,t]=p.useState(null),r=!!e;p.useEffect(()=>{const n=l=>{l.preventDefault(),t(l)};return window.addEventListener("beforeinstallprompt",n),()=>{window.removeEventListener("beforeinstallprompt",n)}},[]),p.useEffect(()=>{const n=()=>{t(null)};return window.addEventListener("appinstalled",n),()=>{window.removeEventListener("appinstalled",n)}},[]);const a=p.useCallback(async()=>{if(!e)return;e.prompt();const{outcome:n}=await e.userChoice;console.log(n==="accepted"?"User accepted the PWA installation":"User dismissed the PWA installation"),t(null)},[e]);return{canInstall:r,promptInstall:a}},G0=p.createContext({reloadApp:()=>{console.error("reloadApp called outside of AppControlProvider")},showNotification:(e,t)=>{console.error("showNotification called outside of AppControlProvider",{message:e,type:t})}}),ut=()=>p.useContext(G0),Sp=({bills:e,recurringBills:t,groups:r})=>{const[a,n]=p.useState({view:H.Dashboard,params:{},billConversionSource:void 0,recurringBillToEdit:void 0,fromTemplate:void 0,groupToEdit:void 0,currentGroup:void 0}),l=p.useCallback((o,i={})=>{let c=`#/${o}`;const d=new URLSearchParams,h={...i};h.recurringBillToEdit&&(d.set("editTemplateId",h.recurringBillToEdit.id),delete h.recurringBillToEdit),h.fromTemplate&&(d.set("fromTemplateId",h.fromTemplate.id),delete h.fromTemplate),h.convertFromBill&&(d.set("convertFromBillId",h.convertFromBill),delete h.convertFromBill),h.groupToEdit&&(d.set("editGroupId",h.groupToEdit.id),delete h.groupToEdit),h.groupToView&&(d.set("groupId",h.groupToView.id),delete h.groupToView),h.billId&&d.set("billId",h.billId),h.importedBillId&&d.set("importedBillId",h.importedBillId),Object.keys(h).forEach(u=>{h[u]!==void 0&&h[u]!==null&&d.set(u,String(h[u]))});const m=d.toString();m&&(c+=`?${m}`),window.location.hash=c},[]);return p.useEffect(()=>{const o=()=>{const c=window.location.hash.substring(1),[d,h]=c.split("?"),m=d.startsWith("/")?d.substring(1):d,u=Object.values(H).find(I=>I===m)||H.Dashboard,f=new URLSearchParams(h||""),g={};f.forEach((I,C)=>{g[C]=I});const w=f.get("convertFromBillId"),j=e.find(I=>I.id===w),x=f.get("editTemplateId"),v=t.find(I=>I.id===x),b=f.get("fromTemplateId"),y=t.find(I=>I.id===b),k=f.get("editGroupId"),N=r.find(I=>I.id===k),S=f.get("groupId"),D=r.find(I=>I.id===S);n({view:u,params:g,billConversionSource:j,recurringBillToEdit:v,fromTemplate:y,groupToEdit:N,currentGroup:D})};return o(),window.addEventListener("hashchange",o),()=>window.removeEventListener("hashchange",o)},[e,t,r]),{...a,navigate:l}},Cp=()=>{const[e,t]=p.useState(null),[r,a]=p.useState(null),[n,l]=p.useState(!1),[o,i]=p.useState(!1),[c,d]=p.useState(()=>sessionStorage.getItem("debugConsoleEnabled")==="true"),{showNotification:h}=ut(),m=p.useCallback((f,g,w,j)=>{t({title:f,message:g,onConfirm:w,options:j})},[]),u=p.useCallback(f=>{sessionStorage.setItem("debugConsoleEnabled",String(f)),d(f),h(`Debug console ${f?"enabled":"disabled"} for this session.`)},[h]);return{confirmation:e,setConfirmation:t,settingsSection:r,setSettingsSection:a,isCsvImporterOpen:n,setIsCsvImporterOpen:l,isQrImporterOpen:o,setIsQrImporterOpen:i,showDebugConsole:c,toggleDebugConsole:u,requestConfirmation:m}},Ip=(e,t)=>{const[r,a]=p.useState("bills"),[n,l]=p.useState(null),[o,i]=p.useState("active"),[c,d]=p.useState("total"),[h,m]=p.useState("last30days"),[u,f]=p.useState(e.dashboardLayoutMode||"card");p.useEffect(()=>{f(e.dashboardLayoutMode||"card")},[e.dashboardLayoutMode]);const g=p.useCallback(x=>{f(x),t({dashboardLayoutMode:x})},[t]),w=p.useCallback(x=>{x&&a("participants"),l(x)},[]),j=p.useCallback(()=>{l(null)},[]);return{dashboardView:r,onSetDashboardView:a,selectedParticipant:n,setSelectedParticipant:l,dashboardStatusFilter:o,onSetDashboardStatusFilter:i,dashboardSummaryFilter:c,onSetDashboardSummaryFilter:d,budgetDate:h,setBudgetDate:m,dashboardLayoutMode:u,onSetDashboardLayoutMode:g,onSelectParticipant:w,onClearParticipant:j}},Dp=({bills:e,importedBills:t,recurringBills:r,groups:a,categories:n,settings:l,isBillsLoading:o,isImportedLoading:i,isRecurringLoading:c,isSettingsLoading:d,isGroupsLoading:h,isCategoriesLoading:m,dashboardStatusFilter:u,budgetDate:f})=>{const g=o||i||c||d||h||m,w=p.useMemo(()=>{const x=l.myDisplayName.trim().toLowerCase(),v=new Map;if(e.forEach(b=>{b.participants.forEach(y=>{if(y.name.trim().toLowerCase()===x)return;const k=v.get(y.name)||{};(y.phone&&!k.phone||y.email&&!k.email)&&v.set(y.name,{phone:y.phone||k.phone,email:y.email||k.email})})}),u==="active"){const b=new Map;return e.forEach(y=>{y.status==="active"&&y.participants.forEach(k=>{!k.paid&&k.amountOwed>.005&&k.name.trim().toLowerCase()!==x&&b.set(k.name,(b.get(k.name)||0)+k.amountOwed)})}),Array.from(b.entries()).map(([y,k])=>({name:y,amount:k,type:"owed",...v.get(y)})).sort((y,k)=>k.amount-y.amount)}else{const b=new Map;return e.forEach(y=>{y.participants.forEach(k=>{const N=b.get(k.name)||{outstandingDebt:0,totalBilled:0};N.totalBilled+=k.amountOwed,k.paid||(N.outstandingDebt+=k.amountOwed),b.set(k.name,N)})}),Array.from(b.entries()).filter(([y,k])=>k.outstandingDebt<.01&&k.totalBilled>0&&y.trim().toLowerCase()!==x).map(([y,k])=>({name:y,amount:k.totalBilled,type:"paid",...v.get(y)})).sort((y,k)=>k.amount-y.amount)}},[e,u,l.myDisplayName]),j=p.useMemo(()=>{const x=l.myDisplayName.trim().toLowerCase();if(!x||d||m||o||i)return{totalBudget:0,totalSpending:0,spendingByCategory:{},hasBudgetData:!1};let v,b=new Date;f==="last30days"?(v=new Date,v.setDate(b.getDate()-30),v.setHours(0,0,0,0)):(v=new Date(f.year,f.month,1),b=new Date(f.year,f.month+1,0),b.setHours(23,59,59,999));const y=[];e.forEach(C=>{const P=new Date(C.date);if(C.status==="active"&&P>=v&&P<=b){const A=C.participants.find(z=>z.name.trim().toLowerCase()===x);if(A){const z=C.participants.length===1&&C.participants[0].name.trim().toLowerCase()===x?C.totalAmount:A.amountOwed;z>0&&y.push({billId:C.id,description:C.description,userPortion:z,date:C.date,categoryId:C.categoryId,isImported:!1})}}}),t.forEach(C=>{const P=C.sharedData.bill,A=new Date(P.date);if(C.status==="active"&&A>=v&&A<=b&&C.myParticipantId){const z=P.participants.find(U=>U.id===C.myParticipantId);if(z){const U=z.amountOwed;U>0&&y.push({billId:C.id,description:P.description,userPortion:U,date:P.date,categoryId:P.categoryId,isImported:!0})}}});const k={};let N=0;y.forEach(C=>{N+=C.userPortion;const P=C.categoryId,A=n.find(U=>U.id===P),z=A?A.id:"uncategorized";k[z]||(k[z]={category:A||{id:"uncategorized",name:"Uncategorized"},spent:0,bills:[]}),k[z].spent+=C.userPortion,k[z].bills.push(C)});let S=l.totalBudget||0;(!l.totalBudget||l.totalBudget===0)&&(S=n.reduce((C,P)=>C+(P.budget||0),0));const D=e.some(C=>C.categoryId)||t.some(C=>C.sharedData.bill.categoryId),I=S>0||n.some(C=>C.budget&&C.budget>0);return{totalBudget:S,totalSpending:N,spendingByCategory:k,hasBudgetData:D||I}},[e,t,n,l,f,d,m,o,i]);return{isLoading:g,participantsData:w,budgetData:j}};function Ep(e){const r=new TextEncoder().encode(e);let a="";for(let n=0;n<r.length;n++)a+=String.fromCharCode(r[n]);return a}function Y0(e){return btoa(Ep(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}const J0=(e,t,r,a,n)=>{const l=r.map(m=>`- "${m.description}": $${m.amountOwed.toFixed(2)}`).join(`
`),{paymentDetails:o,shareTemplate:i}=a;let c="";const d=[];o.venmo&&d.push(`Venmo: @${o.venmo}`),o.paypal&&d.push(`PayPal: ${o.paypal}`),o.cashApp&&d.push(`Cash App: $${o.cashApp}`),o.zelle&&d.push(`Zelle: ${o.zelle}`),d.length>0&&(c=`

You can pay me via ${d.join(" or ")}.`),o.customMessage&&(c+=c?`

${o.customMessage}`:`

${o.customMessage}`);let h="";if(n==="free"){let m="https://sharedbills.app";try{const u=new URL("/",window.location.href).href;m=u.endsWith("/")?u.slice(0,-1):u}catch{console.warn("Could not determine app URL from context.")}h=`

Created with SharedBills: ${m}`}return i.replace("{participantName}",e).replace("{totalOwed}",`$${t.toFixed(2)}`).replace("{billList}",l).replace("{paymentInfo}",c).replace("{promoText}",h)};async function Ms(e,t,r,a,n,l){var y;const{participantShareInfo:o,...i}=e,c=i.participants.map(({phone:k,email:N,...S})=>S),d=(y=i.items)==null?void 0:y.map(k=>{if(k.originalBillData){const N=k.originalBillData.participants.map(({phone:S,email:D,...I})=>I);return{...k,originalBillData:{...k.originalBillData,participants:N}}}return k}),h={...i,participants:c,items:d},m=await R0(JSON.stringify(h),r),u={bill:h,creatorName:t.myDisplayName,publicKey:a,signature:m,paymentDetails:t&&t.paymentDetails?t.paymentDetails:{venmo:"",paypal:"",cashApp:"",zelle:"",customMessage:""}};l&&(u.constituentShares=l);const f=JSON.stringify(u),g=new TextEncoder().encode(f).length,w=pako.deflate(f),j=w.byteLength,x=await Ss(w,n),v=x.length,b=k=>{if(k===0)return"0 B";const N=1024,S=["B","KB","MB","GB"],D=Math.floor(Math.log(k)/Math.log(N));return parseFloat((k/Math.pow(N,D)).toFixed(2))+" "+S[D]};try{const k=JSON.parse(f);console.debug(`Sharing payload stats: Original: ${b(g)}, Compressed: ${b(j)}, Encrypted: ${b(v)}`,k)}catch{console.warn("Could not log share payload for debugging.")}return x}let Er=null,Pr=null;const od=new Map,Mp=500,Tp=async e=>{try{const t=new URL("/health",e).toString(),r=await fetch(t,{method:"GET",signal:AbortSignal.timeout(2e3)});return!!(r.ok&&await r.text()==="OK")}catch(t){return console.debug(`Health check for ${e} failed.`,t),!1}},id=async(e,t=3,r=500)=>{for(let a=0;a<t;a++){if(await Tp(e))return!0;a<t-1&&(console.log(`Health check for ${e} failed. Retrying in ${r*Math.pow(2,a)}ms...`),await new Promise(n=>setTimeout(n,r*Math.pow(2,a))))}return!1},Pp=async()=>{const e="https://backend.sharedbills.app";if(e.length>0){const r=e.split(",").map(a=>a.trim()).filter(Boolean);console.log("Checking for backend API from build-time candidates:",r);for(const a of r)if(await id(a))return console.log(`Discovered and connected to backend API at: ${a}`),a}if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){console.log("No healthy build-time backend found. Falling back to dynamic discovery in dev mode.");const r=[],{hostname:a,protocol:n}=window.location;if(a!=="localhost"&&!a.startsWith("127.0.0.1")){const l=a.startsWith("www.")?a.substring(4):a;["k","c","v","n","a","g","m"].forEach(i=>{r.push(`${n}//${i}.${l}`)})}if(r.length>0){console.log("Checking dynamic candidates:",r);for(const l of r)if(await id(l))return console.log(`Discovered backend via dynamic discovery at: ${l}`),l}}return console.log("No backend discovered. Falling back to relative API paths."),""},_i=()=>(Pr||(Pr=(async()=>{try{Er=await Pp()}catch(e){console.error("API discovery failed:",e),Er=""}})()),Pr),Bp=async()=>(Pr||_i(),await Pr,Er),ce=async e=>(Pr||(console.warn("initializeApi() was not called at startup. Calling it now."),_i()),await Pr,Er===null&&(console.error("API base URL is null after initialization. This indicates a discovery failure. Falling back to relative paths."),Er=""),Er===""?e.startsWith("/")?e:`/${e}`:new URL(e,Er).toString()),de=async(e,t,r=3,a=500)=>{var h;const n=new URL(e.toString(),window.location.origin);let l;const o=((h=t==null?void 0:t.method)==null?void 0:h.toUpperCase())||"GET";if(o==="POST"||o==="PUT"||o==="PATCH"){const m=typeof(t==null?void 0:t.body)=="string"?t.body:"";l=`${o}:${n.pathname}:${m}`}else l=`${o}:${n.pathname}${n.search}`;const i=Date.now(),c=od.get(l);if(c&&i-c<Mp)throw console.warn(`Rate limit exceeded for ${l}. Call blocked.`),new Error("Too many requests. Please wait a moment before trying again.");od.set(l,i);let d;for(let m=0;m<r;m++)try{const u=await fetch(e,t);if(u.ok)return u;if(u.status>=500||u.status===405)throw new Error(`Server error: ${u.status} ${u.statusText}`);return u}catch(u){d=u,console.warn(`Fetch attempt ${m+1} for ${e.toString()} failed. Retrying...`,u.message),m<r-1&&await new Promise(f=>setTimeout(f,a*Math.pow(2,m)))}throw new Error(`All fetch attempts failed for ${e.toString()}. Last error: ${d==null?void 0:d.message}`)};async function Lp(e){var i,c,d,h;if(e.length===0)return[];const t=new Map,r=[],a=new Map;for(const m of e)if(m.constituentShares&&m.constituentShares.length>0)for(const u of m.constituentShares){const f=(i=m.sharedData.bill.items)==null?void 0:i.find(w=>w.id===u.originalBillId),g=((c=f==null?void 0:f.originalBillData)==null?void 0:c.lastUpdatedAt)||m.lastUpdatedAt;r.push({shareId:u.shareId,lastUpdatedAt:g}),t.set(u.shareId,m)}else r.push({shareId:m.shareId,lastUpdatedAt:m.lastUpdatedAt}),a.set(m.shareId,m);const n=Array.from(new Map(r.map(m=>[m.shareId,m])).values()),l=[],o=new Map;try{const m=await de(await ce("/share/batch-check"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(2e4)});if(m.ok){const u=await m.json(),f=new Set(u.map(w=>w.shareId));for(const w of u)if(t.has(w.shareId)){const j=t.get(w.shareId);let x=o.get(j.id)||JSON.parse(JSON.stringify(j));const v=x.constituentShares.find(b=>b.shareId===w.shareId);try{const b=await bt(v.encryptionKey),y=await hs(w.encryptedData,b),k=pako.inflate(y,{to:"string"}),N=JSON.parse(k),S=await Lo(N.publicKey);if(!await ba(JSON.stringify(N.bill),N.signature,S))throw new Error("Signature failed for constituent bill.");const D=x.sharedData.bill.items;if(D){const I=D.findIndex(C=>C.id===v.originalBillId);if(I>-1){D[I].originalBillData=N.bill;const C=(d=x.sharedData.bill.participants.find(P=>P.id===x.myParticipantId))==null?void 0:d.name;if(C){const P=N.bill.participants.find(A=>A.name.toLowerCase().trim()===C.toLowerCase().trim());P&&(D[I].price=P.amountOwed||0)}}}o.set(x.id,x)}catch(b){console.error(`Failed to process constituent update for ${w.shareId}`,b),x.liveStatus!=="stale"&&(x.liveStatus="stale",o.set(x.id,x))}}else if(a.has(w.shareId)){const j=a.get(w.shareId);try{const x=await bt(j.shareEncryptionKey),v=await hs(w.encryptedData,x),b=pako.inflate(v,{to:"string"}),y=JSON.parse(b),k=await Lo(y.publicKey);if(!await ba(JSON.stringify(y.bill),y.signature,k))throw new Error("Signature verification failed.");const N=y.bill.participants.find(I=>I.id===j.myParticipantId),S=N?N.paid:!1,D={...j.localStatus,myPortionPaid:S};l.push({...j,sharedData:{...j.sharedData,bill:y.bill},lastUpdatedAt:w.lastUpdatedAt,liveStatus:"live",localStatus:D})}catch(x){console.error(`Processing updated bill ${w.shareId} failed:`,x),j.liveStatus!=="stale"&&l.push({...j,liveStatus:"stale"})}}for(const w of o.values()){const j=(h=w.sharedData.bill.participants.find(k=>k.id===w.myParticipantId))==null?void 0:h.name;if(!j){console.warn(`Could not find my participant name in summary bill ${w.id}. Skipping recalculation.`),l.push(w);continue}let x=0,v=0,b=!0;const y={...w.localStatus.paidItems||{}};if(w.sharedData.bill.items)for(const k of w.sharedData.bill.items){v+=k.price;let N=!1;const S=k.originalBillData;if(S){const D=S.participants.find(I=>I.name.toLowerCase().trim()===j.toLowerCase().trim());D!=null&&D.paid&&(y[k.id]=!0)}y[k.id]&&(N=!0),N||(x+=k.price,b=!1)}w.sharedData.bill.totalAmount=v,w.sharedData.bill.participants[0]&&(w.sharedData.bill.participants[0].amountOwed=x),w.localStatus.paidItems=y,w.localStatus.myPortionPaid=b,w.liveStatus="live",w.sharedData.bill.items&&(w.lastUpdatedAt=Math.max(...w.sharedData.bill.items.map(k=>{var N;return((N=k.originalBillData)==null?void 0:N.lastUpdatedAt)||0}),w.lastUpdatedAt)),l.push(w)}const g=new Set(n.map(w=>w.shareId));e.forEach(w=>{w.liveStatus==="stale"&&(w.constituentShares&&w.constituentShares.length>0?w.constituentShares.every(x=>g.has(x.shareId))&&l.push({...w,liveStatus:"live"}):g.has(w.shareId)&&!f.has(w.shareId)&&l.push({...w,liveStatus:"live"}))})}else throw new Error(`Batch check failed with status ${m.status}`)}catch(m){console.error("Polling for imported bills failed:",m);for(const u of e)u.liveStatus!=="stale"&&l.push({...u,liveStatus:"stale"})}return Array.from(new Map(l.map(m=>[m.id,m])).values())}async function Rp(e){const t=[],r=e.filter(n=>{var l;return(l=n.shareInfo)==null?void 0:l.shareId});if(r.length===0)return[];const a=r.map(n=>n.shareInfo.shareId);try{const n=await de(await ce("/share/batch-status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareIds:a}),signal:AbortSignal.timeout(15e3)});if(n.ok){const l=await n.json(),o=new Map(l.map(i=>[i.shareId,i.status]));for(const i of r){const c=o.get(i.shareInfo.shareId);c&&i.shareStatus!==c?t.push({...i,shareStatus:c}):!c&&i.shareStatus!=="error"&&t.push({...i,shareStatus:"error"})}}else throw new Error(`Batch status check failed with status ${n.status}`)}catch(n){console.error("Polling failed for owned bills:",n);for(const l of r)l.shareStatus!=="error"&&t.push({...l,shareStatus:"error"})}return t}const Ap=async(e,t,r)=>{let a=JSON.parse(JSON.stringify(e));const n=a.shareInfo,l=await Ea(a.id);if(!(n!=null&&n.shareId)||!n.encryptionKey||!n.signingPublicKey||!l)throw console.error("Cannot recreate share session: Existing keys or shareId are missing.",{billId:a.id}),new Error("Cannot re-sync bill because its original sharing keys or ID are missing.");const{shareId:o,encryptionKey:i,signingPublicKey:c}=n,{privateKey:d}=l,h=await bt(i);delete a.participantShareInfo;const m=await Ms(a,t,d,c,h),u=await de(await ce(`/share/${o}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:m,updateToken:n.updateToken})}),f=await u.json();if(!u.ok)throw new Error(f.error||`Failed to revive the share session on the server for shareId: ${o}.`);return f.updateToken&&a.shareInfo&&(a.shareInfo.updateToken=f.updateToken),f.lastUpdatedAt&&(a.lastUpdatedAt=f.lastUpdatedAt),await r(a,{skipSync:!0}),a};async function cd(e,t,r){var h;if(!((h=e.shareInfo)!=null&&h.shareId)){console.warn("Attempted to sync a bill without a shareId.",e.id);return}const a=await Ea(e.id);if(!a||!a.privateKey)throw new Error(`Could not find signing key for shared bill ${e.id}. Cannot sync update.`);const n=await bt(e.shareInfo.encryptionKey),l=e.shareInfo.signingPublicKey,o=await Ms(e,t,a.privateKey,l,n),i=e.shareInfo.updateToken,c=await de(await ce(`/share/${e.shareInfo.shareId}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:o,updateToken:i})}),d=await c.json();if(!c.ok)throw c.status===403?new Error(d.details||"Update forbidden. This bill may have been updated from another device. Please refresh."):new Error(d.error||"Failed to sync bill update to the server.");if(d.updateToken&&e.shareInfo){console.log(`Received new/updated token for bill ${e.id}. Persisting.`);const m={...e.shareInfo,updateToken:d.updateToken},u={...e,shareInfo:m,lastUpdatedAt:d.lastUpdatedAt};await r(u,{skipSync:!0})}console.log(`Successfully synced update for bill ${e.id}`)}async function Al(e,t){var d;if(!((d=e.shareInfo)!=null&&d.shareId))throw new Error("Cannot reactivate a bill that was never shared.");const r=await Ea(e.id);if(!r||!r.privateKey)throw new Error(`Could not find signing key for shared bill ${e.id}. Cannot reactivate.`);const a=await bt(e.shareInfo.encryptionKey),n=e.shareInfo.signingPublicKey,l=await Ms(e,t,r.privateKey,n,a),o=e.shareInfo.updateToken,i=await de(await ce(`/share/${e.shareInfo.shareId}`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:l,updateToken:o})}),c=await i.json();if(!i.ok)throw new Error(c.error||"Failed to reactivate share on the server.");if(!c.updateToken)throw new Error("Server did not return an update token on reactivation.");return console.log(`Successfully reactivated share for bill ${e.id}`),{lastUpdatedAt:c.lastUpdatedAt,updateToken:c.updateToken}}const Op=async(e,t,r,a,n)=>{var g;const l=[],o=new Map;for(const w of t){let j={...w},x=!1,v=await Ea(j.id);if(!j.shareInfo||!j.shareInfo.shareId||!v){x=!0;const b=await sl();await U0(j.id,b.privateKey),v={billId:j.id,privateKey:b.privateKey};const y=await gt(b.publicKey),k=await Ns(),N=await gt(k);j.shareInfo={...j.shareInfo||{},shareId:((g=j.shareInfo)==null?void 0:g.shareId)||"",encryptionKey:N,signingPublicKey:y}}else x=!0;if(x){if(!v||!j.shareInfo)throw new Error(`Could not find or create signing key for bill ${j.id}`);const b=await bt(j.shareInfo.encryptionKey),y=await Ms(j,r,v.privateKey,j.shareInfo.signingPublicKey,b),k=j.shareInfo.shareId?`/share/${j.shareInfo.shareId}`:"/share",N=await de(await ce(k),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:y,updateToken:j.shareInfo.updateToken})}),S=await N.json();if(!N.ok)throw new Error(S.error||"Failed to create/update share session for constituent bill.");j.shareInfo.shareId=S.shareId,S.updateToken&&(j.shareInfo.updateToken=S.updateToken),S.lastUpdatedAt&&(j.lastUpdatedAt=S.lastUpdatedAt),o.set(j.id,j)}j.shareInfo&&l.push({originalBillId:j.id,shareId:j.shareInfo.shareId,publicKey:j.shareInfo.signingPublicKey,encryptionKey:j.shareInfo.encryptionKey})}o.size>0&&await a(Array.from(o.values()));const i=t.reduce((w,j)=>{const x=j.participants.find(v=>v.name===e);return w+((x==null?void 0:x.amountOwed)||0)},0);let c=0,d=n;const m=[...t].sort((w,j)=>new Date(j.date).getTime()-new Date(w.date).getTime()).map(w=>{const j=w.participants.find(v=>v.name===e),x={...o.get(w.id)||w};return x.receiptImage&&(d>0?d--:(c++,delete x.receiptImage)),{id:w.id,name:w.description,price:(j==null?void 0:j.amountOwed)||0,assignedTo:[],originalBillData:JSON.parse(JSON.stringify(x))}}),u={id:`p-summary-${e.replace(/\s/g,"")}`,name:e,amountOwed:i,paid:i<.01};return{summaryBill:{id:`summary-${Date.now()}`,description:`Summary for ${e}`,totalAmount:i,date:new Date().toISOString(),participants:[u],items:m,status:"active"},constituentShares:l,imagesDropped:c}},zp=5,Q0=async(e,t,r,a,n,l)=>{let o=1/0;if(l==="free"){const ee=n.filter(K=>{var L;return K.status==="active"&&!!((L=K.shareInfo)!=null&&L.shareId)&&!!K.receiptImage}).length;o=Math.max(0,zp-ee)}const{summaryBill:i,constituentShares:c,imagesDropped:d}=await Op(t,e,r,a,o),h=await sl(),m=await gt(h.publicKey),u=await Ns(),f=await Ms(i,r,h.privateKey,m,u,c),g=await de(await ce("/share"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:f})}),w=await g.json();if(!g.ok)throw new Error(w.error||"Failed to create share session.");const{shareId:j}=w,x=i.participants[0].id,v=pako.deflate(x),y=(await Ss(v,u)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),k=await Ns(),N=await gt(u),S=pako.deflate(JSON.stringify(N)),D=await Ss(S,k),I=await de(await ce("/onetime-key"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedBillKey:D})}),C=await I.json();if(!I.ok)throw new Error(C.error||"Failed to create one-time key session.");const{keyId:P}=C,A=await gt(k),z=Y0(JSON.stringify(A)),U=new URL(window.location.href);return U.hash=`#/view-bill?shareId=${j}&keyId=${P}&fragmentKey=${z}&p=${y}`,{shareUrl:U.toString(),imagesDropped:d}},$p=async(e,t,r,a)=>{let n=JSON.parse(JSON.stringify(e)),l=!1;if(n.shareInfo&&n.shareInfo.shareId)try{const j=await de(await ce(`/share/${n.shareInfo.shareId}`),{method:"GET",signal:AbortSignal.timeout(4e3)});if(j.status===404)console.warn(`Share session for bill ${n.id} not found on server. Recreating...`),n=await Ap(n,r,a);else if(!j.ok){const x=await j.json().catch(()=>({}));throw new Error(x.error||`Failed to verify existing share session. Status: ${j.status}`)}}catch(j){throw console.error("Could not verify share session:",j),j.name==="AbortError"?new Error("Could not connect to the server to verify the share link. Please check your connection and try again."):new Error(j.message||"An unexpected error occurred while verifying the share link.")}if(!n.shareInfo||!n.shareInfo.shareId){l=!0;const j=await sl();await U0(n.id,j.privateKey);const x=await gt(j.publicKey),v=await Ns(),b=await gt(v),y=await Ms(n,r,j.privateKey,x,v),k=await de(await ce("/share"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:y})}),N=await k.json();if(!k.ok)throw new Error(N.error||"Failed to create share session.");n.shareInfo={shareId:N.shareId,encryptionKey:b,signingPublicKey:x,updateToken:N.updateToken}}n.participantShareInfo||(n.participantShareInfo={});const o=n.participantShareInfo[t],i=Date.now();let c=!1;if(o&&i<o.expires)try{const j=await de(await ce(`/onetime-key/${o.keyId}/status`));if(j.ok){const{status:x}=await j.json();x==="available"&&(c=!0)}}catch(j){console.error("Failed to check key status, will generate a new one.",j),c=!1}if(!c){l=!0;const j=await bt(n.shareInfo.encryptionKey),x=await Ns(),v=await gt(j),b=pako.deflate(JSON.stringify(v)),y=await Ss(b,x),k=await de(await ce("/onetime-key"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedBillKey:y})}),N=await k.json();if(!k.ok)throw new Error(N.error||"Failed to create one-time key session.");const S=await gt(x);n.participantShareInfo[t]={keyId:N.keyId,fragmentKey:S,expires:i+5*60*1e3}}l&&await a(n,{skipSync:!0});const d=await bt(n.shareInfo.encryptionKey),h=pako.deflate(t),u=(await Ss(h,d)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),f=n.participantShareInfo[t],g=Y0(JSON.stringify(f.fragmentKey)),w=new URL(window.location.href);return w.hash=`#/view-bill?shareId=${n.shareInfo.shareId}&keyId=${f.keyId}&fragmentKey=${g}&p=${u}`,{url:w.toString(),billWithNewShareInfo:n}},Ts=()=>"Notification"in window&&"serviceWorker"in navigator,_p=()=>Ts()&&"showTrigger"in Notification.prototype,Fp=async()=>Ts()?Notification.requestPermission():(console.warn("Notifications are not supported in this browser."),"denied"),X0=e=>`bill-reminder-${e}`,Up=async(e,t)=>{if(!Ts()||Notification.permission!=="granted")return;const r=await navigator.serviceWorker.ready,a=X0(e.id),n=new Date(e.nextDueDate);n.setHours(9,0,0,0);const l=n.getTime()-t*24*60*60*1e3;if(l<Date.now()){console.log(`Skipping notification for "${e.description}" as its reminder date is in the past.`),await _o(e.id);return}const o="Upcoming Bill Reminder",i={body:`Your "${e.description}" bill is due in ${t} day${t>1?"s":""}.`,tag:a,icon:"/icon.svg",silent:!0};if(_p()){console.log(`[App] Scheduling notification for "${e.description}" using TimestampTrigger.`),(await r.getNotifications({tag:a})).forEach(d=>d.close());try{await r.showNotification(o,{...i,showTrigger:new window.TimestampTrigger(l)})}catch(d){console.error("[App] Error scheduling with TimestampTrigger:",d)}}else console.log(`[App] Scheduling notification for "${e.description}" via SW setTimeout fallback.`),(await r.getNotifications({tag:a})).forEach(d=>d.close()),navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({type:"schedule-notification",title:o,options:i,triggerTimestamp:l,tag:a}):console.warn("[App] Service worker controller not available. Cannot schedule fallback notification.")},_o=async e=>{if(!Ts())return;const t=await navigator.serviceWorker.ready,r=X0(e),a=await t.getNotifications({tag:r});a.length>0&&(a.forEach(n=>n.close()),console.log(`[App] Canceled native scheduled notification for bill ID ${e}`)),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"cancel-notification",tag:r})},Vp=({bills:e,importedBills:t,recurringBills:r,settings:a,updateMultipleImportedBills:n,originalUpdateMultipleBills:l,view:o})=>{p.useEffect(()=>{const i=async()=>{if(o===H.BillDetails||o===H.ImportedBillDetails||o===H.ViewShared)return;const d=t.filter(h=>h.status==="active");if(d.length>0){const h=await Lp(d);h.length>0&&await n(h)}},c=setInterval(i,3e4);return i(),()=>clearInterval(c)},[t,n,o]),p.useEffect(()=>{const i=async()=>{if(o===H.BillDetails||o===H.ImportedBillDetails||o===H.ViewShared)return;const d=e.filter(h=>{var m;return(m=h.shareInfo)==null?void 0:m.shareId});if(d.length>0){const h=await Rp(d);h.length>0&&await l(h)}},c=setInterval(i,3e5);return i(),()=>clearInterval(c)},[e,l,o]),p.useEffect(()=>{if(!Ts())return;(async()=>{if(a.notificationsEnabled&&Notification.permission==="granted"){const c=r.filter(m=>m.status==="active");for(const m of c)await Up(m,a.notificationDays);const h=await(await navigator.serviceWorker.ready).getNotifications();for(const m of h){const u=m.tag.replace("bill-reminder-","");c.some(f=>f.id===u)||await _o(u)}}else for(const c of r)await _o(c.id)})().catch(c=>console.error("Failed to sync notifications:",c))},[a.notificationsEnabled,a.notificationDays,r])},Hp=5,Wp=({bills:e,recurringBills:t,settings:r,subscriptionStatus:a,showNotification:n,requestConfirmation:l,navigate:o,originalUpdateBill:i,originalUpdateMultipleBills:c,addBill:d,deleteBill:h,addImportedBill:m,deleteImportedBill:u,addRecurringBill:f,updateRecurringBill:g,deleteRecurringBill:w,updateRecurringBillDueDate:j,addGroup:x,updateGroup:v,deleteGroup:b,incrementGroupPopularity:y})=>{const k=p.useCallback(async(M,R)=>{const $=await i(M);return R!=null&&R.skipSync?(le({type:"bills-updated"}),$):((async()=>{var G;try{if((G=$.shareInfo)!=null&&G.shareId){console.log(`[Sync] Initiating update for shared bill: ${$.id}`);const V=await de(await ce(`/share/${$.shareInfo.shareId}`),{method:"GET",signal:AbortSignal.timeout(4e3)});if(V.status===404){console.log(`[Sync] Share for bill ${$.id} not found on server. Re-creating...`);const{lastUpdatedAt:oe,updateToken:fe}=await Al($,r);await i({...$,shareStatus:"live",lastUpdatedAt:oe,shareInfo:{...$.shareInfo,updateToken:fe}}),console.log(`[Sync] Successfully re-created share for bill ${$.id}.`)}else if(V.ok)console.log(`[Sync] Share for bill ${$.id} is live. Pushing update...`),await cd($,r,i),console.log(`[Sync] Successfully synced update for bill ${$.id}.`);else{const oe=await V.json().catch(()=>({}));throw new Error(oe.error||`Server returned status ${V.status} during share check.`)}}}catch(V){console.error(`[Sync] Failed to sync shared bill update for bill ID ${$.id}:`,V),n(V.message||`Failed to sync update for "${$.description}"`,"error"),await i({...$,shareStatus:"error"})}finally{le({type:"bills-updated"})}})(),$)},[i,r,n]),N=p.useCallback(async M=>{const R=await c(M);(async()=>{var $;try{for(const G of R)if(($=G.shareInfo)!=null&&$.shareId){console.log(`[Sync] Initiating update for shared bill in batch: ${G.id}`);const V=await de(await ce(`/share/${G.shareInfo.shareId}`),{method:"GET",signal:AbortSignal.timeout(4e3)});if(V.status===404){console.log(`[Sync] Share for bill ${G.id} not found on server. Re-creating...`);const{lastUpdatedAt:oe,updateToken:fe}=await Al(G,r);await i({...G,shareStatus:"live",lastUpdatedAt:oe,shareInfo:{...G.shareInfo,updateToken:fe}})}else if(V.ok)await cd(G,r,i);else throw new Error(`Server returned status ${V.status} during share check.`)}}catch(G){console.error("[Sync] Failed to sync a shared bill during batch update:",G)}finally{le({type:"bills-updated"})}})()},[c,r,n,i]),S=p.useCallback(async M=>{if(a!=="free"||!M.receiptImage)return!0;const R=e.filter(G=>{var V;return G.id!==M.id&&G.status==="active"&&!!((V=G.shareInfo)!=null&&V.shareId)&&!!G.receiptImage});if(R.length<Hp)return!0;const $=[...R].sort((G,V)=>(G.lastUpdatedAt||0)-(V.lastUpdatedAt||0))[0];n(`Free image limit reached. Removing image from "${$.description}" to make space.`,"info"),await new Promise(G=>setTimeout(G,2e3));try{return await k({...$,receiptImage:void 0}),n("Space freed. Proceeding with share.","success"),!0}catch(G){return console.error("Failed to automatically downgrade bill:",G),n(`Error: ${G.message||"Could not make space for the new image."}`,"error"),!1}},[a,e,k,n]),D=p.useCallback(async(M,R)=>{if(await d(M),M.groupId&&await y(M.groupId),R){await j(R);const $=t.find(G=>G.id===R);n(`Created bill from "${($==null?void 0:$.description)||"template"}"`)}else n("Bill created successfully!")},[d,y,j,t,n]),I=p.useCallback(M=>{M.isImported?o(H.ImportedBillDetails,{importedBillId:M.billId}):o(H.BillDetails,{billId:M.billId})},[o]),C=p.useCallback(async M=>{await f(M),n("Recurring template created!")},[f,n]),P=p.useCallback(async M=>{await g(M),n("Template updated successfully!")},[g,n]),A=p.useCallback(async M=>{await x(M),n(`Group "${M.name}" created!`)},[x,n]),z=p.useCallback(async M=>{await v(M),n(`Group "${M.name}" updated!`)},[v,n]),U=p.useCallback(M=>l("Delete Bill?","This action is permanent.",()=>{h(M),n("Bill deleted.")},{confirmText:"Delete",confirmVariant:"danger"}),[l,h,n]),ee=p.useCallback(M=>l("Delete Imported Bill?","This removes it from your dashboard.",()=>{u(M),n("Imported bill deleted.")},{confirmText:"Delete",confirmVariant:"danger"}),[l,u,n]),K=p.useCallback(M=>l("Delete Template?","This action is permanent.",()=>{w(M),n("Template deleted.")},{confirmText:"Delete",confirmVariant:"danger"}),[l,w,n]),L=p.useCallback(M=>l("Delete Group?","This action is permanent.",()=>{b(M),n("Group deleted.")},{confirmText:"Delete",confirmVariant:"danger"}),[l,b,n]),E=p.useCallback(async M=>{const R=e.find($=>$.id===M);if(!R){n("Bill not found.","error");return}try{const{lastUpdatedAt:$,updateToken:G}=await Al(R,r);await k({...R,shareStatus:"live",lastUpdatedAt:$,shareInfo:{...R.shareInfo,updateToken:G}}),n("Bill reshared successfully!")}catch($){n($.message||"Failed to reshare.","error")}},[e,r,k,n]),T=p.useCallback(M=>{const R={...M,participants:M.participants.map($=>({...$,paid:!1})),date:new Date().toISOString(),totalAmount:M.totalAmount||0};d(R),j(M.id),n(`Created bill from "${M.description}"`)},[d,j,n]);return{updateBill:k,updateMultipleBills:N,checkAndMakeSpaceForImageShare:S,handleSaveBill:D,handleSelectBillFromBudget:I,handleSaveRecurringBill:C,handleUpdateRecurringBill:P,handleSaveGroup:A,handleUpdateGroup:z,handleDeleteBill:U,handleDeleteImportedBill:ee,handleDeleteRecurringBill:K,handleDeleteGroup:L,handleReshareBill:E,createFromTemplate:T}},Kp=()=>{const e=kp(),t=pp(),r=xp(),a=vp(),n=wp(),l=bp(),o=jp(),i=Ma(),c=Np(),d=ut(),h=Cp(),m=Ip(e.settings,e.updateSettings),u=Sp({bills:t.bills,recurringBills:a.recurringBills,groups:n.groups}),{view:f}=u;p.useEffect(()=>{f!==H.Dashboard&&(m.setSelectedParticipant(null),m.onSetDashboardSummaryFilter("total"))},[f,m.setSelectedParticipant,m.onSetDashboardSummaryFilter]);const g=Dp({bills:t.bills,importedBills:r.importedBills,recurringBills:a.recurringBills,groups:n.groups,categories:l.categories,settings:e.settings,isBillsLoading:t.isLoading,isImportedLoading:r.isLoading,isRecurringLoading:a.isLoading,isSettingsLoading:e.isLoading,isGroupsLoading:n.isLoading,isCategoriesLoading:l.isLoading,dashboardStatusFilter:m.dashboardStatusFilter,budgetDate:m.budgetDate});Vp({bills:t.bills,importedBills:r.importedBills,recurringBills:a.recurringBills,settings:e.settings,updateMultipleImportedBills:r.updateMultipleImportedBills,originalUpdateMultipleBills:t.updateMultipleBills,view:f});const w=Wp({bills:t.bills,recurringBills:a.recurringBills,settings:e.settings,subscriptionStatus:i.subscriptionStatus,showNotification:d.showNotification,requestConfirmation:h.requestConfirmation,navigate:u.navigate,originalUpdateBill:t.updateBill,originalUpdateMultipleBills:t.updateMultipleBills,addBill:t.addBill,deleteBill:t.deleteBill,addImportedBill:r.addImportedBill,deleteImportedBill:r.deleteImportedBill,addRecurringBill:a.addRecurringBill,updateRecurringBill:a.updateRecurringBill,deleteRecurringBill:a.deleteRecurringBill,updateRecurringBillDueDate:a.updateRecurringBillDueDate,addGroup:n.addGroup,updateGroup:n.updateGroup,deleteGroup:n.deleteGroup,incrementGroupPopularity:n.incrementGroupPopularity}),j=p.useMemo(()=>t.bills.find(v=>v.id===u.params.billId),[t.bills,u.params.billId]),x=p.useMemo(()=>r.importedBills.find(v=>v.id===u.params.importedBillId),[r.importedBills,u.params.importedBillId]);return{...e,...t,...r,...a,...n,...l,...o,...i,...c,...d,...h,...m,...u,...g,...w,currentBill:j,currentImportedBill:x}},Gp=({navigate:e,onOpenSettings:t,currentView:r,canInstall:a,promptInstall:n})=>{const[l,o]=p.useState(!1),i=p.useRef(null),c=[{id:"personalization",title:"Personalization",icon:""},{id:"payments",title:"Payment Methods",icon:""},{id:"budgeting",title:"Budgeting",icon:""},{id:"reminders",title:"Bill Reminders",icon:""},{id:"subscription",title:"Subscription",icon:""},{id:"about",title:"About & Support",icon:""},{id:"data",title:"Data & Tools",icon:""},{id:"sync",title:"Sync Devices",icon:""},{id:"disclaimer",title:"Disclaimer & Privacy",icon:""}];p.useEffect(()=>{const h=m=>{i.current&&!i.current.contains(m.target)&&o(!1)};return l&&document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[l]);const d=h=>{h(),o(!1)};return s.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg sticky top-0 z-40 w-full border-b border-slate-200 dark:border-slate-700",children:s.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center h-16",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>e(H.Dashboard),children:[s.jsx("svg",{className:"h-8 w-8 text-teal-500",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M17 9V7C17 5.89543 16.1046 5 15 5H5C3.89543 5 3 5.89543 3 7V13C3 14.1046 3.89543 15 5 15H7M9 19H19C20.1046 19 21 18.1046 21 17V11C21 9.89543 20.1046 9 19 9H9C7.89543 9 7 9.89543 7 11V17C7 18.1046 7.89543 19 9 19ZM16 14C16 15.1046 15.1046 16 14 16C12.8954 16 12 15.1046 12 14C12 12.8954 12.8954 12 14 12C15.1046 12 16 12.8954 16 14Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),s.jsx("h1",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"SharedBills"})]})}),s.jsx("div",{className:"flex-grow flex justify-center",children:r===H.Dashboard&&s.jsx("button",{id:"create-new-bill-button",onClick:()=>e(H.CreateBill),className:"p-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full","aria-label":"Create new bill",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})}),s.jsxs("div",{ref:i,className:"relative flex-shrink-0",children:[s.jsx("button",{onClick:()=>o(h=>!h),className:"p-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg","aria-label":"More options",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z"})})}),l&&s.jsxs("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white dark:bg-slate-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 py-1 z-20",children:[c.map(h=>s.jsx("button",{onClick:()=>d(()=>t(h.id)),className:"w-full text-left flex items-center justify-between gap-3 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{children:h.icon}),s.jsx("span",{children:h.title})]})},h.id)),a&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"my-1 h-px bg-slate-100 dark:bg-slate-700"}),s.jsxs("button",{onClick:()=>d(n),className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:[s.jsx("span",{className:"text-base",children:""}),s.jsx("span",{children:"Install App"})]})]}),s.jsx("div",{className:"my-1 h-px bg-slate-100 dark:bg-slate-700"}),s.jsxs("button",{onClick:()=>d(()=>e(H.Settings)),className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"All Settings"})]})]})]})]})})})},ft=({onClick:e,disabled:t,icon:r,text:a,subtext:n})=>s.jsxs("button",{onClick:e,disabled:t,className:"w-full flex items-center gap-4 text-left p-4 bg-white dark:bg-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors disabled:opacity-50 disabled:cursor-wait cursor-pointer",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center",children:r}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-100",children:a}),n&&s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:n})]}),t&&s.jsxs("svg",{className:"animate-spin h-5 w-5 text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]}),q0=e=>{const{participant:t,shareContext:r,onClose:a,onShareSms:n,onShareEmail:l,onShareGeneric:o,onShareLinkSms:i,onShareLinkEmail:c,onShareLinkGeneric:d,onViewDetails:h}=e,[m,u]=p.useState("choose"),[f,g]=p.useState(!1),w=typeof navigator<"u"&&!!navigator.share;_n.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);const j=async k=>{if(k){g(!0);try{await k(t)}catch{}finally{g(!1),a()}}},x=()=>s.jsxs("div",{className:"space-y-4",children:[s.jsx(ft,{onClick:()=>u("reminder"),icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-teal-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z",clipRule:"evenodd"})}),text:"Send Simple Reminder",subtext:"A plain text message with amounts owed."}),s.jsx(ft,{onClick:()=>u("link"),icon:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:[s.jsx("path",{d:"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"}),s.jsx("path",{d:"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"})]}),text:"Send Interactive Bill",subtext:"A secure, live-updating link to the bill."}),h&&s.jsx("div",{className:"pt-3 border-t border-slate-200 dark:border-slate-700",children:s.jsx(ft,{onClick:h,icon:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-slate-500",viewBox:"0 0 20 20",fill:"currentColor",children:[s.jsx("path",{d:"M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"}),s.jsx("path",{fillRule:"evenodd",d:"M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z",clipRule:"evenodd"})]}),text:"View All Bills"})})]}),v=()=>s.jsxs("div",{className:"space-y-2",children:[t.phone&&s.jsx(ft,{onClick:()=>n(t),icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-teal-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z",clipRule:"evenodd"})}),text:"Share via Text"}),t.email&&s.jsx(ft,{onClick:()=>l(t),icon:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-teal-500",viewBox:"0 0 20 20",fill:"currentColor",children:[s.jsx("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),s.jsx("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]}),text:"Share via Email"}),w?s.jsx(ft,{onClick:()=>o(t),icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-teal-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"})}),text:"Share Reminder..."}):s.jsx(ft,{onClick:()=>o(t),icon:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-teal-500",viewBox:"0 0 20 20",fill:"currentColor",children:[s.jsx("path",{d:"M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2-2H9a2 2 0 01-2-2V9z"}),s.jsx("path",{d:"M4 3a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H4z"})]}),text:"Copy Reminder Text"})]}),b=()=>s.jsxs("div",{className:"space-y-2",children:[t.phone&&i&&s.jsx(ft,{onClick:()=>j(i),disabled:f,icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z",clipRule:"evenodd"})}),text:"Share Link via Text"}),t.email&&c&&s.jsx(ft,{onClick:()=>j(c),disabled:f,icon:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:[s.jsx("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),s.jsx("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]}),text:"Share Link via Email"}),d&&(w?s.jsx(ft,{onClick:()=>j(d),disabled:f,icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"})}),text:"Share Link..."}):s.jsx(ft,{onClick:()=>j(d),disabled:f,icon:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:[s.jsx("path",{d:"M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2-2H9a2 2 0 01-2-2V9z"}),s.jsx("path",{d:"M4 3a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H4z"})]}),text:"Copy Link"}))]}),y=()=>{switch(m){case"reminder":return v();case"link":return b();case"choose":default:return x()}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end backdrop-blur-sm",onClick:a,role:"dialog","aria-modal":"true","aria-labelledby":"share-sheet-title",children:s.jsxs("div",{className:"w-full bg-slate-100 dark:bg-slate-800 rounded-t-2xl p-4 animate-slide-up shadow-2xl",onClick:k=>k.stopPropagation(),children:[s.jsx("div",{className:"w-10 h-1.5 bg-slate-300 dark:bg-slate-600 rounded-full mx-auto mb-4"}),s.jsx("div",{className:"text-center mb-6",children:s.jsxs("h3",{id:"share-sheet-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100 flex items-center justify-center gap-3",children:[m!=="choose"&&s.jsx("button",{onClick:()=>u("choose"),className:"p-1 -ml-2 text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),s.jsxs("span",{children:["Share with ",t.name]})]})}),y(),s.jsx("div",{className:"mt-6",children:s.jsx("button",{onClick:a,className:"w-full px-4 py-3 bg-white dark:bg-slate-700 text-teal-600 dark:text-teal-300 font-bold rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors",children:"Cancel"})})]})})},Yp=e=>`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Advertisement</title>
      <style>
        html, body { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; display: flex; align-items: center; justify-content: center; background-color: transparent; }
        iframe { border: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: transparent; }
      </style>
    </head>
    <body>
      <iframe data-aa="${e}" src="//acceptable.a-ads.com/${e}?size=responsive"></iframe>
    </body>
    </html>
  `,Jp=()=>{const e="a-ads",t="2411644";switch(e){case"a-ads":if(t.trim()===""){const n="Ad provider is 'a-ads' but the required VITE_AADS_ID environment variable is missing. Ads will not be displayed.";return console.warn(n),{content:null,error:n}}return{content:Yp(t),error:null};case"custom":{const n="Ad provider is 'custom' but the required VITE_CUSTOM_AD_HTML_BASE64 environment variable is missing. Ads will not be displayed.";return console.warn(n),{content:null,error:n}}case"admob":const r="Ad provider 'AdMob' is configured but is not yet supported in this version. Ads will not be displayed.";return console.warn(r),{content:null,error:r};case"none":return{content:null,error:null};default:const a=`Unknown ad provider '${e}' is configured in VITE_AD_PROVIDER. Ads will not display. Valid options are 'a-ads', 'custom', or 'none'.`;return console.warn(a),{content:null,error:a}}},Z0=Jp(),Cs=Z0.content,dd=Z0.error,Qp=({onClose:e})=>{const t=p.useRef(null),r=p.useRef(null),[a,n]=p.useState(!1);p.useEffect(()=>{const o=setTimeout(()=>{t.current&&t.current.classList.remove("translate-y-full")},100);return()=>clearTimeout(o)},[]),p.useEffect(()=>{const o=new IntersectionObserver(([i])=>{i.isIntersecting&&(n(!0),r.current&&o.unobserve(r.current))},{threshold:.5});return r.current&&o.observe(r.current),()=>{r.current&&o.unobserve(r.current)}},[]);const l=()=>{t.current?(t.current.classList.add("translate-y-full"),setTimeout(e,300)):e()};return Cs?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-end backdrop-blur-sm",onClick:l,role:"dialog","aria-modal":"true","aria-label":"Advertisement",children:s.jsx("div",{ref:t,className:"w-full h-1/2 bg-white dark:bg-slate-800 rounded-t-2xl shadow-2xl transform translate-y-full transition-transform duration-300 ease-out",onClick:o=>o.stopPropagation(),children:s.jsxs("div",{className:"relative h-full flex flex-col p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider",children:"Advertisement"}),s.jsx("button",{onClick:l,className:"p-1.5 text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-full transition-colors","aria-label":"Close ad",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{ref:r,className:"flex-grow w-full h-full",children:a&&s.jsx("iframe",{srcDoc:Cs,title:"Advertisement",style:{width:"100%",height:"100%",border:"0",overflow:"hidden"},sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox","aria-label":"Advertisement Content"})}),s.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 text-center mt-2",children:"Upgrade to Pro to remove ads!"})]})})}):null},em=({onIntersect:e,root:t=null,rootMargin:r="0px",threshold:a=.1})=>{const n=p.useRef(null),l=p.useCallback(o=>{o.forEach(i=>{i.isIntersecting&&e()})},[e]);return p.useEffect(()=>{const o=new IntersectionObserver(l,{root:t,rootMargin:r,threshold:a}),i=n.current;return i&&o.observe(i),()=>{i&&o.unobserve(i)}},[n,t,r,a,l]),{ref:n}},ll=({paymentDetails:e,billDescription:t,amountOwed:r,creatorName:a,onClose:n})=>{const[l,o]=p.useState(null),i=u=>{const f=r.toFixed(2),g=encodeURIComponent(t);let w="";switch(u){case"venmo":w=`venmo://paycharge?txn=pay&recipients=${e.venmo.trim()}&amount=${f}&note=${g}`,window.location.href=w;break;case"paypal":let x=e.paypal.trim();x.includes("@")?w=`https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=${encodeURIComponent(x)}&amount=${f}&item_name=${g}&currency_code=USD`:(x=x.replace(/^(https?:\/\/)?(www\.)?paypal\.me\//i,""),w=`https://paypal.me/${x}/${f}`),window.open(w,"_blank","noopener,noreferrer");break;case"cashApp":w=`https://cash.app/$${e.cashApp.trim().replace(/^\$/,"")}/${f}?note=${g}`,window.open(w,"_blank","noopener,noreferrer");break}},c=[{id:"venmo",name:"Venmo",logo:"https://cdn.simpleicons.org/venmo/008CFF",info:e.venmo},{id:"paypal",name:"PayPal",logo:"https://cdn.simpleicons.org/paypal/00457C",info:e.paypal},{id:"cashApp",name:"Cash App",logo:"https://cdn.simpleicons.org/cashapp/00C246",info:e.cashApp},{id:"zelle",name:"Zelle",logo:"https://cdn.simpleicons.org/zelle/6D1AD8",info:e.zelle}].filter(u=>u.info&&u.info.trim()!==""),d=({logo:u,name:f,onClick:g})=>s.jsxs("button",{onClick:g,className:"w-full flex items-center gap-4 text-left p-4 bg-slate-100 dark:bg-slate-700/50 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",children:[s.jsx("img",{src:u,alt:`${f} logo`,className:"h-8 w-8 object-contain"}),s.jsxs("span",{className:"font-semibold text-slate-800 dark:text-slate-100",children:["Pay with ",f]})]}),h=()=>s.jsxs("div",{className:"space-y-3",children:[c.map(u=>s.jsx(d,{logo:u.logo,name:u.name,onClick:()=>o(u.id)},u.id)),e.customMessage&&s.jsxs("div",{className:"text-left p-4 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:[s.jsxs("p",{className:"font-semibold text-slate-800 dark:text-slate-100",children:["A Note from ",a]}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 whitespace-pre-wrap mt-1",children:e.customMessage})]})]}),m=()=>{const u=c.find(f=>f.id===l);return u?s.jsxs("div",{children:[s.jsxs("button",{onClick:()=>o(null),className:"flex items-center gap-2 mb-4 text-teal-600 dark:text-teal-400 font-semibold",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back"]}),s.jsxs("div",{className:"p-6 bg-slate-100 dark:bg-slate-700/50 rounded-lg text-center",children:[s.jsx("img",{src:u.logo,alt:`${u.name} logo`,className:"h-12 w-12 object-contain mx-auto mb-4"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:u.id==="zelle"?"Use this email/phone in your banking app to pay with Zelle:":`You are about to pay ${a} using ${u.name}.`}),s.jsx("p",{className:"font-mono text-lg font-semibold my-2 p-2 bg-slate-200 dark:bg-slate-600 rounded break-all",children:u.info}),u.id!=="zelle"&&s.jsx("button",{onClick:()=>i(u.id),className:"w-full mt-4 px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Launch App"})]})]}):null};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:n,children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[90vh]",onClick:u=>u.stopPropagation(),children:[s.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:[s.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:["Settle up with ",a]}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["You owe ",s.jsxs("span",{className:"font-bold text-slate-700 dark:text-slate-200",children:["$",r.toFixed(2)]}),' for "',t,'".']})]}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:l?m():h()}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end flex-shrink-0",children:s.jsx("button",{onClick:n,className:"px-5 py-2 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Close"})})]})})},tm=({onClose:e,onContinue:t,onAddMethods:r,onUpdateSettings:a})=>{const[n,l]=p.useState(!1),o=()=>{n&&a({hidePaymentMethodWarning:!0}),t()},i=()=>{n&&a({hidePaymentMethodWarning:!0}),r()};return s.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-80 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:e,children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg p-8",onClick:c=>c.stopPropagation(),children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 text-center mb-4",children:"Add Payment Methods?"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6 text-center",children:"You haven't set up any payment methods. Adding them makes it easier for others to pay you back."}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("button",{onClick:i,className:"w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600",children:"Add Payment Methods"}),s.jsx("button",{onClick:o,className:"w-full px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",children:"Continue Anyway"})]}),s.jsxs("div",{className:"mt-6 flex items-center justify-center",children:[s.jsx("input",{id:"dontShowAgain",type:"checkbox",checked:n,onChange:c=>l(c.target.checked),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),s.jsx("label",{htmlFor:"dontShowAgain",className:"ml-2 text-sm text-slate-600 dark:text-slate-300",children:"Don't show this warning again"})]})]})})},Xp="# SharedBills CSV Export v2",qp=(e,t,r)=>{const a=new Blob([t],{type:r}),n=URL.createObjectURL(a),l=document.createElement("a");l.href=n,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)},Zp=["RowType","BillID","BillType","Description","Date","TotalAmount","CreatorName","ParticipantID","ParticipantName","AmountOwed","PaidStatus","ShareInfoJSON","LastUpdatedAt"],ud=e=>{if(e==null)return'""';try{return`"${JSON.stringify(e).replace(/"/g,'""')}"`}catch{return'""'}},Gr=e=>`"${(e||"").replace(/"/g,'""')}"`,xs=async(e,t)=>{var o;const{owned:r=[],imported:a=[]}=e,n=[];n.push(Zp.join(","));for(const i of r){let c={};if((o=i.shareInfo)!=null&&o.shareId){const m=await Ea(i.id);if(m!=null&&m.privateKey){const u=await gt(m.privateKey);c={shareId:i.shareInfo.shareId,encryptionKey:i.shareInfo.encryptionKey,signingPublicKey:i.shareInfo.signingPublicKey,signingPrivateKey:u}}}const d=ud(c),h=["BILL",i.id,"OWNED",Gr(i.description),i.date,i.totalAmount.toFixed(2),"","","","","",d,i.lastUpdatedAt||0].join(",");n.push(h);for(const m of i.participants){const u=["PARTICIPANT",i.id,"OWNED","","","","",m.id,Gr(m.name),m.amountOwed.toFixed(2),m.paid?"Paid":"Unpaid","",""].join(",");n.push(u)}}for(const i of a){const c=ud({shareId:i.shareId,shareEncryptionKey:i.shareEncryptionKey,creatorPublicKey:i.sharedData.creatorPublicKey,myParticipantId:i.myParticipantId}),d=["BILL",i.id,"IMPORTED",Gr(i.sharedData.bill.description),i.sharedData.bill.date,i.sharedData.bill.totalAmount.toFixed(2),Gr(i.creatorName),"","","","",c,i.lastUpdatedAt].join(",");n.push(d);for(const h of i.sharedData.bill.participants){let m=h.paid?"Paid":"Unpaid";h.id===i.myParticipantId&&(m=i.localStatus.myPortionPaid?"Paid":"Unpaid");const u=["PARTICIPANT",i.id,"IMPORTED","","","",Gr(i.creatorName),h.id,Gr(h.name),h.amountOwed.toFixed(2),m,"",""].join(",");n.push(u)}}const l=[Xp,...n].join(`
`);qp(t,l,"text/csv;charset=utf-8;")},ex=({summaryTotals:e,dashboardStatusFilter:t,dashboardSummaryFilter:r,onSetDashboardSummaryFilter:a})=>{const n=(d,h)=>{(d.key==="Enter"||d.key===" ")&&t==="active"&&(d.preventDefault(),a(h))},l="p-3 flex-1 rounded-lg transition-all duration-300",o="cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700/50",i="bg-teal-50 dark:bg-teal-900/40 ring-2 ring-teal-500",c="opacity-60 cursor-not-allowed";return s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md mb-8",children:[s.jsx("h3",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-3 px-2",children:"Quick Filters"}),s.jsxs("div",{className:"flex flex-wrap items-stretch text-center gap-4",children:[s.jsxs("div",{className:`${l} ${r==="total"?i:t==="active"?o:""} ${t==="archived"?c:""}`,onClick:()=>t==="active"&&a("total"),onKeyDown:d=>n(d,"total"),role:"button",tabIndex:t==="active"?0:-1,"aria-pressed":r==="total","aria-label":"Filter by Total Tracked","aria-disabled":t==="archived",children:[s.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Total Tracked"}),s.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-slate-800 dark:text-slate-100 mt-1",children:["$",e.totalTracked.toFixed(2)]})]}),s.jsxs("div",{className:`${l} ${r==="othersOweMe"?i:t==="active"?o:""} ${t==="archived"?c:""}`,onClick:()=>t==="active"&&a("othersOweMe"),onKeyDown:d=>n(d,"othersOweMe"),role:"button",tabIndex:t==="active"?0:-1,"aria-pressed":r==="othersOweMe","aria-label":"Filter by bills where others owe me","aria-disabled":t==="archived",children:[s.jsx("p",{className:"text-sm font-semibold text-emerald-600 dark:text-emerald-400 uppercase tracking-wider",children:"Others Owe Me"}),s.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-emerald-700 dark:text-emerald-300 mt-1",children:["$",e.othersOweMe.toFixed(2)]})]}),s.jsxs("div",{className:`${l} ${r==="iOwe"?i:t==="active"?o:""} ${t==="archived"?c:""}`,onClick:()=>t==="active"&&a("iOwe"),onKeyDown:d=>n(d,"iOwe"),role:"button",tabIndex:t==="active"?0:-1,"aria-pressed":r==="iOwe","aria-label":"Filter by bills where I owe","aria-disabled":t==="archived",children:[s.jsx("p",{className:"text-sm font-semibold text-amber-600 dark:text-amber-400 uppercase tracking-wider",children:"I Owe"}),s.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-amber-700 dark:text-amber-300 mt-1",children:["$",e.iOwe.toFixed(2)]})]})]})]})},tx=({selectedParticipant:e,onClearParticipant:t,dashboardView:r,onSetDashboardView:a,dashboardStatusFilter:n,onSetDashboardStatusFilter:l,searchQuery:o,setSearchQuery:i,searchMode:c,setSearchMode:d,dashboardLayoutMode:h,onSetDashboardLayoutMode:m,hasRecurringBills:u,hasBudgetData:f})=>{const w=["bills","participants","upcoming","templates","groups"].includes(r)&&!e;return s.jsxs("div",{className:"mb-6 space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[s.jsx("div",{children:e?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:t,className:"p-2 -ml-2 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-full",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),s.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-slate-700 dark:text-slate-200",children:["Bills for ",s.jsx("span",{className:"text-teal-600 dark:text-teal-400",children:e})]})]}):s.jsxs("div",{className:"flex items-center space-x-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg self-start sm:self-center flex-wrap gap-1 sm:gap-0",children:[s.jsx("button",{onClick:()=>a("bills"),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${r==="bills"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Bills"}),f&&s.jsx("button",{onClick:()=>a("budget"),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${r==="budget"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Budget"}),s.jsx("button",{onClick:()=>a("groups"),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${r==="groups"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Groups"}),s.jsx("button",{onClick:()=>a("participants"),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${r==="participants"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"People"}),u&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>a("upcoming"),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${r==="upcoming"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Upcoming"}),s.jsx("button",{onClick:()=>a("templates"),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${r==="templates"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Templates"})]})]})}),s.jsxs("div",{className:"flex items-center gap-4 justify-end",children:[w&&s.jsxs("div",{className:"flex items-center space-x-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg",children:[s.jsx("button",{onClick:()=>m("card"),title:"Card View",className:`p-1.5 rounded-md transition-colors ${h==="card"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 11a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),s.jsx("button",{onClick:()=>m("list"),title:"List View",className:`p-1.5 rounded-md transition-colors ${h==="list"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})})})]}),!["upcoming","templates","groups","budget"].includes(r)&&s.jsxs("div",{className:"flex items-center space-x-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg self-start sm:self-center",children:[s.jsx("button",{onClick:()=>l("active"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${n==="active"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Active"}),s.jsx("button",{onClick:()=>l("archived"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${n==="archived"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Archived"})]})]})]}),(r!=="participants"||e)&&r!=="budget"&&s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{type:"text",value:o,onChange:j=>i(j.target.value),placeholder:c==="description"?"Search by description...":"Search by participant name...",className:"w-full pl-11 pr-24 py-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100 placeholder:text-slate-400 dark:placeholder:text-slate-500","aria-label":"Search bills"}),s.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center space-x-1 bg-slate-200 dark:bg-slate-600 p-1 rounded-md",children:[s.jsx("button",{onClick:()=>d("description"),className:`p-1.5 rounded ${c==="description"?"bg-white dark:bg-slate-800 text-teal-600 shadow-sm":"text-slate-500 dark:text-slate-300 hover:bg-slate-300/50 dark:hover:bg-slate-500/50"}`,"aria-label":"Search by bill description",title:"Search by bill description",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),s.jsx("button",{onClick:()=>d("participant"),disabled:["upcoming","templates","groups"].includes(r),className:`p-1.5 rounded ${c==="participant"?"bg-white dark:bg-slate-800 text-teal-600 shadow-sm":"text-slate-500 dark:text-slate-300 hover:bg-slate-300/50 dark:hover:bg-slate-500/50"} disabled:opacity-50 disabled:cursor-not-allowed`,"aria-label":"Search by participant name",title:"Search by participant name",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})]})]})]})},md=({status:e,onClick:t})=>{if(!e||!["live","expired","error"].includes(e))return null;const r={live:{color:"bg-emerald-500",title:"Live: This bill is actively shared."},expired:{color:"bg-red-500",title:"Expired: Click to reactivate sharing."},error:{color:"bg-amber-500",title:"Error: Connection issue with share server."}}[e];if(!r)return null;const a=s.jsx("div",{className:"flex-shrink-0",title:r.title,children:s.jsx("span",{className:`block h-2.5 w-2.5 rounded-full ${r.color}`})});return e==="expired"&&t?s.jsx("button",{onClick:t,"aria-label":r.title,className:"p-1 -ml-1",children:a}):a},rx=({bill:e,onClick:t,onArchive:r,onUnarchive:a,onDelete:n,onReshare:l,onConvertToTemplate:o,onExport:i,layoutMode:c,onMenuToggled:d})=>{const[h,m]=p.useState(!1),u=p.useRef(null),f=e.participants.filter(b=>!b.paid).reduce((b,y)=>b+y.amountOwed,0),g=e.participants.every(b=>b.paid);p.useEffect(()=>{d(h)},[h,d]),p.useEffect(()=>{const b=y=>{u.current&&!u.current.contains(y.target)&&m(!1)};return h&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[h]);const w=b=>{b.stopPropagation(),m(y=>!y)},j=(b,y)=>{b.stopPropagation(),y(),m(!1)},x=b=>{b.stopPropagation(),l()},v=()=>s.jsxs("div",{ref:u,className:"relative flex-shrink-0",children:[s.jsx("button",{onClick:w,onMouseDown:b=>b.stopPropagation(),onTouchStart:b=>b.stopPropagation(),className:"p-3 -m-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full","aria-label":"More options",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),h&&s.jsxs("div",{onClick:b=>b.stopPropagation(),className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 py-1 z-20",children:[s.jsx("button",{onClick:b=>j(b,o),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"Convert to Template"}),s.jsx("button",{onClick:b=>j(b,i),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"Export as CSV"}),s.jsx("div",{className:"my-1 h-px bg-slate-100 dark:bg-slate-700"}),s.jsx("button",{onClick:b=>j(b,e.status==="active"?r:a),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:e.status==="active"?"Archive":"Unarchive"}),s.jsx("button",{onClick:b=>j(b,n),className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/40",children:"Delete"})]})]});return c==="list"?s.jsxs("div",{onClick:t,className:"w-full flex items-center p-3 text-sm cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[s.jsxs("div",{className:"flex-grow flex items-center gap-3 overflow-hidden",children:[s.jsx(md,{status:e.shareStatus,onClick:x}),s.jsxs("div",{className:"flex-grow overflow-hidden",children:[s.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 truncate",children:e.description}),s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:new Date(e.date).toLocaleDateString()})]})]}),s.jsxs("div",{className:"flex-shrink-0 w-24 text-right",children:[s.jsx("p",{className:`font-semibold ${f>0?"text-emerald-600 dark:text-emerald-400":"text-slate-500 dark:text-slate-400"}`,children:"Owed"}),s.jsxs("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:["$",f.toFixed(2)]})]}),s.jsxs("div",{className:"flex-shrink-0 w-24 text-right",children:[s.jsx("p",{className:"font-semibold text-slate-500 dark:text-slate-400",children:"Total"}),s.jsxs("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:["$",e.totalAmount.toFixed(2)]})]}),v()]}):s.jsxs("div",{onClick:t,className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg hover:shadow-xl dark:hover:shadow-teal-900/40 transition-shadow duration-300 cursor-pointer overflow-hidden transform hover:-translate-y-1 flex flex-col",children:[s.jsxs("div",{className:"p-5 flex-grow",children:[s.jsxs("div",{className:"flex justify-between items-start gap-2",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(md,{status:e.shareStatus,onClick:x}),s.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 break-words",children:e.description})]}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:new Date(e.date).toLocaleDateString()})]}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[g&&s.jsx("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300",children:"Settled"}),v()]})]}),s.jsxs("div",{className:"mt-4 flex justify-between items-end",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-semibold ${f>0?"text-emerald-600 dark:text-emerald-400":"text-slate-500 dark:text-slate-400"}`,children:f>0?"Owed to you":"No outstanding"}),s.jsxs("p",{className:`text-3xl font-extrabold ${f>0?"text-emerald-700 dark:text-emerald-300":"text-slate-800 dark:text-slate-100"}`,children:["$",f.toFixed(2)]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Bill Total"}),s.jsxs("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["$",e.totalAmount.toFixed(2)]})]})]})]}),s.jsx("div",{className:"bg-slate-50 dark:bg-slate-700/50 px-5 py-3",children:s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{className:"flex -space-x-2 overflow-hidden",children:[e.participants.slice(0,4).map(b=>s.jsx("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-800 bg-teal-500 flex items-center justify-center text-white font-bold text-xs",children:b.name.charAt(0)},b.id)),e.participants.length>4&&s.jsxs("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-800 bg-slate-300 dark:bg-slate-600 flex items-center justify-center text-slate-700 dark:text-slate-200 font-bold text-xs",children:["+",e.participants.length-4]})]}),s.jsxs("p",{className:"font-medium text-slate-600 dark:text-slate-300",children:[e.participants.length," participant",e.participants.length!==1?"s":""]})]})})]})},hn=e=>{const{bill:t,onClick:r,onArchive:a,onUnarchive:n,onDelete:l,layoutMode:o}=e,[i,c]=p.useState(0),d=p.useRef(0),h=p.useRef(0),m=p.useRef(0),u=p.useRef(null),f=p.useRef(!1),g=p.useRef(!1),w=p.useRef(0),j=t.status==="archived",x=o==="card"?-140:0,v=(S,D,I)=>{if(I.target.closest("button")){f.current=!1;return}f.current=!0,g.current=!1,d.current=S,h.current=D,m.current=i,w.current=Date.now(),u.current&&(u.current.style.transition="none")},b=(S,D)=>{if(!f.current||g.current)return;const I=S-d.current,C=D-h.current;if(Math.abs(C)>Math.abs(I)&&Math.abs(C)>5){g.current=!0,f.current=!1,i!==0&&(u.current&&(u.current.style.transition="transform 0.2s ease-out"),c(0));return}if(Math.abs(I)>5){const P=m.current+I,A=Math.min(20,Math.max(x-20,P));c(A)}},y=S=>{const D=f.current;if(f.current=!1,g.current){g.current=!1;return}if(!D)return;u.current&&(u.current.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)");const I=Date.now()-w.current,C=Math.abs(i-m.current);if(I<250&&C<10){i!==0?c(0):S&&(S.type==="touchend"&&S.preventDefault(),r(S));return}i<x/2?c(x):c(0)},k=S=>{S(),c(0)},N=p.useCallback(S=>{u.current&&(u.current.style.zIndex=S?"20":"10")},[]);return s.jsxs("div",{className:`relative w-full ${o==="card"?"overflow-hidden":""}`,children:[o==="card"&&s.jsxs("div",{className:"absolute top-0 right-0 h-full flex items-center z-0",children:[s.jsxs("button",{onClick:()=>k(j?n:a),className:"h-full w-[70px] flex flex-col items-center justify-center bg-blue-500 text-white transition-colors hover:bg-blue-600","aria-label":j?"Unarchive":"Archive",children:[j?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),s.jsx("span",{className:"text-xs mt-1",children:j?"Unarchive":"Archive"})]}),s.jsxs("button",{onClick:()=>k(l),className:"h-full w-[70px] flex flex-col items-center justify-center bg-red-500 text-white transition-colors hover:bg-red-600","aria-label":"Delete",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),s.jsx("span",{className:"text-xs mt-1",children:"Delete"})]})]}),s.jsx("div",{ref:u,className:"relative z-10",style:{transform:`translateX(${i}px)`,touchAction:"pan-y"},onTouchStart:S=>v(S.touches[0].clientX,S.touches[0].clientY,S),onTouchMove:S=>b(S.touches[0].clientX,S.touches[0].clientY),onTouchEnd:S=>y(S),onMouseDown:S=>v(S.clientX,S.clientY,S),onMouseMove:S=>b(S.clientX,S.clientY),onMouseUp:S=>y(S),onMouseLeave:()=>f.current&&y(),children:s.jsx(rx,{...e,onMenuToggled:N})})]})},fd=({status:e})=>{if(!e||e==="error")return null;const t={live:{color:"bg-emerald-500",title:"Live: Connected and up-to-date"},stale:{color:"bg-amber-500",title:"Stale: Connection issue, may be out of date"}}[e];return t?s.jsx("div",{className:"flex-shrink-0",title:t.title,children:s.jsx("span",{className:`block h-2.5 w-2.5 rounded-full ${t.color}`})}):null},sx=({bill:e,onClick:t,onArchive:r,onUnarchive:a,onDelete:n,onSettleUp:l,onShowSummaryDetails:o,onExport:i,layoutMode:c,onMenuToggled:d})=>{const[h,m]=p.useState(!1),u=p.useRef(null),f=e.sharedData.bill.participants.find(k=>k.id===e.myParticipantId),g=(f==null?void 0:f.amountOwed)||0,w=e.localStatus.myPortionPaid,j=e.id.startsWith("summary-"),x=p.useMemo(()=>{if(j){const k=(e.sharedData.bill.items||[]).map(N=>{var S;return(S=N.originalBillData)==null?void 0:S.date}).filter(N=>!!N).map(N=>new Date(N).getTime());if(k.length>0){const N=Math.max(...k);return new Date(N).toLocaleDateString()}return new Date(e.sharedData.bill.date).toLocaleDateString()}return new Date(e.sharedData.bill.date).toLocaleDateString()},[e,j]);p.useEffect(()=>{d(h)},[h,d]),p.useEffect(()=>{const k=N=>{u.current&&!u.current.contains(N.target)&&m(!1)};return h&&document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[h]);const v=k=>{k.stopPropagation(),m(N=>!N)},b=(k,N)=>{k.stopPropagation(),N(),m(!1)},y=()=>s.jsxs("div",{ref:u,className:"relative flex-shrink-0",children:[s.jsx("button",{onClick:v,onMouseDown:k=>k.stopPropagation(),onTouchStart:k=>k.stopPropagation(),className:"p-3 -m-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full","aria-label":"More options",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),h&&s.jsxs("div",{onClick:k=>k.stopPropagation(),className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 py-1 z-20",children:[j&&s.jsx("button",{onClick:k=>b(k,o),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"View Breakdown"}),s.jsx("button",{onClick:k=>b(k,i),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"Export as CSV"}),s.jsx("div",{className:"my-1 h-px bg-slate-100 dark:bg-slate-700"}),s.jsx("button",{onClick:k=>b(k,e.status==="active"?r:a),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:e.status==="active"?"Archive":"Unarchive"}),s.jsx("button",{onClick:k=>b(k,n),className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/40",children:"Delete"})]})]});return c==="list"?s.jsxs("div",{onClick:t,className:"w-full flex items-center p-3 text-sm cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[s.jsxs("div",{className:"flex-grow flex items-center gap-3 overflow-hidden",children:[s.jsx(fd,{status:e.liveStatus}),s.jsxs("div",{className:"flex-grow overflow-hidden",children:[s.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 truncate",children:e.sharedData.bill.description}),s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["From ",e.creatorName,"  ",x]})]})]}),s.jsxs("div",{className:"flex-shrink-0 w-24 text-right",children:[s.jsx("p",{className:"font-semibold text-slate-500 dark:text-slate-400",children:"Your Portion"}),s.jsxs("p",{className:`font-bold ${w?"text-emerald-700 dark:text-emerald-300":"text-slate-800 dark:text-slate-100"}`,children:["$",g.toFixed(2)]})]}),s.jsxs("div",{className:"flex-shrink-0 w-24 text-right",children:[s.jsx("p",{className:"font-semibold text-slate-500 dark:text-slate-400",children:"Total"}),s.jsxs("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:["$",e.sharedData.bill.totalAmount.toFixed(2)]})]}),y()]}):s.jsxs("div",{onClick:t,className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg hover:shadow-xl dark:hover:shadow-teal-900/40 transition-shadow duration-300 cursor-pointer overflow-hidden transform hover:-translate-y-1 flex flex-col",children:[s.jsxs("div",{className:"p-5 flex-grow",children:[s.jsxs("div",{className:"flex justify-between items-start gap-2",children:[s.jsxs("div",{className:"flex-grow flex items-center gap-2",children:[s.jsx(fd,{status:e.liveStatus}),e.isOwnBill&&s.jsx("span",{title:"This is one of your own bills that you imported.",className:"text-xs font-semibold text-slate-500 dark:text-slate-400 bg-slate-200 dark:bg-slate-600 px-2 py-0.5 rounded-full",children:"You"}),s.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 break-words",children:e.sharedData.bill.description})]}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[s.jsx("span",{className:`px-3 py-1 text-xs font-semibold rounded-full flex-shrink-0 ${w?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300":"bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300"}`,children:w?"Paid":"Unpaid"}),y()]})]}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["From ",e.creatorName,"  ",x]}),s.jsxs("div",{className:"mt-4 flex justify-between items-end",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Your Portion"}),s.jsxs("p",{className:`text-3xl font-extrabold ${w?"text-emerald-700 dark:text-emerald-300":"text-slate-800 dark:text-slate-100"}`,children:["$",g.toFixed(2)]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Bill Total"}),s.jsxs("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["$",e.sharedData.bill.totalAmount.toFixed(2)]})]})]})]}),s.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 px-5 py-3 flex items-center justify-end gap-3",children:[j?s.jsx("button",{onClick:k=>{k.stopPropagation(),o()},className:"px-4 py-1.5 text-xs font-semibold rounded-full bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500",children:"View Breakdown"}):s.jsx("button",{onClick:k=>{k.stopPropagation(),t(k)},className:"px-4 py-1.5 text-xs font-semibold rounded-full bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500",children:"Details"}),!w&&s.jsx("button",{onClick:k=>{k.stopPropagation(),l()},className:"px-4 py-1.5 text-xs font-semibold rounded-full bg-emerald-500 text-white hover:bg-emerald-600",children:"Settle Up"})]})]})},ax=70,nx=e=>{const{bill:t,onClick:r,onArchive:a,onUnarchive:n,onDelete:l,onSettleUp:o,layoutMode:i}=e,[c,d]=p.useState(0),h=p.useRef(0),m=p.useRef(0),u=p.useRef(0),f=p.useRef(null),g=p.useRef(!1),w=p.useRef(!1),j=p.useRef(0),x=t.status==="archived",v=t.localStatus.myPortionPaid;let b=1;v||b++,b++;const y=i==="card"?-(ax*b):0,k=(C,P,A)=>{if(A.target.closest("button")){g.current=!1;return}g.current=!0,w.current=!1,h.current=C,m.current=P,u.current=c,j.current=Date.now(),f.current&&(f.current.style.transition="none")},N=(C,P)=>{if(!g.current||w.current)return;const A=C-h.current,z=P-m.current;if(Math.abs(z)>Math.abs(A)&&Math.abs(z)>5){w.current=!0,g.current=!1,c!==0&&(f.current&&(f.current.style.transition="transform 0.2s ease-out"),d(0));return}if(Math.abs(A)>5){const U=u.current+A,ee=Math.min(20,Math.max(y-20,U));d(ee)}},S=C=>{const P=g.current;if(g.current=!1,w.current){w.current=!1;return}if(!P)return;f.current&&(f.current.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)");const A=Date.now()-j.current,z=Math.abs(c-u.current);if(A<250&&z<10){c!==0?d(0):C&&(C.type==="touchend"&&C.preventDefault(),r(C));return}c<y/2?d(y):d(0)},D=C=>{C(),d(0)},I=p.useCallback(C=>{f.current&&(f.current.style.zIndex=C?"20":"10")},[]);return s.jsxs("div",{className:`relative w-full ${i==="card"?"overflow-hidden":""}`,children:[i==="card"&&s.jsxs("div",{className:"absolute top-0 right-0 h-full flex items-center z-0",children:[!v&&s.jsxs("button",{onClick:()=>D(o),className:"h-full w-[70px] flex flex-col items-center justify-center bg-emerald-500 text-white transition-colors hover:bg-emerald-600","aria-label":"Settle Up",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),s.jsx("span",{className:"text-xs mt-1",children:"Settle Up"})]}),s.jsxs("button",{onClick:()=>D(x?n:a),className:"h-full w-[70px] flex flex-col items-center justify-center bg-blue-500 text-white transition-colors hover:bg-blue-600","aria-label":x?"Unarchive":"Archive",children:[x?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),s.jsx("span",{className:"text-xs mt-1",children:x?"Unarchive":"Archive"})]}),s.jsxs("button",{onClick:()=>D(l),className:"h-full w-[70px] flex flex-col items-center justify-center bg-red-500 text-white transition-colors hover:bg-red-600","aria-label":"Delete",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),s.jsx("span",{className:"text-xs mt-1",children:"Delete"})]})]}),s.jsx("div",{ref:f,className:"relative z-10",style:{transform:`translateX(${c}px)`,touchAction:"pan-y"},onTouchStart:C=>k(C.touches[0].clientX,C.touches[0].clientY,C),onTouchMove:C=>N(C.touches[0].clientX,C.touches[0].clientY),onTouchEnd:C=>S(C),onMouseDown:C=>k(C.clientX,C.clientY,C),onMouseMove:C=>N(C.clientX,C.clientY),onMouseUp:C=>S(C),onMouseLeave:()=>g.current&&S(),children:s.jsx(sx,{...e,onMenuToggled:I})})]})},lx=()=>{const[e,t]=p.useState(!1),r=p.useRef(null);return p.useEffect(()=>{const a=new IntersectionObserver(([n])=>{n.isIntersecting&&(t(!0),r.current&&a.unobserve(r.current))},{rootMargin:"100px",threshold:.01});return r.current&&a.observe(r.current),()=>{r.current&&a.unobserve(r.current)}},[]),Cs?s.jsxs("div",{ref:r,className:"w-full bg-white dark:bg-slate-800 rounded-lg shadow-lg overflow-hidden flex flex-col justify-between p-5 border border-slate-200 dark:border-slate-700 min-h-[150px]",children:[s.jsx("div",{children:s.jsx("span",{className:"text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider",children:"Advertisement"})}),s.jsx("div",{className:"flex items-center justify-center min-h-[100px] w-full",children:e&&s.jsx("iframe",{srcDoc:Cs,title:"Advertisement",style:{width:"100%",minHeight:"100px",border:"0",overflow:"hidden"},sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox","aria-label":"Advertisement Content"})})]}):null},ox=10,ix=()=>Cs?s.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[s.jsx("span",{className:"text-xs font-semibold text-slate-400 dark:text-slate-500 uppercase tracking-wider",children:"Advertisement"}),s.jsx("div",{className:"flex items-center justify-center w-full min-h-[100px]",children:s.jsx("iframe",{srcDoc:Cs,title:"Advertisement",style:{width:"100%",minHeight:"100px",border:"0",overflow:"hidden"},sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox","aria-label":"Advertisement Content"})})]}):null,cx=({filteredBills:e,filteredImportedBills:t,visibleCount:r,subscriptionStatus:a,archivingBillIds:n,onSelectBill:l,onArchiveBill:o,onUnarchiveBill:i,onDeleteBill:c,onReshareBill:d,onSelectImportedBill:h,onUpdateImportedBill:m,onArchiveImportedBill:u,onUnarchiveImportedBill:f,onDeleteImportedBill:g,onShowSummaryDetails:w,onSettleUp:j,loadMoreRef:x,hasMore:v,onConvertToTemplate:b,onExportOwnedBill:y,onExportImportedBill:k,dashboardLayoutMode:N})=>{const S=p.useMemo(()=>{const I=e.slice(0,r),C=[],P=a==="free",A=N==="card"?lx:ix;return P&&C.push(s.jsx(A,{},"ad-first")),I.forEach((z,U)=>{const ee=n.includes(z.id);C.push(s.jsx("div",{className:`transition-all duration-500 ease-out ${ee?"opacity-0 scale-90 max-h-0":"max-h-96"}`,children:s.jsx(hn,{bill:z,onArchive:()=>o(z.id),onUnarchive:()=>i(z.id),onDelete:()=>c(z.id),onReshare:()=>d(z.id),onClick:K=>l(z),onConvertToTemplate:()=>b(z),onExport:()=>y(z),layoutMode:N})},z.id)),P&&(U+1)%ox===0&&C.push(s.jsx(A,{},`ad-interval-${U}`))}),C},[e,r,a,o,i,c,d,l,n,b,y,N]),D=N==="card"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"bg-white dark:bg-slate-800 rounded-lg shadow-md";return s.jsxs(s.Fragment,{children:[t.length>0&&s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mb-4",children:"Shared With Me"}),s.jsx("div",{className:D,children:t.map(I=>s.jsx(nx,{bill:I,onArchive:()=>u(I.id),onUnarchive:()=>f(I.id),onDelete:()=>g(I.id),onClick:C=>h(I),onShowSummaryDetails:()=>w(I),onSettleUp:()=>j(I),onExport:()=>k(I),layoutMode:N},I.id))})]}),S.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mb-4",children:"My Bills"}),s.jsx("div",{className:D,children:S}),v&&s.jsx("div",{ref:x,className:"flex justify-center items-center p-8",children:s.jsxs("svg",{className:"animate-spin h-8 w-8 text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]})]})},dx=({data:e,onClick:t,layoutMode:r})=>r==="list"?s.jsxs("div",{onClick:t,className:"w-full flex items-center p-3 text-sm cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[s.jsxs("div",{className:"flex-grow flex items-center gap-3 overflow-hidden",children:[s.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-teal-500 flex items-center justify-center text-white font-bold text-sm",children:e.name.charAt(0).toUpperCase()}),s.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 truncate",children:e.name})]}),s.jsxs("div",{className:"flex-shrink-0 w-28 text-right",children:[s.jsx("p",{className:`font-semibold ${e.type==="owed"?"text-amber-600 dark:text-amber-400":"text-emerald-600 dark:text-emerald-400"}`,children:e.type==="owed"?"Owes":"Total Paid"}),s.jsxs("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:["$",e.amount.toFixed(2)]})]}),s.jsx("div",{className:"flex-shrink-0 ml-2",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400 dark:text-slate-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]}):s.jsxs("div",{onClick:t,className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg hover:shadow-xl dark:hover:shadow-teal-900/40 transition-shadow duration-300 cursor-pointer overflow-hidden transform hover:-translate-y-1 flex flex-col p-5",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-shrink-0 inline-block h-10 w-10 rounded-full ring-2 ring-white dark:ring-slate-800 bg-teal-500 flex items-center justify-center text-white font-bold text-lg",children:e.name.charAt(0).toUpperCase()}),s.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 break-words",children:e.name})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400 dark:text-slate-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]}),s.jsxs("div",{className:"mt-4 text-right",children:[s.jsx("p",{className:`text-sm font-semibold ${e.type==="owed"?"text-amber-600 dark:text-amber-400":"text-emerald-600 dark:text-emerald-400"}`,children:e.type==="owed"?"Owes":"Total Paid"}),s.jsxs("p",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-50",children:["$",e.amount.toFixed(2)]})]})]}),ux=({participant:e,onClick:t,onPaidInFull:r,layoutMode:a})=>{const[n,l]=p.useState(0),[o,i]=p.useState(!1),c=p.useRef(0),d=p.useRef(0),h=p.useRef(0),m=p.useRef(null),u=p.useRef(!1),f=p.useRef(!1),g=p.useRef(0),w=a==="card"&&e.type==="owed"?-90:0,j=(y,k)=>{u.current=e.type==="owed"&&a==="card",f.current=!1,c.current=y,d.current=k,h.current=n,g.current=Date.now(),m.current&&(m.current.style.transition="none")},x=(y,k)=>{if(!u.current||f.current)return;const N=y-c.current,S=k-d.current;if((Math.abs(S)>5||Math.abs(N)>5)&&Math.abs(S)>Math.abs(N)){f.current=!0,u.current=!1,n!==0&&(m.current&&(m.current.style.transition="transform 0.2s ease-out"),l(0));return}const D=h.current+N,I=Math.min(20,Math.max(w-20,D));l(I)},v=y=>{if(!u.current){const D=y&&"changedTouches"in y&&y.changedTouches.length>0?y.changedTouches[0].clientX:y==null?void 0:y.clientX;y&&Math.abs(c.current-D)<10&&Date.now()-g.current<250&&(y.type==="touchend"&&y.preventDefault(),t());return}const k=f.current;if(u.current=!1,f.current=!1,m.current&&(m.current.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)"),k){l(0);return}const N=Date.now()-g.current,S=n-h.current;if(N<250&&Math.abs(S)<10){h.current!==0?l(0):(y&&y.type==="touchend"&&y.preventDefault(),t());return}n<w/2?l(w):l(0)},b=y=>{i(!0),setTimeout(()=>{y()},300)};return s.jsxs("div",{className:`relative w-full transition-all duration-300 ease-in-out ${o?"opacity-0 max-h-0 scale-95":"max-h-96"}`,children:[a==="card"&&e.type==="owed"&&s.jsx("div",{className:"absolute top-0 right-0 h-full flex items-center z-0",children:s.jsxs("button",{onClick:()=>b(r),className:"h-full w-[90px] flex flex-col items-center justify-center bg-emerald-500 text-white transition-colors hover:bg-emerald-600","aria-label":`Mark all bills for ${e.name} as paid`,children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),s.jsx("span",{className:"text-xs mt-1 font-semibold",children:"Paid in Full"})]})}),s.jsx("div",{ref:m,className:"relative z-10",style:{transform:`translateX(${n}px)`,touchAction:"pan-y"},onTouchStart:y=>j(y.touches[0].clientX,y.touches[0].clientY),onTouchMove:y=>x(y.touches[0].clientX,y.touches[0].clientY),onTouchEnd:y=>v(y),onMouseDown:y=>j(y.clientX,y.clientY),onMouseMove:y=>x(y.clientX,y.clientY),onMouseUp:y=>v(y),onMouseLeave:()=>u.current&&v(),children:s.jsx(dx,{data:e,onClick:()=>{},layoutMode:a})})]})},mx=({participantsData:e,onSetShareSheetParticipant:t,onMarkParticipantAsPaid:r,dashboardLayoutMode:a})=>{const n=a==="card"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"bg-white dark:bg-slate-800 rounded-lg shadow-md overflow-hidden";return s.jsx("div",{className:n,children:e.map(l=>s.jsx(ux,{participant:l,onClick:()=>t(l),onPaidInFull:()=>r(l.name),layoutMode:a},l.name))})},Fo=({title:e,message:t,isArchiveContext:r=!1})=>{const a=r?s.jsx("svg",{className:"mx-auto h-12 w-12 text-slate-400 dark:text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:s.jsx("path",{vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}):s.jsx("svg",{className:"mx-auto h-12 w-12 text-slate-400 dark:text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:s.jsx("path",{vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})});return s.jsxs("div",{className:"text-center py-16 px-6 bg-white dark:bg-slate-800 rounded-lg shadow",children:[a,s.jsx("h3",{className:"mt-2 text-xl font-medium text-slate-900 dark:text-slate-100",children:e}),s.jsx("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:t})]})},fx=({participantBills:e,onSelectBill:t,onArchiveBill:r,onUnarchiveBill:a,onDeleteBill:n,onReshareBill:l,dashboardStatusFilter:o,searchQuery:i,selectedParticipant:c,onExport:d,onConvertToTemplate:h,onExportBill:m,dashboardLayoutMode:u})=>{const{active:f,allArchived:g,unpaidArchived:w}=e,j=u==="card"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"bg-white dark:bg-slate-800 rounded-lg shadow-md";return o==="active"?f.length===0&&w.length===0?s.jsx(Fo,{title:"All Settled",message:i?`Your search for "${i}" did not match any bills.`:`${c} has no active bills or unpaid archived bills.`}):s.jsxs("div",{className:"space-y-8",children:[s.jsx("div",{className:"flex justify-end -mb-4",children:s.jsx("button",{onClick:d,className:"p-2 text-slate-500 dark:text-slate-400 hover:text-teal-600 dark:hover:text-teal-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full focus:outline-none focus:ring-2 focus:ring-teal-500","aria-label":`Export all bills for ${c} as CSV`,title:"Export CSV",children:s.jsx("span",{className:"text-xl",role:"img","aria-label":"Download",children:""})})}),f.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-300 mb-4 pb-2 border-b border-slate-200 dark:border-slate-700",children:"Active Bills"}),s.jsx("div",{className:j,children:f.map(x=>s.jsx(hn,{bill:x,onArchive:()=>r(x.id),onUnarchive:()=>a(x.id),onDelete:()=>n(x.id),onClick:v=>t(x),onReshare:()=>l(x.id),onConvertToTemplate:()=>h(x),onExport:()=>m(x),layoutMode:u},x.id))})]}),w.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-red-700 dark:text-red-400 mb-4 pb-2 border-b border-slate-200 dark:border-slate-700",children:"Unpaid Archived Bills"}),s.jsx("div",{className:j,children:w.map(x=>s.jsx(hn,{bill:x,onArchive:()=>r(x.id),onUnarchive:()=>a(x.id),onDelete:()=>n(x.id),onClick:v=>t(x),onReshare:()=>l(x.id),onConvertToTemplate:()=>h(x),onExport:()=>m(x),layoutMode:u},x.id))})]})]}):g.length===0?s.jsx(Fo,{title:"No Archived Bills",message:i?`Your search for "${i}" did not match any archived bills.`:`${c} has no archived bills.`,isArchiveContext:!0}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex justify-end -mb-4",children:s.jsx("button",{onClick:d,className:"p-2 text-slate-500 dark:text-slate-400 hover:text-teal-600 dark:hover:text-teal-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full focus:outline-none focus:ring-2 focus:ring-teal-500","aria-label":`Export all bills for ${c} as CSV`,title:"Export CSV",children:s.jsx("span",{className:"text-xl",role:"img","aria-label":"Download",children:""})})}),s.jsx("div",{className:`${j} mt-8`,children:g.map(x=>s.jsx(hn,{bill:x,onArchive:()=>r(x.id),onUnarchive:()=>a(x.id),onDelete:()=>n(x.id),onClick:v=>t(x),onReshare:()=>l(x.id),onConvertToTemplate:()=>h(x),onExport:()=>m(x),layoutMode:u},x.id))})]})},Uo=({bill:e,onClick:t,layoutMode:r})=>{const a=()=>{const{frequency:l,dayOfMonth:o,dayOfWeek:i,interval:c}=e.recurrenceRule;switch(l){case"daily":return`Repeats ${c>1?`every ${c} days`:"Daily"}`;case"weekly":const d=new Intl.DateTimeFormat("en-US",{weekday:"long"}).format(new Date(2023,0,(i??0)+1));return`Repeats ${c>1?`every ${c} weeks`:"Weekly"} on ${d}`;case"monthly":const h=m=>{if(m>3&&m<21)return"th";switch(m%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}};return`Repeats ${c>1?`every ${c} months`:"Monthly"} on the ${o}${h(o??1)}`;case"yearly":return`Repeats ${c>1?`every ${c} years`:"Yearly"}`}},n=l=>{const o=new Date,i=new Date(l),c=new Date(Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate())),d=new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate())),h=d.getTime()-c.getTime();if(h<0)return"Overdue";if(h<1e3)return"Due today";let m=new Date(c.getTime()),u=0,f=0,g=0;for(;;){let v=new Date(m.getTime());if(v.setUTCFullYear(v.getUTCFullYear()+1),v<=d)u++,m=v;else break}for(;;){let v=new Date(m.getTime());const b=v.getUTCFullYear(),y=v.getUTCMonth();if(v.setUTCMonth(y+1),v.getUTCMonth()!==(y+1)%12&&(v=new Date(Date.UTC(b,y+2,0))),v<=d)f++,m=v;else break}for(;;){let v=new Date(m.getTime());if(v.setUTCDate(v.getUTCDate()+7),v<=d)g++,m=v;else break}const w=d.getTime()-m.getTime(),j=Math.round(w/(1e3*60*60*24)),x=[];return u>0&&x.push(`${u} year${u>1?"s":""}`),f>0&&x.push(`${f} month${f>1?"s":""}`),g>0&&x.push(`${g} week${g>1?"s":""}`),j>0&&x.push(`${j} day${j>1?"s":""}`),x.length===0?"Due today":x.join(", ")};return r==="list"?s.jsxs("div",{onClick:t,className:"w-full flex items-center p-3 text-sm cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[s.jsxs("div",{className:"flex-grow overflow-hidden",children:[s.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 truncate",children:e.description}),s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:a()})]}),s.jsxs("div",{className:"flex-shrink-0 w-40 text-right",children:[s.jsx("p",{className:"font-semibold text-teal-600 dark:text-teal-400",children:"Next due in:"}),s.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:n(e.nextDueDate)})]}),s.jsx("div",{className:"flex-shrink-0 ml-2 w-5 text-right",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400 dark:text-slate-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]}):s.jsxs("div",{onClick:t,className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg hover:shadow-xl dark:hover:shadow-teal-900/40 transition-shadow duration-300 cursor-pointer overflow-hidden transform hover:-translate-y-1 flex flex-col",children:[s.jsxs("div",{className:"p-5 flex-grow",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 break-words",children:e.description}),s.jsx("span",{className:"px-3 py-1 text-xs font-semibold rounded-full flex-shrink-0 ml-2 bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300",children:"Template"})]}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:a()}),s.jsxs("div",{className:"mt-4 flex justify-between items-end",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-teal-600 dark:text-teal-400",children:"Next bill due in:"}),s.jsx("p",{className:"text-xl font-bold text-slate-900 dark:text-slate-50",children:n(e.nextDueDate)})]}),e.totalAmount&&e.totalAmount>0&&s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Default Total"}),s.jsxs("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["$",e.totalAmount.toFixed(2)]})]})]})]}),s.jsx("div",{className:"bg-slate-50 dark:bg-slate-700/50 px-5 py-3",children:s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{className:"flex -space-x-2 overflow-hidden",children:[e.participants.slice(0,4).map((l,o)=>s.jsx("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-800 bg-teal-500 flex items-center justify-center text-white font-bold text-xs",children:l.name.charAt(0)},l.id||o)),e.participants.length>4&&s.jsxs("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-800 bg-slate-300 dark:bg-slate-600 flex items-center justify-center text-slate-700 dark:text-slate-200 font-bold text-xs",children:["+",e.participants.length-4]})]}),s.jsxs("p",{className:"font-medium text-slate-600 dark:text-slate-300",children:[e.participants.length," participant",e.participants.length!==1?"s":""]})]})})]})},hx=({group:e,onClick:t,onEdit:r,layoutMode:a,onMenuToggled:n})=>{const[l,o]=p.useState(!1),i=p.useRef(null);p.useEffect(()=>{n(l)},[l,n]),p.useEffect(()=>{const m=u=>{i.current&&!i.current.contains(u.target)&&o(!1)};return l&&document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[l]);const c=m=>{m.stopPropagation(),o(u=>!u)},d=(m,u)=>{m.stopPropagation(),u(),o(!1)},h=()=>s.jsxs("div",{ref:i,className:"relative flex-shrink-0",children:[s.jsx("button",{onClick:c,onMouseDown:m=>m.stopPropagation(),onTouchStart:m=>m.stopPropagation(),className:"p-3 -m-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full","aria-label":"More options",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),l&&s.jsx("div",{onClick:m=>m.stopPropagation(),className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 py-1 z-20",children:s.jsx("button",{onClick:m=>d(m,r),className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"Edit Group"})})]});return a==="list"?s.jsxs("div",{onClick:t,className:"w-full flex items-center p-3 text-sm cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[s.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 truncate flex-grow",children:e.name}),s.jsxs("p",{className:"flex-shrink-0 w-32 text-right text-slate-500 dark:text-slate-400",children:[e.participants.length," member",e.participants.length!==1?"s":""]}),h()]}):s.jsxs("div",{onClick:t,className:"bg-white dark:bg-slate-800 rounded-lg shadow-lg hover:shadow-xl dark:hover:shadow-teal-900/40 transition-shadow duration-300 cursor-pointer overflow-hidden transform hover:-translate-y-1 flex flex-col",children:[s.jsx("div",{className:"p-5 flex-grow",children:s.jsxs("div",{className:"flex justify-between items-start gap-2",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 break-words",children:e.name}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:[e.participants.length," member",e.participants.length!==1?"s":""]})]}),s.jsx("div",{className:"-mr-2",children:h()})]})}),s.jsx("div",{className:"bg-slate-50 dark:bg-slate-700/50 px-5 py-3",children:s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{className:"flex -space-x-2 overflow-hidden",children:[e.participants.slice(0,5).map(m=>s.jsx("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-800 bg-teal-500 flex items-center justify-center text-white font-bold text-xs",title:m.name,children:m.name.charAt(0).toUpperCase()},m.id)),e.participants.length>5&&s.jsxs("div",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-800 bg-slate-300 dark:bg-slate-600 flex items-center justify-center text-slate-700 dark:text-slate-200 font-bold text-xs",children:["+",e.participants.length-5]})]}),s.jsxs("p",{className:"font-medium text-slate-600 dark:text-slate-300",children:[e.participants.length," member",e.participants.length!==1?"s":""]})]})})]})},px=({group:e,onClick:t,onEdit:r,onDelete:a,layoutMode:n})=>{const[l,o]=p.useState(0),i=p.useRef(0),c=p.useRef(0),d=p.useRef(0),h=p.useRef(null),m=p.useRef(!1),u=p.useRef(!1),f=p.useRef(0),g=n==="card"?-70:0,w=(y,k,N)=>{if(N.target.closest("button")){m.current=!1;return}m.current=!0,u.current=!1,i.current=y,c.current=k,d.current=l,f.current=Date.now(),h.current&&(h.current.style.transition="none")},j=(y,k)=>{if(!m.current||u.current)return;const N=y-i.current,S=k-c.current;if(Math.abs(S)>Math.abs(N)&&Math.abs(S)>5){u.current=!0,m.current=!1,l!==0&&(h.current&&(h.current.style.transition="transform 0.2s ease-out"),o(0));return}if(Math.abs(N)>5){const D=d.current+N,I=Math.min(20,Math.max(g-20,D));o(I)}},x=y=>{const k=m.current;if(m.current=!1,u.current){u.current=!1;return}if(!k)return;h.current&&(h.current.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)");const N=Date.now()-f.current,S=Math.abs(l-d.current);if(N<250&&S<10){l!==0?o(0):y&&(y.type==="touchend"&&y.preventDefault(),t(y));return}l<g/2?o(g):o(0)},v=y=>{y(),o(0)},b=p.useCallback(y=>{h.current&&(h.current.style.zIndex=y?"20":"10")},[]);return s.jsxs("div",{className:`relative w-full ${n==="card"?"overflow-hidden":""}`,children:[n==="card"&&s.jsx("div",{className:"absolute top-0 right-0 h-full flex items-center z-0",children:s.jsxs("button",{onClick:()=>v(a),className:"h-full w-[70px] flex flex-col items-center justify-center bg-red-500 text-white transition-colors hover:bg-red-600","aria-label":"Delete",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),s.jsx("span",{className:"text-xs mt-1",children:"Delete"})]})}),s.jsx("div",{ref:h,className:"relative z-10",style:{transform:`translateX(${l}px)`,touchAction:"pan-y"},onTouchStart:y=>w(y.touches[0].clientX,y.touches[0].clientY,y),onTouchMove:y=>j(y.touches[0].clientX,y.touches[0].clientY),onTouchEnd:y=>x(y),onMouseDown:y=>w(y.clientX,y.clientY,y),onMouseMove:y=>j(y.clientX,y.clientY),onMouseUp:y=>x(y),onMouseLeave:()=>m.current&&x(),children:s.jsx(hx,{group:e,onEdit:r,onClick:t,layoutMode:n,onMenuToggled:b})})]})},rm=({value:e,max:t,label:r,variant:a="primary"})=>{const n=t>0?Math.min(e/t*100,100):0,l={primary:"bg-teal-500",success:"bg-emerald-500",warning:"bg-amber-500",danger:"bg-red-500"};let o=a;return a==="primary"&&(n>95?o="danger":n>80?o="warning":o="success"),s.jsxs("div",{children:[r&&s.jsx("span",{className:"text-sm font-medium text-slate-500 dark:text-slate-400",children:r}),s.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mt-1",children:s.jsx("div",{className:`h-2.5 rounded-full transition-all duration-500 ${l[o]}`,style:{width:`${n}%`}})})]})},xx=["January","February","March","April","May","June","July","August","September","October","November","December"],gx=({categoryData:e,onSelectBill:t})=>{const[r,a]=p.useState(!1),{category:n,spent:l,bills:o}=e,i=n.budget,c=typeof i=="number"&&i>0;return s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-md transition-all duration-300",children:[s.jsxs("button",{onClick:()=>a(!r),className:"w-full text-left p-4","aria-expanded":r,children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:n.name}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:["$",l.toFixed(2)]}),c&&s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["of $",i.toFixed(2)]})]})]}),c&&s.jsx("div",{className:"mt-2",children:s.jsx(rm,{value:l,max:i})})]}),r&&s.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 px-4 py-2",children:s.jsxs("ul",{className:"space-y-2 py-2",children:[o.sort((d,h)=>new Date(h.date).getTime()-new Date(d.date).getTime()).map(d=>s.jsx("li",{children:s.jsxs("button",{onClick:()=>t({billId:d.billId,isImported:d.isImported}),className:"w-full flex justify-between items-center text-sm p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 text-left",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-slate-700 dark:text-slate-200",children:d.description}),s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:new Date(d.date).toLocaleDateString()})]}),s.jsxs("p",{className:"font-semibold text-slate-600 dark:text-slate-300",children:["$",d.userPortion.toFixed(2)]})]})},d.billId)),o.length===0&&s.jsx("li",{className:"text-center text-sm text-slate-500 dark:text-slate-400 py-2",children:"No expenses in this period."})]})})]})},vx=({budgetData:e,date:t,setDate:r,onSelectBill:a})=>{const{totalBudget:n,totalSpending:l,spendingByCategory:o}=e,i=h=>{if(t==="last30days"){const m=new Date;m.setMonth(m.getMonth()+h),r({year:m.getFullYear(),month:m.getMonth()})}else{const m=new Date(t.year,t.month+h,1);r({year:m.getFullYear(),month:m.getMonth()})}},c=Object.values(o).sort((h,m)=>m.spent-h.spent),d=()=>t==="last30days"?"Last 30 Days":`${xx[t.month]} ${t.year}`;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-slate-800 p-2 rounded-lg shadow-md",children:[s.jsx("button",{onClick:()=>i(-1),title:"Previous month","aria-label":"Previous month",className:"p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("div",{className:"text-center",children:s.jsx("button",{onClick:()=>r("last30days"),className:"text-xl font-bold text-slate-700 dark:text-slate-200 hover:underline",children:d()})}),s.jsx("button",{onClick:()=>i(1),title:"Next month","aria-label":"Next month",className:"p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),s.jsxs("div",{className:"p-6 bg-white dark:bg-slate-800 rounded-lg shadow-lg",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200",children:"Overall Spending"}),s.jsxs("div",{className:"mt-2 text-center",children:[s.jsxs("p",{className:"text-4xl font-extrabold text-slate-800 dark:text-slate-100",children:["$",l.toFixed(2)]}),n>0&&s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["spent of $",n.toFixed(2)]})]}),n>0&&s.jsx("div",{className:"mt-4",children:s.jsx(rm,{value:l,max:n})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-xl font-bold text-slate-700 dark:text-slate-200 px-2",children:"Spending by Category"}),c.map(h=>s.jsx(gx,{categoryData:h,onSelectBill:a},h.category.id))]})]})},Ol=15,wx=e=>{const{bills:t,importedBills:r,recurringBills:a,groups:n,participantsData:l,settings:o,updateSettings:i,setSettingsSection:c,subscriptionStatus:d,onSelectBill:h,onSelectImportedBill:m,onArchiveBill:u,onUnarchiveBill:f,onDeleteBill:g,onDeleteGroup:w,onReshareBill:j,onUpdateMultipleBills:x,onUpdateImportedBill:v,onArchiveImportedBill:b,onUnarchiveImportedBill:y,onDeleteImportedBill:k,onShowSummaryDetails:N,onCreateFromTemplate:S,navigate:D,dashboardView:I,selectedParticipant:C,dashboardStatusFilter:P,dashboardSummaryFilter:A,dashboardLayoutMode:z,onSetDashboardView:U,onSetDashboardStatusFilter:ee,onSetDashboardSummaryFilter:K,onSelectParticipant:L,onClearParticipant:E,onSetDashboardLayoutMode:T,budgetData:M,budgetDate:R,setBudgetDate:$,handleSelectBillFromBudget:G}=e,[V,oe]=p.useState(""),[fe,Je]=p.useState("description"),[at,Fr]=p.useState(Ol),[Ue,Ae]=p.useState(null),[gr,kt]=p.useState([]),[Ps,Ft]=p.useState(!1),[Qe,vr]=p.useState(null),[wr,jt]=p.useState(!1),[Ur,Mt]=p.useState(null),{showNotification:ve}=ut(),Ut=a.length>0;p.useEffect(()=>{!Ut&&(I==="upcoming"||I==="templates")&&U("bills")},[Ut,I,U]),p.useEffect(()=>{["upcoming","templates","groups","budget"].includes(I)&&Je("description")},[I]);const Vt=p.useMemo(()=>t.filter(O=>O.status==="active"),[t]);p.useEffect(()=>{if(I!=="bills"||P!=="active")return;const O=Vt.filter(X=>X.participants.length>0&&X.participants.every(Y=>Y.paid));if(O.length>0){const X=O.map(te=>te.id);kt(X);const Y=setTimeout(()=>{const te=O.map(Z=>({...Z,status:"archived"}));x(te)},600);return()=>clearTimeout(Y)}else gr.length>0&&kt([])},[Vt,x,I,P]),p.useEffect(()=>{if(d==="free"){const O="dashboardViewCount",Y=parseInt(sessionStorage.getItem(O)||"0",10)+1;if(sessionStorage.setItem(O,String(Y)),Y>0&&Y%4===0){const te=setTimeout(()=>{Ft(!0)},500);return()=>clearTimeout(te)}}},[d]),p.useEffect(()=>{d==="free"&&dd&&(sessionStorage.getItem("adConfigErrorShown")||(ve(dd,"error"),sessionStorage.setItem("adConfigErrorShown","true")))},[d,ve]);const Ht=p.useMemo(()=>{const O=o.myDisplayName.trim().toLowerCase();let X=0,Y=0,te=0;return Vt.forEach(Z=>{X+=Z.totalAmount,Z.participants.forEach(ae=>{ae.paid||(ae.name.trim().toLowerCase()===O?te+=ae.amountOwed:Y+=ae.amountOwed)})}),r.forEach(Z=>{if(Z.status==="active"&&!Z.localStatus.myPortionPaid){const ae=Z.sharedData.bill.participants.find(Ne=>Ne.id===Z.myParticipantId);ae&&!ae.paid&&(te+=ae.amountOwed)}}),{totalTracked:X,othersOweMe:Y,iOwe:te}},[Vt,r,o.myDisplayName]),Ta=p.useMemo(()=>{if(!C)return{active:[],allArchived:[],unpaidArchived:[]};const O=V.toLowerCase().trim(),X=t.filter(Ne=>Ne.participants.some(Ve=>Ve.name===C)),Y=O?X.filter(Ne=>fe==="description"?Ne.description.toLowerCase().includes(O):Ne.participants.some(Ve=>Ve.name.toLowerCase().includes(O))):X,te=Y.filter(Ne=>Ne.status==="active").sort((Ne,Ve)=>new Date(Ve.date).getTime()-new Date(Ne.date).getTime()),Z=Y.filter(Ne=>Ne.status==="archived").sort((Ne,Ve)=>new Date(Ve.date).getTime()-new Date(Ne.date).getTime()),ae=Z.filter(Ne=>Ne.participants.some(Ve=>Ve.name===C&&!Ve.paid&&Ve.amountOwed>.005));return{active:te,allArchived:Z,unpaidArchived:ae}},[t,C,V,fe]),Wt=p.useMemo(()=>{if(C||I!=="bills")return[];const O=V.toLowerCase().trim(),X=o.myDisplayName.toLowerCase().trim();let te=(O?t.filter(Z=>fe==="description"?Z.description.toLowerCase().includes(O):Z.participants.some(ae=>ae.name.toLowerCase().includes(O))):t).filter(Z=>Z.status===P);return P==="active"&&(A==="othersOweMe"?te=te.filter(Z=>!Z.participants.some(ae=>ae.name.toLowerCase().trim()===X&&!ae.paid)&&Z.participants.some(ae=>ae.name.toLowerCase().trim()!==X&&!ae.paid)):A==="iOwe"&&(te=te.filter(Z=>Z.participants.some(ae=>ae.name.toLowerCase().trim()===X&&!ae.paid)))),te},[t,V,fe,P,C,I,A,o.myDisplayName]),yr=p.useMemo(()=>{if(C||I!=="bills")return[];let O=r.filter(X=>X.status===P);if(P==="active"){if(A==="othersOweMe")return[];if(A==="iOwe")return O.filter(X=>!X.localStatus.myPortionPaid)}return O},[r,P,A,C,I]),br=p.useMemo(()=>{const O=V.toLowerCase().trim(),X=new Date;return X.setDate(X.getDate()+30),a.filter(te=>!(te.status!=="active"||new Date(te.nextDueDate)>X||O&&!te.description.toLowerCase().includes(O))).sort((te,Z)=>new Date(te.nextDueDate).getTime()-new Date(Z.nextDueDate).getTime())},[a,V]),kr=p.useMemo(()=>{const O=V.toLowerCase().trim();return a.filter(Y=>!(Y.status!=="active"||O&&!Y.description.toLowerCase().includes(O))).sort((Y,te)=>Y.description.localeCompare(te.description))},[a,V]),Pa=p.useMemo(()=>{const O=V.toLowerCase().trim();return O?n.filter(X=>X.name.toLowerCase().includes(O)):n},[n,V]);p.useEffect(()=>{Fr(Ol)},[P,V,fe,I,C,A]);const Vr=p.useMemo(()=>I==="upcoming"?at<br.length:I==="templates"?at<kr.length:I==="groups"?!1:at<Wt.length,[I,at,br.length,kr.length,Wt.length]),W=p.useCallback(()=>{Vr&&Fr(O=>O+Ol)},[Vr]),{ref:J}=em({onIntersect:W}),Q=p.useCallback(O=>{const X=l.find(Z=>Z.name===O&&Z.type==="owed");if(!X)return"No outstanding bills found.";const te=t.filter(Z=>Z.status==="active").filter(Z=>Z.participants.some(ae=>ae.name===O&&!ae.paid&&ae.amountOwed>0)).map(Z=>({description:Z.description,amountOwed:Z.participants.find(ae=>ae.name===O).amountOwed}));return J0(O,X.amount,te,o,d)},[l,t,o,d]),q=async O=>{const X=Q(O.name);try{navigator.share?await navigator.share({title:"Bill Split Reminder",text:X}):(await navigator.clipboard.writeText(X),ve("Share text copied to clipboard!"))}catch(Y){Y.name!=="AbortError"&&(console.error("Error sharing or copying:",Y),ve("Failed to share","error"))}finally{Ae(null)}},je=O=>{O.phone&&(window.location.href=`sms:${O.phone}?&body=${encodeURIComponent(Q(O.name))}`,Ae(null))},Xe=O=>{O.email&&(window.location.href=`mailto:${O.email}?subject=${encodeURIComponent("Shared Bill Reminder")}&body=${encodeURIComponent(Q(O.name))}`,Ae(null))},Bs=p.useCallback(async(O,X)=>{var Ne,Ve;const Y=t.filter(Nt=>Nt.participants.some(jr=>jr.name===O&&!jr.paid&&jr.amountOwed>0));if(Y.length===0){ve(`${O} has no outstanding bills to share.`,"info"),Ae(null);return}const{shareUrl:te,imagesDropped:Z}=await Q0(Y,O,o,x,t,d);Z>0&&ve(`Free image limit reached. ${Z} older image(s) omitted from summary.`,"info");const ae=`Here is a link to view a summary of your outstanding bills with me. This link contains a key and should not be shared with others:

${te}`;try{if(X==="sms"){const Nt=(Ne=l.find(jr=>jr.name===O))==null?void 0:Ne.phone;Nt&&(window.location.href=`sms:${Nt}?&body=${encodeURIComponent(ae)}`)}else if(X==="email"){const Nt=(Ve=l.find(jr=>jr.name===O))==null?void 0:Ve.email;Nt&&(window.location.href=`mailto:${Nt}?subject=${encodeURIComponent("Summary of Outstanding Bills")}&body=${encodeURIComponent(ae)}`)}else navigator.share?await navigator.share({title:"Summary of Outstanding Bills",text:ae}):(await navigator.clipboard.writeText(ae),ve("Share link copied to clipboard!"))}catch(Nt){Nt.name==="AbortError"?ve("Share cancelled","info"):(console.error("Error sharing link:",Nt),ve("An error occurred while trying to share the link.","error"))}finally{Ae(null)}},[t,o,x,l,ve,d]),cm=async O=>{const X=t.filter(Y=>Y.status==="active"&&Y.participants.some(te=>te.name===O&&!te.paid)).map(Y=>({...Y,participants:Y.participants.map(te=>te.name===O?{...te,paid:!0}:te)}));X.length>0&&await x(X)},dm=async O=>{const X=t.filter(te=>te.participants.some(Z=>Z.name===O));if(X.length===0){ve(`No bills found for ${O}.`,"info");return}const Y=`bills_for_${O.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.csv`;await xs({owned:X},Y),ve(`Bills for ${O} exported.`)},um=()=>I==="participants"?P==="active"?{title:"No outstanding debts",message:"Everyone is all paid up!"}:{title:"No settled participants",message:"Participants who are fully paid up across all bills will appear here."}:I==="upcoming"?{title:"No upcoming bills",message:"Recurring bills due in the next 30 days will appear here."}:I==="templates"?{title:"No recurring bills",message:"Create a recurring bill template to get started."}:I==="groups"?{title:"No groups yet",message:"Create a group to quickly add a set of friends to a new bill."}:I==="budget"?{title:"No Budget Data",message:"Create bills with categories to see your budget breakdown."}:A==="othersOweMe"&&Wt.length===0?{title:"All Caught Up!",message:"No one currently owes you money on active bills."}:A==="iOwe"&&Wt.length===0&&yr.length===0?{title:"You're All Paid Up!",message:"You don't currently owe money on any active bills."}:V?{title:"No results found",message:`Your search for "${V}" did not match any items.`}:P==="active"&&t.every(O=>O.status==="archived")&&r.every(O=>O.status==="archived")?{title:"All bills archived",message:"You can view your archived bills or create a new one."}:P==="archived"?{title:"No archived bills",message:"Archived bills will appear here."}:{title:"No bills found",message:"Get started by creating a new bill."},mm=O=>{vr(O)},fm=O=>{const{paymentDetails:X,hidePaymentMethodWarning:Y}=o;!(X.venmo||X.paypal||X.cashApp||X.zelle||X.customMessage)&&!Y?(Mt(()=>()=>Ae(O)),jt(!0)):Ae(O)},Ui=Qe?Qe.sharedData.bill.participants.find(O=>O.id===Qe.myParticipantId):null,Vi=A==="othersOweMe"?"Others Owe Me":A==="iOwe"?"I Owe":null,Hi=O=>{D(H.CreateBill,{convertFromBill:O.id})},Wi=O=>{xs({owned:[O]},`${O.description.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.csv`),ve(`Exported "${O.description}"`)},hm=O=>{xs({imported:[O]},`${O.sharedData.bill.description.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.csv`),ve(`Exported "${O.sharedData.bill.description}"`)},pm=()=>{if(I==="participants"&&!C){if(l.length>0)return s.jsx(mx,{participantsData:l,onSetShareSheetParticipant:fm,onMarkParticipantAsPaid:cm,dashboardLayoutMode:z})}else{if(C)return s.jsx(fx,{participantBills:Ta,onSelectBill:h,onArchiveBill:u,onUnarchiveBill:f,onDeleteBill:g,onReshareBill:j,dashboardStatusFilter:P,searchQuery:V,selectedParticipant:C,onExport:()=>dm(C),onConvertToTemplate:Hi,onExportBill:Wi,dashboardLayoutMode:z});if(I==="upcoming"&&br.length>0)return s.jsx("div",{className:z==="card"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"bg-white dark:bg-slate-800 rounded-lg shadow-md",children:br.slice(0,at).map(Y=>s.jsx(Uo,{bill:Y,onClick:()=>D(H.CreateBill,{fromTemplate:Y}),layoutMode:z},Y.id))});if(I==="templates"&&kr.length>0)return s.jsx("div",{className:z==="card"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"bg-white dark:bg-slate-800 rounded-lg shadow-md",children:kr.slice(0,at).map(Y=>s.jsx(Uo,{bill:Y,onClick:()=>D(H.CreateBill,{fromTemplate:Y}),layoutMode:z},Y.id))});if(I==="groups"){if(Pa.length>0)return s.jsx("div",{className:z==="card"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"bg-white dark:bg-slate-800 rounded-lg shadow-md",children:Pa.map(Y=>s.jsx(px,{group:Y,onClick:()=>D(H.GroupDetails,{groupToView:Y}),onEdit:()=>D(H.CreateGroup,{groupToEdit:Y}),onDelete:()=>w(Y.id),layoutMode:z},Y.id))})}else if(I==="budget"){if(M.hasBudgetData)return s.jsx(vx,{budgetData:M,date:R,setDate:$,onSelectBill:G})}else if(I==="bills"&&(Wt.length>0||yr.length>0||d==="free"))return s.jsx(cx,{filteredBills:Wt,filteredImportedBills:yr,visibleCount:at,subscriptionStatus:d,archivingBillIds:gr,onSelectBill:h,onArchiveBill:u,onUnarchiveBill:f,onDeleteBill:g,onReshareBill:j,onSelectImportedBill:m,onUpdateImportedBill:v,onArchiveImportedBill:b,onUnarchiveImportedBill:y,onDeleteImportedBill:k,onShowSummaryDetails:N,onSettleUp:mm,loadMoreRef:J,hasMore:Vr,onConvertToTemplate:Hi,onExportOwnedBill:Wi,onExportImportedBill:hm,dashboardLayoutMode:z})}const{title:O,message:X}=um();return s.jsx(Fo,{title:O,message:X,isArchiveContext:P==="archived"})};return s.jsxs("div",{children:[["bills","participants"].includes(I)&&s.jsx(ex,{summaryTotals:Ht,dashboardStatusFilter:P,dashboardSummaryFilter:A,onSetDashboardSummaryFilter:K}),s.jsx(tx,{selectedParticipant:C,onClearParticipant:E,dashboardView:I,onSetDashboardView:U,dashboardStatusFilter:P,onSetDashboardStatusFilter:ee,searchQuery:V,setSearchQuery:oe,searchMode:fe,setSearchMode:Je,dashboardLayoutMode:z,onSetDashboardLayoutMode:T,hasRecurringBills:Ut,hasBudgetData:M.hasBudgetData}),Vi&&I==="bills"&&s.jsx("div",{className:"mb-4",children:s.jsxs("span",{className:"inline-flex items-center gap-x-1.5 rounded-full bg-slate-100 dark:bg-slate-700 px-2.5 py-1 text-sm font-medium text-slate-700 dark:text-slate-200",children:["Filtering by: ",s.jsx("span",{className:"font-semibold",children:Vi}),s.jsx("button",{onClick:()=>K("total"),className:"ml-1 -mr-1 p-0.5 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),I==="groups"&&s.jsx("div",{className:"mb-6",children:s.jsxs("button",{onClick:()=>D(H.CreateGroup),className:"w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-teal-500/50 dark:border-teal-400/50 rounded-lg text-teal-600 dark:text-teal-300 hover:bg-teal-50 dark:hover:bg-teal-900/40 bg-teal-50/50 dark:bg-teal-900/20 transition-colors",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),s.jsx("span",{className:"font-bold text-lg",children:"Add New Group"})]})}),pm(),Vr&&s.jsx("div",{ref:J,className:"flex justify-center items-center p-8",children:s.jsxs("svg",{className:"animate-spin h-8 w-8 text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),Ue&&s.jsx(q0,{participant:{...Ue,id:Ue.name,amountOwed:Ue.amount,paid:!1},onClose:()=>Ae(null),onShareSms:je,onShareEmail:Xe,onShareGeneric:q,onShareLinkSms:()=>Bs(Ue.name,"sms"),onShareLinkEmail:()=>Bs(Ue.name,"email"),onShareLinkGeneric:()=>Bs(Ue.name,"generic"),onViewDetails:()=>{L(Ue.name),Ae(null)},shareContext:"dashboard"}),Ps&&s.jsx(Qp,{onClose:()=>Ft(!1)}),wr&&s.jsx(tm,{onClose:()=>{jt(!1),Mt(null)},onContinue:()=>{jt(!1),Ur&&Ur(),Mt(null)},onAddMethods:()=>{jt(!1),Mt(null),c("payments")},onUpdateSettings:i}),Qe&&Ui&&s.jsx(ll,{paymentDetails:Qe.sharedData.paymentDetails,billDescription:Qe.sharedData.bill.description,amountOwed:Ui.amountOwed,creatorName:Qe.creatorName,onClose:()=>vr(null)})]})},yx=async(e,t)=>{try{const r=await de(await ce("/scan-receipt"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({base64Image:e,mimeType:t})});if(!r.ok){const l=(await r.json().catch(()=>({}))).error||`Failed to analyze receipt. The server responded with status: ${r.status}`;throw new Error(l)}const a=await r.json();if(a&&a.description&&Array.isArray(a.items))return a;throw new Error("Invalid JSON structure received from the server.")}catch(r){throw console.error("Error calling receipt parsing service:",r),r instanceof Error?new Error(r.message||"Failed to analyze receipt. Please try another image or enter items manually."):new Error("An unknown error occurred while analyzing the receipt.")}},bx=async e=>{try{const t=await de(await ce("/match-items"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const n=(await t.json().catch(()=>({}))).error||`Failed to match items. Server responded with status: ${t.status}`;throw new Error(n)}const r=await t.json();if(!Array.isArray(r))throw new Error("Invalid response structure from the item matching service.");return r.map((a,n)=>({...a,id:`item-matched-${Date.now()}-${n}`}))}catch(t){throw console.error("Error calling item matching service:",t),t instanceof Error?t:new Error("An unknown error occurred while matching items.")}},kx="# SharedBills CSV Export v2",jx=e=>{var d;const t=e.split(/\r?\n/).filter(h=>h.trim()&&!h.startsWith("#"));if(t.length<1)return{ownedBills:[],importedBills:[]};const r=t[0].split(",").map(h=>h.trim()),a=t.slice(1),n=["RowType","BillID","BillType","Description","Date","TotalAmount","CreatorName","ParticipantID","ParticipantName","AmountOwed","PaidStatus","ShareInfoJSON","LastUpdatedAt"],l={};for(const h of n){const m=r.indexOf(h);if(m===-1)throw console.error("CSV parse error: Missing column",h,"Header found:",r),new Error(`CSV is missing required V2 column: "${h}". Please use the AI importer for custom formats.`);l[h]=m}const o=new Map,i=h=>{const m=[];let u="",f=!1;for(let g=0;g<h.length;g++){const w=h[g],j=h[g+1];f?w==='"'&&j==='"'?(u+='"',g++):w==='"'?f=!1:u+=w:w==='"'?f=!0:w===","?(m.push(u),u=""):u+=w}return m.push(u),m};a.forEach(h=>{if(!h.trim())return;const m=i(h);if(m.length!==r.length){console.warn(`Skipping malformed CSV row. Expected ${r.length} columns, found ${m.length}. Row: "${h}"`);return}const u=m[l.BillID];o.has(u)||o.set(u,{billData:{},participants:[]});const f=o.get(u),g=m[l.RowType];if(g==="BILL")try{const w=m[l.ShareInfoJSON]||"{}";f.billData={billType:m[l.BillType],description:m[l.Description],date:m[l.Date],totalAmount:parseFloat(m[l.TotalAmount]||"0"),creatorName:m[l.CreatorName],shareInfo:JSON.parse(w.trim()?w:"{}"),lastUpdatedAt:parseInt(m[l.LastUpdatedAt]||"0",10)}}catch(w){console.warn(`Skipping bill due to invalid ShareInfoJSON for BillID ${u}`,w)}else g==="PARTICIPANT"&&f.participants.push({id:m[l.ParticipantID],name:m[l.ParticipantName],amountOwed:parseFloat(m[l.AmountOwed]||"0"),paid:(m[l.PaidStatus]||"").toLowerCase()==="paid"})});const c={ownedBills:[],importedBills:[]};for(const[h,m]of o.entries())if(m.billData.billType){if(m.billData.billType==="OWNED"){const u={id:h,description:m.billData.description,date:m.billData.date,totalAmount:m.billData.totalAmount,participants:m.participants,lastUpdatedAt:m.billData.lastUpdatedAt,shareInfo:m.billData.shareInfo};c.ownedBills.push(u)}else if(m.billData.billType==="IMPORTED"){const{shareId:u,shareEncryptionKey:f,creatorPublicKey:g,myParticipantId:w}=m.billData.shareInfo;if(!u||!f||!g||!w)continue;const j={id:h,creatorName:m.billData.creatorName,sharedData:{bill:{id:h,description:m.billData.description,totalAmount:m.billData.totalAmount,date:m.billData.date,participants:m.participants,status:"active",lastUpdatedAt:m.billData.lastUpdatedAt},creatorPublicKey:g,signature:"",paymentDetails:{venmo:"",paypal:"",cashApp:"",zelle:"",customMessage:""}},shareId:u,shareEncryptionKey:f,lastUpdatedAt:m.billData.lastUpdatedAt,myParticipantId:w,localStatus:{myPortionPaid:((d=m.participants.find(x=>x.id===w))==null?void 0:d.paid)??!1}};c.importedBills.push(j)}}return c},Nx=async(e,t)=>{if(e.trim().startsWith(kx))try{return console.log("Detected app-native CSV format. Parsing client-side."),jx(e)}catch(r){console.warn("Client-side CSV parsing failed, falling back to AI.",r)}try{const r=await de(await ce("/parse-csv"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvContent:e,myDisplayName:t})});if(!r.ok){const l=(await r.json().catch(()=>({}))).error||`Failed to analyze CSV. The server responded with status: ${r.status}`;throw new Error(l)}const a=await r.json();if(Array.isArray(a))return{ownedBills:a,importedBills:[]};throw new Error("Invalid JSON structure received from the AI. Expected an array of bills.")}catch(r){throw console.error("Error calling CSV parsing service:",r),r instanceof Error?new Error(`Failed to analyze CSV. The service responded with an error: ${r.message}`):new Error("An unknown error occurred while analyzing the CSV.")}},Yr=1280,hd=.8,pd=e=>new Promise((t,r)=>{const a=new FileReader;a.onload=n=>{var o;if(!((o=n.target)!=null&&o.result))return r(new Error("FileReader failed to load file."));const l=new Image;l.onload=()=>{let{width:i,height:c}=l;i>c?i>Yr&&(c*=Yr/i,i=Yr):c>Yr&&(i*=Yr/c,c=Yr);const d=document.createElement("canvas");d.width=i,d.height=c;const h=d.getContext("2d");if(!h)return r(new Error("Could not get canvas context"));h.drawImage(l,0,0,i,c);const m=d.toDataURL("image/jpeg",hd);d.toBlob(u=>{if(!u)return r(new Error("Canvas to Blob conversion failed"));const f=e.name.replace(/\.[^/.]+$/,"")+".jpg",g=new File([u],f,{type:"image/jpeg",lastModified:Date.now()});t({dataUrl:m,file:g})},"image/jpeg",hd)},l.onerror=i=>r(new Error(`Image load error: ${i}`)),l.src=n.target.result},a.onerror=n=>r(new Error(`File read error: ${n}`)),a.readAsDataURL(e)}),Sx=()=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),Cx=()=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"}),s.jsx("line",{x1:"3",y1:"3",x2:"21",y2:"21",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ix=()=>s.jsxs("span",{className:"relative h-6 w-6 inline-flex items-center justify-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),s.jsx("span",{className:"absolute -top-1 -right-2.5 text-white font-bold text-[10px] leading-none bg-black/40 rounded-full px-1 py-0.5",children:"A"})]}),Dx=({onItemsScanned:e,onImageSelected:t,onImageCleared:r,isForTemplate:a})=>{const[n,l]=p.useState(null),[o,i]=p.useState(null),[c,d]=p.useState(!1),[h,m]=p.useState(!1),[u,f]=p.useState(null),[g,w]=p.useState(!1),[j,x]=p.useState(null),[v,b]=p.useState(!1),[y,k]=p.useState("auto"),N=p.useRef(null),S=p.useRef(null);p.useEffect(()=>{if(!g){S.current&&(S.current.getTracks().forEach(E=>E.stop()),S.current=null);return}return(async()=>{x(null),b(!1);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera access is not supported by your browser.");const E=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});S.current=E,N.current&&(N.current.srcObject=E),E.getVideoTracks()[0].getCapabilities().torch&&b(!0)}catch(E){console.error("Error accessing camera:",E);let T="Could not access the camera. Please ensure you have granted permission.";E.name==="NotAllowedError"?T="Camera access was denied. Please enable it in your browser settings.":E.name==="NotFoundError"&&(T="No suitable camera was found on your device."),x(T),w(!1)}})(),()=>{S.current&&(S.current.getTracks().forEach(E=>E.stop()),S.current=null)}},[g]),p.useEffect(()=>{if(!g||!v||!S.current)return;const L=S.current.getVideoTracks()[0],E=y==="on";L.applyConstraints({advanced:[{torch:E}]}).catch(T=>{console.error("Failed to apply flash constraints:",T)})},[y,g,v]);const D=()=>w(!0),I=()=>w(!1),C=p.useCallback(()=>{if(!N.current)return;const L=document.createElement("canvas");L.width=N.current.videoWidth,L.height=N.current.videoHeight;const E=L.getContext("2d");E&&(E.drawImage(N.current,0,0,L.width,L.height),I(),L.toBlob(async T=>{if(T){const M=new File([T],`capture-${Date.now()}.jpg`,{type:"image/jpeg"});m(!0),f(null);try{const{dataUrl:R,file:$}=await pd(M);i(R),t(R),l($)}catch(R){console.error("Image resizing failed after capture:",R),f("Failed to process captured image."),U()}finally{m(!1)}}},"image/jpeg",1))},[t]),P=()=>{const L=["auto","on","off"],T=(L.indexOf(y)+1)%L.length;k(L[T])},A=()=>{switch(y){case"on":return s.jsx(Sx,{});case"off":return s.jsx(Cx,{});case"auto":default:return s.jsx(Ix,{})}},z=async L=>{var T;const E=(T=L.target.files)==null?void 0:T[0];if(E){m(!0),f(null);try{const{dataUrl:M,file:R}=await pd(E);i(M),t(M),l(R)}catch(M){console.error("Image resizing failed:",M),f("Failed to process image. Please try a different one."),U()}finally{m(!1)}}},U=()=>{l(null),i(null),f(null);const L=document.getElementById("receipt-upload");L&&(L.value=""),r()},ee=L=>new Promise((E,T)=>{const M=new FileReader;M.readAsDataURL(L),M.onload=()=>{const R=M.result.split(",")[1];E(R)},M.onerror=R=>T(R)}),K=p.useCallback(async()=>{if(n){d(!0),f(null);try{const L=await ee(n),E=await yx(L,n.type);if(E&&E.items)e(E);else throw new Error("No items found in the receipt.")}catch(L){f(L.message||"An unknown error occurred.")}finally{d(!1)}}},[n,e]);return s.jsxs(s.Fragment,{children:[g&&s.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center",children:[s.jsx("video",{ref:N,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),v&&s.jsx("div",{className:"absolute top-4 right-4",children:s.jsx("button",{type:"button",onClick:P,className:"p-3 bg-black bg-opacity-40 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-white","aria-label":`Set flash to ${y}`,children:s.jsx(A,{})})}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-black bg-opacity-50 flex justify-around items-center",children:[s.jsx("button",{type:"button",onClick:I,className:"px-6 py-3 bg-gray-600/70 text-white font-semibold rounded-lg text-lg",children:"Cancel"}),s.jsx("button",{type:"button",onClick:C,className:"w-20 h-20 bg-white rounded-full border-4 border-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white ring-offset-black/50"})]})]}),s.jsxs("div",{className:"mb-6 p-6 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-center bg-slate-50 dark:bg-slate-700/30",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-2 text-slate-700 dark:text-slate-200",children:["Scan a Receipt ",a?"(to populate template)":"(Optional)"]}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:[a?"Use an image to quickly fill out the template fields below. The image itself will not be saved.":"Let AI extract the items and prices for you.",s.jsx("br",{}),s.jsx("strong",{className:"text-slate-600 dark:text-slate-300",children:"Note: AI scanning uses Google Gemini and requires an internet connection."})]}),!o&&!h&&s.jsxs("div",{className:"flex justify-center gap-4",children:[s.jsx("input",{type:"file",id:"receipt-upload",className:"hidden",accept:"image/*",onChange:z}),s.jsxs("label",{htmlFor:"receipt-upload",className:"cursor-pointer inline-flex items-center gap-2 bg-white dark:bg-slate-700 text-teal-600 dark:text-teal-400 font-semibold px-4 py-2 border border-teal-500 rounded-lg hover:bg-teal-50 dark:hover:bg-slate-600",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),s.jsx("span",{children:"Choose Image"})]}),s.jsxs("button",{type:"button",onClick:D,className:"cursor-pointer inline-flex items-center gap-2 bg-white dark:bg-slate-700 text-teal-600 dark:text-teal-400 font-semibold px-4 py-2 border border-teal-500 rounded-lg hover:bg-teal-50 dark:hover:bg-slate-600",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:"Use Camera"})]})]}),h&&s.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-8",children:[s.jsxs("svg",{className:"animate-spin h-8 w-8 text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Processing image..."})]}),o&&!h&&s.jsxs("div",{className:"mt-4 relative inline-block",children:[s.jsx("img",{src:o,alt:"Receipt preview",className:"max-h-48 mx-auto rounded-md shadow-sm"}),s.jsx("button",{type:"button",onClick:U,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-white","aria-label":"Clear image",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),n&&!h&&s.jsx("div",{className:"mt-4",children:s.jsx("button",{type:"button",onClick:K,disabled:c,className:"w-full bg-teal-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-600 disabled:bg-slate-400 dark:disabled:bg-slate-600 flex items-center justify-center gap-2",children:c?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{children:"Scanning..."})]}):"Scan with AI"})}),u&&s.jsx("p",{className:"mt-4 text-sm text-red-600 bg-red-100 p-3 rounded-md dark:bg-red-900/50 dark:text-red-400",children:u}),j&&s.jsx("p",{className:"mt-4 text-sm text-red-600 bg-red-100 p-3 rounded-md dark:bg-red-900/50 dark:text-red-400",children:j})]})]})},Ex=({initialItems:e,participants:t,onSave:r,onCancel:a,isRecurring:n})=>{const[l,o]=p.useState(()=>JSON.parse(JSON.stringify(e))),i=(f,g,w)=>{o(j=>j.map(x=>{if(x.id===f){const v={...x};return g==="name"?v.name=w:g==="price"&&(v.price=parseFloat(w)||0),v}return x}))},c=(f,g)=>{o(w=>w.map(j=>{if(j.id===f){const x=j.assignedTo.includes(g)?j.assignedTo.filter(v=>v!==g):[...j.assignedTo,g];return{...j,assignedTo:x}}return j}))},d=()=>{const f={id:`item-manual-${Date.now()}`,name:"",price:0,assignedTo:[]};o(g=>[...g,f])},h=f=>o(g=>g.filter(w=>w.id!==f)),m=()=>{const f=n?l.filter(g=>g.name.trim()!==""):l.filter(g=>g.name.trim()!==""||g.price>0);r(f)},u=p.useMemo(()=>l.reduce((f,g)=>f+(g.price||0),0),[l]);return s.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-60 z-50 flex justify-center items-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"item-editor-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[90vh]",children:[s.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:[s.jsx("h2",{id:"item-editor-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:n?"Edit Default Items":"Edit Itemization"}),!n&&l.some(f=>f.assignedTo.length===0)&&s.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:"Some items are unassigned. All items must be assigned to at least one person."})]}),s.jsxs("div",{className:"p-6 flex-grow overflow-y-auto",children:[l.length===0?s.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400",children:"No items yet. Add one to get started."}):s.jsx("ul",{className:"space-y-4",children:l.map(f=>s.jsxs("li",{className:`p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg ring-2 ${f.assignedTo.length===0&&!n?"ring-red-500/50":"ring-transparent"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("label",{htmlFor:`item-name-${f.id}`,className:"sr-only",children:"Item Name"}),s.jsx("input",{id:`item-name-${f.id}`,type:"text",value:f.name,onChange:g=>i(f.id,"name",g.target.value),placeholder:"Item Name",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),!n&&s.jsxs("div",{className:"w-28",children:[s.jsx("label",{htmlFor:`item-price-${f.id}`,className:"sr-only",children:"Price"}),s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500",children:"$"}),s.jsx("input",{id:`item-price-${f.id}`,type:"number",step:"0.01",value:f.price,onChange:g=>i(f.id,"price",g.target.value),placeholder:"0.00",className:"w-full pl-7 pr-2 py-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]})]}),s.jsx("button",{onClick:()=>h(f.id),className:"p-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-500 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 rounded-full flex-shrink-0","aria-label":`Delete item ${f.name}`,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]}),!n&&t.length>0&&s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Assigned to:"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:t.filter(g=>g.name.trim()!=="").map(g=>s.jsx("button",{type:"button",onClick:()=>c(f.id,g.id),className:`flex items-center justify-center h-8 px-3 rounded-full text-xs font-semibold whitespace-nowrap transition-all ring-2 ring-offset-2 dark:ring-offset-slate-700 ${f.assignedTo.includes(g.id)?"bg-teal-500 text-white ring-teal-500":"bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 ring-transparent"}`,children:g.name},g.id))})]})]},f.id))}),s.jsx("div",{className:"mt-6",children:s.jsxs("button",{onClick:d,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),s.jsx("span",{children:"Add Item"})]})})]}),s.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[s.jsx("div",{children:!n&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-sm font-medium text-slate-500 dark:text-slate-400",children:"New Total:"}),s.jsxs("span",{className:"ml-2 text-lg font-bold text-slate-800 dark:text-slate-100",children:["$",u.toFixed(2)]})]})}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsx("button",{onClick:a,className:"px-5 py-2.5 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:m,className:"px-5 py-2.5 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Done"})]})]})]})})},Mx=({initialInfo:e,onSave:t,onCancel:r})=>{const[a,n]=p.useState(()=>JSON.parse(JSON.stringify(e))),l=(d,h,m)=>{n(u=>u.map(f=>f.id===d?{...f,[h]:m}:f))},o=()=>{const d={id:`info-manual-${Date.now()}`,key:"",value:""};n(h=>[...h,d])},i=d=>{n(h=>h.filter(m=>m.id!==d))},c=()=>{const d=a.filter(h=>h.key.trim()!==""||h.value.trim()!=="");t(d)};return s.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-60 z-50 flex justify-center items-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"info-editor-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[90vh]",children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:s.jsx("h2",{id:"info-editor-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Edit Additional Information"})}),s.jsxs("div",{className:"p-6 flex-grow overflow-y-auto",children:[a.length===0?s.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400",children:"No additional details yet. Add one to get started."}):s.jsx("ul",{className:"space-y-4",children:a.map(d=>s.jsxs("li",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg flex items-center gap-3",children:[s.jsxs("div",{className:"flex-grow space-y-2",children:[s.jsx("input",{type:"text",value:d.key,onChange:h=>l(d.id,"key",h.target.value),placeholder:"Key (e.g., Store Address)",className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),s.jsx("textarea",{value:d.value,onChange:h=>l(d.id,"value",h.target.value),placeholder:"Value (e.g., 123 Main St)",rows:2,className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsx("button",{onClick:()=>i(d.id),className:"p-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-500 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 rounded-full flex-shrink-0 self-start","aria-label":`Delete item ${d.key}`,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},d.id))}),s.jsx("div",{className:"mt-6",children:s.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),s.jsx("span",{children:"Add Detail"})]})})]}),s.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-end items-center",children:s.jsxs("div",{className:"flex space-x-4",children:[s.jsx("button",{onClick:r,className:"px-5 py-2.5 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:c,className:"px-5 py-2.5 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Done"})]})})]})})},Tx=["daily","weekly","monthly","yearly"],Px=["S","M","T","W","T","F","S"],Bx=({value:e,onChange:t})=>{const r=i=>{const c={...e,frequency:i};c.interval||(c.interval=1),i==="weekly"&&c.dayOfWeek===void 0&&(c.dayOfWeek=new Date().getDay()),i==="monthly"&&c.dayOfMonth===void 0&&(c.dayOfMonth=new Date().getDate()),t(c)},a=i=>{const c=Math.max(1,parseInt(i.target.value,10)||1);t({...e,interval:c})},n=i=>{t({...e,dayOfWeek:i})},l=i=>{const c=Math.max(1,Math.min(31,i));t({...e,dayOfMonth:c})},o={daily:"day(s)",weekly:"week(s)",monthly:"month(s)",yearly:"year(s)"}[e.frequency];return s.jsxs("div",{className:"mb-6 p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-700/30",children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-slate-700 dark:text-slate-200",children:"Recurrence"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-2",children:"Frequency"}),s.jsx("div",{className:"flex items-center space-x-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg",children:Tx.map(i=>s.jsx("button",{type:"button",onClick:()=>r(i),className:`flex-1 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors capitalize ${e.frequency===i?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:i},i))}),s.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[s.jsx("label",{htmlFor:"interval",className:"font-medium text-slate-600 dark:text-slate-300",children:"Every"}),s.jsx("input",{id:"interval",type:"number",min:"1",value:e.interval||1,onChange:a,className:"w-20 px-3 py-1.5 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),s.jsx("span",{className:"text-slate-700 dark:text-slate-200",children:o})]})]}),e.frequency==="weekly"&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-2",children:"On day"}),s.jsx("div",{className:"flex justify-center gap-1",children:Px.map((i,c)=>s.jsx("button",{type:"button",onClick:()=>n(c),className:`w-10 h-10 rounded-full text-sm font-semibold transition-colors ${e.dayOfWeek===c?"bg-teal-500 text-white":"bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-500"}`,children:i},c))})]}),e.frequency==="monthly"&&s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dayOfMonth",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"On day of the month"}),s.jsx("input",{id:"dayOfMonth",type:"number",min:"1",max:"31",value:e.dayOfMonth||"",onChange:i=>l(parseInt(i.target.value,10)),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"If a month doesn't have this day (e.g., 31st), the last day of the month will be used."})]})]})]})},Lx=({onSave:e,currentName:t})=>{const[r,a]=p.useState(t.trim().toLowerCase()==="myself"?"":t),[n,l]=p.useState(""),o=()=>{const i=r.trim();if(!i){l("Display name cannot be empty.");return}if(i.toLowerCase()==="myself"){l("Please choose a different name.");return}l(""),e(i)};return s.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-80 z-50 flex justify-center items-center p-4",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-8 text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-2",children:"Set Your Name"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:"Your name is required before creating a bill. This is how others will see you when you share bills, so please use your real name."}),s.jsxs("div",{className:"mb-4 text-left",children:[s.jsx("label",{htmlFor:"displayNameSetup",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Your Name"}),s.jsx("input",{id:"displayNameSetup",type:"text",value:r,onChange:i=>a(i.target.value),onKeyDown:i=>i.key==="Enter"&&o(),placeholder:"e.g., Jane Doe",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100",autoFocus:!0}),n&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:n})]}),s.jsx("button",{onClick:o,disabled:!r.trim()||r.trim().toLowerCase()==="myself",className:"w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:cursor-not-allowed transition-colors",children:"Save and Continue"})]})})},Rx=({description:e,setDescription:t,totalAmount:r,setTotalAmount:a,date:n,setDate:l,isRecurring:o,splitMode:i,errors:c})=>s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Description"}),s.jsx("input",{id:"description",type:"text",value:e,onChange:d=>t(d.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),c.description&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.description})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("div",{className:`flex-1 ${o?"w-full":"sm:w-1/2"}`,children:[s.jsxs("label",{htmlFor:"totalAmount",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:["Total Amount ",o&&"(Optional)"]}),s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500",children:"$"}),s.jsx("input",{id:"totalAmount",type:"number",step:"0.01",value:r===void 0?"":r,onChange:d=>a(d.target.value===""?void 0:parseFloat(d.target.value)),disabled:i==="item",className:"w-full pl-7 pr-2 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100 disabled:bg-slate-100 dark:disabled:bg-slate-600"})]}),c.totalAmount&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.totalAmount})]}),!o&&s.jsxs("div",{className:"flex-1 sm:w-1/2",children:[s.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Date"}),s.jsx("input",{id:"date",type:"date",value:n,onChange:d=>l(d.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]})]})]}),sm=({splitMode:e,setSplitMode:t,splitError:r})=>s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-slate-700 dark:text-slate-200",children:"Split Method"}),s.jsxs("div",{className:"flex items-center space-x-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg",children:[s.jsx("button",{type:"button",onClick:()=>t("equally"),className:`flex-1 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${e==="equally"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Equally"}),s.jsx("button",{type:"button",onClick:()=>t("amount"),className:`flex-1 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${e==="amount"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"By Amount"}),s.jsx("button",{type:"button",onClick:()=>t("percentage"),className:`flex-1 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${e==="percentage"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"By %"}),s.jsx("button",{type:"button",onClick:()=>t("item"),className:`flex-1 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${e==="item"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"By Item"})]}),r&&s.jsx("p",{className:"text-sm text-red-500 mt-2",children:r})]}),am=({participants:e,setParticipants:t,splitMode:r,participantsError:a})=>{const[n,l]=p.useState(!1);p.useEffect(()=>{"contacts"in navigator&&"select"in navigator.contacts&&l(!0)},[]);const o=()=>{t([...e,{id:`p-${Date.now()}`,name:"",amountOwed:0,paid:!1,splitValue:0}])},i=h=>{e.length>1&&t(e.filter(m=>m.id!==h))},c=(h,m,u)=>{const f=e.map(g=>{if(g.id===h){if(m==="name")return{...g,name:u};const w=parseFloat(u)||0;return{...g,splitValue:w}}return g});t(f)},d=async()=>{try{const h=await navigator.contacts.select(["name","email","tel"],{multiple:!0});if(h.length===0)return;const m=new Set(e.map(g=>g.name.toLowerCase().trim())),u=h.map(g=>{const w=g.name&&g.name.length>0?g.name[0]:null,j=g.email&&g.email.length>0?g.email[0]:null,x=g.tel&&g.tel.length>0?g.tel[0]:null;return w&&w.trim()&&!m.has(w.toLowerCase().trim())?(m.add(w.toLowerCase().trim()),{id:`p-${Date.now()}-${Math.random()}`,name:w.trim(),amountOwed:0,paid:!1,splitValue:0,email:j||void 0,phone:x||void 0}):null}).filter(g=>g!==null);if(u.length===0)return;const f=e.findIndex(g=>g.name.trim()==="");if(f>-1){const g=[...e],w=u.shift();w&&(g[f]=w),t([...g,...u])}else t([...e,...u])}catch(h){console.error("Error fetching contacts:",h)}};return s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3 text-slate-700 dark:text-slate-200",children:"Participants"}),s.jsxs("div",{className:"space-y-3",children:[e.map((h,m)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:h.name,onChange:u=>c(h.id,"name",u.target.value),placeholder:`Participant ${m+1}`,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),(r==="amount"||r==="percentage")&&s.jsxs("div",{className:"relative w-32",children:[s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500",children:r==="amount"?"$":"%"}),s.jsx("input",{type:"number",step:"0.01",value:h.splitValue||"",onChange:u=>c(h.id,"splitValue",u.target.value),className:"w-full pl-7 pr-2 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsx("button",{onClick:()=>i(h.id),disabled:e.length<=1,className:"p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-full disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent","aria-label":`Remove participant ${h.name||`Participant ${m+1}`}`,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})})]},h.id)),s.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row gap-3",children:[s.jsxs("button",{type:"button",onClick:o,className:"w-full sm:flex-1 flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"http://www.w3.org/2000/svg",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z",clipRule:"evenodd"})}),s.jsx("span",{children:"Add Manually"})]}),n&&s.jsxs("button",{type:"button",onClick:d,className:"w-full sm:flex-1 flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-teal-500/50 dark:border-teal-400/50 rounded-lg text-teal-600 dark:text-teal-300 hover:bg-teal-50 dark:hover:bg-teal-900/40 bg-teal-50/50 dark:bg-teal-900/20 transition-colors",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"http://www.w3.org/2000/svg",fill:"currentColor",children:[s.jsx("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6z"}),s.jsx("path",{fillRule:"evenodd",d:"M1.5 14.5a3 3 0 013-3h7a3 3 0 013 3v1a2 2 0 01-2 2H3.5a2 2 0 01-2-2v-1zM5 14a1 1 0 00-1 1v1a1 1 0 001 1h7a1 1 0 001-1v-1a1 1 0 00-1-1H5z",clipRule:"evenodd"})]}),s.jsx("span",{children:"Add from Contacts"})]})]}),a&&s.jsx("p",{className:"text-sm text-red-500",children:a})]})]})},Jr=1280,Vo=.8,Ax=e=>new Promise((t,r)=>{const a=new FileReader;a.onload=n=>{var o;if(!((o=n.target)!=null&&o.result))return r(new Error("FileReader failed to load file."));const l=new Image;l.onload=()=>{let{width:i,height:c}=l;i>c?i>Jr&&(c*=Jr/i,i=Jr):c>Jr&&(i*=Jr/c,c=Jr);const d=document.createElement("canvas");d.width=i,d.height=c;const h=d.getContext("2d");if(!h)return r(new Error("Could not get canvas context"));h.drawImage(l,0,0,i,c);const m=d.toDataURL("image/jpeg",Vo);d.toBlob(u=>{if(!u)return r(new Error("Canvas to Blob conversion failed"));const f=e.name.replace(/\.[^/.]+$/,"")+".jpg",g=new File([u],f,{type:"image/jpeg",lastModified:Date.now()});t({dataUrl:m,file:g})},"image/jpeg",Vo)},l.onerror=i=>r(new Error(`Image load error: ${i}`)),l.src=n.target.result},a.onerror=n=>r(new Error(`File read error: ${n}`)),a.readAsDataURL(e)}),Ox=({receiptImage:e,onReceiptImageChange:t})=>{const[r,a]=p.useState(!1),[n,l]=p.useState(null),[o,i]=p.useState(!1),c=p.useRef(null),d=p.useRef(null);p.useEffect(()=>{if(!o){d.current&&(d.current.getTracks().forEach(f=>f.stop()),d.current=null);return}return(async()=>{l(null);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera access is not supported by your browser.");const f=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});d.current=f,c.current&&(c.current.srcObject=f)}catch(f){l(f.message||"Could not access camera."),i(!1)}})(),()=>{d.current&&d.current.getTracks().forEach(f=>f.stop())}},[o]);const h=async u=>{var g;const f=(g=u.target.files)==null?void 0:g[0];if(f){a(!0),l(null);try{const{dataUrl:w}=await Ax(f);t(w)}catch{l("Failed to process image.")}finally{a(!1)}}},m=p.useCallback(()=>{if(!c.current)return;const u=document.createElement("canvas");u.width=c.current.videoWidth,u.height=c.current.videoHeight;const f=u.getContext("2d");if(f){f.drawImage(c.current,0,0,u.width,u.height),i(!1);const g=u.toDataURL("image/jpeg",Vo);t(g)}},[t]);return s.jsxs("div",{className:"flex-1 p-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-center hover:border-teal-500 dark:hover:border-teal-400 transition-colors duration-200",children:[o&&s.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center",children:[s.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-black bg-opacity-50 flex justify-around items-center",children:[s.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-6 py-3 bg-gray-600/70 text-white font-semibold rounded-lg text-lg",children:"Cancel"}),s.jsx("button",{type:"button",onClick:m,className:"w-20 h-20 bg-white rounded-full border-4 border-gray-400"})]})]}),s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"Receipt Image"}),e?s.jsxs("div",{className:"mt-2 relative inline-block",children:[s.jsx("img",{src:e,alt:"Receipt preview",className:"max-h-24 mx-auto rounded-md shadow-sm"}),s.jsx("button",{type:"button",onClick:()=>t(void 0),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-lg hover:bg-red-600",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}):r?s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-2",children:"Processing..."}):s.jsxs("div",{className:"mt-2 space-y-2",children:[s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"(Optional)"}),s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx("input",{type:"file",id:"image-upload",className:"hidden",accept:"image/*",onChange:h}),s.jsx("label",{htmlFor:"image-upload",className:"cursor-pointer text-xs font-semibold px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded-md hover:bg-slate-50 dark:hover:bg-slate-700",children:"Choose"}),s.jsx("button",{type:"button",onClick:()=>i(!0),className:"cursor-pointer text-xs font-semibold px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded-md hover:bg-slate-50 dark:hover:bg-slate-700",children:"Camera"})]})]}),n&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:n})]})},zx=({items:e,additionalInfo:t,onEditItems:r,onEditInfo:a,isRecurring:n,receiptImage:l,onReceiptImageChange:o})=>s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("button",{type:"button",onClick:r,className:"flex-1 p-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:border-teal-500 dark:hover:border-teal-400 transition-all duration-200",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 mx-auto text-slate-500 dark:text-slate-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:n?"Default Items":"Itemization"}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["(",e.length," items)"]})]}),s.jsxs("button",{type:"button",onClick:a,className:"flex-1 p-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:border-teal-500 dark:hover:border-teal-400 transition-all duration-200",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 mx-auto text-slate-500 dark:text-slate-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"Additional Details"}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["(",t.length," details)"]})]})]}),s.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:s.jsx(Ox,{receiptImage:l,onReceiptImageChange:o})})]}),xd=5,$x=({isOpen:e,onClose:t,groups:r,onSelect:a})=>{const[n,l]=p.useState(""),[o,i]=p.useState(xd),c=p.useMemo(()=>{const f=n.toLowerCase();return[...r].sort((g,w)=>(w.popularity??0)-(g.popularity??0)||g.name.localeCompare(w.name)).filter(g=>g.name.toLowerCase().includes(f))},[r,n]),d=p.useMemo(()=>c.slice(0,o),[c,o]),h=o<c.length,m=p.useCallback(()=>{h&&i(f=>f+xd)},[h]),{ref:u}=em({onIntersect:m});return e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:t,role:"dialog","aria-modal":"true","aria-labelledby":"select-group-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:f=>f.stopPropagation(),children:[s.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:[s.jsx("h2",{id:"select-group-title",className:"sr-only",children:"Select a Group"}),s.jsx("input",{type:"text",placeholder:"Search groups...",value:n,onChange:f=>l(f.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100",autoFocus:!0})]}),s.jsxs("ul",{className:"flex-grow overflow-y-auto p-4 space-y-2",children:[d.map((f,g)=>{const w=g===d.length-1;return s.jsx("li",{ref:w&&h?u:null,children:s.jsxs("button",{onClick:()=>a(f.id),className:"w-full text-left p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-teal-500 dark:hover:border-teal-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[s.jsx("p",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:f.name}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[f.participants.length," members"]})]})},f.id)}),h&&s.jsx("li",{className:"text-center p-4 text-slate-500 dark:text-slate-400",children:"Loading more..."}),!c.length&&s.jsx("li",{className:"text-center p-8 text-slate-500 dark:text-slate-400",children:n?"No groups match your search.":"No groups found."})]})]})}):null},_x=()=>new Date().toISOString().split("T")[0],Fx=()=>{const t=new URLSearchParams(window.location.hash.split("?")[1]||"").get("step");return t==="1.5"?1.5:parseFloat(t||"0")},Ux=({onSaveBill:e,onSaveRecurringBill:t,onUpdateRecurringBill:r,onBack:a,settings:n,updateSettings:l,recurringBillToEdit:o,fromTemplate:i,billConversionSource:c,groups:d,categories:h})=>{const m=o||i||c,u=!!o,f=!!i,g=!!c,w=u||g,[j,x]=p.useState(u||g?2:d.length>0?0:1),[v,b]=p.useState(!1),{showNotification:y}=ut(),[k,N]=p.useState(null),[S,D]=p.useState(!1),I=W=>{x(parseFloat(String(W)));const J=new URLSearchParams(window.location.hash.split("?")[1]||""),Q=window.location.hash.split("?")[0];W===1||W===0?J.delete("step"):J.set("step",String(W));const q=J.toString();window.history.replaceState(null,"",q?`${Q}?${q}`:Q)};p.useEffect(()=>{const W=()=>{const J=Fx();j!==J&&x(J)};return window.addEventListener("hashchange",W),()=>window.removeEventListener("hashchange",W)},[j]);const[C,P]=p.useState((m==null?void 0:m.description)||""),[A,z]=p.useState(m==null?void 0:m.totalAmount),[U,ee]=p.useState(c!=null&&c.date?c.date.split("T")[0]:_x()),[K,L]=p.useState((m==null?void 0:m.participants)||[{id:"p1",name:n.myDisplayName,amountOwed:0,paid:!0,splitValue:0}]),[E,T]=p.useState((m==null?void 0:m.splitMode)||(m!=null&&m.items&&m.items.length>0?"item":"equally")),[M,R]=p.useState((m==null?void 0:m.items)||[]),[$,G]=p.useState(m==null?void 0:m.receiptImage),[V,oe]=p.useState(m!=null&&m.additionalInfo?Object.entries(m.additionalInfo).map(([W,J],Q)=>({id:`info-${Q}`,key:W,value:J})):[]),[fe,Je]=p.useState(m==null?void 0:m.categoryId),[at,Fr]=p.useState((m==null?void 0:m.recurrenceRule)||{frequency:"monthly",interval:1,dayOfMonth:new Date().getDate()}),[Ue,Ae]=p.useState({}),[gr,kt]=p.useState(!1),[Ps,Ft]=p.useState(!1),[Qe,vr]=p.useState(!1);p.useEffect(()=>{const W=K.filter(Q=>Q.name.trim()!=="");if(W.length===0)return;let J=[...K];switch(E){case"equally":{const Q=(A||0)/W.length;J=K.map(q=>({...q,amountOwed:q.name.trim()?parseFloat(Q.toFixed(2)):0}));break}case"amount":J=K.map(Q=>({...Q,amountOwed:Q.splitValue||0}));break;case"percentage":{const Q=K.reduce((q,je)=>q+(je.splitValue||0),0);J=K.map(q=>({...q,amountOwed:Q>0?parseFloat(((A||0)*((q.splitValue||0)/Q)).toFixed(2)):0}));break}case"item":{J=K.map(Q=>{let q=M.reduce((je,Xe)=>je+(Xe.assignedTo.includes(Q.id)?Xe.price/(Xe.assignedTo.length||1):0),0);return{...Q,amountOwed:parseFloat(q.toFixed(2))}});break}}if(E!=="item"){const Q=J.reduce((je,Xe)=>je+Xe.amountOwed,0),q=(A||0)-Q;if(Math.abs(q)>.001&&J.length>0){const je=J.findIndex(Xe=>Xe.name.trim());je!==-1&&(J[je].amountOwed=parseFloat((J[je].amountOwed+q).toFixed(2)))}}JSON.stringify(J)!==JSON.stringify(K)&&L(J)},[A,E,M,K]),p.useEffect(()=>{f&&i&&L(i.participants.map(W=>({...W,paid:!1})))},[f,i]),p.useEffect(()=>{!n.myDisplayName||n.myDisplayName.trim().toLowerCase()==="myself"?vr(!0):vr(!1)},[n.myDisplayName]);const wr=async W=>{const J=n.myDisplayName.trim().toLowerCase();await l({myDisplayName:W}),L(Q=>Q.map(q=>q.name.trim().toLowerCase()===J?{...q,name:W}:q))},jt=()=>{if(E==="item"&&M.some(Q=>Q.assignedTo.length===0)){y("Please assign all items to a participant before saving.","error"),kt(!0);return}if(!ve(4))return;const W=K.map(Q=>({...Q,name:Q.name.trim()})),J=V.reduce((Q,q)=>(q.key.trim()&&(Q[q.key.trim()]=q.value),Q),{});if(w){const Q={description:C,totalAmount:A||0,participants:W,items:M,receiptImage:$,additionalInfo:J,splitMode:E,recurrenceRule:at,groupId:k||void 0,categoryId:fe};u&&o?r({...o,...Q}):t(Q)}else e({description:C,totalAmount:A||0,date:U,participants:W,items:M,receiptImage:$,additionalInfo:J,groupId:k||void 0,categoryId:fe},i==null?void 0:i.id);a()},Ur=async W=>{P(W.description||""),W.date&&!w&&ee(W.date),W.additionalInfo&&oe(W.additionalInfo.map((q,je)=>({id:`info-scan-${je}`,...q})));const J=W.items.map(q=>({name:q.name,price:q.price}));z(J.reduce((q,je)=>q+(je.price||0),0));const Q=(q,je)=>q.map((Xe,Bs)=>({...Xe,id:`item-scan-${Bs}`,assignedTo:je}));if(f&&i)if(i.splitMode!=="item")R(Q(J,[])),T(i.splitMode);else{b(!0);try{const q=await bx({templateItems:i.items||[],scannedItems:J,participants:K});R(q),T("item")}catch(q){y(`AI item matching failed: ${q.message}. Assign manually.`,"error"),R(Q(J,[])),T("item")}finally{b(!1)}}else{const q=K.find(Xe=>Xe.name.toLowerCase().trim()===n.myDisplayName.toLowerCase().trim()),je=k?[]:q?[q.id]:[];R(Q(J,je)),T("item")}I(2)},Mt=p.useMemo(()=>M.reduce((W,J)=>W+(J.price||0),0),[M]);p.useEffect(()=>{E==="item"&&z(Mt)},[M,E,Mt]);const ve=W=>{const J={};return W>=2&&(C.trim()||(J.description="Description is required."),!w&&(!A||A<=0)&&E!=="item"&&(J.totalAmount="Total amount must be greater than zero.")),W>=3&&K.some(Q=>!Q.name.trim())&&(J.participants="All participants must have a name."),Ae(J),Object.keys(J).length===0},Ut=W=>{ve(j)&&I(W)},Vt=W=>{const J=d.find(Q=>Q.id===W);J&&(N(J.id),L(J.participants.map(Q=>({...Q,paid:!1,amountOwed:0}))),T(J.defaultSplit.mode),J.defaultSplit.splitValues&&L(J.participants.map(Q=>({...Q,paid:!1,amountOwed:0,splitValue:J.defaultSplit.splitValues[Q.id]||0})))),D(!1),I(1)},Ht=()=>d.length>5?s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mb-6",children:"Start with a Group?"}),s.jsx("button",{type:"button",onClick:()=>D(!0),className:"w-full px-6 py-4 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 mb-4 text-lg",children:"Select Group"}),s.jsx("button",{type:"button",onClick:()=>I(1),className:"w-full px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",children:"Continue without a Group"})]}):s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mb-6",children:"Start with a Group?"}),s.jsx("div",{className:"space-y-4 mb-6",children:d.map(W=>s.jsxs("button",{type:"button",onClick:()=>Vt(W.id),className:"w-full text-left p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-teal-500 dark:hover:border-teal-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[s.jsx("p",{className:"font-bold text-lg",children:W.name}),s.jsxs("p",{className:"text-sm text-slate-500",children:[W.participants.length," members"]})]},W.id))}),s.jsx("button",{type:"button",onClick:()=>I(1),className:"w-full px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",children:"Continue without a Group"})]}),Ta=()=>s.jsxs("div",{className:"text-center",children:[" ",s.jsx("h3",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mb-6",children:"How do you want to start?"})," ",s.jsxs("div",{className:"flex flex-col sm:flex-row gap-6",children:[" ",s.jsxs("button",{type:"button",onClick:()=>I(1.5),className:"flex-1 p-8 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-teal-500 dark:hover:border-teal-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all transform hover:-translate-y-1",children:[" ",s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-teal-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[" ",s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})," "]})," ",s.jsx("h4",{className:"text-xl font-bold mt-4 text-slate-800 dark:text-slate-100",children:"Scan a Receipt"})," ",s.jsx("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:"Use AI to automatically add items."})," "]})," ",s.jsxs("button",{type:"button",onClick:()=>I(2),className:"flex-1 p-8 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-teal-500 dark:hover:border-teal-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all transform hover:-translate-y-1",children:[" ",s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-teal-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[" ",s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})," "]})," ",s.jsx("h4",{className:"text-xl font-bold mt-4 text-slate-800 dark:text-slate-100",children:"Enter Manually"})," ",s.jsx("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:"Add the bill details yourself."})," "]})," "]})," "]}),Wt=()=>s.jsx(Dx,{onItemsScanned:Ur,onImageSelected:G,onImageCleared:()=>G(void 0),isForTemplate:w}),yr=()=>s.jsxs("div",{className:"space-y-6",children:[" ",s.jsx(Rx,{description:C,setDescription:P,totalAmount:A,setTotalAmount:z,date:U,setDate:ee,isRecurring:w,splitMode:E,errors:Ue}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Category (Optional)"}),s.jsxs("select",{id:"category",value:fe||"",onChange:W=>Je(W.target.value||void 0),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100",children:[s.jsx("option",{value:"",children:"Uncategorized"}),h.map(W=>s.jsx("option",{value:W.id,children:W.name},W.id))]})]}),s.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[" ",s.jsx("button",{type:"button",onClick:()=>I(k?0:1),className:"px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Back"})," ",s.jsx("button",{type:"button",onClick:()=>Ut(3),className:"px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Next"})," "]})," "]}),br=()=>s.jsxs("div",{className:"space-y-6",children:[" ",s.jsx(sm,{splitMode:E,setSplitMode:T})," ",s.jsx(am,{participants:K,setParticipants:L,splitMode:E,participantsError:Ue.participants})," ",s.jsxs("div",{className:"mt-8 flex justify-between space-x-4",children:[" ",s.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Back"})," ",s.jsx("button",{type:"button",onClick:()=>Ut(4),className:"px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Next"})," "]})," "]}),kr=()=>s.jsxs("div",{className:"space-y-6",children:[" ",w&&s.jsx(Bx,{value:at,onChange:Fr})," ",s.jsx(zx,{items:M,additionalInfo:V,onEditItems:()=>kt(!0),onEditInfo:()=>Ft(!0),isRecurring:w,receiptImage:$,onReceiptImageChange:G})," ",s.jsxs("div",{className:"mt-8 flex justify-between space-x-4",children:[" ",s.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Back"})," ",s.jsx("button",{type:"button",onClick:jt,className:"px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:u?"Update Template":"Save Bill"})," "]})," "]}),Pa=()=>u?"Edit Template":f?"Create Bill from Template":g?"Convert to Template":"Create New Bill",Vr=()=>{if(u||g)switch(j){case 2:return yr();case 3:return br();case 4:return kr();default:return I(2),yr()}switch(j){case 0:return Ht();case 1:return Ta();case 1.5:return Wt();case 2:return yr();case 3:return br();case 4:return kr();default:return Ta()}};return s.jsxs("div",{className:"max-w-2xl mx-auto",children:[Qe&&s.jsx(Lx,{onSave:wr,currentName:n.myDisplayName}),s.jsxs("button",{onClick:a,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back"]}),s.jsxs("form",{onSubmit:W=>{W.preventDefault(),jt()},className:"space-y-6 relative",children:[v&&s.jsxs("div",{className:"absolute inset-0 bg-white/80 dark:bg-slate-900/80 z-10 flex flex-col items-center justify-center rounded-lg",children:[s.jsxs("svg",{className:"animate-spin h-10 w-10 text-teal-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("h1",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200",children:"AI is matching items from your template..."})]}),s.jsx("h2",{className:"text-3xl font-bold text-slate-700 dark:text-slate-200",children:Pa()}),Vr()]}),gr&&s.jsx(Ex,{initialItems:M,participants:K,onSave:W=>{R(W),kt(!1)},onCancel:()=>kt(!1),isRecurring:w}),Ps&&s.jsx(Mx,{initialInfo:V,onSave:W=>{oe(W),Ft(!1)},onCancel:()=>Ft(!1)}),S&&s.jsx($x,{isOpen:S,onClose:()=>D(!1),groups:d,onSelect:Vt})]})},Vx=({onSave:e,onUpdate:t,onBack:r,groupToEdit:a})=>{const n=!!a,[l,o]=p.useState((a==null?void 0:a.name)||""),[i,c]=p.useState((a==null?void 0:a.participants)||[{id:`p-${Date.now()}`,name:"",amountOwed:0,paid:!1}]),[d,h]=p.useState((a==null?void 0:a.defaultSplit.mode)||"equally"),[m,u]=p.useState({});p.useEffect(()=>{(d==="equally"||d==="item")&&c(w=>w.map(j=>({...j,splitValue:void 0})))},[d]);const f=()=>{const w={};return l.trim()||(w.name="Group name is required."),(i.length===0||i.every(j=>!j.name.trim()))&&(w.participants="A group must have at least one participant with a name."),i.some(j=>!j.name.trim())&&(w.participants="All participants must have a name."),u(w),Object.keys(w).length===0},g=()=>{if(!f())return;const w=i.filter(x=>x.name.trim()!==""),j=d==="amount"||d==="percentage"?w.reduce((x,v)=>(x[v.id]=v.splitValue||0,x),{}):void 0;if(n&&a){const x={...a,name:l,participants:w,defaultSplit:{mode:d,splitValues:j}};t(x)}else e({name:l,participants:w,defaultSplit:{mode:d,splitValues:j},popularity:0});r()};return s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsxs("button",{onClick:r,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to Dashboard"]}),s.jsxs("form",{onSubmit:w=>{w.preventDefault(),g()},className:"space-y-6",children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-700 dark:text-slate-200",children:n?"Edit Group":"Create New Group"}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"groupName",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Group Name"}),s.jsx("input",{id:"groupName",type:"text",value:l,onChange:w=>o(w.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),m.name&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:m.name})]}),s.jsx(am,{participants:i,setParticipants:c,splitMode:d,participantsError:m.participants}),s.jsxs("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-700/30",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200",children:"Default Split Settings"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"When you create a bill from this group, these settings will be applied by default."}),s.jsx(sm,{splitMode:d,setSplitMode:h})]}),s.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[s.jsx("button",{type:"button",onClick:r,className:"px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:n?"Update Group":"Save Group"})]})]})]})},Za=({onClick:e,children:t,disabled:r,title:a,isUsed:n})=>s.jsx("button",{onClick:e,disabled:r,title:a,className:`p-2 rounded-full transition-colors disabled:opacity-50 disabled:cursor-wait cursor-pointer ${n?"text-emerald-600 bg-emerald-100 dark:text-emerald-400 dark:bg-emerald-400/20":"text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:t}),Hx=e=>{const t=Date.now(),r=Math.floor((t-e)/1e3);if(r<60)return`${r} second${r!==1?"s":""} ago`;const a=Math.floor(r/60);if(a<60)return`${a} minute${a!==1?"s":""} ago`;const n=Math.floor(a/60);if(n<24)return`${n} hour${n!==1?"s":""} ago`;const l=Math.floor(n/24);return`${l} day${l!==1?"s":""} ago`},Wx=({bill:e})=>{const t=p.useMemo(()=>{if(!e.shareHistory)return[];const a=[];for(const n in e.shareHistory){const l=e.participants.find(i=>i.id===n);if(!l)continue;const o=e.shareHistory[n];for(const i in o)a.push({participantName:l.name,method:i,timestamp:o[i]})}return a.sort((n,l)=>l.timestamp-n.timestamp)},[e.shareHistory,e.participants]);if(t.length===0)return s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 text-center py-2",children:"No shares have been sent for this bill yet."});const r=a=>{switch(a){case"sms":return"via Text Message";case"email":return"via Email";case"copy":return"via Link Copy";case"share":return"via Share";default:return`via ${a}`}};return s.jsx("ul",{className:"space-y-2 text-sm max-h-48 overflow-y-auto",children:t.map((a,n)=>s.jsxs("li",{className:"flex justify-between items-center p-2 bg-slate-100 dark:bg-slate-700/50 rounded-md",children:[s.jsxs("span",{className:"text-slate-700 dark:text-slate-200",children:["Shared with ",s.jsx("span",{className:"font-semibold",children:a.participantName})," ",r(a.method)]}),s.jsx("span",{className:"text-slate-500 dark:text-slate-400 text-xs flex-shrink-0 ml-2",children:Hx(a.timestamp)})]},n))})},Kx=({bill:e,settings:t,onClose:r,onUpdateBill:a,checkAndMakeSpaceForImageShare:n})=>{const[l,o]=p.useState(null),[i,c]=p.useState(null),{showNotification:d}=ut(),h=(u,f)=>`Hi ${u.name.split(" ")[0]}, here is the secure link to our bill for "${e.description}":

${f}`,m=async(u,f)=>{const g=`${u.id}-${f}`;if(l!==g){o(g);try{if(!await n(e))return;const{url:j,billWithNewShareInfo:x}=await $p(e,u.id,t,async(y,k)=>{await a(y,k)});if(!j)throw new Error("Failed to generate share link.");const v=async()=>{var N;const y=Date.now(),k={...x.shareHistory||{},[u.id]:{...((N=x.shareHistory)==null?void 0:N[u.id])||{},[f]:y}};await a({...x,shareHistory:k},{skipSync:!0})},b=h(u,j);switch(f){case"sms":u.phone&&(window.location.href=`sms:${u.phone}?&body=${encodeURIComponent(b)}`,await v());break;case"email":u.email&&(window.location.href=`mailto:${u.email}?subject=${encodeURIComponent(`Bill: ${e.description}`)}&body=${encodeURIComponent(b)}`,await v());break;case"copy":await navigator.clipboard.writeText(j),c(u.id),setTimeout(()=>c(null),2e3),await v();break;case"share":navigator.share?(await navigator.share({title:`Bill: ${e.description}`,text:b}),await v()):(await navigator.clipboard.writeText(b),d("Share message with link copied.","success"),c(u.id),setTimeout(()=>c(null),2e3),await v());break}}catch(w){w.name!=="AbortError"&&(console.error(`Share action '${f}' failed:`,w),d(w.message||"Failed to perform share action.","error"))}finally{o(null)}}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:r,children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[90vh]",onClick:u=>u.stopPropagation(),children:[s.jsxs("div",{className:"p-6",children:[s.jsx("h3",{className:"text-xl font-bold text-center text-slate-800 dark:text-slate-100 mb-2",children:"Share Bill"}),s.jsx("p",{className:"text-sm text-center text-slate-500 dark:text-slate-400 mb-6",children:"Send each participant a unique, secure link to view this bill. Links are single-use for key retrieval and expire after 24 hours."}),s.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:e.participants.map(u=>{var f,g,w,j,x,v,b,y;return s.jsxs("li",{className:"flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-teal-500 flex items-center justify-center text-white font-bold text-xs",children:u.name.charAt(0)}),s.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-100",children:u.name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[u.phone&&s.jsx(Za,{title:"Share via Text Message",onClick:()=>m(u,"sms"),disabled:!!l,isUsed:!!((g=(f=e.shareHistory)==null?void 0:f[u.id])!=null&&g.sms),children:s.jsx("span",{className:"text-xl",role:"img","aria-label":"Text message",children:""})}),u.email&&s.jsx(Za,{title:"Share via Email",onClick:()=>m(u,"email"),disabled:!!l,isUsed:!!((j=(w=e.shareHistory)==null?void 0:w[u.id])!=null&&j.email),children:s.jsx("span",{className:"text-xl",role:"img","aria-label":"Email",children:""})}),s.jsx(Za,{title:"Copy Link",onClick:()=>m(u,"copy"),disabled:!!l,isUsed:!!((v=(x=e.shareHistory)==null?void 0:x[u.id])!=null&&v.copy),children:i===u.id?s.jsx("span",{className:"text-xl",role:"img","aria-label":"Checkmark",children:""}):s.jsx("span",{className:"text-xl",role:"img","aria-label":"Copy",children:""})}),s.jsx(Za,{title:"Share...",onClick:()=>m(u,"share"),disabled:!!l,isUsed:!!((y=(b=e.shareHistory)==null?void 0:b[u.id])!=null&&y.share),children:s.jsx("span",{className:"text-xl",role:"img","aria-label":"Share",children:""})})]})]},u.id)})}),s.jsx("div",{className:"mt-4",children:s.jsxs("details",{className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("summary",{className:"cursor-pointer p-3 font-semibold text-slate-600 dark:text-slate-300",children:"Share History"}),s.jsx("div",{className:"p-3 border-t border-slate-200 dark:border-slate-600",children:s.jsx(Wx,{bill:e})})]})})]}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:s.jsx("button",{onClick:r,className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Done"})})]})})},Gx=5e3,Yx=({status:e,onClick:t})=>{if(!e||!["live","expired","error"].includes(e))return null;const r={live:{color:"bg-emerald-500",title:"Live: This bill is actively shared."},expired:{color:"bg-red-500",title:"Expired: Click to reactivate sharing."},error:{color:"bg-amber-500",title:"Connection issue with share server."}}[e];if(!r)return null;const a=s.jsx("div",{className:"flex-shrink-0",title:r.title,children:s.jsx("span",{className:`block h-3 w-3 rounded-full ${r.color}`})});return e==="expired"&&t?s.jsx("button",{onClick:t,"aria-label":r.title,className:"p-1",children:a}):a},Jx=({bill:e,onUpdateBill:t,onBack:r,settings:a,updateSettings:n,setSettingsSection:l,navigate:o,onReshareBill:i,checkAndMakeSpaceForImageShare:c})=>{const[d,h]=p.useState(e),[m,u]=p.useState(!1),f=p.useRef(null),g=p.useRef(null),[w,j]=p.useState(!1),[x,v]=p.useState(!1),[b,y]=p.useState(!1),[k,N]=p.useState(!1),[S,D]=p.useState(!1),[I,C]=p.useState(!1),P=p.useRef(null);p.useEffect(()=>{m||h(e)},[e,m]);const A=p.useCallback(()=>{f.current&&g.current&&(console.log("Flushing debounced changes before unmount/pagehide."),clearTimeout(f.current),t(g.current),f.current=null,g.current=null,u(!1))},[t]);p.useEffect(()=>(window.addEventListener("pagehide",A),()=>{window.removeEventListener("pagehide",A),A()}),[A]),p.useEffect(()=>{const L=E=>{P.current&&!P.current.contains(E.target)&&y(!1)};return b&&document.addEventListener("mousedown",L),()=>{document.removeEventListener("mousedown",L)}},[b]);const z=L=>{f.current&&clearTimeout(f.current),u(!0);const E={...d,participants:d.participants.map(T=>T.id===L?{...T,paid:!T.paid}:T)};h(E),g.current=E,f.current=setTimeout(()=>{g.current&&t(g.current).finally(()=>{u(!1),g.current=null,f.current=null})},Gx)},U=()=>{xs({owned:[d]},`${d.description.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.csv`),y(!1)},ee=()=>{o(H.CreateBill,{convertFromBill:d.id}),y(!1)},K=()=>{const{paymentDetails:L,hidePaymentMethodWarning:E}=a;!(L.venmo||L.paypal||L.cashApp||L.zelle||L.customMessage)&&!E?v(!0):j(!0)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsxs("button",{onClick:r,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back"]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsxs("div",{className:"flex justify-between items-start gap-4",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Yx,{status:d.shareStatus,onClick:i}),s.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100 break-words",children:d.description})]}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:new Date(d.date).toLocaleDateString()})]}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[s.jsxs("p",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-50",children:["$",d.totalAmount.toFixed(2)]}),s.jsxs("div",{ref:P,className:"relative",children:[s.jsx("button",{onClick:()=>y(L=>!L),className:"p-3 -m-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full","aria-label":"More options",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),b&&s.jsxs("div",{className:"absolute top-full right-0 mt-2 w-56 bg-white dark:bg-slate-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 py-1 z-20",children:[s.jsx("button",{onClick:ee,className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"Convert to Template"}),s.jsx("button",{onClick:U,className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"Export as CSV"})]})]})]})]}),s.jsxs("div",{className:"my-4 flex flex-wrap gap-x-4 gap-y-2 border-b border-slate-200 dark:border-slate-700 pb-4",children:[d.receiptImage&&s.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"View Receipt Image"]}),d.additionalInfo&&Object.keys(d.additionalInfo).length>0&&s.jsxs("button",{onClick:()=>D(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"View Additional Info"]}),d.items&&d.items.length>0&&s.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 11a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"View Itemization"]})]}),s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4",children:"Participants"}),s.jsx("ul",{className:"space-y-3",children:d.participants.map(L=>s.jsxs("li",{className:"flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:[s.jsxs("span",{className:"font-semibold text-slate-800 dark:text-slate-100",children:[L.name," - $",L.amountOwed.toFixed(2)]}),s.jsx("button",{onClick:()=>z(L.id),className:`px-4 py-1.5 text-sm font-semibold rounded-full ${L.paid?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300":"bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300"}`,children:L.paid?"Paid":"Unpaid"})]},L.id))})]}),s.jsxs("div",{className:"mt-8 border-t border-slate-200 dark:border-slate-700 pt-6 flex justify-between items-center",children:[m?s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400",children:[s.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("span",{children:"Syncing changes..."})]}):s.jsx("div",{}),s.jsx("button",{onClick:K,className:"bg-teal-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-600 transition-colors",children:"Share Bill"})]})]}),x&&s.jsx(tm,{onClose:()=>v(!1),onContinue:()=>{v(!1),j(!0)},onAddMethods:()=>{v(!1),l("payments")},onUpdateSettings:n}),w&&s.jsx(Kx,{bill:d,settings:a,onClose:()=>j(!1),onUpdateBill:t,checkAndMakeSpaceForImageShare:c})]}),k&&d.receiptImage&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>N(!1),role:"dialog","aria-modal":"true","aria-label":"Receipt Image Viewer",children:s.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",onClick:L=>L.stopPropagation(),children:[s.jsx("img",{src:d.receiptImage,alt:"Receipt",className:"w-full h-full object-contain rounded-lg shadow-2xl"}),s.jsx("button",{onClick:()=>N(!1),className:"absolute -top-3 -right-3 bg-white text-slate-800 rounded-full p-2 shadow-lg hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-white","aria-label":"Close receipt view",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),S&&d.additionalInfo&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>D(!1),role:"dialog","aria-modal":"true","aria-labelledby":"info-dialog-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:L=>L.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:s.jsx("h3",{id:"info-dialog-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Additional Information"})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:s.jsx("dl",{className:"space-y-4",children:Object.entries(d.additionalInfo).map(([L,E])=>s.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-3 rounded-md",children:[s.jsx("dt",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 truncate",children:L}),s.jsx("dd",{className:"mt-1 text-slate-800 dark:text-slate-100 whitespace-pre-wrap",children:String(E)})]},L))})}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:s.jsx("button",{onClick:()=>D(!1),className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Close"})})]})}),I&&d.items&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>C(!1),role:"dialog","aria-modal":"true","aria-labelledby":"items-dialog-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:L=>L.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:s.jsx("h3",{id:"items-dialog-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Itemization"})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:s.jsx("ul",{className:"space-y-3",children:d.items.map(L=>{const E=L.assignedTo.map(T=>{var M;return(M=d.participants.find(R=>R.id===T))==null?void 0:M.name}).filter(Boolean);return s.jsxs("li",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-100 break-words pr-2",children:L.name}),s.jsxs("p",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:["$",L.price.toFixed(2)]})]}),E.length>0&&s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Assigned to: ",E.join(", ")]})]},L.id)})})}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:s.jsx("button",{onClick:()=>C(!1),className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Close"})})]})})]})},nm=({summaryBill:e,creatorName:t,paymentDetails:r,myParticipantId:a,importedBill:n,onUpdateImportedBill:l,onClose:o})=>{var k,N;const[i,c]=p.useState("list"),[d,h]=p.useState(null),[m,u]=p.useState(null),[f,g]=p.useState(!1),[w,j]=p.useState(!1),x=S=>{h(S),c("details")},v=S=>{if(!n||!l)return;const D=n.localStatus.paidItems||{},I={...D,[S]:!D[S]},C=(n.sharedData.bill.items||[]).every(A=>I[A.id]),P={...n,localStatus:{...n.localStatus,paidItems:I,myPortionPaid:C}};l(P)},b=()=>s.jsx("ul",{className:"space-y-3",children:(e.items||[]).map(S=>{var ee,K;const{name:D,price:I,originalBillData:C}=S;if(!C)return null;const P=(ee=e.participants.find(L=>L.id===a))==null?void 0:ee.name,A=P?C.participants.find(L=>L.name.toLowerCase().trim()===P.toLowerCase().trim()):null,z=(A==null?void 0:A.paid)??!1,U=((K=n==null?void 0:n.localStatus.paidItems)==null?void 0:K[S.id])??!1;return s.jsx("li",{children:s.jsxs("div",{className:`w-full p-4 rounded-lg transition-colors text-left ${z||U?"bg-emerald-50 dark:bg-emerald-900/40":"bg-slate-50 dark:bg-slate-700/50"}`,children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-100 flex-1 break-words pr-2",children:D}),z?s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300",children:"Paid"})}):s.jsxs("div",{className:"text-right flex-shrink-0",children:[s.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:"You Owe"}),s.jsxs("p",{className:`font-bold text-xl ${U?"text-emerald-700 dark:text-emerald-300":"text-slate-800 dark:text-slate-100"}`,children:["$",I.toFixed(2)]})]})]}),s.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[s.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Total: $",C.totalAmount.toFixed(2),"  ",new Date(C.date).toLocaleDateString()]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>x(S),className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500",children:"Details"}),!z&&s.jsx("button",{onClick:()=>u(S),className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-emerald-500 text-white hover:bg-emerald-600",children:"Settle Up"})]})]})]})},S.id)})}),y=()=>{var U,ee;if(!d||!d.originalBillData)return null;const S=(U=e.participants.find(K=>K.id===a))==null?void 0:U.name,D=S?d.originalBillData.participants.find(K=>K.name.toLowerCase().trim()===S.toLowerCase().trim()):null,I=(D==null?void 0:D.paid)??!1,C=((ee=n==null?void 0:n.localStatus.paidItems)==null?void 0:ee[d.id])??!1,{receiptImage:P,additionalInfo:A,participants:z}=d.originalBillData;return s.jsxs("div",{children:[s.jsxs("button",{onClick:()=>c("list"),className:"flex items-center gap-2 mb-4 text-teal-600 dark:text-teal-400 font-semibold",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to List"]}),s.jsxs("div",{className:"p-6 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h4",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:d.name}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["Bill Total: $",d.originalBillData.totalAmount.toFixed(2)]}),s.jsxs("p",{className:"text-4xl font-extrabold text-teal-600 dark:text-teal-400 mt-2",children:["$",d.price.toFixed(2)]}),s.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400 mt-1",children:"Your Portion"}),s.jsxs("div",{className:"my-4 flex flex-wrap gap-x-4 gap-y-2",children:[P&&s.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"View Scanned Receipt"]}),A&&Object.keys(A).length>0&&s.jsxs("button",{onClick:()=>j(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"View Additional Info"]})]}),s.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3",children:[!I&&s.jsx("button",{onClick:()=>u(d),className:"w-full flex-1 px-6 py-3 bg-emerald-500 text-white font-bold rounded-lg hover:bg-emerald-600 transition-colors",children:"Settle Up"}),n&&l&&s.jsx("button",{onClick:()=>v(d.id),disabled:I,className:`w-full flex-1 px-6 py-3 font-bold rounded-lg transition-colors ${I?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300 cursor-not-allowed":C?"bg-emerald-100 text-emerald-800 hover:bg-emerald-200 dark:bg-emerald-900/50 dark:text-emerald-300":"bg-slate-200 text-slate-800 hover:bg-slate-300 dark:bg-slate-600 dark:text-slate-100 dark:hover:bg-slate-500"}`,children:I?"Creator marked as paid":C?"I Paid":"Mark as Paid"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:"text-md font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Original Bill Participants"}),s.jsx("ul",{className:"space-y-2 text-sm",children:z.map(K=>s.jsxs("li",{className:"flex justify-between p-2 bg-slate-100 dark:bg-slate-700/50 rounded-md",children:[s.jsx("span",{className:"text-slate-700 dark:text-slate-200",children:K.name}),s.jsxs("span",{className:`${K.paid?"text-emerald-600 dark:text-emerald-400":"text-amber-600 dark:text-amber-400"}`,children:[K.paid?"Paid":"Owes"," $",K.amountOwed.toFixed(2)]})]},K.id))})]})]})};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:o,children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[90vh]",onClick:S=>S.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:s.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:i==="list"?"Bill Breakdown":"Item Details"})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:i==="list"?b():y()}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end flex-shrink-0",children:s.jsx("button",{onClick:o,className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Close"})})]})}),m&&s.jsx(ll,{paymentDetails:r,billDescription:m.name,amountOwed:m.price,creatorName:t,onClose:()=>u(null)}),f&&((k=d==null?void 0:d.originalBillData)==null?void 0:k.receiptImage)&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>g(!1),role:"dialog","aria-modal":"true","aria-label":"Receipt Image Viewer",children:s.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",onClick:S=>S.stopPropagation(),children:[s.jsx("img",{src:d.originalBillData.receiptImage,alt:"Scanned receipt",className:"w-full h-full object-contain rounded-lg shadow-2xl"}),s.jsx("button",{onClick:()=>g(!1),className:"absolute -top-3 -right-3 bg-white text-slate-800 rounded-full p-2 shadow-lg hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-white","aria-label":"Close receipt view",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),w&&((N=d==null?void 0:d.originalBillData)==null?void 0:N.additionalInfo)&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>j(!1),role:"dialog","aria-modal":"true","aria-labelledby":"info-dialog-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:S=>S.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:s.jsx("h3",{id:"info-dialog-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Additional Information"})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:s.jsx("dl",{className:"space-y-4",children:Object.entries(d.originalBillData.additionalInfo).map(([S,D])=>s.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-3 rounded-md",children:[s.jsx("dt",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 truncate",children:S}),s.jsx("dd",{className:"mt-1 text-slate-800 dark:text-slate-100 whitespace-pre-wrap",children:String(D)})]},S))})}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:s.jsx("button",{onClick:()=>j(!1),className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Close"})})]})})]})},Qx=({bill:e,onUpdateBill:t,onBack:r})=>{const[a,n]=p.useState(!1),[l,o]=p.useState(!1),[i,c]=p.useState(!1),[d,h]=p.useState(!1),[m,u]=p.useState(!1),[f,g]=p.useState(!1),w=p.useRef(null),j=e.sharedData.bill.participants.find(k=>k.id===e.myParticipantId),x=e.localStatus.myPortionPaid,v=e.id.startsWith("summary-");p.useEffect(()=>{const k=N=>{w.current&&!w.current.contains(N.target)&&c(!1)};return i&&document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[i]);const b=()=>{const k={...e,localStatus:{...e.localStatus,myPortionPaid:!e.localStatus.myPortionPaid}};t(k)},y=()=>{xs({imported:[e]},`${e.sharedData.bill.description.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.csv`),c(!1)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsxs("button",{onClick:r,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back"]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsxs("div",{className:"flex justify-between items-start gap-4",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100 break-words",children:e.sharedData.bill.description}),s.jsxs("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:["From ",e.creatorName,"  ",new Date(e.sharedData.bill.date).toLocaleDateString()]})]}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[s.jsxs("p",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-50",children:["$",j==null?void 0:j.amountOwed.toFixed(2)]}),s.jsxs("div",{ref:w,className:"relative",children:[s.jsx("button",{onClick:()=>c(k=>!k),className:"p-3 -m-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full","aria-label":"More options",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),i&&s.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 py-1 z-20",children:s.jsx("button",{onClick:y,className:"w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700",children:"Export as CSV"})})]})]})]}),s.jsxs("div",{className:"my-4 flex flex-wrap gap-x-4 gap-y-2 border-b border-slate-200 dark:border-slate-700 pb-4",children:[e.sharedData.bill.receiptImage&&s.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"View Receipt Image"]}),e.sharedData.bill.additionalInfo&&Object.keys(e.sharedData.bill.additionalInfo).length>0&&s.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"View Additional Info"]}),e.sharedData.bill.items&&e.sharedData.bill.items.length>0&&!v&&s.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 11a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"View Itemization"]})]}),j&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4",children:"Your Status"}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"My Portion"}),s.jsx("button",{onClick:b,className:`px-4 py-1.5 text-sm font-semibold rounded-full ${x?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300":"bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300"}`,children:x?"Paid":"Unpaid"})]})]}),s.jsxs("div",{className:"mt-8 border-t border-slate-200 dark:border-slate-700 pt-6 flex flex-col sm:flex-row gap-4",children:[!x&&s.jsx("button",{onClick:()=>n(!0),className:"flex-1 w-full bg-emerald-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-emerald-600 transition-colors",children:"Settle Up"}),v&&s.jsx("button",{onClick:()=>o(!0),className:"flex-1 w-full bg-slate-100 text-slate-800 font-semibold py-3 px-4 rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"View Bill Breakdown"})]})]})]}),a&&j&&s.jsx(ll,{paymentDetails:e.sharedData.paymentDetails,billDescription:e.sharedData.bill.description,amountOwed:j.amountOwed,creatorName:e.creatorName,onClose:()=>n(!1)}),l&&j&&s.jsx(nm,{summaryBill:e.sharedData.bill,paymentDetails:e.sharedData.paymentDetails,creatorName:e.creatorName,myParticipantId:j.id,importedBill:e,onUpdateImportedBill:t,onClose:()=>o(!1)}),d&&e.sharedData.bill.receiptImage&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>h(!1),role:"dialog","aria-modal":"true","aria-label":"Receipt Image Viewer",children:s.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",onClick:k=>k.stopPropagation(),children:[s.jsx("img",{src:e.sharedData.bill.receiptImage,alt:"Receipt",className:"w-full h-full object-contain rounded-lg shadow-2xl"}),s.jsx("button",{onClick:()=>h(!1),className:"absolute -top-3 -right-3 bg-white text-slate-800 rounded-full p-2 shadow-lg hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-white","aria-label":"Close receipt view",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),m&&e.sharedData.bill.additionalInfo&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>u(!1),role:"dialog","aria-modal":"true","aria-labelledby":"info-dialog-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:k=>k.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:s.jsx("h3",{id:"info-dialog-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Additional Information"})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:s.jsx("dl",{className:"space-y-4",children:Object.entries(e.sharedData.bill.additionalInfo).map(([k,N])=>s.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-3 rounded-md",children:[s.jsx("dt",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 truncate",children:k}),s.jsx("dd",{className:"mt-1 text-slate-800 dark:text-slate-100 whitespace-pre-wrap",children:String(N)})]},k))})}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:s.jsx("button",{onClick:()=>u(!1),className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Close"})})]})}),f&&e.sharedData.bill.items&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-[51] flex justify-center items-center p-4",onClick:()=>g(!1),role:"dialog","aria-modal":"true","aria-labelledby":"items-dialog-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:k=>k.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:s.jsx("h3",{id:"items-dialog-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Itemization"})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:s.jsx("ul",{className:"space-y-3",children:e.sharedData.bill.items.map(k=>{const N=k.assignedTo.map(S=>{var D;return(D=e.sharedData.bill.participants.find(I=>I.id===S))==null?void 0:D.name}).filter(Boolean);return s.jsxs("li",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-100 break-words pr-2",children:k.name}),s.jsxs("p",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:["$",k.price.toFixed(2)]})]}),N.length>0&&s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Assigned to: ",N.join(", ")]})]},k.id)})})}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:s.jsx("button",{onClick:()=>g(!1),className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Close"})})]})})]})},Xx=({onNavigateToSection:e,onBack:t,canInstall:r,promptInstall:a})=>{const n=[{id:"personalization",title:"Personalization",description:"Name, theme, and share message",icon:""},{id:"payments",title:"Payment Methods",description:"Your Venmo, PayPal, etc.",icon:""},{id:"budgeting",title:"Budgeting",description:"Set monthly budgets and categories",icon:""},{id:"reminders",title:"Bill Reminders",description:"Get notifications for due bills",icon:""},{id:"subscription",title:"Subscription",description:"Manage your Pro subscription",icon:""},{id:"data",title:"Data & Tools",description:"Import, export, or scan QR",icon:""},{id:"sync",title:"Sync Devices",description:"Transfer data to another device",icon:""},{id:"about",title:"About & Support",description:"Project source, issues, and changelog",icon:""},{id:"disclaimer",title:"Disclaimer & Privacy",description:"How your data is handled",icon:""},{id:"danger",title:"Danger Zone",description:"Reset all application data",icon:""}];return s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsxs("button",{onClick:t,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back"]}),s.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100 mb-6",children:"Settings"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[n.map(l=>s.jsxs("button",{onClick:()=>e(l.id),className:"relative p-6 bg-white dark:bg-slate-800 rounded-lg shadow-md hover:shadow-xl dark:hover:shadow-teal-900/40 text-left transition-all duration-300 transform hover:-translate-y-1",children:[s.jsx("div",{className:"text-4xl mb-4",children:l.icon}),s.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:l.title}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:l.description})]},l.id)),r&&s.jsxs("button",{onClick:a,className:"relative p-6 bg-white dark:bg-slate-800 rounded-lg shadow-md hover:shadow-xl dark:hover:shadow-teal-900/40 text-left transition-all duration-300 transform hover:-translate-y-1",children:[s.jsx("div",{className:"text-4xl mb-4",children:""}),s.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:"Install App"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Install to your device for an offline, native app experience."})]})]})]})},lm=e=>{const[t,r]=p.useState(!1),[a,n]=p.useState(null),l=p.useRef(null),o=p.useRef(null),i=p.useRef(null),c=p.useCallback(()=>{if(l.current&&l.current.readyState===l.current.HAVE_ENOUGH_DATA){const m=document.createElement("canvas"),u=l.current;m.width=u.videoWidth,m.height=u.videoHeight;const f=m.getContext("2d");if(f){f.drawImage(u,0,0,m.width,m.height);const g=f.getImageData(0,0,m.width,m.height),w=jsQR(g.data,g.width,g.height);if(w&&w.data){e(w.data);return}}}i.current=requestAnimationFrame(c)},[e]),d=p.useCallback(async()=>{var m;n(null);try{if(!((m=navigator.mediaDevices)!=null&&m.getUserMedia))throw new Error("Camera not supported by this browser.");const u=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});o.current=u,l.current&&(l.current.srcObject=u,l.current.setAttribute("playsinline","true"),await l.current.play(),r(!0),i.current=requestAnimationFrame(c))}catch(u){console.error("QR Scanner Error:",u);let f="Could not access the camera. Please ensure you have granted permission.";u.name==="NotAllowedError"?f="Camera access was denied. Please enable it in your browser settings.":u.name==="NotFoundError"&&(f="No suitable camera was found on your device."),n(f),r(!1)}},[c]),h=p.useCallback(()=>{i.current&&(cancelAnimationFrame(i.current),i.current=null),o.current&&(o.current.getTracks().forEach(m=>m.stop()),o.current=null),r(!1)},[]);return p.useEffect(()=>()=>{h()},[h]),{isScanning:t,startScanner:d,stopScanner:h,videoRef:l,error:a}},qx=({expiry:e,onExpire:t})=>{const[r,a]=p.useState(e-Date.now());if(p.useEffect(()=>{const o=setInterval(()=>{const i=e-Date.now();i<=0?(clearInterval(o),a(0),t()):a(i)},1e3);return()=>clearInterval(o)},[e,t]),r<=0)return s.jsx("span",{className:"font-bold text-amber-500",children:"Expired"});const n=Math.floor(r/6e4),l=Math.floor(r%6e4/1e3).toString().padStart(2,"0");return s.jsx("span",{children:`${n}:${l}`})},Zx=({onBack:e,requestConfirmation:t})=>{const[r,a]=p.useState("idle"),[n,l]=p.useState("generating"),[o,i]=p.useState("scanning"),[c,d]=p.useState(null),[h,m]=p.useState(null),[u,f]=p.useState(null),[g,w]=p.useState(0),{reloadApp:j}=ut(),x=p.useCallback(async U=>{i("connecting");try{const ee=JSON.parse(U);if(!ee.c||!ee.k)throw new Error("Invalid QR code format. Please scan the code generated by the app.");const{c:K,k:L}=ee,E=await de(await ce(`/sync?code=${K}`)),T=await E.text();if(!E.ok)try{const oe=JSON.parse(T);throw new Error(oe.error||"Failed to retrieve data. The code may have expired.")}catch{throw new Error("Failed to retrieve data. The code may have expired or the server is unavailable.")}const M=JSON.parse(T);i("decrypting");const R=await bt(L),$=await hs(M.encryptedData,R),G=pako.inflate($,{to:"string"}),V=JSON.parse(G);i("confirming"),t("Confirm Data Import","Data has been received. This will overwrite all your current bills and settings.",async()=>{await W0(V),i("complete"),setTimeout(()=>j(),2e3)},{confirmText:"Overwrite & Import",confirmVariant:"danger",onCancel:()=>{a("idle")}})}catch(ee){console.error("Error during receive process:",ee),d(ee.message||"An unknown error occurred."),a("error")}},[t,j]),{isScanning:v,startScanner:b,stopScanner:y,videoRef:k,error:N}=lm(x);p.useEffect(()=>{v&&o!=="scanning"&&y()},[v,o,y]);const S=p.useCallback(async()=>{a("sharing"),l("generating"),d(null),m(null),f(null);try{const U=await Ns(),ee=await gt(U),K=await H0(),L=JSON.stringify(K),E=pako.deflate(L),T=await Ss(E,U),M=await de(await ce("/sync"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedData:T})}),R=await M.json();if(!M.ok)throw new Error(R.error||"Failed to create a sync session on the server.");const{code:$}=R,G=JSON.stringify({c:$,k:ee});m({code:$,qrData:G}),w(Date.now()+5*60*1e3),l("waiting")}catch(U){console.error("Error during share process:",U),d(U.message||"An unknown error occurred."),a("error")}},[]);p.useEffect(()=>{n==="waiting"&&h&&window.QRCode.toDataURL(h.qrData,{width:256,margin:1,errorCorrectionLevel:"H"},(U,ee)=>{U?(console.error("QR Code generation failed:",U),d("Failed to generate QR code display."),a("error")):f(ee)})},[n,h]);const D=()=>{i("scanning"),a("receiving"),b()},I=()=>{v&&y(),a("idle"),d(null),e()};p.useEffect(()=>()=>{v&&y()},[v,y]);const C=()=>s.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[s.jsxs("button",{onClick:I,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to Settings"]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-700 dark:text-slate-200 mb-2",children:"Sync Devices"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-8",children:"Securely transfer your app data between two devices."}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[s.jsxs("button",{onClick:S,className:"flex-1 p-8 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-teal-500 dark:hover:border-teal-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all transform hover:-translate-y-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-teal-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 8.25H7.5a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25H15M9 12l3 3m0 0l3-3m-3 3V2.25"})}),s.jsx("h3",{className:"text-xl font-bold mt-4 text-slate-800 dark:text-slate-100",children:"Share Data"}),s.jsx("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:"Send data from this device."})]}),s.jsxs("button",{onClick:D,className:"flex-1 p-8 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-teal-500 dark:hover:border-teal-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all transform hover:-translate-y-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-teal-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m-3 0l3-3m0 0l-3-3m3 3H9"})}),s.jsx("h3",{className:"text-xl font-bold mt-4 text-slate-800 dark:text-slate-100",children:"Receive Data"}),s.jsx("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:"Load data onto this device."})]})]})]})]}),P=()=>s.jsx("div",{className:"max-w-md mx-auto text-center",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mb-2",children:"Share Data"}),n==="generating"&&s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin h-12 w-12 text-teal-500 mx-auto my-8",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Generating secure session..."})]}),n==="waiting"&&h&&s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-6",children:'On your other device, choose "Receive Data" and scan this QR code.'}),s.jsx("div",{className:"my-6 p-4 bg-white rounded-lg inline-block shadow-md",children:u?s.jsx("img",{src:u,alt:"QR Code for sync",width:"256",height:"256"}):s.jsx("div",{className:"w-[256px] h-[256px] bg-slate-200 dark:bg-slate-600 animate-pulse rounded-lg flex items-center justify-center",children:s.jsx("p",{className:"text-slate-500",children:"Generating QR..."})})}),s.jsxs("div",{className:"bg-slate-100 dark:bg-slate-700 p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Sync Code"}),s.jsx("p",{className:"text-4xl font-bold tracking-widest text-slate-800 dark:text-slate-100",children:h.code.replace(/(\d{3})(?=\d)/,"$1 ")})]}),s.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-4",children:["Expires in: ",s.jsx(qx,{expiry:g,onExpire:()=>a("error")})]})]}),s.jsx("button",{onClick:I,className:"mt-6 px-6 py-3 w-full bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Done"})]})}),A=()=>{const U={scanning:"Point your camera at the QR code on the other device.",connecting:"Code found! Connecting to sync service...",decrypting:"Download complete. Decrypting data...",confirming:"Awaiting your confirmation...",complete:"Success! Your data has been imported."}[o];return s.jsx("div",{className:"max-w-xl mx-auto text-center",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 sm:p-8 rounded-lg shadow-lg relative aspect-square sm:aspect-auto",children:[s.jsx("video",{ref:k,className:"w-full h-auto rounded-lg shadow-inner bg-slate-900",playsInline:!0,autoPlay:!0}),s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-between p-4 bg-black/20 rounded-lg",children:[s.jsxs("div",{className:"w-full p-3 bg-black/50 rounded-lg text-white font-semibold text-center backdrop-blur-sm",children:[s.jsx("p",{children:U}),N&&s.jsx("p",{className:"mt-2 text-sm text-red-300 bg-red-800/80 p-2 rounded-md",children:N})]}),s.jsx("button",{onClick:I,className:"px-8 py-3 bg-slate-600/70 text-white font-semibold rounded-lg text-lg backdrop-blur-sm",children:"Cancel"})]})]})})},z=()=>s.jsx("div",{className:"max-w-md mx-auto text-center",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),s.jsx("h2",{className:"text-2xl font-bold text-slate-700 dark:text-slate-200 mt-4 mb-2",children:"Sync Failed"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 bg-red-50 dark:bg-red-900/30 p-3 rounded-md",children:c||"An unknown error occurred. The sync code may have expired."}),s.jsx("button",{onClick:I,className:"mt-6 px-6 py-3 w-full bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Go Back"})]})});switch(r){case"sharing":return P();case"receiving":return A();case"error":return z();case"idle":default:return C()}},Fi=()=>s.jsxs("div",{className:"space-y-6 text-slate-600 dark:text-slate-300",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold mb-2 text-slate-800 dark:text-slate-100",children:"On-Device Data Storage"}),s.jsxs("p",{children:["All your core application databills, participants, settings, etc.is stored exclusively in your browser's ",s.jsx("strong",{children:"IndexedDB"})," database. This is a private, sandboxed database that lives directly on your device (your computer or phone)."]}),s.jsxs("ul",{className:"list-disc list-inside space-y-1 mt-2 pl-2",children:[s.jsx("li",{children:s.jsx("strong",{children:"We do not have a central database of user bills."})}),s.jsx("li",{children:s.jsx("strong",{children:"We never see or have access to your personal financial data."})}),s.jsx("li",{children:'Because the data is only on your device, you are responsible for it. If you clear your browser data, your information will be permanently lost unless you have created a backup using the "Export Data" feature.'})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold mb-2 text-slate-800 dark:text-slate-100",children:"Ephemeral Server Data for Sync & Share"}),s.jsxs("p",{children:["When you use the ",s.jsx("strong",{children:'"Sync with Another Device"'})," or ",s.jsx("strong",{children:'"Share Bill"'})," features, a temporary, end-to-end encrypted copy of your data is sent to our server."]}),s.jsxs("ul",{className:"list-disc list-inside space-y-1 mt-2 pl-2",children:[s.jsxs("li",{children:["The data is ",s.jsx("strong",{children:"end-to-end encrypted"})," on your device before it is sent. This means we, the server operators, cannot read its contents."]}),s.jsxs("li",{children:["This encrypted data is stored temporarily in a secure, managed NoSQL database (",s.jsx("strong",{children:"Amazon DynamoDB"}),") and is automatically deleted upon expiration."]}),s.jsxs("li",{children:['"Sync" data expires and is deleted after ',s.jsx("strong",{children:"5 minutes"}),"."]}),s.jsxs("li",{children:['"Share Bill" encrypted data expires and is deleted after ',s.jsx("strong",{children:"30 days"}),"."]})]}),s.jsxs("div",{className:"mt-4 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"How Secure Bill Sharing Works"}),s.jsx("p",{className:"text-sm mt-1",children:"To ensure share links are secure and can only be used once to retrieve the bill's key, we use a two-key system."}),s.jsxs("ul",{className:"list-disc list-inside space-y-1 mt-2 pl-2 text-sm",children:[s.jsxs("li",{children:["A ",s.jsx("strong",{children:"long-term key"})," is created to encrypt the bill data itself. This key is what the recipient will store to view the bill long-term."]}),s.jsxs("li",{children:["A ",s.jsx("strong",{children:"one-time-use key"})," is generated and embedded directly into the URL fragment of the share link you send. Your browser does not send this part of the URL to our server."]}),s.jsx("li",{children:"The long-term key is itself encrypted and stored temporarily on our server with a unique ID."}),s.jsxs("li",{children:["When your friend opens the link, their browser uses the one-time-use key from the URL to securely download and decrypt the long-term key. This long-term key is then ",s.jsx("strong",{children:"immediately and permanently deleted"})," from our server."]}),s.jsx("li",{children:"This process makes the link single-use for key retrieval and ensures we (the server operators) can never read your bill data."})]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold mb-2 text-slate-800 dark:text-slate-100",children:"Third-Party Services & Scripts"}),s.jsx("p",{children:"To provide advanced features, this application interacts with a few external services and utilizes third-party Javascript libraries."}),s.jsxs("div",{className:"mt-4 space-y-4",children:[s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"Google Gemini API"}),s.jsxs("p",{className:"text-sm mt-1",children:['The "Scan with AI" feature sends your receipt image to our server, which securely forwards it to the ',s.jsx("strong",{children:"Google Gemini API"})," for analysis. Because this feature relies on Google's powerful AI, ",s.jsx("strong",{children:"it is the only feature in the app that requires an active internet connection to function."})," The extracted text is sent back to your device and is not stored by us. Your use of this feature is subject to Google's Privacy Policy."]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"PayPal Subscriptions"}),s.jsxs("p",{className:"text-sm mt-1",children:["For Pro subscriptions, our server communicates with ",s.jsx("strong",{children:"PayPal"})," to handle all billing features. We do not handle or store your credit card or bank information directly; all payment details are securely managed by PayPal. You can manage or cancel your subscription at any time through your PayPal account."]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"A-ADS (Anonymous Ads)"}),s.jsxs("p",{className:"text-sm mt-1",children:["To support the free version of this application, we display advertisements from ",s.jsx("strong",{children:"A-ADS"}),". This is a privacy-focused advertising network that does not collect personal data or use tracking cookies. Ads are served in sandboxed ",s.jsx("code",{children:"iframe"})," elements to prevent them from accessing application content."]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"Core Application Libraries"}),s.jsxs("p",{className:"text-sm mt-1",children:["This web application is built using modern web technologies. To ensure fast performance, core libraries such as ",s.jsx("strong",{children:"React"})," are loaded from secure, third-party Content Delivery Networks (CDNs). These external scripts are essential for the application's functionality."]})]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold mb-2 text-slate-800 dark:text-slate-100",children:"No Warranties"}),s.jsx("p",{children:'This application is provided "as is," without warranty of any kind. We are not responsible for any data loss. We strongly encourage you to use the export feature to back up your data regularly.'})]})]}),eg=({onBack:e})=>s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsxs("button",{onClick:e,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back"]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100 mb-6",children:"Disclaimer & Data Privacy"}),s.jsx("p",{className:"text-lg font-medium text-slate-700 dark:text-slate-200 mb-8",children:'We believe in complete transparency. This application is designed with a "privacy first" approach. Heres exactly how your data is handled.'}),s.jsx(Fi,{})]})]}),om=({onAccept:e})=>{const[t,r]=p.useState(!1),a=p.useRef(null),n=()=>{const l=a.current;l&&!t&&l.scrollHeight-l.scrollTop<=l.clientHeight+5&&r(!0)};return p.useEffect(()=>{const l=()=>{const o=a.current;if(o)if(o.scrollHeight<=o.clientHeight)r(!0);else{const i=o.scrollHeight-o.scrollTop<=o.clientHeight+5;r(i)}};return l(),window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l)}},[]),s.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-center p-4",children:s.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 text-center flex flex-col max-h-[90vh]",children:[s.jsxs("div",{className:"flex justify-center items-center mb-6 flex-shrink-0",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-teal-500",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),s.jsx("h1",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100 ml-3",children:"Data & Privacy Policy"})]}),s.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 flex-shrink-0",children:"Please review our data policy below. This app stores all your data on your device for privacy. You must scroll to the bottom to continue."}),s.jsx("div",{ref:a,onScroll:n,className:"text-left overflow-y-auto pr-4 mb-6 text-sm border-y border-slate-200 dark:border-slate-700 py-4 flex-grow",children:s.jsx(Fi,{})}),s.jsx("div",{className:"flex flex-col gap-4 flex-shrink-0",children:s.jsx("button",{onClick:e,disabled:!t,className:"w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 transition-all duration-300 disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:cursor-not-allowed disabled:opacity-70",children:t?"Acknowledge & Continue":"Scroll to Continue"})})]})})};function tg(e){if(typeof e!="string"||!e)throw new Error("Malformed share link: The key data in the URL is missing, empty, or invalid.");let t=e.replace(/-/g,"+").replace(/_/g,"/");const r=t.length%4;if(r)if(r===2)t+="==";else if(r===3)t+="=";else throw new Error("Malformed share link: The key data appears to be truncated (invalid length).");try{const a=atob(t),n=new Uint8Array(a.length);for(let l=0;l<a.length;l++)n[l]=a.charCodeAt(l);return new TextDecoder("utf-8",{fatal:!0}).decode(n)}catch(a){throw a instanceof DOMException&&a.name==="InvalidCharacterError"?new Error("Failed to decode share link key. The link is corrupted (invalid Base64 characters)."):a instanceof TypeError?new Error("Failed to decode share link key. The data contains an invalid character sequence (not valid UTF-8)."):new Error(`An unexpected error occurred during link decoding: ${a.message}`)}}const rg=({onImportComplete:e,settings:t,addImportedBill:r,importedBills:a,requestConfirmation:n,bills:l})=>{const[o,i]=p.useState(()=>typeof window<"u"&&localStorage.getItem("privacyConsentAccepted")==="true"),[c,d]=p.useState("loading"),[h,m]=p.useState(null),[u,f]=p.useState(null),[g,w]=p.useState(0),[j,x]=p.useState(null),[v,b]=p.useState(null),[y,k]=p.useState(!1),[N,S]=p.useState(!1),[D,I]=p.useState(!1),[C,P]=p.useState(!1),[A,z]=p.useState(!1);p.useRef(!1);const U=u?a.some(E=>E.id===u.bill.id):!1;p.useEffect(()=>{if(!o)return;(async()=>{d("loading"),m(null),f(null),w(0),x(null),b(null),k(!1);try{const T=window.location.hash;if(!T.includes("?"))throw new Error("Share link is missing parameters.");const M=new URLSearchParams(T.split("?")[1]),R=M.get("shareId"),$=M.get("keyId"),G=M.get("fragmentKey"),V=M.get("p");if(!R||!$||!G||!V)throw new Error("Invalid or incomplete share link. All components are required.");d("fetching_key");const oe=await de(await ce(`/onetime-key/${$}`));if(oe.status===404){d("expired"),m("This share link has already been used or has expired. Please ask for a new one.");return}if(!oe.ok){const Ht=await oe.json().catch(()=>({}));throw new Error(Ht.error||"Failed to retrieve the bill key.")}const fe=await oe.json(),{encryptedBillKey:Je}=fe;if(!Je||typeof Je!="string")throw new Error("Received an invalid response from the key server. The encrypted key was missing.");const at=JSON.parse(tg(G)),Fr=await bt(at),Ue=await hs(Je,Fr);let Ae;try{Ae=pako.inflate(Ue,{to:"string"})}catch{console.warn("Could not decompress bill key, assuming legacy format."),Ae=new TextDecoder().decode(Ue)}const gr=JSON.parse(Ae);x(gr);const kt=await bt(gr),Ps=await hs(V,kt),Ft=pako.inflate(Ps,{to:"string"});b(Ft),d("fetching_data");const Qe=await de(await ce(`/share/${R}`));if(!Qe.ok){const Ht=await Qe.json().catch(()=>({}));throw new Error(Ht.error||"Failed to retrieve shared bill data.")}const vr=await Qe.json(),{encryptedData:wr,lastUpdatedAt:jt}=vr;if(!wr||typeof wr!="string"||typeof jt!="number")throw new Error("Received invalid bill data from the server. The payload was incomplete.");w(jt),d("verifying");const Ur=await hs(wr,kt),Mt=pako.inflate(Ur,{to:"string"}),ve=JSON.parse(Mt),Ut=await Lo(ve.publicKey);if(!await ba(JSON.stringify(ve.bill),ve.signature,Ut))throw new Error("Signature verification failed. The bill data may have been tampered with.");f(ve),d("verified")}catch(T){console.error("Error processing share link:",T),m(T.message||"An unknown error occurred."),d("error")}})()},[o,window.location.hash]),p.useEffect(()=>{var M;if(!u||!l)return;const E=u.publicKey;let T=!1;for(const R of l)if((M=R.shareInfo)!=null&&M.signingPublicKey&&JSON.stringify(R.shareInfo.signingPublicKey)===JSON.stringify(E)){T=!0;break}k(T)},[u,l]);const ee=async()=>{if(!u||!v||!j)return;const E=u.bill.participants.find($=>$.id===v);if(!E){d("error"),m("Could not identify you as a participant in this bill. The link may be corrupted.");return}const T=E.name.toLowerCase().trim(),M=(u.bill.items||[]).reduce(($,G)=>{if(G.originalBillData){const V=G.originalBillData.participants.find(oe=>oe.name.toLowerCase().trim()===T);V!=null&&V.paid&&($[G.id]=!0)}return $},{}),R={id:u.bill.id,creatorName:u.creatorName,status:"active",sharedData:{bill:u.bill,creatorPublicKey:u.publicKey,signature:u.signature,paymentDetails:u.paymentDetails},shareId:new URLSearchParams(window.location.hash.split("?")[1]).get("shareId"),shareEncryptionKey:j,constituentShares:u.constituentShares,lastUpdatedAt:g,myParticipantId:v,localStatus:{myPortionPaid:!1,paidItems:M},isOwnBill:y,liveStatus:"live"};await r(R),d("imported"),setTimeout(e,1500)},K=()=>{localStorage.setItem("privacyConsentAccepted","true"),i(!0)},L=()=>{if(["loading","fetching_key","fetching_data","verifying"].includes(c)){const E={loading:"Loading bill...",fetching_key:"Retrieving secure key...",fetching_data:"Downloading bill data...",verifying:"Verifying bill integrity..."};return s.jsxs("div",{className:"text-center p-8",children:[s.jsxs("svg",{className:"animate-spin h-10 w-10 text-teal-500 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("h2",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200",children:E[c]})]})}if(c==="error"||c==="expired")return s.jsxs("div",{className:"text-center p-8",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),s.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mt-4 mb-2",children:c==="expired"?"Link Expired":"An Error Occurred"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 bg-red-50 dark:bg-red-900/30 p-3 rounded-md",children:h})]});if(c==="imported")return s.jsxs("div",{className:"text-center p-8",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mt-4",children:"Bill Imported!"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:"Redirecting you to the dashboard..."})]});if(u){const{bill:E,paymentDetails:T,creatorName:M}=u,R=E.participants.find(V=>V.id===v),$=E.id.startsWith("summary-"),G=T&&(T.venmo||T.paypal||T.cashApp||T.zelle||T.customMessage);return s.jsxs(s.Fragment,{children:[A&&$&&s.jsx(nm,{summaryBill:E,paymentDetails:T,creatorName:M,myParticipantId:v,onClose:()=>z(!1)}),c==="verified"&&!U&&s.jsx("div",{className:"p-4 bg-red-100 dark:bg-red-900/40 border-l-4 border-red-500 rounded-r-lg mb-6",role:"alert",children:s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-lg font-bold text-red-800 dark:text-red-200",children:"Important: One-Time Link"}),s.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:["This is a secure, single-use link. ",s.jsx("strong",{children:"Navigating away or closing this page before importing will invalidate the link."})," You will need to request a new one from ",M," if you leave."]})]})]})}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-start mb-2",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100",children:E.description}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:new Date(E.date).toLocaleDateString()})]}),s.jsxs("div",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-50 text-right mt-4 md:mt-0",children:["$",E.totalAmount.toFixed(2)]})]}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-x-4 gap-y-2",children:[E.receiptImage&&s.jsxs("button",{onClick:()=>S(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"View Scanned Receipt"]}),E.additionalInfo&&Object.keys(E.additionalInfo).length>0&&s.jsxs("button",{onClick:()=>I(!0),className:"inline-flex items-center gap-2 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"View Additional Info"]}),$&&s.jsxs("button",{onClick:()=>z(!0),className:"inline-flex items-center gap-1.5 text-sm text-teal-600 dark:text-teal-400 font-semibold hover:underline",children:[s.jsx("span",{children:""}),s.jsx("span",{children:"View Bill Breakdown"})]})]}),s.jsx("div",{className:"my-6 border-t border-slate-200 dark:border-slate-700"}),R?s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold mb-4 text-slate-700 dark:text-slate-200",children:"This Bill Is For You"}),s.jsxs("div",{className:"p-4 rounded-lg bg-teal-50 dark:bg-teal-900/40 border-2 border-teal-500/50 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-teal-500 flex items-center justify-center text-white font-bold text-lg",children:R.name.charAt(0)}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:R.name}),s.jsxs("p",{className:"text-sm font-semibold text-slate-600 dark:text-slate-300",children:["You Owe: $",R.amountOwed.toFixed(2)]})]})]}),s.jsx("div",{className:`px-3 py-1 text-sm font-semibold rounded-full ${R.paid?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300":"bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300"}`,children:R.paid?"Paid":"Unpaid"})]}),s.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-3",children:[G&&!R.paid&&s.jsx("button",{onClick:()=>P(!0),className:"w-full flex-1 px-6 py-3 bg-emerald-500 text-white font-bold rounded-lg hover:bg-emerald-600 transition-colors order-1 sm:order-none",children:"Settle Up"}),s.jsx("button",{onClick:ee,disabled:!v||U,className:"w-full flex-1 px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:cursor-not-allowed transition-colors order-2 sm:order-none",children:U?"Bill Already in Dashboard":"Import This Bill"})]})]}):s.jsx("div",{className:"p-4 rounded-lg bg-red-50 dark:bg-red-900/30 text-center",children:s.jsx("p",{className:"font-semibold text-red-800 dark:text-red-200",children:"Your participant ID was not found in this bill. The bill may have been updated since this link was shared."})})]}),N&&E.receiptImage&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex justify-center items-center p-4",onClick:()=>S(!1),role:"dialog","aria-modal":"true","aria-label":"Receipt Image Viewer",children:s.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",onClick:V=>V.stopPropagation(),children:[s.jsx("img",{src:E.receiptImage,alt:"Scanned receipt",className:"w-full h-full object-contain rounded-lg shadow-2xl"}),s.jsx("button",{onClick:()=>S(!1),className:"absolute -top-3 -right-3 bg-white text-slate-800 rounded-full p-2 shadow-lg hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-white","aria-label":"Close receipt view",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),D&&E.additionalInfo&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex justify-center items-center p-4",onClick:()=>I(!1),role:"dialog","aria-modal":"true","aria-labelledby":"info-dialog-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:V=>V.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:s.jsx("h3",{id:"info-dialog-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Additional Information"})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:s.jsx("dl",{className:"space-y-4",children:Object.entries(E.additionalInfo).map(([V,oe])=>s.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-3 rounded-md",children:[s.jsx("dt",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 truncate",children:V}),s.jsx("dd",{className:"mt-1 text-slate-800 dark:text-slate-100 whitespace-pre-wrap",children:String(oe)})]},V))})}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end",children:s.jsx("button",{onClick:()=>I(!1),className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Close"})})]})}),C&&u&&R&&s.jsx(ll,{paymentDetails:u.paymentDetails,billDescription:u.bill.description,amountOwed:R.amountOwed,creatorName:M,onClose:()=>P(!1)})]})}};return o?s.jsx("div",{className:"max-w-xl mx-auto",children:L()}):s.jsx("div",{className:"max-w-xl mx-auto py-8",children:s.jsx(om,{onAccept:K})})},sg=70,ag=({bill:e,onClick:t,onEdit:r,onArchive:a,onUnarchive:n,onDelete:l,layoutMode:o})=>{const[i,c]=p.useState(0),d=p.useRef(0),h=p.useRef(0),m=p.useRef(0),u=p.useRef(null),f=p.useRef(!1),g=p.useRef(!1),w=p.useRef(0),j=e.status==="archived",x=o==="card"?-(sg*(j?2:3)):0,v=(N,S)=>{f.current=!0,g.current=!1,d.current=N,h.current=S,m.current=i,w.current=Date.now(),u.current&&(u.current.style.transition="none")},b=(N,S)=>{if(!f.current||g.current)return;const D=N-d.current,I=S-h.current;if((Math.abs(I)>5||Math.abs(D)>5)&&Math.abs(I)>Math.abs(D)){g.current=!0,f.current=!1,i!==0&&(u.current&&(u.current.style.transition="transform 0.2s ease-out"),c(0));return}const C=m.current+D,P=Math.min(20,Math.max(x-20,C));c(P)},y=N=>{if(!f.current)return;const S=g.current;if(f.current=!1,g.current=!1,u.current&&(u.current.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)"),S){c(0);return}const D=Date.now()-w.current,I=i-m.current;if(D<250&&Math.abs(I)<10){m.current!==0?c(0):(N&&N.type==="touchend"&&N.preventDefault(),t());return}i<x/2?c(x):c(0)},k=N=>{N(),c(0)};return s.jsxs("div",{className:`relative w-full ${o==="card"?"overflow-hidden":""}`,children:[o==="card"&&s.jsxs("div",{className:"absolute top-0 right-0 h-full flex items-center z-0",children:[!j&&s.jsxs("button",{onClick:()=>k(r),className:"h-full w-[70px] flex flex-col items-center justify-center bg-indigo-500 text-white transition-colors hover:bg-indigo-600","aria-label":"Edit Template",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:[s.jsx("path",{d:"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"}),s.jsx("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z",clipRule:"evenodd"})]}),s.jsx("span",{className:"text-xs mt-1",children:"Edit"})]}),s.jsxs("button",{onClick:()=>k(j?n:a),className:"h-full w-[70px] flex flex-col items-center justify-center bg-blue-500 text-white transition-colors hover:bg-blue-600","aria-label":j?"Unarchive":"Archive",children:[j?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),s.jsx("span",{className:"text-xs mt-1",children:j?"Unarchive":"Archive"})]}),s.jsxs("button",{onClick:()=>k(l),className:"h-full w-[70px] flex flex-col items-center justify-center bg-red-500 text-white transition-colors hover:bg-red-600","aria-label":"Delete",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),s.jsx("span",{className:"text-xs mt-1",children:"Delete"})]})]}),s.jsx("div",{ref:u,className:"relative z-10",style:{transform:`translateX(${i}px)`,touchAction:"pan-y"},onTouchStart:N=>v(N.touches[0].clientX,N.touches[0].clientY),onTouchMove:N=>b(N.touches[0].clientX,N.touches[0].clientY),onTouchEnd:N=>y(N),onMouseDown:N=>v(N.clientX,N.clientY),onMouseMove:N=>b(N.clientX,N.clientY),onMouseUp:N=>y(N),onMouseLeave:()=>y(),children:s.jsx(Uo,{bill:e,onClick:()=>{},layoutMode:o})})]})},ng=({recurringBills:e,onCreateFromTemplate:t,onEditTemplate:r,onArchive:a,onUnarchive:n,onDelete:l,onBack:o})=>{const[i,c]=p.useState("active"),d=e.filter(h=>h.status===i);return s.jsxs("div",{children:[s.jsxs("button",{onClick:o,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to Dashboard"]}),s.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-700 dark:text-slate-200",children:"Recurring Bills"}),s.jsxs("div",{className:"flex items-center space-x-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg self-start sm:self-center",children:[s.jsx("button",{onClick:()=>c("active"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${i==="active"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Active"}),s.jsx("button",{onClick:()=>c("archived"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${i==="archived"?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300"}`,children:"Archived"})]})]}),d.length>0?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(h=>s.jsx(ag,{bill:h,onClick:()=>t(h),onEdit:()=>r(h),onArchive:()=>a(h.id),onUnarchive:()=>n(h.id),onDelete:()=>l(h.id),layoutMode:"card"},h.id))}):s.jsxs("div",{className:"text-center py-16 px-6 bg-white dark:bg-slate-800 rounded-lg shadow",children:[s.jsx("svg",{className:"mx-auto h-12 w-12 text-slate-400 dark:text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:s.jsx("path",{vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h5M4 18v-5h5m10-4h5v5h-5M14 18h5v-5h-5"})}),s.jsxs("h3",{className:"mt-2 text-xl font-medium text-slate-900 dark:text-slate-100",children:["No ",i," recurring bills"]}),s.jsx("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:i==="active"?"Create a new recurring bill template to get started.":"Archived templates will appear here."})]})]})},lg=e=>{const[t,r]=p.useState([]),[a,n]=p.useState(!0),l=p.useCallback(async()=>{n(!0);try{const c=await V0(),d=new Map(c.map(m=>[m.id,{...m,isCurrentDevice:!1}]));if(e&&e.provider==="paypal"&&!d.has(e.subscriptionId))try{const m=await de(await ce(`/paypal-subscription-details?id=${e.subscriptionId}`));if(!m.ok)throw new Error("Could not verify current subscription.");const u=await m.json();d.set(u.id,u)}catch(m){console.error("Failed to fetch primary subscription details, it may have been cancelled:",m)}if(e){const m=d.get(e.subscriptionId);m&&d.set(m.id,{...m,isCurrentDevice:!0})}const h=Array.from(d.values()).sort((m,u)=>u.isCurrentDevice?1:-1);r(h),await Ll(h)}catch(c){console.error("Failed to load managed subscriptions:",c)}finally{n(!1)}},[e]);p.useEffect(()=>{l()},[l]);const o=p.useCallback(async c=>{const d=await de(await ce(`/paypal-subscription-details?id=${c}`));if(!d.ok){const m=await d.json().catch(()=>({}));throw new Error(m.error||"Could not find or verify this subscription ID.")}const h=await d.json();return r(m=>{const u=[...m.filter(f=>f.id!==h.id),h];return u.sort((f,g)=>g.isCurrentDevice?1:-1),Ll(u),u}),h},[]),i=p.useCallback(async c=>{r(d=>{const h=d.filter(m=>m.id!==c);return Ll(h),h})},[]);return{managedSubscriptions:t,addSubscription:o,removeSubscription:i,isLoading:a}},og=({onBack:e,requestConfirmation:t})=>{const{subscriptionDetails:r,logout:a}=Ma(),{showNotification:n}=ut(),{managedSubscriptions:l,addSubscription:o,removeSubscription:i,isLoading:c}=lg(r),[d,h]=p.useState(null),[m,u]=p.useState(!1),[f,g]=p.useState(null),[w,j]=p.useState(""),x=y=>{r&&t("Cancel Subscription?",`Are you sure you want to cancel subscription ${y}? This action is permanent.`,async()=>{h(y);try{const k=await de(await ce("/cancel-subscription"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:"paypal",subscriptionId:y})});if(k.status!==204&&k.status!==200){const N=await k.json().catch(()=>({}));throw new Error(N.error||`Failed to cancel subscription. Status: ${k.status}`)}n("Subscription cancelled successfully."),y===r.subscriptionId?a():i(y)}catch(k){n(k.message||"An unknown error occurred.","error")}finally{h(null)}},{confirmText:"Yes, Cancel",confirmVariant:"danger"})},v=async()=>{const y=w.trim();if(y){if(l.some(k=>k.id===y)){g("This subscription has already been added.");return}u(!0),g(null);try{const k=await o(y);n(`Successfully added subscription ${k.id}.`),j("")}catch(k){g(k.message)}finally{u(!1)}}},b=({sub:y})=>s.jsxs("div",{className:`p-4 rounded-lg border-2 ${y.isCurrentDevice?"bg-teal-50 dark:bg-teal-900/40 border-teal-500/50":"bg-slate-50 dark:bg-slate-700/50 border-slate-200 dark:border-slate-700"}`,children:[y.isCurrentDevice&&s.jsx("p",{className:"text-xs font-bold text-teal-600 dark:text-teal-400 mb-2",children:"CURRENT DEVICE"}),s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-mono text-sm text-slate-500 dark:text-slate-400 break-all",children:y.id}),s.jsxs("p",{className:"font-semibold text-slate-800 dark:text-slate-100 capitalize",children:[y.plan," Plan  Started ",new Date(y.startTime).toLocaleDateString()]})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("button",{onClick:()=>x(y.id),disabled:!!d,className:"px-4 py-2 bg-red-600 text-white font-semibold text-sm rounded-lg hover:bg-red-700 disabled:bg-slate-400",children:d===y.id?"Cancelling...":"Cancel"})})]})]});return s.jsxs("div",{className:"max-w-3xl mx-auto",children:[s.jsxs("button",{onClick:e,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to Settings"]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-700 dark:text-slate-200 mb-2",children:"Manage PayPal Subscriptions"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-6",children:"View and cancel any active subscriptions linked to your PayPal account for this app."}),c?s.jsx("p",{className:"text-center p-8",children:"Loading subscriptions..."}):s.jsx("div",{className:"space-y-4",children:l.map(y=>s.jsx(b,{sub:y},y.id))}),s.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-200 dark:border-slate-700",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200",children:"Link Another Subscription"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 mb-4",children:'If you have other active subscriptions (e.g., from another device), you can add them here to manage them. You can find your Subscription ID (starts with "I-...") in your PayPal account under "Automatic Payments".'}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s.jsx("input",{type:"text",value:w,onChange:y=>j(y.target.value),placeholder:"Enter Subscription ID (I-...)",className:"flex-grow w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),s.jsx("button",{onClick:v,disabled:m||!w.trim(),className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 disabled:bg-slate-400",children:m?"Verifying...":"Add"})]}),f&&s.jsx("p",{className:"text-sm text-red-500 mt-2",children:f})]})]})]})},ig=({group:e,participantsWithDebt:t,onClose:r,onRemind:a})=>{const n=new Map(t.map(l=>[l.name,l]));return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:r,children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[90vh]",onClick:l=>l.stopPropagation(),children:[s.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:[s.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"Remind Group Members"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Send reminders for outstanding balances across all bills."})]}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:s.jsx("ul",{className:"space-y-3",children:e.participants.map(l=>{const o=n.get(l.name),i=o&&o.type==="owed"&&o.amount>0;return s.jsxs("li",{className:"flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-teal-500 flex items-center justify-center text-white font-bold text-xs",children:l.name.charAt(0)}),s.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-100",children:l.name})]}),i?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-sm font-semibold text-amber-600 dark:text-amber-400",children:["Owes $",o.amount.toFixed(2)]}),s.jsx("button",{onClick:()=>a(o),className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-teal-500 text-white hover:bg-teal-600",children:"Remind"})]}):s.jsx("span",{className:"text-sm font-semibold text-emerald-600 dark:text-emerald-400",children:"All settled"})]},l.id)})})}),s.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end flex-shrink-0",children:s.jsx("button",{onClick:r,className:"px-5 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Done"})})]})})},cg=({group:e,participantsData:t,bills:r,settings:a,subscriptionStatus:n,onBack:l,onSelectParticipant:o,onUpdateMultipleBills:i,navigate:c})=>{const[d,h]=p.useState(!1),[m,u]=p.useState(null),{showNotification:f}=ut(),g=p.useMemo(()=>{const k=new Set(e.participants.map(N=>N.name));return t.filter(N=>k.has(N.name))},[e,t]),w=k=>{h(!1),u(k)},j=p.useCallback(k=>{const N=t.find(I=>I.name===k&&I.type==="owed");if(!N)return"No outstanding bills found.";const D=r.filter(I=>I.status==="active").filter(I=>I.participants.some(C=>C.name===k&&!C.paid&&C.amountOwed>0)).map(I=>({description:I.description,amountOwed:I.participants.find(C=>C.name===k).amountOwed}));return J0(k,N.amount,D,a,n)},[t,r,a,n]),x=async k=>{const N=j(k.name);try{navigator.share?await navigator.share({title:"Bill Split Reminder",text:N}):(await navigator.clipboard.writeText(N),f("Share text copied to clipboard!"))}catch(S){S.name!=="AbortError"&&(console.error("Error sharing or copying:",S),f("Failed to share","error"))}finally{u(null)}},v=k=>{k.phone&&(window.location.href=`sms:${k.phone}?&body=${encodeURIComponent(j(k.name))}`,u(null))},b=k=>{k.email&&(window.location.href=`mailto:${k.email}?subject=${encodeURIComponent("Shared Bill Reminder")}&body=${encodeURIComponent(j(k.name))}`,u(null))},y=p.useCallback(async(k,N)=>{var P,A;const S=r.filter(z=>z.status==="active"&&z.participants.some(U=>U.name===k&&!U.paid&&U.amountOwed>0));if(S.length===0){f(`${k} has no outstanding bills to share.`,"info"),u(null);return}const{shareUrl:D,imagesDropped:I}=await Q0(S,k,a,i,r,n);I>0&&f(`Free image limit reached. ${I} older image(s) omitted from summary.`,"info");const C=`Here is a link to view a summary of your outstanding bills with me. This link contains a key and should not be shared with others:

${D}`;try{if(N==="sms"){const z=(P=t.find(U=>U.name===k))==null?void 0:P.phone;z&&(window.location.href=`sms:${z}?&body=${encodeURIComponent(C)}`)}else if(N==="email"){const z=(A=t.find(U=>U.name===k))==null?void 0:A.email;z&&(window.location.href=`mailto:${z}?subject=${encodeURIComponent("Summary of Outstanding Bills")}&body=${encodeURIComponent(C)}`)}else navigator.share?await navigator.share({title:"Summary of Outstanding Bills",text:C}):(await navigator.clipboard.writeText(C),f("Share link copied to clipboard!"))}catch(z){z.name==="AbortError"?f("Share cancelled","info"):(console.error("Error sharing link:",z),f("An error occurred while trying to share the link.","error"))}finally{u(null)}},[r,a,i,t,f,n]);return s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsxs("button",{onClick:l,className:"flex items-center gap-2 mb-6 text-teal-600 dark:text-teal-400 font-semibold hover:text-teal-800 dark:hover:text-teal-300",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l-4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Back to Dashboard"]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg",children:[s.jsxs("div",{className:"flex justify-between items-start gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100",children:e.name}),s.jsxs("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:[e.participants.length," members"]})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("button",{onClick:()=>c(H.CreateGroup,{groupToEdit:e}),className:"px-4 py-2 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",children:"Edit"})})]}),s.jsxs("div",{className:"mt-6 border-t border-slate-200 dark:border-slate-700 pt-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200 mb-4",children:"Members"}),s.jsx("ul",{className:"space-y-3",children:e.participants.map(k=>{const N=t.find(D=>D.name===k.name),S=N&&N.type==="owed"&&N.amount>0;return s.jsx("li",{children:s.jsxs("button",{onClick:()=>o(k.name),className:"w-full flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600/50 text-left",children:[s.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-100",children:k.name}),S?s.jsxs("span",{className:"text-sm font-semibold text-amber-600 dark:text-amber-400",children:["Owes $",N.amount.toFixed(2)]}):s.jsx("span",{className:"text-sm font-semibold text-emerald-600 dark:text-emerald-400",children:"All settled"})]})},k.id)})})]}),s.jsx("div",{className:"mt-8 border-t border-slate-200 dark:border-slate-700 pt-6",children:s.jsx("button",{onClick:()=>h(!0),className:"w-full bg-teal-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-600 transition-colors",children:"Remind Group"})})]}),d&&s.jsx(ig,{group:e,participantsWithDebt:g,onClose:()=>h(!1),onRemind:w}),m&&s.jsx(q0,{participant:{...m,id:m.name,amountOwed:m.amount,paid:!1},onClose:()=>u(null),onShareSms:v,onShareEmail:b,onShareGeneric:x,onShareLinkSms:()=>y(m.name,"sms"),onShareLinkEmail:()=>y(m.name,"email"),onShareLinkGeneric:()=>y(m.name,"generic"),onViewDetails:()=>{o(m.name),u(null)},shareContext:"dashboard"})]})},dg=e=>{const{view:t,isLoading:r,currentBill:a,currentImportedBill:n,currentGroup:l,handleSaveBill:o,handleSaveRecurringBill:i,handleUpdateRecurringBill:c,navigate:d,settings:h,updateSettings:m,recurringBillToEdit:u,fromTemplate:f,billConversionSource:g,updateBill:w,setSettingsSection:j,requestConfirmation:x,recurringBills:v,createFromTemplate:b,archiveRecurringBill:y,unarchiveRecurringBill:k,handleDeleteRecurringBill:N,addImportedBill:S,importedBills:D,canInstall:I,promptInstall:C,checkAndMakeSpaceForImageShare:P,bills:A,groups:z,groupToEdit:U,handleSaveGroup:ee,handleUpdateGroup:K,handleDeleteGroup:L,categories:E}=e;if(r)return s.jsx("div",{className:"flex-grow flex items-center justify-center text-center",children:s.jsxs("div",{children:[s.jsxs("svg",{className:"animate-spin h-10 w-10 text-teal-500 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("h1",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200",children:"Loading your data..."})]})});switch(t){case H.CreateBill:return s.jsx(Ux,{onSaveBill:o,onSaveRecurringBill:i,onUpdateRecurringBill:c,onBack:()=>d(H.Dashboard),settings:h,updateSettings:m,recurringBillToEdit:u,fromTemplate:f,billConversionSource:g,groups:z,categories:E});case H.CreateGroup:return s.jsx(Vx,{onSave:ee,onUpdate:K,onBack:()=>d(H.Dashboard,{view:"groups"}),groupToEdit:U});case H.GroupDetails:return l?s.jsx(cg,{group:l,...e,onUpdateMultipleBills:e.updateMultipleBills,onBack:()=>d(H.Dashboard,{view:"groups"})}):s.jsx("div",{children:"Group not found."});case H.BillDetails:return a?s.jsx(Jx,{bill:a,onUpdateBill:w,onBack:()=>d(H.Dashboard),settings:h,updateSettings:m,setSettingsSection:j,navigate:d,onReshareBill:()=>e.handleReshareBill(a.id),checkAndMakeSpaceForImageShare:P}):s.jsx("div",{children:"Bill not found."});case H.ImportedBillDetails:return n?s.jsx(Qx,{bill:n,onUpdateBill:e.updateImportedBill,onBack:()=>d(H.Dashboard)}):s.jsx("div",{children:"Bill not found."});case H.RecurringBills:return s.jsx(ng,{recurringBills:v,onCreateFromTemplate:b,onEditTemplate:T=>d(H.CreateBill,{recurringBillToEdit:T}),onArchive:y,onUnarchive:k,onDelete:N,onBack:()=>d(H.Dashboard)});case H.Settings:return s.jsx(Xx,{onNavigateToSection:j,onBack:()=>d(H.Dashboard),canInstall:I,promptInstall:C});case H.Sync:return s.jsx(Zx,{onBack:()=>d(H.Settings),requestConfirmation:x});case H.Disclaimer:return s.jsx(eg,{onBack:()=>d(H.Settings)});case H.ViewShared:return s.jsx(rg,{onImportComplete:()=>{window.location.hash="",d(H.Dashboard)},settings:h,addImportedBill:S,importedBills:D,requestConfirmation:x,bills:A});case H.ManageSubscription:return s.jsx(og,{onBack:()=>d(H.Settings),requestConfirmation:x});case H.Dashboard:default:return s.jsx(wx,{...e,onDeleteGroup:L,onSelectBill:T=>d(H.BillDetails,{billId:T.id}),onSelectImportedBill:T=>d(H.ImportedBillDetails,{importedBillId:T.id}),onArchiveBill:e.archiveBill,onUnarchiveBill:e.unarchiveBill,onDeleteBill:e.handleDeleteBill,onReshareBill:e.handleReshareBill,onUpdateMultipleBills:e.updateMultipleBills,onUpdateImportedBill:e.updateImportedBill,onArchiveImportedBill:e.archiveImportedBill,onUnarchiveImportedBill:e.unarchiveImportedBill,onDeleteImportedBill:e.handleDeleteImportedBill,onShowSummaryDetails:T=>d(H.ImportedBillDetails,{importedBillId:T.id,showSummary:!0}),onCreateFromTemplate:e.createFromTemplate,onSelectParticipant:e.onSelectParticipant,onClearParticipant:()=>e.onSelectParticipant(null),budgetData:e.budgetData,budgetDate:e.budgetDate,setBudgetDate:e.setBudgetDate,handleSelectBillFromBudget:e.handleSelectBillFromBudget})}},ug=({isOpen:e,title:t,message:r,onConfirm:a,onCancel:n,confirmText:l="Confirm",cancelText:o="Cancel",confirmVariant:i="primary"})=>{if(!e)return null;const c={primary:"bg-teal-500 text-white hover:bg-teal-600 focus:ring-teal-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"};return s.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-60 z-50 flex justify-center items-center p-4",role:"alertdialog","aria-modal":"true","aria-labelledby":"dialog-title","aria-describedby":"dialog-description",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[s.jsx("h2",{id:"dialog-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:t}),s.jsx("p",{id:"dialog-description",className:"mt-2 text-slate-600 dark:text-slate-300",children:r}),s.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[s.jsx("button",{onClick:n,className:"px-4 py-2 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:o}),s.jsx("button",{onClick:a,className:`px-4 py-2 font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-slate-800 transition-colors ${c[i]}`,children:l})]})]})})},mg=[{name:"light",title:"Light",icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})},{name:"dark",title:"Dark",icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})},{name:"system",title:"System",icon:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}],fg=({settings:e,onSettingsChange:t,theme:r,setTheme:a})=>{const n=l=>{t({[l.target.name]:l.target.value})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"myDisplayName",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Your Display Name"}),s.jsx("input",{id:"myDisplayName",name:"myDisplayName",type:"text",value:e.myDisplayName,onChange:n,placeholder:"e.g., Jane Doe",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-2",children:"Theme"}),s.jsx("div",{className:"flex items-center space-x-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg",children:mg.map(l=>s.jsxs("button",{type:"button",onClick:()=>a(l.name),className:`flex-1 flex items-center justify-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-md transition-colors ${r===l.name?"bg-white dark:bg-slate-800 shadow text-teal-600 dark:text-teal-400":"text-slate-600 dark:text-slate-300 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:[l.icon,s.jsx("span",{children:l.title})]},l.name))})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"shareTemplate",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Share Message Template"}),s.jsx("textarea",{id:"shareTemplate",name:"shareTemplate",value:e.shareTemplate,onChange:n,rows:5,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Available placeholders: ",s.jsx("code",{className:"bg-slate-100 dark:bg-slate-600 rounded px-1",children:"{participantName}"}),", ",s.jsx("code",{className:"bg-slate-100 dark:bg-slate-600 rounded px-1",children:"{totalOwed}"}),", ",s.jsx("code",{className:"bg-slate-100 dark:bg-slate-600 rounded px-1",children:"{billList}"}),", ",s.jsx("code",{className:"bg-slate-100 dark:bg-slate-600 rounded px-1",children:"{paymentInfo}"}),", ",s.jsx("code",{className:"bg-slate-100 dark:bg-slate-600 rounded px-1",children:"{promoText}"}),"."]})]})]})},hg=({settings:e,onPaymentDetailsChange:t})=>{const r=a=>{t({[a.target.name]:a.target.value})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"venmo",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Venmo Username"}),s.jsx("input",{id:"venmo",name:"venmo",type:"text",value:e.paymentDetails.venmo,onChange:r,placeholder:"e.g., Jane-Doe-1",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"paypal",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"PayPal.Me Link or Email"}),s.jsx("input",{id:"paypal",name:"paypal",type:"text",value:e.paymentDetails.paypal,onChange:r,placeholder:"e.g., paypal.me/janedoe or email@example.com",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"cashApp",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Cash App $Cashtag"}),s.jsx("input",{id:"cashApp",name:"cashApp",type:"text",value:e.paymentDetails.cashApp,onChange:r,placeholder:"e.g., $janedoe",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"zelle",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Zelle (Phone or Email)"}),s.jsx("input",{id:"zelle",name:"zelle",type:"text",value:e.paymentDetails.zelle,onChange:r,placeholder:"e.g., 555-123-4567",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"customMessage",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Custom Payment Message"}),s.jsx("textarea",{id:"customMessage",name:"customMessage",value:e.paymentDetails.customMessage,onChange:r,rows:3,placeholder:"e.g., Or pay me back in person!",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]})]})},pg=({settings:e,onSettingsChange:t})=>{const[r,a]=p.useState("loading");p.useEffect(()=>{if(!Ts()){a("unsupported");return}const c=Notification.permission;a(c)},[]);const n=async()=>{const c=await Fp();a(c),c==="granted"&&t({notificationsEnabled:!0})},l=()=>{t({notificationsEnabled:!e.notificationsEnabled})},o=c=>{t({notificationDays:parseInt(c.target.value,10)||1})},i=()=>{switch(r){case"loading":return s.jsx("div",{className:"text-slate-500 dark:text-slate-400",children:"Checking notification status..."});case"unsupported":return s.jsxs("div",{className:"p-4 bg-slate-100 dark:bg-slate-700/50 rounded-lg text-sm",children:[s.jsx("p",{className:"font-semibold text-slate-700 dark:text-slate-200",children:"Browser Not Supported"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Your browser or current browsing mode (e.g., private window) does not support scheduled notifications. Please try a modern browser like Chrome, Edge, or Firefox."})]});case"denied":return s.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/40 rounded-lg",children:[s.jsx("p",{className:"font-semibold text-amber-800 dark:text-amber-200",children:"Permission Denied"}),s.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:"You have blocked notifications for this app. You must grant permission in your browser's site settings to enable reminders."})]});case"default":return s.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/40 rounded-lg flex flex-col sm:flex-row items-center gap-4",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("p",{className:"font-semibold text-amber-800 dark:text-amber-200",children:"Enable Notifications"}),s.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:"To receive bill reminders, you need to grant permission."})]}),s.jsx("button",{onClick:n,className:"w-full sm:w-auto flex-shrink-0 px-4 py-2 bg-amber-500 text-white font-bold rounded-lg hover:bg-amber-600",children:"Grant Permission"})]});case"granted":return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{htmlFor:"notificationsEnabled",className:"font-medium text-slate-700 dark:text-slate-200",children:"Enable Reminders"}),s.jsx("button",{id:"notificationsEnabled",type:"button",onClick:l,className:`relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 ${e.notificationsEnabled?"bg-teal-600":"bg-slate-300 dark:bg-slate-600"}`,children:s.jsx("span",{className:`inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200 ${e.notificationsEnabled?"translate-x-5":"translate-x-0"}`})})]}),e.notificationsEnabled&&s.jsxs("div",{children:[s.jsx("label",{htmlFor:"notificationDays",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Remind me"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{id:"notificationDays",type:"number",min:"1",max:"30",value:e.notificationDays,onChange:o,className:"w-24 px-3 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"}),s.jsx("span",{className:"text-slate-700 dark:text-slate-200",children:"days before a bill is due."})]})]})]});default:return null}};return s.jsx("div",{className:"space-y-6",children:i()})},xg=({requestConfirmation:e,onOpenCsvImporter:t,onOpenQrImporter:r,bills:a,importedBills:n})=>{const{reloadApp:l,showNotification:o}=ut(),i=async()=>{try{const m=await H0(),u=JSON.stringify(m,null,2),f=new Blob([u],{type:"application/json"}),g=URL.createObjectURL(f),w=document.createElement("a");w.href=g,w.download=`sharedbills_backup_${new Date().toISOString().split("T")[0]}.json`,w.click(),URL.revokeObjectURL(g),o("Data exported successfully!")}catch(m){console.error("Export failed:",m),o("Data export failed.","error")}},c=async()=>{try{if(a.length===0&&n.length===0){o("No bills to export.","info");return}const m=`sharedbills_export_${new Date().toISOString().split("T")[0]}.csv`;await xs({owned:a,imported:n},m),o("All bills exported to CSV successfully!")}catch(m){console.error("CSV Export failed:",m),o("CSV export failed.","error")}},d=()=>{e("Import Data?","This will overwrite all current data on this device. This action cannot be undone. Are you sure you want to proceed?",()=>{const m=document.createElement("input");m.type="file",m.accept=".json,application/json",m.onchange=async u=>{var g;const f=(g=u.target.files)==null?void 0:g[0];if(f){const w=new FileReader;w.onload=async j=>{var x;try{const v=JSON.parse((x=j.target)==null?void 0:x.result);await W0(v),o("Data imported successfully! App will now reload."),setTimeout(l,1500)}catch(v){console.error("Import failed:",v),o("Failed to import data. The file may be corrupted.","error")}},w.readAsText(f)}},m.click()},{confirmText:"Overwrite & Import",confirmVariant:"danger"})},h=({onClick:m,title:u,description:f})=>s.jsxs("button",{onClick:m,className:"w-full text-left p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",children:[s.jsx("h4",{className:"font-semibold text-slate-800 dark:text-slate-100",children:u}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:f})]});return s.jsxs("div",{className:"space-y-4",children:[s.jsx(h,{onClick:t,title:"Import from CSV",description:"Import bills from a CSV file using AI."}),s.jsx(h,{onClick:r,title:"Scan QR Code",description:"Import a shared bill by scanning its QR code."}),s.jsx(h,{onClick:c,title:"Export All Bills (CSV)",description:"Save all your owned and imported bills to a single CSV file."}),s.jsx(h,{onClick:i,title:"Export All Data (JSON Backup)",description:"Save a JSON file of all your data as a backup."}),s.jsx(h,{onClick:d,title:"Import All Data (Restore)",description:"Restore data from a previously exported JSON backup."})]})},gg=({onNavigate:e})=>s.jsxs("div",{children:[s.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:"This feature allows you to securely transfer all your app data (bills, settings, etc.) from one device to another using a temporary, end-to-end encrypted connection."}),s.jsx("button",{onClick:e,className:"w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Start Sync"})]}),vg=({requestConfirmation:e})=>{const{showNotification:t}=ut(),r=()=>{e("Hard Reset Application?","This will permanently delete all bills, settings, and subscription data from this device. This action cannot be undone. Are you sure you want to proceed?",()=>{Ia();const a=indexedDB.deleteDatabase("SmartBillSplitterDB");a.onsuccess=()=>{localStorage.clear(),sessionStorage.clear(),t("Application has been reset. Reloading now..."),setTimeout(()=>window.location.reload(),1500)},a.onerror=()=>{t("Could not delete database. Please clear site data in browser settings.","error")},a.onblocked=()=>{t("Reset blocked. Close other tabs for this site and try again.","error")}},{confirmText:"Yes, Delete Everything",confirmVariant:"danger"})};return s.jsxs("div",{className:"p-4 border-2 border-dashed border-red-500/50 rounded-lg bg-red-50 dark:bg-red-900/20",children:[s.jsx("h4",{className:"font-bold text-red-800 dark:text-red-200",children:"Hard Reset"}),s.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1 mb-4",children:"Permanently delete all data stored by this application on this device. This is useful if the app is not working correctly or you want a fresh start."}),s.jsx("button",{onClick:r,className:"w-full sm:w-auto px-6 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700",children:"Reset Application"})]})},wg=({onNavigate:e,onGoToManageSubscriptionPage:t})=>{const{subscriptionStatus:r,subscriptionDetails:a,logout:n}=Ma(),l=()=>{n()};return s.jsxs("div",{children:[r==="subscribed"&&a?s.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/40 rounded-lg",children:[s.jsx("p",{className:"font-semibold text-emerald-800 dark:text-emerald-200",children:"You are a Pro Subscriber!"}),s.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-300 mt-1",children:"Thank you for your support."}),s.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 mt-2",children:a.customerId==="trial-user"?"Status: Active (Free Trial)":`Status: Active (${a.duration}) via ${a.provider}`})]}):s.jsxs("div",{className:"p-4 bg-slate-100 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"You are on the Free Plan"}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mt-1",children:"Enjoy the core features, supported by ads."})]}),s.jsxs("div",{className:"mt-6 space-y-3",children:[r==="free"&&s.jsx("button",{onClick:l,className:"w-full px-6 py-3 bg-yellow-400 text-yellow-900 font-bold rounded-lg hover:bg-yellow-500",children:"Upgrade to Pro"}),(a==null?void 0:a.provider)==="stripe"&&s.jsx("button",{onClick:()=>e(H.ManageSubscription),className:"w-full px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",children:"Manage Stripe Subscription"}),(a==null?void 0:a.provider)==="paypal"&&s.jsx("button",{onClick:t,className:"w-full px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600",children:"Manage PayPal Subscriptions In-App"})]})]})},yg=({showDebugConsole:e,onToggleDebugConsole:t})=>{const r=[{href:"https://github.com/centerionware/smartbillsplitter",title:"GitHub Repository",description:"View the source code, star the project, or contribute.",icon:""},{href:"https://github.com/centerionware/smartbillsplitter/issues",title:"Report an Issue / Request a Feature",description:"Found a bug or have a great idea? Let us know!",icon:""},{href:"https://github.com/centerionware/smartbillsplitter/commits/main",title:"Changelog",description:"See whats new by viewing recent commit messages.",icon:""}];return s.jsxs("div",{children:[s.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4",children:"This is an open-source project. We welcome contributions and feedback from the community."}),s.jsx("div",{className:"space-y-4",children:r.map(a=>s.jsxs("a",{href:a.href,target:"_blank",rel:"noopener noreferrer",className:"w-full text-left p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors flex items-center gap-4",children:[s.jsx("div",{className:"text-2xl",children:a.icon}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("h4",{className:"font-semibold text-slate-800 dark:text-slate-100",children:a.title}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:a.description})]}),s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400 dark:text-slate-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]},a.href))}),s.jsx("div",{className:"mt-6 pt-4 border-t border-slate-200 dark:border-slate-700",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"Debug Console"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Show the developer debug console for this session only."})]}),s.jsxs("button",{type:"button",onClick:()=>t(!e),className:`relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 dark:focus:ring-offset-slate-800 ${e?"bg-teal-600":"bg-slate-300 dark:bg-slate-600"}`,"aria-pressed":e,"aria-label":"Toggle Debug Console",children:[s.jsx("span",{className:"sr-only",children:"Toggle Debug Console"}),s.jsx("span",{className:`inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200 ${e?"translate-x-5":"translate-x-0"}`})]})]})})]})},bg=({settings:e,onSettingsChange:t,categories:r,onCategoriesChange:a})=>{const n=(i,c,d)=>{a(r.map(h=>{if(h.id===i){if(c==="budget"){const m=parseFloat(d);return{...h,budget:isNaN(m)?void 0:m}}return{...h,name:d}}return h}))},l=()=>{const i={id:`cat-new-${Date.now()}`,name:"",budget:void 0};a([...r,i])},o=(i,c)=>{a(c?r.map(d=>d.id===i?{...d,budget:void 0}:d):r.filter(d=>d.id!==i))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"totalBudget",className:"block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:"Total Monthly Budget (Optional)"}),s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500",children:"$"}),s.jsx("input",{id:"totalBudget",name:"totalBudget",type:"number",step:"0.01",value:e.totalBudget??"",onChange:i=>t({totalBudget:i.target.value===""?void 0:parseFloat(i.target.value)}),placeholder:"e.g., 2000",className:"w-full pl-7 pr-2 py-2 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 text-slate-900 dark:text-slate-100"})]}),s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Set an overall budget. If left empty, your total budget will be the sum of individual category budgets."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200",children:"Category Budgets"}),r.map(i=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"text",value:i.name,onChange:c=>n(i.id,"name",c.target.value),placeholder:"Category Name",className:"flex-grow px-3 py-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600 disabled:bg-slate-100 dark:disabled:bg-slate-600",disabled:i.isDefault}),s.jsxs("div",{className:"relative w-32",children:[s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500",children:"$"}),s.jsx("input",{type:"number",step:"0.01",value:i.budget===void 0?"":i.budget,onChange:c=>n(i.id,"budget",c.target.value),placeholder:"Budget",className:"w-full pl-7 pr-2 py-2 border border-slate-300 rounded-md focus:ring-teal-500 focus:border-teal-500 bg-white dark:bg-slate-700 dark:border-slate-600"})]}),!i.isDefault&&s.jsx("button",{onClick:()=>o(i.id,i.isDefault),className:"p-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-500 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 rounded-full flex-shrink-0","aria-label":`Delete category ${i.name}`,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},i.id)),s.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),s.jsx("span",{children:"Add New Category"})]})]})]})},kg=e=>{const{activeSection:t,onClose:r,settings:a,updateSettings:n,categories:l,saveCategories:o}=e,[i,c]=p.useState(a),[d,h]=p.useState(()=>JSON.parse(JSON.stringify(l))),[m,u]=p.useState(!1),{showNotification:f}=ut();p.useEffect(()=>{c(a),h(JSON.parse(JSON.stringify(l))),u(!1)},[a,l,t]);const g=k=>{c(N=>({...N,...k})),u(!0)},w=k=>{h(k),u(!0)},j=k=>{c(N=>({...N,paymentDetails:{...N.paymentDetails,...k}})),u(!0)},x=async()=>{const k=d.filter(N=>N.name.trim()!=="");await n(i),await o(k),f("Settings saved successfully!"),r()},v=()=>{m?e.requestConfirmation("Discard changes?","You have unsaved changes. Are you sure you want to discard them?",r,{confirmText:"Discard",confirmVariant:"danger"}):r()},y={personalization:{title:"Personalization",component:s.jsx(fg,{settings:i,onSettingsChange:g,theme:e.theme,setTheme:e.setTheme}),hasSave:!0},payments:{title:"Payment Methods",component:s.jsx(hg,{settings:i,onPaymentDetailsChange:j}),hasSave:!0},reminders:{title:"Bill Reminders",component:s.jsx(pg,{settings:i,onSettingsChange:g}),hasSave:!0},budgeting:{title:"Budgeting",component:s.jsx(bg,{settings:i,onSettingsChange:g,categories:d,onCategoriesChange:w}),hasSave:!0},data:{title:"Data & Tools",component:s.jsx(xg,{requestConfirmation:e.requestConfirmation,onOpenCsvImporter:e.onOpenCsvImporter,onOpenQrImporter:e.onOpenQrImporter,bills:e.bills,importedBills:e.importedBills})},sync:{title:"Sync Devices",component:s.jsx(gg,{onNavigate:()=>{r(),e.onNavigate(H.Sync)}})},subscription:{title:"Subscription",component:s.jsx(wg,{onNavigate:e.onNavigate,onGoToManageSubscriptionPage:()=>e.onNavigate(H.ManageSubscription)})},danger:{title:"Danger Zone",component:s.jsx(vg,{requestConfirmation:e.requestConfirmation})},about:{title:"About & Support",component:s.jsx(yg,{showDebugConsole:e.showDebugConsole,onToggleDebugConsole:e.toggleDebugConsole})},disclaimer:{title:"Disclaimer & Privacy",component:s.jsx(Fi,{})}}[t];return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:v,role:"dialog","aria-modal":"true","aria-labelledby":"settings-modal-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col max-h-[85vh]",onClick:k=>k.stopPropagation(),children:[s.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:s.jsx("h2",{id:"settings-modal-title",className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:y.title})}),s.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:y.component}),y.hasSave&&s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end gap-4 flex-shrink-0",children:[s.jsx("button",{onClick:v,className:"px-5 py-2.5 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:m?"Cancel":"Close"}),m&&s.jsx("button",{onClick:x,className:"px-5 py-2.5 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Save Changes"})]})]})})},jg=({onClose:e,onMergeBills:t,onMergeImportedBills:r,settings:a})=>{const[n,l]=p.useState("idle"),[o,i]=p.useState(null),c=p.useRef(null),{showNotification:d}=ut(),h=f=>{const g=f.target.files;g&&g.length>0&&m(Array.from(g))},m=async f=>{l("processing"),i(null);const g={ownedBills:[],importedBills:[]};for(const w of f)try{const j=await w.text();if(!j)continue;const x=await Nx(j,a.myDisplayName);g.ownedBills.push(...x.ownedBills),g.importedBills.push(...x.importedBills)}catch(j){i(`Failed to process ${w.name}: ${j.message||"An unknown error occurred."}`),l("error");return}try{const w=await t(g.ownedBills),j=await r(g.importedBills),x=w.added+j.added,v=w.updated+j.updated,b=x+v+w.skipped+j.skipped;x===0&&v===0?b>0?d("All bills in the file(s) already exist and are up-to-date.","info"):d("No valid bills could be found in the selected file(s).","info"):d(`Import complete: ${x} added, ${v} updated.`,"success"),e()}catch(w){i(`Failed to save imported data: ${w.message}`),l("error")}},u=()=>{var f;(f=c.current)==null||f.click()};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 backdrop-blur-sm",onClick:n!=="processing"?e:void 0,role:"dialog","aria-modal":"true","aria-labelledby":"csv-importer-title",children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg p-8 text-center",onClick:f=>f.stopPropagation(),children:[s.jsx("h2",{id:"csv-importer-title",className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-2",children:"Import Bills from CSV"}),n==="idle"&&s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:"Upload a CSV file and let AI automatically create your bills. For best results, use a file previously exported from this app."}),s.jsx("input",{type:"file",ref:c,onChange:h,accept:".csv,text/csv",className:"hidden",multiple:!0}),s.jsx("button",{onClick:u,className:"w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:"Select CSV File(s)"})]}),n==="processing"&&s.jsxs("div",{className:"py-8",children:[s.jsxs("svg",{className:"animate-spin h-12 w-12 text-teal-500 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Analyzing CSV, please wait..."})]}),n==="error"&&s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/40 p-4 rounded-lg my-6",children:o}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx("button",{onClick:e,className:"flex-1 px-6 py-3 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 dark:bg-slate-600 dark:text-slate-100 dark:hover:bg-slate-500",children:"Close"}),s.jsx("button",{onClick:u,className:"flex-1 px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600",children:"Try Again"})]})]})]})})},Ng=({onClose:e,onScanSuccess:t})=>{const{startScanner:r,stopScanner:a,videoRef:n,error:l}=lm(t);return p.useEffect(()=>(r(),()=>a()),[r,a]),s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex flex-col justify-center items-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"qr-scanner-title",children:s.jsxs("div",{className:"relative w-full max-w-xl bg-slate-900 rounded-lg shadow-xl overflow-hidden aspect-square",children:[s.jsx("video",{ref:n,className:"w-full h-full object-cover",playsInline:!0,autoPlay:!0,"aria-label":"Camera feed for QR code scanning"}),s.jsxs("div",{className:"absolute inset-0 flex flex-col justify-between p-4",children:[s.jsxs("div",{className:"w-full p-3 bg-black/50 rounded-lg text-white font-semibold text-center backdrop-blur-sm",children:[s.jsx("h2",{id:"qr-scanner-title",children:"Scan QR Code"}),s.jsx("p",{className:"text-sm font-normal opacity-90 mt-1",children:"Point your camera at a share QR code to import a bill."})]}),l&&s.jsxs("div",{className:"p-3 text-sm text-red-300 bg-red-800/80 rounded-md",children:[s.jsx("p",{className:"font-semibold",children:"Camera Error:"}),s.jsx("p",{children:l})]}),s.jsx("button",{onClick:e,className:"self-center px-8 py-3 bg-slate-600/70 text-white font-semibold rounded-lg text-lg backdrop-blur-sm hover:bg-slate-500/80",children:"Cancel"})]}),s.jsx("div",{className:"absolute inset-0 pointer-events-none",children:s.jsx("div",{className:"w-full h-full relative",children:s.jsxs("div",{className:"absolute w-1/2 h-1/2 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:[s.jsx("div",{className:"absolute -top-1 -left-1 w-12 h-12 border-t-4 border-l-4 border-white/80 rounded-tl-lg"}),s.jsx("div",{className:"absolute -top-1 -right-1 w-12 h-12 border-t-4 border-r-4 border-white/80 rounded-tr-lg"}),s.jsx("div",{className:"absolute -bottom-1 -left-1 w-12 h-12 border-b-4 border-l-4 border-white/80 rounded-bl-lg"}),s.jsx("div",{className:"absolute -bottom-1 -right-1 w-12 h-12 border-b-4 border-r-4 border-white/80 rounded-br-lg"})]})})})]})})},Sg=({confirmation:e,setConfirmation:t,settingsSection:r,setSettingsSection:a,isCsvImporterOpen:n,setIsCsvImporterOpen:l,isQrImporterOpen:o,setIsQrImporterOpen:i,...c})=>s.jsxs(s.Fragment,{children:[e&&s.jsx(ug,{isOpen:!0,title:e.title,message:e.message,onConfirm:()=>{e.onConfirm(),t(null)},onCancel:()=>{var d;(d=e.options)!=null&&d.onCancel&&e.options.onCancel(),t(null)},...e.options}),r&&s.jsx(kg,{activeSection:r,onClose:()=>a(null),settings:c.settings,updateSettings:c.updateSettings,categories:c.categories,saveCategories:c.saveCategories,deleteCategory:c.deleteCategory,requestConfirmation:c.requestConfirmation,onNavigate:c.navigate,theme:c.theme,setTheme:c.setTheme,onOpenCsvImporter:()=>{a(null),l(!0)},onOpenQrImporter:()=>{a(null),i(!0)},bills:c.bills,importedBills:c.importedBills,showDebugConsole:c.showDebugConsole,toggleDebugConsole:c.toggleDebugConsole}),n&&s.jsx(jg,{onClose:()=>l(!1),onMergeBills:c.mergeBills,onMergeImportedBills:c.mergeImportedBills,settings:c.settings}),o&&s.jsx(Ng,{onClose:()=>i(!1),onScanSuccess:d=>{window.location.href=d,i(!1)}})]}),Cg=()=>{const[e,t]=p.useState(!1),[r,a]=p.useState(""),n=window.self!==window.top;if(p.useEffect(()=>{if(n)try{const o=new URL("/app.html",window.location.href).href;a(o),t(!0)}catch{console.warn("Cannot construct a valid URL to open in a new tab due to sandboxing."),t(!1)}},[n]),!n)return null;const l=()=>{e&&r&&window.open(r,"_blank")};return s.jsx("div",{className:"bg-teal-50 dark:bg-teal-900/50 p-4 text-center text-sm text-teal-800 dark:text-teal-200 shadow-sm z-50",children:s.jsx("div",{className:"container mx-auto flex flex-col sm:flex-row items-center justify-center gap-3",children:e?s.jsxs(s.Fragment,{children:[s.jsx("p",{children:"For the best experience, including offline use and installation, please open this app in its own tab."}),s.jsx("button",{onClick:l,className:"bg-teal-500 text-white font-semibold px-4 py-2 rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 transition-colors duration-300 flex-shrink-0",children:"Open Fullscreen"})]}):s.jsx("p",{children:"For the best experience, please open this app's main URL in a new browser tab. This preview environment does not support opening a new tab automatically."})})})},Ig=({mode:e,setMode:t,onClear:r,isExpanded:a,onToggleExpand:n,isDevEnvironment:l})=>{var u;const[o,i]=p.useState(!1),c=p.useRef(null),d=[{id:"console",label:"Console"},{id:"network",label:"Network"},{id:"broadcast",label:"Broadcast"},{id:"database",label:"Database"}];l&&d.push({id:"dev",label:"Dev"});const h=((u=d.find(f=>f.id===e))==null?void 0:u.label)||"Console";p.useEffect(()=>{const f=g=>{c.current&&!c.current.contains(g.target)&&i(!1)};return o&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[o]);const m=f=>{t(f),i(!1)};return s.jsxs("header",{className:"flex-shrink-0 flex justify-between items-center p-2 bg-slate-800/80 dark:bg-slate-900/80 border-b border-slate-700",children:[s.jsxs("div",{className:"relative",ref:c,children:[s.jsxs("button",{onClick:()=>i(!o),className:"flex items-center gap-2 px-3 py-1 bg-slate-700 rounded-lg text-sm font-semibold text-slate-100 hover:bg-slate-600","aria-haspopup":"true","aria-expanded":o,children:[s.jsx("span",{children:h}),s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${o?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&s.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 bg-slate-800 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 py-1 z-20",children:d.map(f=>s.jsx("button",{onClick:()=>m(f.id),className:`w-full text-left px-4 py-2 text-sm ${e===f.id?"bg-teal-800/50 text-teal-300":"text-slate-200 hover:bg-slate-700"}`,children:f.label},f.id))})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:r,title:"Clear",className:"hover:text-teal-400 p-1",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),s.jsx("button",{onClick:n,title:a?"Collapse":"Expand",className:"hover:text-teal-400 p-1",children:a?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]})]})},Dg=(e,t)=>{var r;return typeof e=="object"&&e!==null?s.jsx("button",{onClick:()=>t(e),className:"bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded-md text-cyan-400 font-semibold text-left",children:((r=e.constructor)==null?void 0:r.name)||"Object"}):e===void 0?s.jsx("span",{className:"text-slate-500",children:"undefined"}):e===null?s.jsx("span",{className:"text-purple-400",children:"null"}):typeof e=="string"?s.jsxs("span",{className:"text-amber-300",children:['"',e,'"']}):typeof e=="number"?s.jsx("span",{className:"text-lime-400",children:e}):typeof e=="boolean"?s.jsx("span",{className:"text-purple-400",children:String(e)}):String(e)},Eg=e=>{switch(e){case"error":return"text-red-400 border-l-2 border-red-500";case"warn":return"text-yellow-400 border-l-2 border-yellow-500";case"info":return"text-blue-400 border-l-2 border-blue-400";default:return"text-slate-300 border-l-2 border-transparent"}},Mg=({logs:e,onExploreObject:t})=>s.jsx(s.Fragment,{children:e.map(r=>s.jsxs("div",{className:`flex gap-3 py-1 px-2 items-start ${Eg(r.level)}`,children:[s.jsx("span",{className:"text-slate-500 flex-shrink-0",children:r.timestamp}),s.jsx("div",{className:"flex-grow flex flex-wrap gap-2",children:r.args.map((a,n)=>s.jsx("div",{children:Dg(a,t)},n))})]},r.id))}),Tg=({networkLogs:e,onSelectLog:t,interceptionActive:r})=>r?e.length===0?s.jsx("div",{className:"p-4 text-center text-slate-500",children:"No network requests recorded yet."}):s.jsx(s.Fragment,{children:e.map(a=>{const n=a.ok===null?"text-slate-400":a.ok?"text-emerald-400":"text-red-400",l=a.url.split("?")[0].split("/").pop()||a.url,o=l.length>35?`...${l.slice(-32)}`:l,i=a.ok===null?"":a.ok?"":"";return s.jsxs("div",{onClick:()=>t(a),className:"flex gap-3 py-1 px-2 items-center border-b border-slate-800 hover:bg-slate-700/50 cursor-pointer",children:[s.jsx("span",{title:a.ok===!1?"Request Failed":"Success",children:i}),s.jsx("span",{className:`font-bold w-12 text-center ${n}`,children:a.status===0?"FAIL":a.status||"..."}),s.jsx("span",{className:"font-semibold text-sky-400 w-16 text-center",children:a.method}),s.jsx("span",{className:"flex-grow text-slate-300",title:a.url,children:o}),s.jsx("span",{className:"text-slate-500 flex-shrink-0",children:a.timestamp})]},a.id)})}):s.jsxs("div",{className:"p-4 text-center text-slate-400",children:[s.jsx("p",{className:"font-bold",children:"Network Interception Disabled"}),s.jsx("p",{className:"text-xs mt-2",children:"Could not attach to `window.fetch`. This can happen in sandboxed environments or due to browser security policies."})]}),im=()=>{const e=new WeakSet;return(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular Reference]";e.add(r)}return r}},Pg=e=>{if(e==null)return 4;switch(typeof e){case"string":return e.length*2;case"number":return 8;case"boolean":return 4;case"object":try{return JSON.stringify(e,im()).length}catch{return 0}default:return 0}},Bg=e=>{if(e===0)return"0 B";const t=1024,r=["B","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+r[a]},zr=p.memo(({data:e,name:t,path:r})=>{const[a,n]=p.useState(!1),[l,o]=p.useState(!1),i=g=>typeof CryptoKey<"u"&&g instanceof CryptoKey,c=g=>typeof CryptoKey<"u"&&g&&g.publicKey instanceof CryptoKey&&g.privateKey instanceof CryptoKey;let d=e;i(e)?d={$$typeof:"CryptoKey",type:e.type,extractable:e.extractable,algorithm:e.algorithm,usages:e.usages}:c(e)&&(d={$$typeof:"CryptoKeyPair",publicKey:e.publicKey,privateKey:e.privateKey});const h=typeof d=="object"&&d!==null&&Object.keys(d).length>0,m=d===null?"null":Array.isArray(d)?"array":typeof d,u=Pg(d),f=()=>h?null:typeof d=="string"&&d.length>200?`"${d.substring(0,200)}..."`:JSON.stringify(d,im(),2);return s.jsxs("div",{className:"ml-4 pl-2 border-l border-slate-700",children:[s.jsxs("div",{className:"flex items-center gap-2 py-0.5",children:[h?s.jsx("button",{onClick:()=>n(!a),className:"text-slate-500",children:a?"":""}):s.jsx("div",{className:"w-4"}),s.jsxs("span",{className:"text-purple-400",children:[t,":"]}),s.jsxs("span",{className:"text-xs text-slate-500",children:["(",m,", ",Bg(u),")"]}),!h&&s.jsx("button",{onClick:()=>o(!l),className:"text-cyan-400 text-xs",children:"[view]"})]}),l&&!h&&s.jsx("pre",{className:"text-amber-300 ml-6 bg-slate-800 p-1 rounded-md text-xs whitespace-pre-wrap break-all",children:f()}),a&&h&&s.jsx("div",{children:Object.entries(d).map(([g,w])=>s.jsx(zr,{data:w,name:g,path:`${r}.${g}`},`${r}.${g}`))})]})}),Lg=({data:e,onClose:t})=>s.jsx("div",{className:"absolute inset-0 bg-slate-900/80 z-20 flex justify-center items-center",onClick:t,children:s.jsxs("div",{className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-2xl flex flex-col max-h-[80vh]",onClick:r=>r.stopPropagation(),children:[s.jsxs("header",{className:"flex justify-between items-center p-4 border-b border-slate-700",children:[s.jsx("h2",{className:"font-bold text-lg text-slate-100",children:"Object Explorer"}),s.jsx("button",{onClick:t,className:"p-1 hover:bg-slate-700 rounded-full text-2xl leading-none",children:""})]}),s.jsx("div",{className:"p-4 overflow-auto",children:s.jsx(zr,{data:e,name:"(root)",path:"root"})})]})}),Rg=({log:e})=>{const[t,r]=p.useState("Verifying...");return p.useEffect(()=>{(async()=>{const n=e.data;if(!n||typeof n.payload!="object"||typeof n.signature!="string"){r({error:"Malformed or unsigned message."});return}try{const l=await nl();if(!(l!=null&&l.publicKey)){r({error:"Public key not found."});return}const o=JSON.stringify(n.payload),i=await ba(o,n.signature,l.publicKey);r(i?n.payload:{error:"INVALID SIGNATURE"})}catch(l){r({error:l.message})}})()},[e]),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4 border-t border-slate-700 py-2",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-slate-400 mb-2",children:"Raw Signed Message"}),s.jsx("div",{className:"bg-slate-800 p-2 rounded-md",children:s.jsx(zr,{data:e.data,name:"(root)",path:`raw-${e.id}`})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-slate-400 mb-2",children:"Verification Result"}),s.jsx("div",{className:"bg-slate-800 p-2 rounded-md",children:s.jsx(zr,{data:t,name:"(root)",path:`verified-${e.id}`})})]})]})},Ag=({logs:e})=>s.jsx("div",{className:"space-y-2",children:e.map(t=>s.jsxs("div",{className:"flex gap-3 items-start",children:[s.jsx("span",{className:"text-slate-500 flex-shrink-0",children:t.timestamp}),s.jsx("div",{className:"flex-grow",children:s.jsx(Rg,{log:t})})]},t.id))}),Og=()=>{const[e,t]=p.useState(null),[r,a]=p.useState(null),[n,l]=p.useState(!1),[o,i]=p.useState(null),c=p.useCallback(async()=>{l(!0),i(null);try{const d=await mp();t(d),!r&&d&&Object.keys(d).length>0?a(Object.keys(d)[0]):r&&d&&!d[r]&&a(Object.keys(d)[0]||null)}catch(d){i(d.message||"Failed to load database.")}finally{l(!1)}},[r]);return p.useEffect(()=>{c()},[]),s.jsxs("div",{className:"flex h-full",children:[s.jsxs("div",{className:"w-1/3 border-r border-slate-700 p-2 overflow-y-auto",children:[s.jsx("button",{onClick:c,disabled:n,className:"w-full mb-2 p-2 bg-slate-700 hover:bg-slate-600 rounded-md",children:n?"Refreshing...":"Refresh DB"}),o&&s.jsx("p",{className:"text-red-400 text-xs",children:o}),e&&Object.keys(e).sort().map(d=>s.jsxs("button",{onClick:()=>a(d),className:`w-full text-left p-2 rounded-md ${r===d?"bg-teal-800/50":"hover:bg-slate-700"}`,children:[d," (",e[d].length,")"]},d))]}),s.jsx("div",{className:"w-2/3 p-2 overflow-y-auto",children:r&&e&&e[r]?s.jsx(zr,{data:e[r],name:r,path:r}):s.jsx("p",{className:"text-slate-500",children:"Select a store to view its contents."})})]})},zg=()=>{const{subscriptionStatus:e,subscriptionDetails:t,login:r,selectFreeTier:a,logout:n,startTrial:l}=Ma(),o=()=>{a()},i=()=>{r({provider:"paypal",duration:"yearly",customerId:"dev-pro-user",subscriptionId:"dev-pro-sub"})},c=()=>{n(),setTimeout(()=>{l()},100)},d=()=>{n()};return s.jsxs("div",{className:"p-4 text-slate-300",children:[s.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-100",children:"Auth State Override"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("p",{children:["Current Status: ",s.jsx("span",{className:"font-bold text-teal-400",children:e||"None (Paywall)"})]}),s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsx("button",{onClick:i,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md",children:"Set to Pro"}),s.jsx("button",{onClick:o,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md",children:"Set to Free (Ads)"}),s.jsx("button",{onClick:c,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-md",children:"Reset to Trial"}),s.jsx("button",{onClick:d,className:"px-4 py-2 bg-red-800/80 hover:bg-red-700/80 rounded-md",children:"Logout (Show Paywall)"})]}),t&&s.jsxs("div",{className:"mt-4 text-xs",children:[s.jsx("p",{children:"Details:"}),s.jsx("pre",{className:"bg-slate-900 p-2 rounded mt-1 whitespace-pre-wrap",children:JSON.stringify(t,null,2)})]})]})]})},$g=({log:e,onBack:t})=>{const[r,a]=p.useState("responseBody"),n=i=>{if(i==null)return s.jsx("span",{className:"text-slate-500",children:"Empty"});if(typeof i=="string"&&i.startsWith("["))try{const c=JSON.parse(i);return s.jsx(zr,{data:c,name:"(root)",path:"root"})}catch{return s.jsx("pre",{className:"whitespace-pre-wrap break-all",children:i})}return typeof i=="object"?s.jsx(zr,{data:i,name:"(root)",path:"root"}):s.jsx("pre",{className:"whitespace-pre-wrap break-all",children:String(i)})},l=i=>Object.keys(i).length===0?s.jsx("span",{className:"text-slate-500",children:"No Headers"}):s.jsx("div",{className:"space-y-1",children:Object.entries(i).map(([c,d])=>s.jsxs("div",{className:"flex",children:[s.jsxs("span",{className:"text-purple-400 w-48 flex-shrink-0",children:[c,":"]}),s.jsx("span",{className:"text-slate-300 break-all",children:d})]},c))}),o=i=>`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${r===i?"bg-slate-800 shadow text-teal-400":"text-slate-300"}`;return s.jsxs("div",{className:"p-2",children:[s.jsx("button",{onClick:t,className:"flex items-center gap-2 mb-4 text-teal-400 font-semibold",children:" Back to Network List"}),s.jsxs("div",{className:"p-2 bg-slate-800 rounded-lg",children:[s.jsxs("p",{className:"font-bold break-all",children:[e.method," ",e.url]}),s.jsxs("p",{className:`font-bold ${e.ok?"text-emerald-400":"text-red-400"}`,children:["Status: ",e.status]})]}),s.jsxs("div",{className:"my-4 flex items-center space-x-1 bg-slate-700 p-1 rounded-lg self-start",children:[s.jsx("button",{onClick:()=>a("responseBody"),className:o("responseBody"),children:"Response Body"}),s.jsx("button",{onClick:()=>a("requestBody"),className:o("requestBody"),children:"Request Body"}),s.jsx("button",{onClick:()=>a("responseHeaders"),className:o("responseHeaders"),children:"Response Headers"}),s.jsx("button",{onClick:()=>a("requestHeaders"),className:o("requestHeaders"),children:"Request Headers"})]}),s.jsxs("div",{className:"p-2 bg-slate-800/50 rounded-lg overflow-x-auto",children:[r==="responseBody"&&n(e.responseBody),r==="requestBody"&&n(e.requestBody),r==="responseHeaders"&&l(e.responseHeaders),r==="requestHeaders"&&l(e.requestHeaders)]})]})};let zl=!1;const _g=()=>{const[e,t]=p.useState([]),[r,a]=p.useState([]),[n,l]=p.useState([]),[o,i]=p.useState(!0),c=p.useCallback((w,j)=>{zl||(zl=!0,t(x=>[...x,{id:x.length,level:w,timestamp:new Date().toLocaleTimeString(),args:j}]),zl=!1)},[]),d=p.useCallback(w=>{a(j=>[...j,{...w,id:j.length}])},[]),h=p.useCallback((w,j)=>{a(x=>x.map(v=>v.id===w?{...v,...j}:v))},[]),m=p.useCallback(w=>{l(j=>[...j,{id:j.length,timestamp:new Date().toLocaleTimeString(),data:w}])},[]),u=p.useCallback(()=>t([]),[]),f=p.useCallback(()=>a([]),[]),g=p.useCallback(()=>l([]),[]);return p.useEffect(()=>{const w={...console},j=x=>(...v)=>{c(x,v),w[x](...v)};return console.log=j("log"),console.warn=j("warn"),console.error=j("error"),console.info=j("info"),console.debug=j("debug"),()=>{Object.assign(console,w)}},[c]),p.useEffect(()=>{if(typeof window.fetch!="function"){i(!1);return}const w=window.fetch;let j=0;return window.fetch=async(x,v)=>{const b=j++,y=new Request(x,v);let k=null;if(y.body)try{k=await y.clone().json()}catch{try{k=await y.clone().text()}catch{k="[Could not read body]"}}a(N=>[...N,{id:b,url:y.url,method:y.method,status:null,ok:null,timestamp:new Date().toLocaleTimeString(),requestHeaders:Object.fromEntries(y.headers.entries()),requestBody:k,responseHeaders:{},responseBody:null}]);try{const N=await w(y),S=N.clone();let D=null;try{D=await S.json()}catch{try{D=await S.text()}catch{D="[Could not read body]"}}return h(b,{status:N.status,ok:N.ok,responseHeaders:Object.fromEntries(N.headers.entries()),responseBody:D}),N}catch(N){throw h(b,{status:0,ok:!1,responseBody:N}),N}},()=>{window.fetch=w}},[d,h]),p.useEffect(()=>{if(typeof BroadcastChannel>"u")return;const w=BroadcastChannel.prototype.postMessage;return BroadcastChannel.prototype.postMessage=function(j){return m(j),w.apply(this,[j])},()=>{BroadcastChannel.prototype.postMessage=w}},[m]),{logs:e,networkLogs:r,broadcastLogs:n,clearLogs:u,clearNetworkLogs:f,clearBroadcastLogs:g,networkInterceptionActive:o}},Fg=({isDevEnvironment:e})=>{const{logs:t,networkLogs:r,broadcastLogs:a,clearLogs:n,clearNetworkLogs:l,clearBroadcastLogs:o,networkInterceptionActive:i}=_g(),[c,d]=p.useState("console"),[h,m]=p.useState(!1),[u,f]=p.useState(null),[g,w]=p.useState(null),j=p.useRef(null);p.useEffect(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)},[t,r,a,c,u,h]);const x=()=>{switch(c){case"console":n();break;case"network":l(),f(null);break;case"broadcast":o();break}},v=()=>{switch(c){case"console":return s.jsx(Mg,{logs:t,onExploreObject:w});case"network":return u?s.jsx($g,{log:u,onBack:()=>f(null)}):s.jsx(Tg,{networkLogs:r,onSelectLog:f,interceptionActive:i});case"broadcast":return s.jsx(Ag,{logs:a});case"database":return s.jsx(Og,{});case"dev":return s.jsx(zg,{});default:return null}};return s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-900/90 dark:bg-black/90 backdrop-blur-sm text-white font-mono text-sm z-[100] transition-all duration-300 ease-in-out",style:{height:h?"80vh":"10vh"},children:[s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsx(Ig,{mode:c,setMode:b=>{d(b),f(null)},onClear:x,isExpanded:h,onToggleExpand:()=>m(!h),isDevEnvironment:e}),s.jsx("div",{ref:j,className:"flex-grow p-2 overflow-auto",children:v()})]}),g&&s.jsx(Lg,{data:g,onClose:()=>w(null)})]})},gd=12,Hs=16,Ug=({targetSelector:e,title:t,description:r,buttonText:a="Got It!",placement:n="bottom",onClose:l})=>{const[o,i]=p.useState(null),c=p.useRef(null),[d,h]=p.useState({popover:{opacity:0},arrow:{}});if(p.useLayoutEffect(()=>{const u=()=>{const f=document.querySelector(e);f?i(f.getBoundingClientRect()):(console.warn(`Tutorial target selector "${e}" not found.`),i(null))};return u(),window.addEventListener("resize",u),window.addEventListener("scroll",u,!0),()=>{window.removeEventListener("resize",u),window.removeEventListener("scroll",u,!0)}},[e]),p.useLayoutEffect(()=>{if(o&&c.current){const f=c.current.getBoundingClientRect(),g={opacity:1,transition:"top 0.2s ease-out, left 0.2s ease-out, opacity 0.2s ease-in"},w={},j=o.left+o.width/2;switch(n){case"bottom":{let x=j-f.width/2;x<Hs?x=Hs:x+f.width>window.innerWidth-Hs&&(x=window.innerWidth-Hs-f.width),g.top=`${o.bottom+gd+Hs}px`,g.left=`${x}px`,w.bottom="100%",w.left=`${j-x}px`,w.transform="translateX(-50%)";break}}h({popover:g,arrow:w})}else h({popover:{opacity:0},arrow:{}})},[o,n]),!o)return null;const m={bottom:"border-b-white dark:border-b-slate-800",top:"border-t-white dark:border-t-slate-800",left:"border-l-white dark:border-l-slate-800",right:"border-r-white dark:border-r-slate-800"}[n];return s.jsxs("div",{className:"fixed inset-0 bg-black/80 z-[100] animate-fade-in",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"tutorial-title",children:[s.jsx("div",{className:"absolute rounded-lg pointer-events-none animate-pulse-glow border-2 border-white/50",style:{top:`${o.top-4}px`,left:`${o.left-4}px`,width:`${o.width+8}px`,height:`${o.height+8}px`,transition:"all 0.2s ease-out"}}),s.jsxs("div",{ref:c,className:"absolute max-w-sm bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 text-center",style:d.popover,onClick:u=>u.stopPropagation(),children:[s.jsx("div",{className:`absolute w-0 h-0 border-solid border-transparent ${m}`,style:{...d.arrow,borderWidth:`${gd}px`}}),s.jsx("h2",{id:"tutorial-title",className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:t}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2 mb-6",children:r}),s.jsx("button",{onClick:l,className:"w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 transition-colors",children:a})]})]})},Vg=({dashboardView:e,selectedParticipant:t})=>{const[r,a]=p.useState(!1);p.useEffect(()=>{if(e==="bills"&&!t&&!localStorage.getItem("sharedbills.tutorialCompleted")){const o=setTimeout(()=>a(!0),500);return()=>clearTimeout(o)}},[e,t]);const n=p.useCallback(()=>{localStorage.setItem("sharedbills.tutorialCompleted","true"),a(!1)},[]);return r?s.jsx(Ug,{targetSelector:"#create-new-bill-button",title:"Welcome!",description:"To get started, tap the plus button to create your first bill.",buttonText:"Got It!",onClose:n,placement:"bottom"}):null},Hg=()=>{const e=Kp(),[t,r]=p.useState(null);return p.useEffect(()=>{(async()=>{const n=await Bp();if(n==="")r(!0);else if(n)try{const l=new URL(n).hostname,o=window.location.hostname;r(l===o)}catch{r(!1)}else r(!1)})()},[]),s.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 font-sans text-slate-900 dark:text-slate-100 flex flex-col",children:[s.jsx(Cg,{}),s.jsx(Gp,{navigate:e.navigate,onOpenSettings:e.setSettingsSection,currentView:e.view,canInstall:e.canInstall,promptInstall:e.promptInstall}),s.jsx("main",{className:"flex-grow container mx-auto p-4 sm:p-6 lg:p-8",children:s.jsx(dg,{...e})}),s.jsx(Sg,{...e}),e.showDebugConsole&&t!==null&&s.jsx(Fg,{isDevEnvironment:t}),e.view===H.Dashboard&&s.jsx(Vg,{dashboardView:e.dashboardView,selectedParticipant:e.selectedParticipant})]})},Wg=({onContinue:e,onCancel:t})=>{const[r,a]=p.useState(7);return p.useEffect(()=>{if(r>0){const n=setTimeout(()=>a(r-1),1e3);return()=>clearTimeout(n)}},[r]),s.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-80 z-50 flex justify-center items-center p-4 backdrop-blur-sm",role:"alertdialog","aria-modal":"true","aria-labelledby":"dialog-title","aria-describedby":"dialog-description",onClick:t,children:s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-lg p-8",onClick:n=>n.stopPropagation(),children:[s.jsx("h2",{id:"dialog-title",className:"text-2xl font-bold text-slate-800 dark:text-slate-100 text-center mb-4",children:"A Quick Heads-Up Before You Subscribe"}),s.jsxs("div",{id:"dialog-description",className:"space-y-4 text-slate-600 dark:text-slate-300",children:[s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"1. Manage Your Subscription via PayPal"}),s.jsx("p",{className:"text-sm mt-1",children:"Your Pro subscription is managed directly through your PayPal account. This means you have full control and can view or cancel your subscription at any time by logging into PayPal, even if you lose access to this device."})]}),s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"2. Your Data Lives On Your Device"}),s.jsx("p",{className:"text-sm mt-1",children:"For your privacy, all your bill data is stored locally. This means there is no automatic cloud backup. If you change or lose your device, your data will be lost unless you use the 'Export Data' or 'Sync Devices' feature regularly."})]}),s.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"3. Help Us Grow!"}),s.jsx("p",{className:"text-sm mt-1",children:"This is a one-man show, and your subscription directly supports development. An automatic cloud sync feature is on our roadmap, but we need enough Pro subscribers to make it happen. Thank you for your support!"})]})]}),s.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row justify-end sm:space-x-4 gap-3 sm:gap-0",children:[s.jsx("button",{onClick:t,className:"w-full sm:w-auto order-2 sm:order-1 px-6 py-3 bg-slate-100 text-slate-800 font-semibold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:e,disabled:r>0,className:"w-full sm:w-auto order-1 sm:order-2 px-6 py-3 font-bold rounded-lg transition-colors bg-teal-500 text-white hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 disabled:bg-slate-400 dark:disabled:bg-slate-600 disabled:cursor-not-allowed",children:r>0?`Please Read... (${r}s)`:"Continue to Checkout"})]})]})})},Kg=({onSelectFreeTier:e,initialError:t})=>{const[r,a]=p.useState(null),[n,l]=p.useState(t||null),[o,i]=p.useState(null),c=u=>{i(u)},d=async u=>{i(null),l(null),a(u);try{const f=window.location.origin,g=await de(await ce("/create-checkout-session"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:u,origin:f})}),w=await g.json();if(!g.ok)throw new Error(w.error||"Failed to create a checkout session.");if(w.url)window.location.href=w.url;else throw new Error("No checkout URL returned from the server.")}catch(f){console.error("Checkout error:",f),l(f.message||"An unknown error occurred. Please try again."),a(null)}},h=(u,f)=>{(u.key==="Enter"||u.key===" ")&&!r&&(u.preventDefault(),c(f))},m=()=>s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{onClick:()=>!r&&c("monthly"),onKeyDown:f=>h(f,"monthly"),role:"button",tabIndex:r?-1:0,className:`p-5 border border-slate-200 dark:border-slate-700 rounded-lg text-left flex items-center transition-all duration-300 ${r?"opacity-50 cursor-not-allowed":"cursor-pointer hover:shadow-lg hover:border-teal-600 dark:hover:border-teal-500 hover:-translate-y-1"}`,"aria-disabled":!!r,children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"Monthly Plan"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Billed every month."})]}),r==="monthly"?s.jsxs("svg",{className:"animate-spin h-6 w-6 text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):s.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-50",children:["$1",s.jsx("span",{className:"text-base font-normal text-slate-500 dark:text-slate-400",children:"/mo"})]})]}),s.jsxs("div",{onClick:()=>!r&&c("yearly"),onKeyDown:f=>h(f,"yearly"),role:"button",tabIndex:r?-1:0,className:`relative p-5 border-2 rounded-lg text-left flex items-center transition-all duration-300 ${r?"opacity-50 cursor-not-allowed border-slate-300 dark:border-slate-600":"cursor-pointer hover:shadow-lg hover:-translate-y-1 border-teal-500"}`,"aria-disabled":!!r,children:[s.jsx("div",{className:"absolute -top-3.5 left-1/2 -translate-x-1/2 bg-teal-500 text-white text-xs font-semibold px-3 py-1 rounded-full",children:"BEST VALUE"}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"Yearly Plan"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Save 17% with annual billing."})]}),r==="yearly"?s.jsxs("svg",{className:"animate-spin h-6 w-6 text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):s.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-50",children:["$10",s.jsx("span",{className:"text-base font-normal text-slate-500 dark:text-slate-400",children:"/yr"})]})]})]}),s.jsxs("p",{className:"mt-4 text-center text-xs text-slate-500 dark:text-slate-400",children:["Payment processing is handled securely by ","PayPal","."]})]});return s.jsxs(s.Fragment,{children:[o&&s.jsx(Wg,{onCancel:()=>i(null),onContinue:()=>d(o)}),s.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-center p-4",children:s.jsxs("div",{className:"w-full max-w-md mx-auto bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("svg",{className:"h-12 w-12 mx-auto text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),s.jsx("h2",{className:"text-3xl font-bold text-slate-800 dark:text-slate-100 mt-4",children:"Upgrade to Pro"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:"Unlock unlimited features and remove ads."})]}),n&&s.jsxs("div",{className:"mb-6 p-3 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-900/40 dark:text-red-300",role:"alert",children:[s.jsx("span",{className:"font-medium",children:"Oops!"})," ",n]}),m(),s.jsxs("div",{className:"relative flex py-4 items-center",children:[s.jsx("div",{className:"flex-grow border-t border-slate-200 dark:border-slate-700"}),s.jsx("span",{className:"flex-shrink mx-4 text-slate-400 dark:text-slate-500 text-xs uppercase font-semibold",children:"Or"}),s.jsx("div",{className:"flex-grow border-t border-slate-200 dark:border-slate-700"})]}),s.jsx("div",{className:"text-center",children:s.jsx("button",{onClick:e,className:"w-full px-6 py-3 bg-slate-100 text-slate-800 font-bold rounded-lg hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 transition-colors",children:"Continue with the free, ad-supported version"})})]})})]})},Gg=()=>{const{subscriptionStatus:e,login:t,selectFreeTier:r,isLoading:a,startTrial:n}=Ma(),[l,o]=p.useState(!1),[i,c]=p.useState(null),[d,h]=p.useState(()=>localStorage.getItem("privacyConsentAccepted")==="true");p.useEffect(()=>{(async()=>{const g=new URLSearchParams(window.location.search),w=g.get("session_id"),j=g.get("subscription_id");let x=null,v=null;if(w?(x="stripe",v=w):j&&(x="paypal",v=j),x&&v){o(!0),c(null);try{const b=await de(await ce("/verify-payment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:x,sessionId:v})}),y=await b.json();if(!b.ok)throw new Error(y.error||"Failed to verify payment session.");if(y.status==="success"){await t({provider:y.provider,duration:y.duration,customerId:y.customerId,subscriptionId:y.subscriptionId}),window.location.href="/app.html";return}else throw new Error("Payment verification was not successful.")}catch(b){console.error("Payment verification failed:",b),c(b.message),window.history.replaceState({},document.title,window.location.pathname),o(!1)}}})()},[t]);const m=()=>{localStorage.setItem("privacyConsentAccepted","true"),h(!0),n()},u=()=>s.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-center text-center p-4",children:[s.jsxs("svg",{className:"animate-spin h-10 w-10 text-teal-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s.jsx("h1",{className:"text-2xl font-semibold text-slate-700 dark:text-slate-200",children:l?"Verifying your payment...":"Loading..."})]});return d?a||l?s.jsx(u,{}):e?s.jsx(Hg,{}):s.jsx(Kg,{onSelectFreeTier:r,initialError:i??void 0}):s.jsx(om,{onAccept:m})};class Yg extends _n.Component{constructor(){super(...arguments);Ba(this,"state",{hasError:!1,error:null});Ba(this,"handleReset",()=>{window.location.reload()});Ba(this,"handleHardReset",()=>{console.warn("Performing hard reset from Error Boundary."),Ia();const r=indexedDB.deleteDatabase("SmartBillSplitterDB");r.onsuccess=()=>{console.log("Database deleted successfully."),localStorage.clear(),sessionStorage.clear(),window.location.reload()},r.onerror=a=>{console.error("Error deleting database:",a),alert("Could not delete the database. Please clear your browser's site data manually through the browser settings.")},r.onblocked=()=>{alert("Database is locked, likely by another open tab. To reset the app, please close all other tabs for this site and then reload this page to try again.")}})}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){console.error("Uncaught error:",r,a)}render(){var r,a,n;return this.state.hasError?s.jsx("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-900 flex items-center justify-center p-4",children:s.jsxs("div",{className:"w-full max-w-lg mx-auto bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 text-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mt-4",children:"Something went wrong."}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2 mb-6",children:"The application has encountered an unexpected error. You can try to recover or reset the application data if the problem persists."}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("button",{onClick:this.handleReset,className:"w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600",children:"Reload App"}),s.jsx("button",{onClick:this.handleHardReset,className:"w-full px-6 py-3 bg-red-100 text-red-800 font-bold rounded-lg hover:bg-red-200 dark:bg-red-900/40 dark:text-red-300 dark:hover:bg-red-900/60",children:"Hard Reset App Data"})]}),s.jsxs("details",{className:"mt-4 text-left text-xs text-slate-400 dark:text-slate-500",children:[s.jsx("summary",{className:"cursor-pointer",children:"Error Details"}),s.jsx("pre",{className:"mt-2 p-2 bg-slate-100 dark:bg-slate-700 rounded overflow-auto whitespace-pre-wrap",children:s.jsxs("code",{children:[(r=this.state.error)==null?void 0:r.name,": ",(a=this.state.error)==null?void 0:a.message,"\\n\\n",(n=this.state.error)==null?void 0:n.stack]})})]})]})}):this.props.children}}const Jg="SmartBillSplitterDB",$l=e=>{var r,a;const t=document.getElementById("root");t&&(t.innerHTML=`
    <div class="min-h-screen bg-slate-100 dark:bg-slate-900 flex items-center justify-center p-4 font-sans">
      <div class="w-full max-w-lg mx-auto bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
        </svg>
        <h1 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mt-4">Oops! Something went wrong.</h1>
        <p class="text-slate-500 dark:text-slate-400 mt-2 mb-6">
          The application encountered a critical problem during startup.
        </p>
        <div id="fallback-message-container" class="mb-4 text-left"></div>
        <div class="space-y-4">
          <button id="fallback-reload-btn" class="w-full px-6 py-3 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600">
            Reload App
          </button>
          <button id="fallback-reset-btn" class="w-full px-6 py-3 bg-red-100 text-red-800 font-bold rounded-lg hover:bg-red-200 dark:bg-red-900/40 dark:text-red-300 dark:hover:bg-red-900/60">
            Hard Reset & Reload
          </button>
          <p class="text-xs text-slate-500 dark:text-slate-400">
            <span class="font-semibold">Warning:</span> Hard reset will permanently delete all app data from this device.
          </p>
        </div>
        <details class="mt-4 text-left text-xs text-slate-400 dark:text-slate-500">
          <summary class="cursor-pointer">Error Details</summary>
          <pre class="mt-2 p-2 bg-slate-100 dark:bg-slate-700 rounded overflow-auto whitespace-pre-wrap">
            <code>${e.name}: ${e.message}

${e.stack}</code>
          </pre>
        </details>
      </div>
    </div>
  `,(r=document.getElementById("fallback-reload-btn"))==null||r.addEventListener("click",()=>{window.location.reload()}),(a=document.getElementById("fallback-reset-btn"))==null||a.addEventListener("click",()=>{const n=document.getElementById("fallback-message-container");n&&(n.innerHTML=""),console.warn("Performing hard reset from fallback UI."),Ia();const l=indexedDB.deleteDatabase(Jg);l.onsuccess=()=>{console.log("Database deleted successfully."),localStorage.clear(),sessionStorage.clear(),window.location.reload()},l.onerror=()=>{n?n.innerHTML=`
          <div class="p-4 bg-red-100 dark:bg-red-900/40 border-l-4 border-red-500 rounded-r-lg">
              <h4 class="font-bold text-red-800 dark:text-red-200">Reset Failed</h4>
              <p class="text-sm text-red-700 dark:text-red-300 mt-1">
                  Could not delete the database. Please clear your browser's site data manually through the browser settings.
              </p>
          </div>
        `:alert("Could not delete the database. Please clear your browser's site data manually.")},l.onblocked=()=>{n?n.innerHTML=`
          <div class="p-4 bg-yellow-100 dark:bg-yellow-900/40 border-l-4 border-yellow-500 rounded-r-lg">
              <h4 class="font-bold text-yellow-800 dark:text-yellow-200">Action Required</h4>
              <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
                  Database is locked, likely by another open tab. To reset the app, please close all other tabs for this site and then click "Hard Reset" again.
              </p>
          </div>
        `:alert("Database is locked, likely by another open tab. To reset the app, please close all other tabs for this site and then reload this page to try again.")}}))};try{const e=document.getElementById("root");if(!e)console.error("React app script loaded on a page without a '#root' element. App will not mount. This is expected if you are on the landing page.");else{e.innerHTML=`
        <div class="min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-center text-center p-4 font-sans">
          <svg class="animate-spin h-10 w-10 text-teal-500 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <h1 class="text-2xl font-semibold text-slate-700 dark:text-slate-200">Initializing App...</h1>
          <div id="loading-warning" class="mt-4 w-full max-w-md"></div>
        </div>
      `;const t=setTimeout(()=>{const n=document.getElementById("loading-warning");n&&(n.innerHTML=`
                <div class="p-4 bg-yellow-100 dark:bg-yellow-900/40 border-l-4 border-yellow-500 rounded-r-lg text-left">
                    <h4 class="font-bold text-yellow-800 dark:text-yellow-200">Still Loading?</h4>
                    <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
                        This is taking longer than usual. If you have this app open in other browser tabs, closing them may help speed things up.
                    </p>
                </div>
              `)},3e3),r=()=>{const[n,l]=p.useState(null),[o,i]=p.useState(!1),[c,d]=p.useState(!1),[h,m]=p.useState(!1),u=p.useRef(null),f=p.useCallback(()=>{o||c||(i(!0),setTimeout(()=>{window.location.reload()},4e3))},[o,c]);p.useEffect(()=>{if(!("serviceWorker"in navigator))return;navigator.serviceWorker.ready.then(N=>{N.addEventListener("updatefound",()=>{const S=N.installing;S&&(console.log("Service Worker: New version found, installing."),S.addEventListener("statechange",()=>{S.state==="installed"&&navigator.serviceWorker.controller&&(console.log("Service Worker: New version installed and waiting."),u.current=S,m(!0))}))})});let k=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{k||(console.log("Service Worker: Controller changed, reloading page."),window.location.reload(),k=!0)})},[]);const g=()=>{u.current&&(u.current.postMessage({type:"SKIP_WAITING"}),m(!1))};p.useEffect(()=>(window.addEventListener("db-versionchange",f),()=>{window.removeEventListener("db-versionchange",f)}),[f]),pr(p.useCallback(y=>{y.type==="db-close-request"?(console.log("Received request to close DB connection for migration."),Ia(),d(!0)):y.type==="db-migration-complete"&&c&&(console.log("Migration complete in another tab. Reloading now."),window.location.reload())},[c])),p.useEffect(()=>{if(n){const y=setTimeout(()=>l(null),5e3);return()=>clearTimeout(y)}},[n]);const w=()=>{window.history.replaceState(null,"","/app.html"),window.location.reload()},j=(y,k="success")=>{l({message:y,type:k})},x=y=>{switch(y){case"error":return"bg-red-600 text-white";case"info":return"bg-blue-600 text-white";case"success":default:return"bg-teal-500 text-white"}},v=y=>{switch(y){case"error":return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})});case"info":return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})});case"success":default:return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}},b=({title:y,message:k,showSpinner:N})=>s.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-80 z-[100] flex justify-center items-center p-4 font-sans backdrop-blur-sm",children:s.jsxs("div",{className:"w-full max-w-md mx-auto bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 text-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-teal-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5M4 18v-5h5m10-4h5v5h-5M14 18h5v-5h-5"})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mt-4",children:y}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2 mb-6",children:k}),N&&s.jsx("div",{className:"flex justify-center items-center",children:s.jsxs("svg",{className:"animate-spin h-6 w-6 text-teal-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]})});return o?s.jsx(b,{title:"App Update Required",message:"A new version of the app is running in another tab. This page will reload automatically to apply the update.",showSpinner:!0}):c?s.jsx(b,{title:"Applying App Update...",message:"Please wait while the update finishes in another tab. This page will reload automatically.",showSpinner:!0}):s.jsxs(G0.Provider,{value:{reloadApp:w,showNotification:j},children:[h&&s.jsxs("div",{role:"alert",className:"fixed bottom-4 left-1/2 -translate-x-1/2 w-full max-w-md z-[60] bg-slate-800 text-white rounded-lg shadow-2xl p-4 flex items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-teal-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("p",{className:"font-bold",children:"Update Available"}),s.jsx("p",{className:"text-sm text-slate-300",children:"A new version of the app is ready."})]})]}),s.jsx("button",{onClick:g,className:"px-4 py-2 bg-teal-500 text-white font-bold rounded-lg hover:bg-teal-600 flex-shrink-0",children:"Refresh"})]}),s.jsx("div",{className:"fixed top-0 left-0 right-0 z-[60] flex justify-center pointer-events-none",children:s.jsx("div",{className:`transition-all duration-500 ease-in-out mt-4 px-6 py-3 rounded-lg shadow-lg ${n?"translate-y-0 opacity-100":"-translate-y-20 opacity-0"} ${n?x(n.type):""}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[n&&v(n.type),s.jsx("span",{className:"font-semibold",children:n==null?void 0:n.message})]})})}),s.jsx(fp,{children:s.jsx(Gg,{})})]})};(async()=>{_i(),await Xh()})().then(()=>{clearTimeout(t),e.innerHTML="",_l.createRoot(e).render(s.jsx(_n.StrictMode,{children:s.jsx(Yg,{children:s.jsx(r,{})})}))}).catch(n=>{clearTimeout(t),console.error("Failed to initialize the application.",n),$l(n)})}}catch(e){console.error("A catastrophic error occurred during app startup:",e),e instanceof Error?$l(e):$l(new Error("An unknown error occurred."))}
//# sourceMappingURL=app-DTLf6lKU.js.map
