# Use a lightweight Node.js image
FROM node:20-alpine

WORKDIR /app

# Copy package files from the pre-built artifact directory
# The CI job places these artifacts in the `backend-dist` directory in the context.
COPY backend-dist/package*.json ./

# Install only production dependencies for a smaller, more secure image
RUN npm install --production

# Copy the compiled server code from the pre-built artifact directory
COPY backend-dist/dist-server ./dist-server

# Expose the port the server listens on
EXPOSE 3000

# Start the server
CMD ["node", "dist-server/server.js"]
